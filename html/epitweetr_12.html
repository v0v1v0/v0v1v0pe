<div class="container">

<table style="width: 100%;"><tr>
<td>geolocate_text</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>geolocate text in a data frame given a text column and optionally a language column</h2>

<h3>Description</h3>

<p>extracts geolocaion information on text on a column of the provided data frame and returns a new data frame with geolocation information
</p>


<h3>Usage</h3>

<pre><code class="language-R">geolocate_text(df, text_col = "text", lang_col = NULL, min_score = NULL)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>df</code></td>
<td>
<p>A data frame containing at least character column with text, a column with the language name can be provided to improve geolocation quality</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>text_col</code></td>
<td>
<p>character, name of the column on the data frame containing the text to geolocalize, default:text</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>lang_col</code></td>
<td>
<p>character, name of the column on the data frame containing the language of texts, default: NULL</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>min_score, </code></td>
<td>
<p>numeric, the minimum score obtained on the Lucene scoring function to accept matches on GeoNames. It has to be empirically set default: NULL</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>This function perform a call to the epitweetr database which includes functionality for geolocating for languages activated and successfully processed on the shiny app.
</p>
<p>The geolocation process tries to find the best match in GeoNames database <a href="https://www.geonames.org/">https://www.geonames.org/</a> including all local aliases for words.
</p>
<p>If no language is associated to the text, all tokens will be sent as a query to the indexed GeoNames database.
</p>
<p>If a language code is associated to the text and this language is trained on epitweetr, entity recognition techniques will be used to identify the best candidate in text to contain a location
and only these tokens will be sent to the GeoNames query.
</p>
<p>A custom scoring function is implemented to grant more weight to cities increasing with population to try to perform disambiguation.
</p>
<p>Rules for forcing the geolocation choices of the algorithms and for tuning performance with manual annotations can be performed on the geotag tab of the Shiny app.
</p>
<p>A prerequisite to this function is that the tasks <code>download_dependencies</code> <code>update_geonames</code> and <code>update_languages</code> has been run successfully.
</p>
<p>This function is called from the Shiny app on geolocation evaluation tab but can also be used for manually evaluating the epitweetr geolocation algorithm.
</p>


<h3>Value</h3>

<p>A new data frame containing the following geolocation columns: geo_code, geo_country_code, geo_country, geo_name, tags
</p>


<h3>See Also</h3>

<p><code>download_dependencies</code>
</p>
<p><code>update_geonames</code>
</p>
<p><code>detect_loop</code>
</p>


<h3>Examples</h3>

<pre><code class="language-R">if(FALSE) {
   library(epitweetr)
   # setting up the data folder
   message('Please choose the epitweetr data directory')
   setup_config(file.choose())

   # creating a test dataframe
   df &lt;- data.frame(text = c("Me gusta Santiago de Chile es una linda ciudad"), lang = c("es"))
   geo &lt;- geolocate_text(df = df, text_col = "text", lang_col="lang") 
   
}
</code></pre>


</div>