<div class="container">

<table style="width: 100%;"><tr>
<td>distLquantile</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>distribution quantiles</h2>

<h3>Description</h3>

<p>Parametric quantiles of distributions fitted to a sample.
</p>


<h3>Usage</h3>

<pre><code class="language-R">distLquantile(
  x = NULL,
  probs = c(0.8, 0.9, 0.99),
  truncate = 0,
  threshold = quantileMean(dlf$dat_full[is.finite(dlf$dat_full)], truncate),
  sanerange = NA,
  sanevals = NA,
  selection = NULL,
  order = TRUE,
  dlf = NULL,
  datname = deparse(substitute(x)),
  list = FALSE,
  empirical = TRUE,
  qemp.type = 8,
  weighted = empirical,
  gpd = empirical,
  speed = TRUE,
  quiet = FALSE,
  ssquiet = quiet,
  ttquiet = quiet,
  gpquiet = missing(quiet) | quiet,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>x</code></td>
<td>
<p>Sample for which parametric quantiles are to be calculated.
If it is NULL (the default), <code>dat</code> from <code>dlf</code> is used.
DEFAULT: NULL</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>probs</code></td>
<td>
<p>Numeric vector of probabilities with values in [0,1]. DEFAULT: c(0.8,0.9,0.99)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>truncate</code></td>
<td>
<p>Number between 0 and 1 (proportion of sample discarded).
Censored quantile: fit to highest values only (truncate lower proportion of x).
Probabilities are adjusted accordingly. DEFAULT: 0</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>threshold</code></td>
<td>
<p>POT cutoff value. If you want correct percentiles,
set this only via truncate, see Details of <code>q_gpd</code>.
DEFAULT: <code>quantileMean(x, truncate)</code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>sanerange</code></td>
<td>
<p>Range outside of which results should be changed to <code>sanevals</code>.
This can capture numerical errors in small samples
(notably GPD_MLE_extRemes). If NA, this is ignored.
Attention: the RMSE column is also checked and changed.
DEFAULT: NA</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>sanevals</code></td>
<td>
<p>Values to be used below [1] and above [2] <code>sanerange</code>.
DEFAULT: NA</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>selection</code></td>
<td>
<p>Distribution type, eg. "gev" or "wak", see
<code>lmomco::dist.list</code>.
Can be a vector. If NULL (the default), all types present in
dlf$distnames are used. DEFAULT: NULL</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>order</code></td>
<td>
<p>Logical: sort by RMSE, even if selection is given?
See <code>distLweights</code>. DEFAULT: TRUE</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>dlf</code></td>
<td>
<p>dlf object described in <code>extremeStat</code>. Use this to save
computing time for large datasets where you already have dlf.
DEFAULT: NULL</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>datname</code></td>
<td>
<p>Character string: data name, important if list=TRUE.
DEFAULT: deparse(substitute(x))</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>list</code></td>
<td>
<p>Return full <code>dlf</code>list with output attached as element <code>quant</code>?
If FALSE (the default), just the matrix with quantile estimates
is returned. DEFAULT: FALSE</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>empirical</code></td>
<td>
<p>Add rows "empirical" and "quantileMean" in the output matrix?
Uses <code>quantile</code> with <code>qemp.type</code> (ignoring truncation)
and <code>quantileMean</code>. DEFAULT: TRUE</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>qemp.type</code></td>
<td>
<p>Method passed to <code>quantile</code> for row "empirical".
Only used if <code>empirical=TRUE</code>.
DEFAULT: 8 (NOT the <code>stats::quantile</code> default)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>weighted</code></td>
<td>
<p>Include weighted averages across distribution functions to the output?
DEFAULT: empirical, so additional options can all be excluded with emp=F.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>gpd</code></td>
<td>
<p>Include GPD quantile estimation via <code>q_gpd</code>?
Note that the 'GPD_LMO_lmomco' result differs slightly from 'gpa',
especially if truncate=0. This comes from using
x&gt;threshold (all 'GPD_*' distributions) or
x&gt;=threshold ('gpa' and all other distributions in extremeStat).
DEFAULT: empirical</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>speed</code></td>
<td>
<p>Compute <code>q_gpd</code> only for fast methods?
Currently, only the Bayesian method is excluded. DEFAULT: TRUE</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>quiet</code></td>
<td>
<p>Suppress notes? If it is actually set to FALSE (not missing),
gpquiet is set to FALSE to print all the warnings including stacks.
DEFAULT: FALSE</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>ssquiet</code></td>
<td>
<p>Suppress sample size notes? DEFAULT: quiet</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>ttquiet</code></td>
<td>
<p>Suppress truncation!=threshold note? DEFAULT: quiet</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>gpquiet</code></td>
<td>
<p>Suppress warnings in <code>q_gpd</code>?
DEFAULT: TRUE if quiet is not specified, else quiet</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>Arguments passed to <code>distLfit</code>
and <code>distLweights</code> like weightc, ks=TRUE</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>Very high quantiles (99% and higher) need large sample sizes for
<code>quantile</code> to yield a robust estimate. Theoretically, at least
1/(1-probs) values must be present, e.g. 10'000 for Q99.99%. With smaller
sample sizes (eg n=35), they underestimate the actual (but unknown)
quantile. Parametric quantiles need only small sample sizes. They don't have
a systematical underestimation bias, but have higher variability.
</p>


<h3>Value</h3>

<p>if list=FALSE (default): invisible matrix with distribution quantile values .
if list=TRUE: invisible dlf object, see <code>printL</code>
</p>


<h3>Note</h3>

<p>NAs are always removed from x in <code>distLfit</code>
</p>


<h3>Author(s)</h3>

<p>Berry Boessenkool, <a href="mailto:berry-b@gmx.de">berry-b@gmx.de</a>, March + July 2015, Feb 2016
</p>


<h3>References</h3>

<p>On GPD: <a href="https://stats.stackexchange.com/questions/69438">https://stats.stackexchange.com/questions/69438</a>
</p>


<h3>See Also</h3>

<p><code>q_gpd</code>, <code>distLfit</code>, require("truncdist")
Xian Zhou, Liuquan Sun and Haobo Ren (2000): Quantile estimation for
left truncated and right censored data, Statistica Sinica 10
<a href="https://www3.stat.sinica.edu.tw/statistica/oldpdf/A10n411.pdf">https://www3.stat.sinica.edu.tw/statistica/oldpdf/A10n411.pdf</a><br></p>


<h3>Examples</h3>

<pre><code class="language-R">
data(annMax) # Annual Discharge Maxima (streamflow)

distLquantile(annMax, emp=FALSE)[,] # several distribution functions in lmomco

## Not run: 
## Taken out from CRAN package check because it's slow
distLquantile(annMax, truncate=0.8, probs=0.95)[,] # POT (annMax already block maxima)
dlf &lt;- distLquantile(annMax, probs=0.95, list=TRUE)
plotLquantile(dlf, linargs=list(lwd=3), nbest=5, breaks=10)
dlf$quant
# Parametric 95% quantile estimates range from 92 to 111!
# But the best fitting distributions all lie aroud 103.

# compare General Pareto Fitting methods
# Theoretically, the tails of distributions converge to GPD (General Pareto)
# q_gpd compares several R packages for fitting and quantile estimation:
dlq &lt;- distLquantile(annMax, weighted=FALSE, quiet=TRUE, probs=0.97, list=TRUE)
dlq$quant
plotLquantile(dlq) # per default best fitting distribution functions
plotLquantile(dlq, row=c("wak","GPD*"), nbest=14)
#pdf("dummy.pdf", width=9)
plotLquantile(dlq, row="GPD*", nbest=13, xlim=c(102,110),
          linargs=list(lwd=3), heights=seq(0.02, 0.005, len=14))
#dev.off()


# Sanity checks: important for very small samples:
x1 &lt;- c(2.6, 2.5, 2.9, 3, 5, 2.7, 2.7, 5.7, 2.8, 3.1, 3.6, 2.6, 5.8, 5.6, 5.7, 5.3)
q1 &lt;- distLquantile(x1, sanerange=c(0,500), sanevals=c(NA,500))
x2 &lt;- c(6.1, 2.4, 4.1, 2.4, 6, 6.3, 2.9, 6.8, 3.5)
q2 &lt;- distLquantile(x2, sanerange=c(0,500), sanevals=c(NA,500), quiet=FALSE)
x3 &lt;- c(4.4, 3, 1.8, 7.3, 2.1, 2.1, 1.8, 1.8)
q3 &lt;- distLquantile(x3, sanerange=c(0,500), sanevals=c(NA,500))

# weighted distribution quantiles are calculated by different weighting schemes:
plotLweights(dlf)

# If speed is important and parameters are already available, pass them via dlf:
distLquantile(dlf=dlf, probs=0:5/5, selection=c("wak","gev","kap"))
distLquantile(dlf=dlf, truncate=0.3, list=TRUE)$truncate

# censored (truncated, trimmed) quantile, Peak Over Treshold (POT) method:
qwak &lt;- distLquantile(annMax, sel="wak", prob=0.95, emp=FALSE, list=TRUE)
plotLquantile(qwak, ylim=c(0,0.06) ); qwak$quant
qwak2 &lt;-distLquantile(annMax, sel="wak", prob=0.95, emp=FALSE, list=TRUE, truncate=0.6)
plotLquantile(qwak2, add=TRUE, distcols="blue")


# Simulation of truncation effect
library(lmomco)
#set.seed(42)
rnum &lt;- rlmomco(n=1e3, para=dlf$parameter$gev)
myprobs &lt;- c(0.9, 0.95, 0.99, 0.999)
mytrunc &lt;- seq(0, 0.9, length.out=20)
trunceffect &lt;- sapply(mytrunc, function(mt) distLquantile(rnum, selection="gev",
                             probs=myprobs, truncate=mt, quiet=TRUE,
                             pempirical=FALSE)["gev",])
# If more values are truncated, the function runs faster

op &lt;- par(mfrow=c(2,1), mar=c(2,4.5,2,0.5), cex.main=1)
dlf1 &lt;- distLquantile(rnum, sel="gev", probs=myprobs, emp=FALSE, list=TRUE)
dlf2 &lt;- distLquantile(rnum, sel="gev", probs=myprobs, emp=FALSE, list=TRUE, truncate=0.3)
plotLquantile(dlf1, ylab="", xlab="")
plotLquantile(dlf2, add=TRUE, distcols=4)
legend("right", c("fitted GEV", "fitted with truncate=0.3"), lty=1, col=c(2,4), bg="white")
par(mar=c(3,4.5,3,0.5))
plot(mytrunc, trunceffect[1,], ylim=range(trunceffect), las=1, type="l",
     main=c("High quantiles of 1000 random numbers from gev distribution",
           "Estimation based on proportion of lower values truncated"),
     xlab="", ylab="parametric quantile")
title(xlab="Proportion censored", mgp=c(1.8,1,0))
for(i in 2:4) lines(mytrunc, trunceffect[i,])
library("berryFunctions")
textField(rep(0.5,4), trunceffect[,11], paste0("Q",myprobs*100,"%") )
par(op)

trunc &lt;- seq(0,0.1,len=200)
dd &lt;- pbsapply(trunc, function(t) distLquantile(annMax,
          selection="gpa", weight=FALSE, truncate=t, prob=0.99, quiet=T)[c(1,3),])
 plot(trunc, dd[1,], type="o", las=1)
lines(trunc, dd[2,], type="o", col=2)


set.seed(3); rnum &lt;- rlmomco(n=1e3, para=dlf$parameter$gpa)
qd99 &lt;- evir::quant(rnum, p=0.99, start=15, end=1000, ci=0.5, models=30)
axis(3, at=seq(-1000,0, length=6), labels=0:5/5, pos=par("usr")[3])
title(xlab="Proportion truncated", line=-3)
mytrunc &lt;- seq(0, 0.9, length.out=30)
trunceffect &lt;- sapply(mytrunc, function(mt) distLquantile(rnum, selection="gpa",
                      probs=0.99, truncate=mt, plot=FALSE, quiet=TRUE,
                      empirical=FALSE, gpd=TRUE))
lines(-1000*(1-mytrunc), trunceffect[1,], col=4)
lines(-1000*(1-mytrunc), trunceffect[2,], col=3) # interesting...
for(i in 3:13) lines(-1000*(1-mytrunc), trunceffect[i,], col=3) # interesting...

# If you want the estimates only for one single truncation, use
q_gpd(rnum, probs=myprobs, truncate=0.5)


## End(Not run) # end dontrun

</code></pre>


</div>