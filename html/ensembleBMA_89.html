<div class="container">

<table style="width: 100%;"><tr>
<td>ensembleBMA</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>
BMA mixture model fit
</h2>

<h3>Description</h3>

<p>Fits a BMA mixture model to ensemble forecasts.
Allows specification of a model, training rule, and forecasting dates.
</p>


<h3>Usage</h3>

<pre><code class="language-R">ensembleBMA( ensembleData, trainingDays, dates = NULL, control = NULL,
             model = NULL, exchangeable = NULL, minCRPS = NULL)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>ensembleData</code></td>
<td>

<p>An <code>ensembleData</code> object including ensemble forecasts with the 
corresponding verifying observations and their dates. 
Missing values (indicated by <code>NA</code>) are allowed.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>dates</code></td>
<td>

<p>The dates for which BMA forecasting models are desired. 
By default, this will be all dates in <code>ensembleData</code>
for which modeling is allowed given training rule.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>trainingDays</code></td>
<td>

<p>An integer giving the number of time steps (e.g. days)
in the training period. There is no default.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>control</code></td>
<td>

<p>A list of control values for the fitting functions. 
The default is <code>controlBMAnormal()</code> for normal models
and <code>controlBMAgamma0()</code> for gamma models with a point mass at 0.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>model</code></td>
<td>

<p>A character string describing the BMA model to be fit. 
Current choices are <code>"normal"</code>, typically used for temperature 
or pressure data, and <code>"gamma0"</code>, 
typically used for precipitation data.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>exchangeable</code></td>
<td>

<p>A numeric or character vector or factor indicating groups of
ensemble members that are exchangeable (indistinguishable).
The model fit will have equal weights and parameters within each group.
The default determines exchangeability from <code>ensembleData</code>.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>minCRPS</code></td>
<td>

<p>A logical variable indicating whether or not to add a postprocessing
step after a normal BMA fit to choose the standard deviation so as to
minimize the CRPS for the training data. This argument is used only
for normal models, and the default is to not do the CRPS minimization
for those models because it may require consderably more
computation time, expecially when there are many ensemble members.
</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>If dates are specified in <code>dates</code> that cannot be forecast 
with the training rule, the corresponding BMA model parameter outputs will
be missing (<code>NA</code>) but not <code>NULL</code>. <br>
The training rule uses the number of days corresponding to its 
<code>length</code> regardless of whether or not the dates are consecutive.<br>
The following methods are available for the output of <code>ensembleBMA</code>:
<code>cdf</code>, <code>quantileForecast</code>,  <code>modelParameters</code>,  
<code>brierScore</code>, <code>crps</code>, <code>CRPS</code>  and <code>MAE</code>.
</p>


<h3>Value</h3>

<p>A list with the following output components:
</p>
<table>
<tr style="vertical-align: top;">
<td><code>dateTable</code></td>
<td>

<p>The table of observations corresponding to the dates in <code>x</code>   
in chronological order.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>trainingDays</code></td>
<td>

<p>The number of days in the training period as specified in input.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>

<p>One or more components corresponding to fitted coefficients for the model.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>weights</code></td>
<td>

<p>The fitted BMA weights for the mixture components for each ensemble
member at each date.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>power</code></td>
<td>

<p>A scalar value giving the power (if any) by which the data was
transformed for modeling.
The untransformed forecast is used to fit the variance model.
This is input as part of <code>control</code>,
and applies only to certain models.
</p>
</td>
</tr>
</table>
<h3>References</h3>

<p>A. E. Raftery, T. Gneiting, F. Balabdaoui and M. Polakowski,
Using Bayesian Model Averaging to calibrate forecast ensembles,
<em>Monthly Weather Review 133:1155–1174, 2005</em>.
</p>
<p>J. M. Sloughter, A. E. Raftery, T. Gneiting and C. Fraley, 
Probabilistic quantitative precipitation forecasting 
using Bayesian model averaging,
<em>Monthly Weather Review 135:3209–3220, 2007</em>.
</p>
<p>C. Fraley, A. E. Raftery, T. Gneiting and J. M. Sloughter,
<code>ensembleBMA</code>: An <code>R</code> Package for Probabilistic Forecasting
using Ensembles and Bayesian Model Averaging,
Technical Report No. 516R, Department of Statistics, University of
Washington, 2007 (revised 2010).
</p>
<p>C. Fraley, A. E. Raftery, T. Gneiting,
Calibrating Multi-Model Forecast Ensembles
with Exchangeable and Missing Members using Bayesian Model Averaging,
<em>Monthly Weather Review 138:190–202, 2010</em>.
</p>
<p>J. M. Sloughter, T. Gneiting and A. E. Raftery, 
Probabilistic wind speed forecasting 
using ensembles and Bayesian model averaging,
<em>Journal of the American Statistical Association, 105:25–35, 2010</em>.
</p>


<h3>See Also</h3>

<p><code>ensembleData</code>, 
<code>ensembleBMAnormal</code>, 
<code>ensembleBMAgamma0</code>,
<code>ensembleBMAgamma</code>,
<code>cdf</code>,
<code>quantileForecast</code>,
<code>modelParameters</code>, 
<code>brierScore</code>,
<code>crps</code>,
<code>MAE</code>,
<code>controlBMAnormal</code>,
<code>controlBMAgamma0</code>,
<code>controlBMAgamma</code>
</p>


<h3>Examples</h3>

<pre><code class="language-R">  data(ensBMAtest)

  ensMemNames &lt;- c("gfs","cmcg","eta","gasp","jma","ngps","tcwb","ukmo")

  obs &lt;- paste("T2","obs", sep = ".")
  ens &lt;- paste("T2", ensMemNames, sep = ".")

  tempTestData &lt;- ensembleData( forecasts = ensBMAtest[,ens],
                                dates = ensBMAtest[,"vdate"],
                                observations = ensBMAtest[,obs],
                                station = ensBMAtest[,"station"],
                                forecastHour = 48,
                                initializationTime = "00")

## Not run:  # R check
  tempTestFit &lt;- ensembleBMA( tempTestData, trainingDays = 30,
                              model = "normal")

## equivalent to
##    tempTestFit &lt;- ensembleBMAnormal( tempTestData, trainingDays = 30)

## End(Not run)

# for quick run only; use more training days for forecasting
  tempTestFit &lt;- ensembleBMA( tempTestData[1:20,], trainingDays = 8,
                              model = "normal")

  set.seed(0); exch &lt;- sample(1:length(ens),replace=TRUE)

  tempTestData &lt;- ensembleData( forecasts = ensBMAtest[,ens],
                                exchangeable = exch,
                                dates = ensBMAtest[,"vdate"],
                                observations = ensBMAtest[,obs],
                                station = ensBMAtest[,"station"],
                                forecastHour = 48,
                                initializationTime = "00")

# for quick run only; use more training days for forecasting
  tempTestFit &lt;- ensembleBMA( tempTestData[1:20,], trainingDays = 8,
                              model = "normal")
</code></pre>


</div>