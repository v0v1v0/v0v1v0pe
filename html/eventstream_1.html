<div class="container">

<table style="width: 100%;"><tr>
<td>extract_event_ftrs</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Extracts events from a data stream and computes event features.</h2>

<h3>Description</h3>

<p>This function extracts events from a 2D or 3D data stream and computes a set of 30 features for 2D streams and 13 features for 3D streams, by using a moving window. 2D data streams with class labels can be generated by using the function <code>gen_stream</code>. To get the class labels of the extracted events for the supervised setting, the event position is matched with the <code>details</code> of the events, which is part of the output of the <code>gen_stream</code> function.
</p>


<h3>Usage</h3>

<pre><code class="language-R">extract_event_ftrs(
  stream,
  supervised = FALSE,
  details = NULL,
  win_size = 200,
  step_size = 20,
  thres = 0.95,
  folder = NULL,
  vis = FALSE,
  tt = 10,
  epsilon = 5,
  miniPts = 10,
  rolling = TRUE
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>stream</code></td>
<td>
<p>A data stream. This can be the output of either the <code>gen_stream</code> function or the <code>stream_from_files</code> function.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>supervised</code></td>
<td>
<p>If <code>TRUE</code>, event class labels need to be given in <code>details</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>details</code></td>
<td>
<p>Event details. This is also an output of the <code>gen_stream</code> function. Event details are used to get the class labels of the extracted events, by matching the position.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>win_size</code></td>
<td>
<p>The window length of the moving window model, default is set to <code>200</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>step_size</code></td>
<td>
<p>The window is moved by the <code>step_size</code>, default is <code>20</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>thres</code></td>
<td>
<p>The cut-off quantile. Default is set to <code>0.95</code>. Values greater than the quantile will be clustered. The rest is not clustered.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>folder</code></td>
<td>
<p>If set to a local folder, this is where the jpegs of window data and extracted events are saved for a 2D data stream.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>vis</code></td>
<td>
<p>If <code>TRUE</code>, the window data and the extracted events are plotted for a 2D data stream.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>tt</code></td>
<td>
<p>Related to event ages. For example if <code>tt=10</code> then the event ages are <code>10, 20, 30</code> and <code>40</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>epsilon</code></td>
<td>
<p>The <code>eps</code> parameter in <code>dbscan</code> function in the package <code>dbscan</code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>miniPts</code></td>
<td>
<p>The <code>minPts</code> parameter in <code>dbscan</code> function in the package <code>dbscan</code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>rolling</code></td>
<td>
<p>This parameter is set to <code>TRUE</code> if rolling windows are considered.</p>
</td>
</tr>
</table>
<h3>Value</h3>

<p>An <code>Nx22x4</code> array  is returned for 2D data streams and an <code>Nx13x4</code> array for 3D data streams. Here <code>N</code> is the total number of  events extracted from all windows. The second dimension has <code>m</code> features and the class label for the <code>supervised</code> setting.  The third dimension has <code>4</code> different event ages : <code>tt, 2tt, 3tt, 4tt</code>.
For example, the element at <code>[10,6,3]</code> has the 6th feature, of the 10th extracted event when the age of the event is <code>3tt</code>. The features for 2D streams are listed below. For 3D streams the features <code>cluster_id, pixels, length, width, height, total_value, l2w_ratio, centroid_x, centroid_y, centroid_z, mean, std_dev</code> and <code>sd_from_global_mean</code> are computed.
</p>
<table>
<tr style="vertical-align: top;">
<td><code>cluster_id</code></td>
<td>
<p>An identification number for each event.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>pixels</code></td>
<td>
<p>The number of pixels of each event.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>length</code></td>
<td>
<p>The length of the event.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>width</code></td>
<td>
<p>The width of the event.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>total_value</code></td>
<td>
<p>The total value of the pixels.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>l2w_ratio</code></td>
<td>
<p>Length to width ratio of event.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>centroid_x</code></td>
<td>
<p>x coordinate of event centroid.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>centroid_y</code></td>
<td>
<p>y coordinate of event centroid.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>mean</code></td>
<td>
<p>Mean value of event pixels.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>std_dev</code></td>
<td>
<p>Standard deviation of event pixels.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>avg_slope</code></td>
<td>
<p>The slope of an <code>lm</code> object fitted to the event pixels.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>quad_1</code></td>
<td>
<p>The linear coefficient of  a second order polynomial fitted to event pixels using <code>lm</code>. </p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>quad_2</code></td>
<td>
<p>The quadratic coefficient of a second order polynomial fitted to event pixels using <code>lm</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>2sd_from_mean</code></td>
<td>
<p>The proportion of event pixels/cells that has values greater than 2 global standard deviations from the global mean of the window.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>3sd_from_mean</code></td>
<td>
<p>The proportion of event pixels/cells that has values greater than 3 global standard deviations from the global mean of the window.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>4sd_from_mean</code></td>
<td>
<p>The proportion of event pixels/cells that has values greater than 4 global standard deviations from the global mean of the window.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>5iqr_from_median</code></td>
<td>
<p>A small portion of each window and its column medians and column IQRs are used to construct two smoothing splines: a median spline and an IQR spline. The value of the median smoothing spline at each event centroid is used as the local median for that event. Similarly, the value of the IQR smoothing spline at each event centroid is used as the local IQR for that event. This feature gives the proportion of event pixels/cells  that has values greater than 5 local IQRs from the local median.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>6iqr_from_median</code></td>
<td>
<p>The proportion of event pixels/cells that has values greater than 6 local IQRs from the local median computed using splines.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>7iqr_from_median</code></td>
<td>
<p>The proportion of event pixels/cells that has values greater than 7 local IQRs from the local median computed using splines.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>8iqr_from_median</code></td>
<td>
<p>The proportion of event pixels/cells that has values greater than 8 local IQRs from the local median computed using splines.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>iqr_from_median</code></td>
<td>
<p>Let us denote the 75th percentile of the event pixels value by <code>x</code>. How many local IQRs is <code>x</code> is away from the local median? Both local IQR and local median are computed using splines. That value is given by this feature. </p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>sd_from_mean</code></td>
<td>
<p>Let us denote the 80th percentile of the event pixels value by <code>x</code>. How many global standard deviations is <code>x</code> is away from the global mean? Here both global values are computed from window data. </p>
</td>
</tr>
</table>
<h3>Examples</h3>

<pre><code class="language-R"># 2D data stream example
out &lt;- gen_stream(1, sd=15)
zz &lt;- as.matrix(out$data)
features &lt;- extract_event_ftrs(zz, supervised=TRUE, details = out$details)
features

# 3D data stream example
set.seed(1)
arr &lt;- array(rnorm(12000),dim=c(40,25,30))
arr[25:33,12:20, 20:23] &lt;- 10
# getting events
ftrs &lt;- extract_event_ftrs(arr, supervised=FALSE, win_size=10, step_size = 2, tt=2, thres=0.985)
ftrs

</code></pre>


</div>