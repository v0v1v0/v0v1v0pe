<div class="container">

<table style="width: 100%;"><tr>
<td>bt_smoother</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Bootstrap the Smoother</h2>

<h3>Description</h3>

<p>First, fit an autoregressive model on the residuals of the smoother. Then bootstrap
the errors of the autoregressive model. Afterwards, reconstruct the measurements
by adding the bootstrapped error, the autoregressive model, and the smoother.
We can again calculate the smoother using these reconstructed measurements to
obtain the bootstrapped smoother (which can later be used to construct the
simultaneous confidence bounds). For details see below.
</p>


<h3>Usage</h3>

<pre><code class="language-R">bt_smoother(
  data,
  smoother,
  resample_method,
  smoother_pts,
  resid,
  bt_tot_rep,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>data</code></td>
<td>
<p>A data frame in long format containing the data for which events
is to be detected. This means that each measurement corresponds to a row
and the columns are (in order): source (the device or person from which the
data was collected), point in time, and
measurement value. If custom detection bounds are chosen, the folloing two
columns must be added: lower detection bound, and upper detection bound.
</p>
<p>The source is expected to
be a string; the time point are integers; measurements, and detection bounds are expected to be numerical.
The detection bounds are in absolute value in the same unit as the
values and each is expected to be identical for the same source.
</p>
<p>In case detection is wanted for a one sided change (e.g. give an event if
the confidence bounds drop below a threshold) then the upper or lower detection
bound can be chosen to be Inf or -Inf respectively.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>smoother</code></td>
<td>
<p>A string specifying which smoother is to be used. Use <code>mov_med</code> for the
moving median. When using the moving median, the parameter <code>med_win</code> must
be given to specify the size of the window over which the moving median is
to be taken. Defaults to the moving median.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>resample_method</code></td>
<td>
<p>A string that determines how to resample the errors of the
autoregression for the bootstrap. Default is <code>all</code>, meaning that the epsilon of a
certain time point are resampled from all time points. <code>past</code> only
considers epsilon corresponding to a time point prior to the one being
resampled. <code>window</code> resamples the epsilon from the window given by
<code>resample_win</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>smoother_pts</code></td>
<td>
<p>A data frame containing the smoother with columns time_point
and value. Preferably the output of one of the smoother functions within
this package.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>resid</code></td>
<td>
<p>A vector of the same length as the number of rows of data
containing the difference between the smoother and the
measurements. Preferably the output of <code>smoother_resid</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>bt_tot_rep</code></td>
<td>
<p>The number of iterations for the bootstrap computation. Because of
run time, it is recommended to keep this number below 500. Defaults to 100.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>Additional parameters to be given to the function. Possible
parameters for the model are <code>order</code> and <code>min_pts_in_win</code>. For
the moving median, a <code>med_win</code> is required. When resampling from
window, a <code>resample_win</code> may be given.
</p>
<p>The parameter <code>min_pts_in_win</code>
defines the minimal number of
measurements required to be in the time window for the median to be calculated.
Defaults to 1.
</p>
<p>If the parameter <code>order</code> is given, that number will be the (maximal)
order of the autoregressive model. If no <code>order</code> is given, it will be
determined using the Akaike information criterion.
</p>
<p>When the moving
median is used as the smoother, <code>med_win</code> is expected. If no <code>med_win</code> is
given, it will default to <code>c(-42, 42)</code>.
</p>
<p>When resampling from window, one can choose the window size for the
resampling window with <code>resample_win</code> by giving a window like e.g. <code>c(-14,14)</code>..</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>An autoregressive (AR) model is used for the residuals of the smoother:
</p>
<p style="text-align: center;"><code class="reqn">Y(t) = S(t) + \eta(t)</code>
</p>

<p style="text-align: center;"><code class="reqn">\eta(t) = \sum^{p}_{j = 1} \phi_j \eta(t - j) + \epsilon</code>
</p>

<p>where <code class="reqn">t</code> is the point in time, <code class="reqn">Y(t)</code> the data point,
<code class="reqn">S(t)</code> a smoother, <code class="reqn">\eta(t)</code> the residual of the smoother, <code class="reqn">p</code>
the order of the AR model, <code class="reqn">\phi_j</code> the coefficients of the AR model, and
<code class="reqn">\epsilon</code> the error of the AR model.
</p>
<p>The bootstrap procedure is as follows:
</p>

<ol>
<li>
<p> Compute the smoother <code class="reqn">S(t)</code>.
</p>
</li>
<li>
<p> Compute the residuals <code class="reqn">\eta(t_i) = Y(t_i) - S(t_i)</code>.
</p>
</li>
<li>
<p> Fit an AR(p) model to <code class="reqn">\eta(t_i)</code> to obtain the coefficients
<code class="reqn">\phi_1, \dots, \phi_p</code> and residuals <code class="reqn">\epsilon(t_i) = \eta(t_i) -
    \sum^{p}_{j = 1} \phi_j \eta(t_i - t_{i-j})</code>.
</p>
</li>
<li>
<p> Resample <code class="reqn">\epsilon(t_i)*</code> from <code class="reqn">\epsilon(t_{p+1}), \dots,
    \epsilon(t_n)</code> to obtain </p>
<p style="text-align: center;"><code class="reqn">Y(t_i)* = S(t_i) + \eta(t_i)*,</code>
</p>
<p> where  </p>
<p style="text-align: center;"><code class="reqn">\eta(t_i)* = \sum^{p}_{j=1} \phi_j \eta(t_{i-j})*+ \epsilon(t_{i-j})*.</code>
</p>

</li>
<li>
<p> Compute <code class="reqn">S(.)* = g(Y(t_1), \dots, Y(t_n))</code> where <code class="reqn">g</code> is the
function with which the smoother is calculated.
</p>
</li>
<li>
<p> Repeat steps 4 and 5 <code>bt_tot_rep</code> times.
</p>
</li>
</ol>
<h3>Value</h3>

<p>A data frame containing the bootstrap repetitions of the smoother.
The column are subject identifier, time point, value, and the bootstrap
repetition the value corrsponds to.
</p>


<h3>References</h3>

<p>BÃ¼hlmann, P. (1998). Sieve Bootstrap for Smoothing in
Nonstationary Time Series. <em>The Annals of Statistics</em>, 26(1), 48-83.
</p>


</div>