<div class="container">

<table style="width: 100%;"><tr>
<td>CForBenefit</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>c-for-benefit</h2>

<h3>Description</h3>

<p>Calculates the c-for-benefit, as proposed by D. van Klaveren et al. (2018),
by matching patients based on patient characteristics.
</p>


<h3>Usage</h3>

<pre><code class="language-R">CForBenefit(
  forest,
  match = c("covariates", "CATE"),
  match_method = "nearest",
  match_distance = "mahalanobis",
  tau_hat_method = c("risk_diff", "tau_avg"),
  CI = c("simple", "bootstrap", "none"),
  level = 0.95,
  n_bootstraps = 999L,
  time_limit = Inf,
  time_limit_CI = Inf,
  verbose = TRUE,
  Y = NULL,
  W = NULL,
  X = NULL,
  p_0 = NULL,
  p_1 = NULL,
  tau_hat = NULL,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>forest</code></td>
<td>
<p>An object of class <code>causal_forest</code>, as returned by
causal_forest().</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>match</code></td>
<td>
<p>character, <code>"covariates"</code> to match on covariates or <code>"CATE"</code> to
match on estimated CATE.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>match_method</code></td>
<td>
<p>see matchit.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>match_distance</code></td>
<td>
<p>see matchit.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>tau_hat_method</code></td>
<td>
<p>character, <code>"risk_diff"</code> to calculate the expected
treatment effect in matched groups as the risk under treatment for the
treated subject minus the risk under control for the untreated subject.
<code>"tau_avg"</code> to calculate it as the average treatment effect of matched
subject.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>CI</code></td>
<td>
<p>character, <code>"none"</code> for no confidence interval, <code>"simple"</code> to use a
normal approximation, and <code>"bootstrap"</code> to use the bootstrap.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>level</code></td>
<td>
<p>numeric, confidence level of the confidence interval.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>n_bootstraps</code></td>
<td>
<p>numeric, number of bootstraps to use for the bootstrap
confidence interval computation.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>time_limit</code></td>
<td>
<p>numeric, maximum allowed time to compute C-for-benefit. If
limit is reached, execution stops.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>time_limit_CI</code></td>
<td>
<p>numeric, maximum time allowed to compute the bootstrap
confidence interval. If limit is reached, the user is asked if execution
should continue or be stopped.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>verbose</code></td>
<td>
<p>boolean, TRUE to display progress bar, FALSE to not display
progress bar.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>Y</code></td>
<td>
<p>a vector of outcomes. If provided, replaces <code>forest$Y.orig</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>W</code></td>
<td>
<p>a vector of treatment assignment; 1 for active treatment; 0 for
control If provided, replaces <code>forest$W.orig</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>X</code></td>
<td>
<p>a matrix of patient characteristics. If provided, replaces
<code>forest$X.orig</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>p_0</code></td>
<td>
<p>a vector of outcome probabilities under control.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>p_1</code></td>
<td>
<p>a vector of outcome probabilities under active treatment.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>tau_hat</code></td>
<td>
<p>a vector of individualized treatment effect predictions. If
provided, replaces forest$predictions.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>additional arguments for matchit.</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>The c-for-benefit statistic is inspired by the c-statistic used with
prediction models to measure discrimination. The c-statistic takes all
pairs of observations discordant on the outcome, and calculates the
proportion of these where the subject with the higher predicted probability
was the one who observed the outcome. In order to extend this to treatment
effects, van Klaveren et al. suggest matching a treated subject to a
control subject on the predicted treatments effect (or alternatively the
covariates) and defining the observed effect as the difference between the
outcomes of the treated subject and the control subject. The c-for-benefit
statistic is then defined as the proportion of matched pairs with unequal
observed effect in which the subject pair receiving greater treatment
effect also has the highest expected treatment effect. <br> When calculating
the expected treatment effect, van Klaveren et al. use the average CATE
from the matched subjects in a pair (tau_hat_method = "mean"). However,
this doesn't match the observed effect used, unless the baseline risks are
equal. The observed effect is the difference between the observed outcome
for the subject receiving treatment and the observed outcome for the
subject receiving control. Their outcomes are governed by the exposed risk
and the baseline risk respectively. The baseline risks are ideally equal
when covariate matching, although instability of the forest estimates can
cause significantly different baseline risks due to non-exact matching.
When matching on CATE, we should not expect baseline risks to be equal.
Instead, we can more closely match the observed treatment effect by using
the difference between the exposed risk for the subject receiving treatment
and the baseline risk of the subject receiving control (tau_hat_method =
"treatment").
</p>


<h3>Value</h3>

<p>a list with the following components:
</p>

<ul>
<li>
<p> type: a list with the input provided to the function which determines
how C-for-benefit is computed.
</p>
</li>
<li>
<p> matched_patients: a tibble containing the matched patients.
</p>
</li>
<li>
<p> c_for_benefit: the resulting C-for-benefit value.
</p>
</li>
<li>
<p> lower_CI: the lower bound of the confidence interval (if CI = TRUE).
</p>
</li>
<li>
<p> upper_CI: the upper bound of the confidence interval (if CI = TRUE).
</p>
</li>
</ul>
<h3>Author(s)</h3>

<p>KIJA
</p>


<h3>Examples</h3>

<pre><code class="language-R">
n &lt;- 800
p &lt;- 3
X &lt;- matrix(rnorm(n * p), n, p)
W &lt;- rbinom(n, 1, 0.5)
event_prob &lt;- 1 / (1 + exp(2 * (pmax(2 * X[, 1], 0) * W - X[, 2])))
Y &lt;- rbinom(n, 1, event_prob)
cf &lt;- grf::causal_forest(X, Y, W)
CB_out &lt;- CForBenefit(
forest = cf, CI = "bootstrap", n_bootstraps = 20L, verbose = TRUE,
match_method = "nearest", match_distance = "mahalanobis"
)


</code></pre>


</div>