<div class="container">

<table style="width: 100%;"><tr>
<td>ciTableProp</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>
Table of Confidence Intervals for Proportion or Difference Between Two Proportions
</h2>

<h3>Description</h3>

<p>Create a table of confidence intervals for probability of "success" for a 
binomial distribution or the difference between two proportions following 
Bacchetti (2010), by varying the estimated proportion or differene between 
the two estimated proportions given the sample size(s).
</p>


<h3>Usage</h3>

<pre><code class="language-R">  ciTableProp(n1 = 10, p1.hat = c(0.1, 0.2, 0.3), n2 = n1, 
    p2.hat.minus.p1.hat = c(0.2, 0.1, 0), sample.type = "two.sample", 
    ci.type = "two.sided", conf.level = 0.95, digits = 2, ci.method = "score", 
    correct = TRUE, tol = 10^-(digits + 1))
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>n1</code></td>
<td>

<p>positive integer greater than 1 specifying the sample size when <br><code>sample.type="one.sample"</code> or the sample size for group 1 when <br><code>sample.type="two.sample"</code>.  The default value is <code>n1=10</code>.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>p1.hat</code></td>
<td>

<p>numeric vector of values between 0 and 1 indicating the estimated proportion 
(<code>sample.type="one.sample"</code>) or the estimated proportion for group 1 <br>
(<code>sample.type="two.sample"</code>).  The default value is <code>c(0.1, 0.2, 0.3)</code>.
Missing (<code>NA</code>), undefined (<code>NaN</code>), an infinite 
(<code>-Inf</code>, <code>Inf</code>) values are not allowed.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>n2</code></td>
<td>

<p>positive integer greater than 1 specifying the sample size for group 2 when 
<code>sample.type="two.sample"</code>.  The default value is <code>n2=n1</code>, i.e., 
equal sample sizes.  This argument is ignored when <code>sample.type="one.sample"</code>.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>p2.hat.minus.p1.hat</code></td>
<td>

<p>numeric vector indicating the assumed difference between the two sample proportions 
when <code>sample.type="two.sample"</code>.  The default value is <code>c(0.2, 0.1, 0)</code>.  
Missing (<code>NA</code>), undefined (<code>NaN</code>), an infinite 
(<code>-Inf</code>, <code>Inf</code>) values are not allowed.  This argument is ignored when 
<code>sample.type="one.sample"</code>.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>sample.type</code></td>
<td>

<p>character string specifying whether to create confidence intervals for the difference 
between two proportions (<code>sample.type="two.sample"</code>; the default) or confidence 
intervals for a single proportion (<code>sample.type="one.sample"</code>).
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>ci.type</code></td>
<td>

<p>character string indicating what kind of confidence interval to compute.  The 
possible values are <code>"two-sided"</code> (the default), <code>"lower"</code>, and 
<code>"upper"</code>.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>conf.level</code></td>
<td>

<p>a scalar between 0 and 1 indicating the confidence level of the confidence interval.  
The default value is <code>conf.level=0.95</code>.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>digits</code></td>
<td>

<p>positive integer indicating how many decimal places to display in the table.  The 
default value is <code>digits=2</code>.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>ci.method</code></td>
<td>

<p>character string indicating the method to use to construct the confidence interval.  
The default value is <code>ci.method="score"</code> (i.e., the score method; see the 
help file for <code>prop.test</code>), which is the only method available when <br><code>sample.type="two.sample"</code>.  When <code>sample.type="one.sample"</code>, you may 
also set <code>ci.method="exact"</code> (i.e., the exact method).
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>correct</code></td>
<td>

<p>logical scalar indicating whether to use the correction for continuity when <br><code>ci.method="score"</code> (see the help file for <code>prop.test</code>).  The 
default value is <code>correct=TRUE</code>.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>tol</code></td>
<td>

<p>numeric scalar indicating how close the values of the adjusted elements of <br><code>p2.hat.minus.p1.hat</code> have to be in order to provide a simply display 
of confidence intervals (see DETAILS section below).  The default value is <br><code>tol=10^-(digits + 1)</code>.
</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p><em>One-Sample Case</em> (<code>sample.type="one.sample"</code>) <br>
For the one-sample case, the function <code>ciTableProp</code> calls the <span style="font-family: Courier New, Courier; color: #666666;"><b>R</b></span> function 
<code>prop.test</code> when <br><code>ci.method="score"</code>, and calls the <span style="font-family: Courier New, Courier; color: #666666;"><b>R</b></span> function 
<code>binom.test</code>, when <code>ci.method="exact"</code>.  To ensure that the 
user-supplied values of <code>p1.hat</code> are valid for the given user-supplied values 
of <code>n1</code>, values for the argument <code>x</code> to the function 
<code>prop.test</code> or <code>binom.test</code> are computed using the formula
</p>
<p><code>x &lt;- unique(round((p1.hat * n1), 0))</code>
</p>
<p>and the argument <code>p.hat</code> is then adjusted using the formula
</p>
<p><code>p.hat &lt;- x/n1</code>
<br></p>
<p><em>Two-Sample Case</em> (<code>sample.type="two.sample"</code>) <br>
For the two-sample case, the function <code>ciTableProp</code> calls the <span style="font-family: Courier New, Courier; color: #666666;"><b>R</b></span> function 
<code>prop.test</code>.  To ensure that the user-supplied values of <code>p1.hat</code> 
are valid for the given user-supplied values of <code>n1</code>, the values for the 
first component of the argument <code>x</code> to the function 
<code>prop.test</code> are computed using the formula
</p>
<p><code>x1 &lt;- unique(round((p1.hat * n1), 0))</code> <br></p>
<p>and the argument <code>p1.hat</code> is then adjusted using the formula
</p>
<p><code>p1.hat &lt;- x1/n1</code>
</p>
<p>Next, the estimated proportions from group 2 are computed by adding together all 
possible combinations from the elements of <code>p1.hat</code> and 
<code>p2.hat.minus.p1.hat</code>.  These estimated proportions from group 2 are then 
adjusted using the formulas:
</p>
<p><code>x2.rep &lt;- round((p2.hat.rep * n2), 0)</code> <br><code>p2.hat.rep &lt;- x2.rep/n2</code>
</p>
<p>If any of these adjusted proportions from group 2 are <code class="reqn">\le 0</code> or <code class="reqn">\ge 1</code> 
the function terminates with a message indicating that impossible 
values have been supplied. 
</p>
<p>In cases where the sample sizes are small there may be instances where the 
user-supplied values of <code>p1.hat</code> and/or <code>p2.hat.minus.p1.hat</code> are not 
attainable.  The argument <code>tol</code> is used to determine whether to return 
the table in conventional form or whether it is necessary to modify the table 
to include twice as many columns (see EXAMPLES section below).
</p>


<h3>Value</h3>

<p>a data frame with elements that are character strings indicating the 
confidence intervals.
</p>
<p>When <code>sample.type="two.sample"</code>, a data frame with the rows varying 
the estimated proportion for group 1 (i.e., the values of <code>p1.hat</code>) and 
the columns varying the estimated difference between the proportions from 
group 2 and group 1 (i.e., the values of <code>p2.hat.minus.p1.hat</code>).  In cases 
where the sample sizes are small, it may not be possible to obtain certain 
differences for given values of <code>p1.hat</code>, in which case the returned 
data frame contains twice as many columns indicating the actual difference 
in one column and the compute confidence interval next to it (see EXAMPLES 
section below).
</p>
<p>When <code>sample.type="one.sample"</code>, a 1-row data frame with the columns 
varying the estimated proportion (i.e., the values of <code>p1.hat</code>).
</p>


<h3>Note</h3>

<p>Bacchetti (2010) presents strong arguments against the current convention in 
scientific research for computing sample size that is based on formulas that 
use a fixed Type I error (usually 5%) and a fixed minimal power (often 80%) 
without regard to costs.  He notes that a key input to these formulas is a 
measure of variability (usually a standard deviation) that is difficult to 
measure accurately "unless there is so much preliminary data that the study 
isn't really needed."  Also, study designers often avoid defining what a 
scientifically meaningful difference is by presenting sample size results in 
terms of the effect size (i.e., the difference of interest divided by the 
elusive standard deviation).  Bacchetti (2010) encourages study designers to use 
simple tables in a sensitivity analysis to see what results of a study may look 
like for low, moderate, and high rates of variability and large, intermediate, 
and no underlying differences in the populations or processes being studied.
</p>


<h3>Author(s)</h3>

<p>Steven P. Millard (<a href="mailto:EnvStats@ProbStatInfo.com">EnvStats@ProbStatInfo.com</a>)
</p>


<h3>References</h3>

<p>Bacchetti, P. (2010).  Current sample size conventions: Flaws, Harms, and 
Alternatives.  <em>BMC Medicine</em> <b>8</b>, 17â€“23.
</p>
<p>Also see the references in the help files for <code>prop.test</code> and 
<code>binom.test</code>.
</p>


<h3>See Also</h3>

<p><code>prop.test</code>, <code>binom.test</code>, <code>ciTableMean</code>, 
<code>ciBinomHalfWidth</code>, <code>ciBinomN</code>, 
<code>plotCiBinomDesign</code>.
</p>


<h3>Examples</h3>

<pre><code class="language-R">  # Reproduce Table 1 in Bacchetti (2010).  This involves planning a study with 
  # n1 = n2 = 935 subjects per group, where Group 1 is the control group and 
  # Group 2 is the treatment group.  The outcome in the study is proportion of 
  # subjects with serious outcomes or death.  A negative value for the difference 
  # in proportions between groups (Group 2 proportion - Group 1 proportion) 
  # indicates the treatment group has a better outcome.  In this table, the 
  # proportion of subjects in Group 1 with serious outcomes or death is set 
  # to 3%, 6.5%, and 12%, and the difference in proportions between the two 
  # groups is set to -2.8 percentage points, -1.4 percentage points, and 0.

  ciTableProp(n1 = 935, p1.hat = c(0.03, 0.065, 0.12), n2 = 935, 
    p2.hat.minus.p1.hat = c(-0.028, -0.014, 0), digits = 3)
  #                  Diff=-0.028      Diff=-0.014           Diff=0
  #P1.hat=0.030 [-0.040, -0.015] [-0.029,  0.001] [-0.015,  0.015]
  #P1.hat=0.065 [-0.049, -0.007] [-0.036,  0.008] [-0.022,  0.022]
  #P1.hat=0.120 [-0.057,  0.001] [-0.044,  0.016] [-0.029,  0.029]

  #==========

  # Show how the returned data frame has to be modified for cases of small 
  # sample sizes where not all user-supplied differenes are possible.

  ciTableProp(n1 = 5, n2 = 5, p1.hat = c(0.3, 0.6, 0.12), p2.hat = c(0.2, 0.1, 0))
  #           Diff            CI Diff            CI Diff            CI
  #P1.hat=0.4  0.2 [-0.61, 1.00]  0.0 [-0.61, 0.61]    0 [-0.61, 0.61]
  #P1.hat=0.6  0.2 [-0.55, 0.95]  0.2 [-0.55, 0.95]    0 [-0.61, 0.61]
  #P1.hat=0.2  0.2 [-0.55, 0.95]  0.2 [-0.55, 0.95]    0 [-0.50, 0.50]

  #==========

  # Suppose we are planning a study to compare the proportion of nondetects at 
  # a background and downgradient well, and we can use ciTableProp to look how 
  # the confidence interval for the difference between the two proportions using 
  # say 36 quarterly samples at each well varies with the observed estimated 
  # proportions.  Here we'll let the argument "p1.hat" denote the proportion of 
  # nondetects observed at the downgradient well and set this equal to 
  # 20%, 40% and 60%.  The argument "p2.hat.minus.p1.hat" represents the proportion 
  # of nondetects at the background well minus the proportion of nondetects at the 
  # downgradient well.

  ciTableProp(n1 = 36, p1.hat = c(0.2, 0.4, 0.6), n2 = 36, 
    p2.hat.minus.p1.hat = c(0.3, 0.15, 0))
  #                Diff=0.31     Diff=0.14        Diff=0
  #P1.hat=0.19 [ 0.07, 0.54] [-0.09, 0.37] [-0.18, 0.18]
  #P1.hat=0.39 [ 0.06, 0.55] [-0.12, 0.39] [-0.23, 0.23]
  #P1.hat=0.61 [ 0.09, 0.52] [-0.10, 0.38] [-0.23, 0.23]

  # We see that even if the observed difference in the proportion of nondetects 
  # is about 15 percentage points, all of the confidence intervals for the 
  # difference between the proportions of nondetects at the two wells contain 0, 
  # so if a difference of 15 percentage points is important to substantiate, we 
  # may need to increase our sample sizes.
</code></pre>


</div>