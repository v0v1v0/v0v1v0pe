<div class="container">

<table style="width: 100%;"><tr>
<td>tidyst_kde_local_test</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Tidy and geospatial kernel density based local two-sample comparison tests</h2>

<h3>Description</h3>

<p>Tidy and geospatial versions of kernel density based local two-sample comparison tests for 1- and 2-dimensional data.
</p>


<h3>Usage</h3>

<pre><code class="language-R">tidy_kde_local_test(data1, data2, labels, ...)
st_kde_local_test(x1, x2, labels, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>data1, data2</code></td>
<td>
<p>data frames/tibbles of data values</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>x1,x2</code></td>
<td>
<p>sf objects with point geometry</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>labels</code></td>
<td>
<p>flag or vector of strings for legend labels</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>other parameters in <code>ks::kde.local.test</code> function</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>A kernel local density based two-sample comparison is a modification of the standard kernel density estimate where the two data samples are compared. A Hochberg procedure is employed to control the significance level for multiple comparison tests. 
</p>
<p>For details of the computation of the kernel local density based two-sample comparison test and the bandwidth selector procedure, see <code>?ks::kde.local.test</code>. The bandwidth matrix of smoothing parameters is computed as in <code>ks::kde</code> per data sample. 
</p>
<p>If <code>labels</code> is missing, then the first sample label is taken from <code>x1</code>, and the second sample label from <code>x2</code>. If <code>labels="default"</code> then these are "f1" and "f2". Otherwise, they are assigned to the values of the input vector of strings.
</p>


<h3>Value</h3>

<p>The output has the same structure as the kernel density estimate from <code>*_kde</code>, except that <code>estimate</code> is the difference between the density values <code>data1-data2</code> rather than the density values, and <code>label</code> becomes an indicator factor of the local comparison test result: "f1&lt;f2" = <code>data1 &lt; data2</code>, 0 = <code>data1 = data2</code>, "f2&gt;f1" = <code>data1 &gt; data2</code>.
</p>
<p>The output from <code>st_kde_local_test</code> has two contours, with <code>contlabel=-50</code> (for f1&lt;f2) and <code>contlabel=50</code> (for f1&gt;f2), as multipolygons which delimit the significant difference regions.
</p>


<h3>Examples</h3>

<pre><code class="language-R">## tidy local test between unsuccessful and successful grafts
library(ggplot2)
data(hsct, package="ks")
hsct &lt;- dplyr::as_tibble(hsct)
hsct &lt;- dplyr::filter(hsct, PE.Ly65Mac1 &gt;0 &amp; APC.CD45.2&gt;0)
hsct6 &lt;- dplyr::filter(hsct, subject==6)   ## unsuccessful graft 
hsct6 &lt;- dplyr::select(hsct6, PE.Ly65Mac1, APC.CD45.2)
hsct12 &lt;- dplyr::filter(hsct, subject==12) ## successful graft 
hsct12 &lt;- dplyr::select(hsct12, PE.Ly65Mac1, APC.CD45.2)
t1 &lt;- tidy_kde_local_test(data1=hsct6, data2=hsct12)
gt &lt;- ggplot(t1, aes(x=PE.Ly65Mac1, y=APC.CD45.2)) 
gt + geom_contour_filled_ks() + 
    scale_transparent(colorspace::scale_fill_discrete_qualitative(
        palette="Dark2", rev=TRUE, breaks=c("hsct6&lt;hsct12","hsct6&gt;hsct12"), order=c(2,1,3)))

## geospatial local test between Grevillea species
data(wa)
data(grevilleasf)
hakeoides &lt;- dplyr::filter(grevilleasf, species=="hakeoides")
paradoxa &lt;- dplyr::filter(grevilleasf, species=="paradoxa")
s1 &lt;- st_kde_local_test(x1=hakeoides, x2=paradoxa)

## base R plot
xlim &lt;- c(1.2e5, 1.1e6); ylim &lt;- c(6.1e6, 7.2e6)
plot(wa, xlim=xlim, ylim=ylim)
plot(s1, add=TRUE)

## geom_sf plot
gs &lt;- ggplot(s1) + geom_sf(data=wa, fill=NA) + ggthemes::theme_map() 
gs + geom_sf(data=st_get_contour(s1), aes(fill=label)) +
    colorspace::scale_fill_discrete_qualitative(palette="Dark2", rev=TRUE) +
    coord_sf(xlim=xlim, ylim=ylim) 
</code></pre>


</div>