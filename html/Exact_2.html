<div class="container">

<table style="width: 100%;"><tr>
<td>exact.test</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Unconditional Exact Tests for 2x2 Tables with Independent Samples</h2>

<h3>Description</h3>

<p>Calculates Barnard's or Boschloo's unconditional exact test for binomial or multinomial models with independent samples</p>


<h3>Usage</h3>

<pre><code class="language-R">exact.test(data, alternative = c("two.sided", "less", "greater"), npNumbers = 100,
    np.interval = FALSE, beta = 0.001,
     method = c("z-pooled", "z-unpooled", "boschloo", "santner and snell", "csm"),
    model = c("Binomial", "Multinomial"), tsmethod = c("square", "central"),
    conf.int = FALSE, conf.level = 0.95,
    cond.row = TRUE, to.plot = TRUE, ref.pvalue = TRUE,
    delta = 0, reject.alpha = NULL, useStoredCSM = TRUE)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>data</code></td>
<td>
<p>A two dimensional contingency table in matrix form</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>alternative</code></td>
<td>
<p>Indicates the alternative hypothesis: must be either "two.sided", "less", or "greater"</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>npNumbers</code></td>
<td>
<p>Number: The number of nuisance parameters considered</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>np.interval</code></td>
<td>
<p>Logical: Indicates if a confidence interval on the nuisance parameter should be computed</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>beta</code></td>
<td>
<p>Number: Confidence level for constructing the interval of nuisance parameters considered.  Only used if np.interval=TRUE</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>method</code></td>
<td>

<p>Indicates the method for finding the more extreme tables:
must be either "Z-pooled", "Z-unpooled", "Santner and Snell", "Boschloo", or "CSM".
CSM tests cannot be calculated for multinomial models</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>model</code></td>
<td>
<p>The model being used: must be either "Binomial" or "Multinomial"</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>tsmethod</code></td>
<td>

<p>Indicates two-sided method: must be either "square" or "central".  Only used if model="Binomial"</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>conf.int</code></td>
<td>

<p>Logical: Indicates if a confidence interval on the difference in proportion should be computed.
Only used if model="Binomial"</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>conf.level</code></td>
<td>
<p>Number: Confidence level of interval on difference in proportion.  Only used if conf.int=TRUE</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>cond.row</code></td>
<td>
<p>Logical: Indicates if row margins are fixed in the binomial models.  Only used if model="Binomial"</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>to.plot</code></td>
<td>
<p>Logical: Indicates if plot of p-value vs. nuisance parameter should be generated.  Only used if model="Binomial"</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>ref.pvalue</code></td>
<td>
<p>Logical: Indicates if p-value should be refined by maximizing the p-value function after the nuisance parameter is selected.  Only used if model="Binomial"</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>delta</code></td>
<td>
<p>Number: null hypothesis of the difference in proportion.  Only used if model="Binomial"</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>reject.alpha</code></td>
<td>
<p>Number: significance level for exact test.  Optional and primarily used to speed up <code>exact.reject.region</code> function</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>useStoredCSM</code></td>
<td>
<p>Logical: uses stored CSM ordering matrix.  Only used if method="csm"</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>Unconditional exact tests (i.e., Barnard's test) can be performed for binomial or multinomial models with independent samples. The binomial model assumes the row or column margins (but not both) are known in advance, while the multinomial model assumes only the total sample size is known beforehand.  For the binomial model, the user needs to specify which margin is fixed (default is rows). Conditional tests (e.g., Fisher's exact test) have both row and column margins fixed, but this is a very uncommon design.  For paired samples, see <code>paired.exact.test</code>.
</p>
<p>For the binomial model, the null hypothesis is the difference of proportion is equal to 0. Under the null hypothesis, the probability of a 2x2 table is the product of two binomials. The p-value is calculated by maximizing a nuisance parameter and summing the as or more extreme tables. The <code>method</code> parameter specifies the method to determine the more extreme tables (see references for more details):
</p>

<ul>
<li>
<p> Z-pooled (or Score) - Uses the test statistic from a Z-test using a pooled proportion
</p>
</li>
<li>
<p> Z-unpooled - Uses the test statistic from a Z-test without using the pooled proportion
</p>
</li>
<li>
<p> Santner and Snell - Uses the difference in proportion
</p>
</li>
<li>
<p> Boschloo - Uses the p-value from Fisher's exact test
</p>
</li>
<li>
<p> CSM - Starts with the most extreme table and sequentially adds more extreme tables based on the smallest p-value (calculated by maximizing the probability of a 2x2 table).  This is Barnard's original method
</p>
</li>
</ul>
<p>There is some disagreement on which method to use.  Barnard's CSM (Convexity, Symmetry, and Minimization) test is often the most powerful test, but is much more computationally intensive.  This test is recommended by Mato and Andres and the author of this R package when computationally feasible.  Suissa and Shuster suggested using a Z-pooled statistic, which is uniformly more powerful than Fisher's test for balanced designs.  Boschloo recommended using the p-value for Fisher's test as the test statistic.  This method became known as Boschloo's test, and it is always uniformly more powerful than Fisher's test.  Many researchers argue that Fisher's exact test should <strong>never</strong> be used to analyze 2x2 tables (except in the rare instance both margins are fixed).
</p>
<p>Once the more extreme tables are determined, the p-value is calculated by maximizing over the common success probability â€“ a nuisance parameter.  The p-value computation has many local maxima and can be computationally intensive.  The code performs an exhaustive search by considering many values of the nuisance parameter from 0 to 1, represented by <code>npNumbers</code>.  If <code>ref.pvalue = TRUE</code>, then the code will also use the <code>optimise</code> function near the nuisance parameter to refine the p-value.  Increasing <code>npNumbers</code> and using <code>ref.pvalue</code> ensures the p-value is correctly calculated at the expense of slightly more computation time.
</p>
<p>Another approach, proposed by Berger and Boos, is to calculate the Clopper-Pearson confidence interval of the nuisance parameter (represented by <code>np.interval</code>) and only maximize the p-value function for nuisance parameters within the confidence interval; this approach adds a small penalty to the p-value to control for the type 1 error rate (cannot be used with CSM).
</p>
<p>The tests can also be implemented for non-inferiority hypotheses by changing the <code>delta</code> for binomial models. A confidence interval for the difference in proportion can be constructed by determining the smallest delta such that all greater deltas are significant (essentially the delta that crosses from non-significant to significant, but since the p-value is non-monotonic as a function of delta, this code takes the supremum).  For details regarding calculation, please see Chan (2003).  We note the "z-pooled" method uses a delta-projected Z-statistic (aka Score) and uses a constrained MLE of the success proportions, while "boschloo" method ignores the delta and uses the same ordering procedure.  
</p>
<p>For two-sided tests, the code will either sum the probabilities for both sides of the table if <code>tsmethod = "square"</code> (Default, same approach as <code>fisher.test</code>) or construct a one-sided test and double the p-value if <code>tsmethod = "central"</code>.  Generally, the "square" procedure is more powerful and conventional, although there are some advantages with using the "central" procedure.  Mainly, Boschloo's test cannot order tables (i.e., use Fisher's p-value) for a two-sided alternative with non-zero delta.  Thus, to calculate a two-sided confidence interval with Boschloo's test, one has to resort to using the "central" approach.  For other tests, there is an equivalent statistic based on delta, and the two-sided p-value is determined by either the Agresti-Min interval (<code>tsmethod = "square"</code>) or Chan-Zhang interval (<code>tsmethod = "central"</code>).
</p>
<p>The CSM test is computationally intensive due to iteratively maximizing the p-value calculation to order the tables.  The CSM ordering matrix has been stored for all possible sample sizes less than or equal to 100 (i.e., max(n1,n2)&lt;=100).  In addition, any table with (n1+1)x(n2+1)&lt;=15,000 with a ratio between 1:1 and 2:1 is stored.  Thus, using the <code>useStoredCSM = TRUE</code> can greatly improve computation time.  However, the stored ordering matrix was computed with <code>npNumbers=100</code> and it is possible that the ordering matrix was not optimal for larger <code>npNumbers</code>.  Increasing <code>npNumbers</code> and setting <code>useStoredCSM = FALSE</code> ensures the p-value is correctly calculated at the expense of significantly greater computation time.  The stored ordering matrix is not used in the calculation of confidence intervals or non-inferiority tests, so CSM can still be very computationally intensive.
</p>
<p>The above description applies to the binomial model.  The multinomial model is similar except there are two nuisance parameters.  The CSM test has not been developed for multinomial models.  Improvements to the code have focused on the binomial model, so multinomial models takes substantially longer.
</p>


<h3>Value</h3>

<p>A list with class "htest" containing the following components:
</p>
<table>
<tr style="vertical-align: top;">
<td><code>p.value</code></td>
<td>
<p>The p-value of the test</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>statistic</code></td>
<td>
<p>The observed test statistic to determine more extreme tables</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>estimate</code></td>
<td>
<p>An estimate of the difference in proportion</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>null.value</code></td>
<td>
<p>The difference in proportion under the null</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>conf.int</code></td>
<td>
<p>A confidence interval for the difference in proportion.  Only present if <code>conf.int = TRUE</code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>alternative</code></td>
<td>
<p>A character string describing the alternative hypothesis</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>model</code></td>
<td>
<p>A character string describing the model design ("Binomial" or "Multinomial")</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>method</code></td>
<td>
<p>A character string describing the method to determine more extreme tables</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>tsmethod</code></td>
<td>
<p>A character string describing the method to implement two-sided tests.  Only present if <code>model = "binomial"</code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>np</code></td>
<td>
<p>The nuisance parameter that maximizes the p-value.  For multinomial models, both nuisance parameters are given</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>np.range</code></td>
<td>
<p>The range of nuisance parameters considered.  For multinomial models, both nuisance parameter ranges are given</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>data.name</code></td>
<td>
<p>A character string giving the names of the data</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>parameter</code></td>
<td>
<p>The sample sizes</p>
</td>
</tr>
</table>
<h3>Warning</h3>

<p>Multinomial models and CSM tests with confidence intervals may take a very long time, even for small sample sizes.</p>


<h3>Note</h3>

<p>CSM test and multinomial models are much more computationally intensive.  I have also spent a greater amount of time improving the computation speed and adding functionality to the binomial model. Increasing the number of nuisance parameters considered and refining the p-value will increase the computation time, but more likely to ensure accurate calculations. Performing confidence intervals also greatly increases computation time.
</p>
<p>This code was influenced by the FORTRAN program located at <a href="https://www4.stat.ncsu.edu/~boos/exact/">https://www4.stat.ncsu.edu/~boos/exact/</a>
</p>


<h3>Author(s)</h3>

<p>Peter Calhoun</p>


<h3>References</h3>

<p>Agresti, A. and Min, Y. (2001) On small-sample confidence intervals for parameters in discrete distributions. <em>Biometrics</em>, <b>57</b>, 963â€“971
</p>
<p>Barnard, G.A. (1945) A new test for 2x2 tables. <em>Nature</em>, <b>156</b>, 177
</p>
<p>Barnard, G.A. (1947) Significance tests for 2x2 tables. <em>Biometrika</em>, <b>34</b>, 123â€“138
</p>
<p>Berger, R. and Boos D. (1994) P values maximized over a confidence set for the nuisance parameter. <em>Journal of the American Statistical Association</em>, <b>89</b>, 1012â€“1016
</p>
<p>Berger, R. (1994) Power comparison of exact unconditional tests for comparing two binomial proportions. <em>Institute of Statistics Mimeo Series No. 2266</em>
</p>
<p>Berger, R. (1996) More powerful tests from confidence interval p values. <em>American Statistician</em>, <b>50</b>, 314â€“318
</p>
<p>Boschloo, R. D. (1970), Raised Conditional Level of Significance for the 2x2-table when Testing the Equality of Two Probabilities. <em>Statistica Neerlandica</em>, <b>24</b>, 1â€“35
</p>
<p>Chan, I. (2003), Proving non-inferiority or equivalence of two treatments with dichotomous endpoints using exact methods, <em>Statistical Methods in Medical Research</em>, <b>12</b>, 37â€“58
</p>
<p>Cardillo, G. (2009) MyBarnard: a very compact routine for Barnard's exact test on 2x2 matrix.
<a href="https://www.mathworks.com/matlabcentral/fileexchange/25760-mybarnard">https://www.mathworks.com/matlabcentral/fileexchange/25760-mybarnard</a>
</p>
<p>Mato, S. and Andres, M. (1997), Simplifying the calculation of the P-value for Barnard's test and its derivatives.  <em>Statistics and Computing</em>, <b>7</b>, 137â€“143
</p>
<p>Mehrotra, D., Chan, I., Berger, R. (2003), A Cautionary Note on Exact Unconditional Inference for a Difference Between Two Independent Binomial Proportions.  <em>Biometrics</em>, <b>59</b>, 441â€“450
</p>
<p>Ruxton, G. D. and Neuhauser M (2010), Good practice in testing for an association in contingency tables. <em>Behavioral Ecology and Sociobiology</em>, <b>64</b>, 1505â€“1513
</p>
<p>Suissa, S. and Shuster, J. J. (1985), Exact Unconditional Sample Sizes for the 2x2 Binomial Trial, <em>Journal of the Royal Statistical Society, Ser. A</em>, <b>148</b>, 317â€“327
</p>


<h3>See Also</h3>

<p><code>fisher.test</code> and <span class="pkg">exact2x2</span>
</p>


<h3>Examples</h3>

<pre><code class="language-R">data &lt;- matrix(c(7, 8, 12, 3), 2, 2, byrow=TRUE)
exact.test(data, alternative="two.sided", method="Z-pooled",
           conf.int=TRUE, conf.level=0.95)
exact.test(data, alternative="two.sided", method="Boschloo",
           np.interval=TRUE, beta=0.001, tsmethod="central")

## Not run: 
# Ensure that the ExactData R package is available before running the CSM test.
if (requireNamespace("ExactData", quietly = TRUE)) {
# Example from Barnard's (1947) appendix:
data &lt;- matrix(c(4, 0, 3, 7), 2, 2,
               dimnames=list(c("Box 1","Box 2"), c("Defective","Not Defective")))
exact.test(data, method="CSM", alternative="two.sided")
}

## End(Not run)
</code></pre>


</div>