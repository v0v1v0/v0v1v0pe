<div class="container">

<table style="width: 100%;"><tr>
<td>fExtDep.np</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Non-parametric extremal dependence estimation</h2>

<h3>Description</h3>

<p>This function estimates the bivariate extremal dependence structure using a non-parametric approach based on Bernstein Polynomials.</p>


<h3>Usage</h3>

<pre><code class="language-R">fExtDep.np(method, data, cov1=NULL, cov2=NULL, u, mar.fit=TRUE, 
           mar.prelim=TRUE, par10, par20, sig10, sig20, param0=NULL, 
           k0=NULL, pm0=NULL, prior.k="nbinom", prior.pm="unif", 
           nk=70, lik=TRUE, 
           hyperparam = list(mu.nbinom=3.2, var.nbinom=4.48), 
           nsim, warn=FALSE, type="rawdata")
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>method</code></td>
<td>
<p>A character string indicating the estimation method inlcuding <code>"Bayesian"</code>, <code>"Frequentist"</code> and <code>"Empirical"</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>data</code></td>
<td>
<p>A matrix containing the data.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>cov1, cov2</code></td>
<td>
<p>A covariate vector/matrix for linear model on the location parameter of the marginal distributions. <code>length(cov1)</code>/<code>nrow(cov1)</code> needs to match <code>nrow(data)</code>. If <code>NULL</code> it is assumed to be constant. Required when <code>method="Bayesian"</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>u</code></td>
<td>
<p>When <code>method="Bayesian"</code>: a bivariate indicating the threshold for the exceedance approach. If logical <code>TRUE</code> the threshold are calculated by default as the 90% quantiles. When missing, a block maxima approach is considered. When <code>method="Frequentist"</code>: the associated quantile is used to select observations with the largest radial components. If missing, the 90% quantile is used. </p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>mar.fit</code></td>
<td>
<p>A logical value indicated whether the marginal distributions should be fitted. When <code>method="Frequentist"</code>, data are empirically transformed to unit Frechet scale if <code>mar.fit=TRUE</code>. Not required when <code>method="Empirical"</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>rawdata</code></td>
<td>
<p>A character string specifying if the data is <code>"rawdata"</code> or <code>"maxima"</code>. Required when <code>method="Frequentist"</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>mar.prelim</code></td>
<td>
<p>A logical value indicated whether a preliminary fit of marginal distributions should be done prior to estimating the margins and dependence. Required when <code>method="Bayesian"</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>par10, par20</code></td>
<td>
<p>Vectors of starting values for the marginal parameter estimation. Required when <code>method="Bayesian"</code> and <code>mar.fit=TRUE</code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>sig10, sig20</code></td>
<td>
<p>Positive reals representing the initial value for the scaling parameter of the multivariate normal proposal distribution for both margins. Required when <code>method="Bayesian"</code> and <code>mar.fit=TRUE</code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>param0</code></td>
<td>
<p>A vector of initial value for the Bernstein polynomial coefficients. It should be a list with elements <code>$eta</code> and <code>$beta</code> which can be generated by the internal function <code>rcoef</code> if missing. Required when <code>method="Bayesian"</code>. </p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>k0</code></td>
<td>
<p>An integer indicating the initial value of the polynomial order. Required when <code>method="Bayesian"</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>pm0</code></td>
<td>
<p>A list of initial values for the probability masses at the boundaries of the simplex. It should be a list with two elements <code>$p0</code> and <code>$p1</code>. Randomly generated if missing. Required when <code>method="Bayesian"</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>prior.k</code></td>
<td>
<p>A character string indicating the prior distribution on the polynomial order. By default <code>prior.k="nbinom"</code> (negative binomial) but can also be <code>"pois"</code> (Poisson). Required when <code>method="Bayesian"</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>prior.pm</code></td>
<td>
<p>A character string indicating the prior on the probability masses at the endpoints of the simplex. By default <code>prior.pm="unif"</code> (uniform) but can also be <code>"beta"</code> (beta). Required when <code>method="Bayesian"</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>nk</code></td>
<td>
<p>An integer indicating the maximum polynomial order. Required when <code>method="Bayesian"</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>lik</code></td>
<td>
<p>A logical value; if <code>FALSE</code>, an approximation of the likelihood, by means of the angular measure in Bernstein form is used (<code>TRUE</code> by default). Required when <code>method="Bayesian"</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>hyperparam</code></td>
<td>
<p>A list of the hyper-parameters depending on the choice of <code>prior.k</code> and <code>prior.pm</code>. See <b>details</b>. Required when <code>method="Bayesian"</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>nsim</code></td>
<td>
<p>An integer indicating the number of iterations in the Metropolis-Hastings algorithm. Required when <code>method="Bayesian"</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>warn</code></td>
<td>
<p>A logical value. If <code>TRUE</code> warnings are printed when some specifics (e.g., <code>param0</code>, <code>k0</code>, <code>pm0</code> and <code>hyperparam</code>) are not provided and set by default. Required when <code>method="Bayesian"</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>type</code></td>
<td>
<p>A character string indicating whther the data are <code>"rawdata"</code> or <code>"maxima"</code>. Required when <code>method="Bayesian"</code>.</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>When <code>method="Bayesian"</code>, the vector of hyper-parameters is provided in the argument <code>hyperparam</code>. It should include:
</p>

<dl>
<dt>If <code>prior.pm="unif"</code>
</dt>
<dd>
<p> requires <code>hyperparam$a.unif</code> and <code>hyperparam$b.unif</code>.</p>
</dd>
<dt>If <code>prior.pm="beta"</code>
</dt>
<dd>
<p> requires <code>hyperparam$a.beta</code> and <code>hyperparam$b.beta</code>.</p>
</dd>
<dt>If <code>prior.k="pois"</code>
</dt>
<dd>
<p> requires <code>hyperparam$mu.pois</code>.</p>
</dd>
<dt>If <code>prior.k="nbinom"</code>
</dt>
<dd>
<p> requires <code>hyperparam$mu.nbinom</code> and <code>hyperparam$var.nbinom</code> or <code>hyperparam$pnb</code> and <code>hyperparam$rnb</code>. The relationship is <code>pnb = mu.nbinom/var.nbinom</code> and <code>rnb = mu.nbinom^2 / (var.nbinom-mu.nbinom)</code>.</p>
</dd>
</dl>
<p>When <code>u</code> is specified Algorithm 1 of Beranger et al. (2021) is applied whereas when it is not specified Algorithm 3.5 of Marcon et al. (2016) is considered.
</p>
<p>When <code>method="Frequentist"</code>, if <code>type="rawdata"</code> then pseudo-polar coordinates are extracted and only observations with a radial component above some high threshold (the quantile equivalent of <code>u</code> for the raw data) are retained. The inferential approach proposed in Marcon et al. (2017) based on the approximate likelihood is applied.
</p>
<p>When <code>method="Empirical"</code>, the empirical estimation procedure presented in Einmahl et al. (2013) is applied.
</p>


<h3>Value</h3>

<p>Outputs take the form of list including:
</p>

<dl>
<dt>method:</dt>
<dd>
<p>The argument.</p>
</dd>
<dt>type:</dt>
<dd>
<p>whether it is <code>"maxima"</code> or <code>"rawdata"</code> (in the broader sense that a threshold exceedance model was taken).</p>
</dd>
</dl>
<p>If <code>method="Bayesian"</code> the list also includes:
</p>

<dl>
<dt>mar.fit:</dt>
<dd>
<p>The argument.</p>
</dd>
<dt>pm:</dt>
<dd>
<p>The posterior sample of probability masses.</p>
</dd>
<dt>eta:</dt>
<dd>
<p>The posterior sample for the coeficients of the Bernstein polynomial.</p>
</dd>
<dt>k:</dt>
<dd>
<p>The posterior sample for the Bernstein polynoial order.</p>
</dd>
<dt>accepted:</dt>
<dd>
<p>A binary vector indicating if the proposal was accepted.</p>
</dd>
<dt>acc.vec:</dt>
<dd>
<p>A vector containing the acceptance probabilities for the dependence parameters at each iteration.</p>
</dd>
<dt>prior:</dt>
<dd>
<p>A list containing <code>hyperparam</code>, <code>prior.pm</code> and <code>prior.k</code>.</p>
</dd>
<dt>nsim:</dt>
<dd>
<p>The argument.</p>
</dd>
<dt>data:</dt>
<dd>
<p>The argument.</p>
</dd>
</dl>
<p>In addition if the marginal parameters are estimated (<code>mar.fit=TRUE</code>):
</p>

<dl>
<dt>cov1, cov2:</dt>
<dd>
<p>The arguments.</p>
</dd>
<dt>accepted.mar, accepted.mar2:</dt>
<dd>
<p>Binary vectors indicating if the marginal proposals were accepted.</p>
</dd>
<dt>straight.reject1, straight.reject2:</dt>
<dd>
<p>Binary vectors indicating if the marginal proposals were rejected straight away as not respecting existence conditions (proposal is multivariate normal).</p>
</dd>
<dt>acc.vec1, acc.vec2:</dt>
<dd>
<p>Vectors containing the acceptance probabilities for the marginal parameters at each iteration.</p>
</dd>
<dt>sig1.vec, sig2.vec:</dt>
<dd>
<p>Vectors containing the values of the scaling parameter in the marginal proposal distributions.</p>
</dd>
</dl>
<p>Finally, if the argument <code>u</code> is provided, the list also contains:
</p>

<dl>
<dt>threshold:</dt>
<dd>
<p>A bivariate vector indicating the threshold level for both margins.</p>
</dd>
<dt>kn:</dt>
<dd>
<p>The empirical estimate of the probability of being greater than the threshold.</p>
</dd>
</dl>
<p>When <code>method="Frequentist"</code>, the list includes:  
</p>
<p>When <code>method="Empirical"</code>, the list includes:
</p>

<dl>
<dt>hhat:</dt>
<dd>
<p>An estimate of the angular density.</p>
</dd>
<dt>Hhat:</dt>
<dd>
<p>An estimate of the angular measure.</p>
</dd>
<dt>p0, p1:</dt>
<dd>
<p>The estimates of the probability mass at 0 and 1.</p>
</dd>
<dt>Ahat:</dt>
<dd>
<p>An estimate of the PIckands dependence function.</p>
</dd>
<dt>w:</dt>
<dd>
<p>A sequence of value on the bivariate unit simplex.</p>
</dd>
<dt>q:</dt>
<dd>
<p>A real in <code class="reqn">[0,1]</code> indicating the quantile associated with the threshold <code>u</code>. Takes value <code>NULL</code> if <code>type="maxima"</code>.</p>
</dd>
<dt>data:</dt>
<dd>
<p>The data on the unit Frechet scale (empirical transformation) if <code>type="rawdata"</code> and <code>mar.fit=TRUE</code>. Data on the original scale otherwise.</p>
</dd>
</dl>
<h3>Author(s)</h3>

<p>Simone Padoan, <a href="mailto:simone.padoan@unibocconi.it">simone.padoan@unibocconi.it</a>,
<a href="https://faculty.unibocconi.it/simonepadoan/">https://faculty.unibocconi.it/simonepadoan/</a>;
Boris Beranger, <a href="mailto:borisberanger@gmail.com">borisberanger@gmail.com</a>
<a href="https://www.borisberanger.com">https://www.borisberanger.com</a>;
</p>


<h3>References</h3>

<p>Beranger, B., Padoan, S. A. and Sisson, S. A. (2021).
Estimation and uncertainty quantification for extreme quantile regions.
<em>Extremes</em>, <b>24</b>, 349-375.
</p>
<p>Einmahl, J. H. J., de Haan, L. and Krajina, A. (2013).
Estimating extreme bivariate quantile regions.
<em>Extremes</em>, <b>16</b>, 121-145.
</p>
<p>Marcon, G., Padoan, S. A. and Antoniano-Villalobos, I. (2016).
Bayesian inference for the extremal dependence.
<em>Electronic Journal of Statistics</em>, <b>10</b>, 3310-3337.
</p>
<p>Marcon, G., Padoan, S.A., Naveau, P., Muliere, P. and Segers, J. (2017)
Multivariate Nonparametric Estimation of the Pickands Dependence
Function using Bernstein Polynomials.
<em>Journal of Statistical Planning and Inference</em>, <b>183</b>, 1-17.
</p>


<h3>See Also</h3>

<p><code>dExtDep</code>, <code>pExtDep</code>, <code>rExtDep</code>, <code>fExtDep</code> </p>


<h3>Examples</h3>

<pre><code class="language-R"># Example Bayesian estimation, 
# Threshold exceedances approach, threshold set by default
# Joint estimation margins + dependence
# Default uniform prior on pm
# Default negative binomial prior on polynomial order
# Quadratic relationship between location and max temperature

## Not run: 
  data(MilanPollution)
  data &lt;- Milan.winter[,c("NO2", "SO2", "MaxTemp")]
  data &lt;- data[complete.cases(data),]
  
  covar &lt;- cbind(rep(1,nrow(data)), data[,3], data[,3]^2)
  hyperparam &lt;- list(mu.binom=6, var.binom=8, a.unif=0, b.unif=0.2)
  pollut &lt;- fExtDep.np(method="Bayesian", data = data[,-3], u=TRUE,
                       cov1 = covar, cov2 = covar, mar.prelim=FALSE,
                       par10 = c(100,0,0,35,1), par20 = c(20,0,0,20,1),
                       sig10 = 0.1, sig20 = 0.1, k0 = 5,
                       hyperparam = hyperparam, nsim = 5e+4)
  # Warning: This is slow!                     

## End(Not run)

# Example Frequentist estimation
# Data are maxima

data(WindSpeedGust)
years &lt;- format(ParcayMeslay$time, format="%Y")
attach(ParcayMeslay[which(years %in% c(2004:2013)),])
  
WS_th &lt;- quantile(WS,.9)
DP_th &lt;- quantile(DP,.9)
  
pars.WS &lt;- evd::fpot(WS, WS_th, model="pp")$estimate
pars.DP &lt;- evd::fpot(DP, DP_th, model="pp")$estimate
  
data_uf &lt;- trans2UFrechet(cbind(WS,DP), type="Empirical")
  
rdata &lt;- rowSums(data_uf)
r0 &lt;- quantile(rdata, probs=.90)
extdata &lt;- data_uf[rdata&gt;=r0,]
  
SP_mle &lt;- fExtDep.np(method="Frequentist", data=extdata, k0=10, 
                     type="maxima")
</code></pre>


</div>