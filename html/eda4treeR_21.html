<div class="container">

<table style="width: 100%;"><tr>
<td>Exam5.2</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Example 5.2 from Experimental Design and Analysis for Tree Improvement</h2>

<h3>Description</h3>

<p>Exam5.2 presents the height of 37 seedlots from 6 sites.
</p>


<h3>Author(s)</h3>


<ol>
<li>
<p>  Muhammad Yaseen (<a href="mailto:myaseen208@gmail.com">myaseen208@gmail.com</a>)
</p>
</li>
<li>
<p>  Sami Ullah (<a href="mailto:samiullahuos@gmail.com">samiullahuos@gmail.com</a>)
</p>
</li>
</ol>
<h3>References</h3>


<ol><li>
<p> E.R. Williams, C.E. Harwood and A.C. Matheson (2023). <em>Experimental Design and Analysis for Tree Improvement</em>.
CSIRO Publishing (<a href="https://www.publish.csiro.au/book/3145/">https://www.publish.csiro.au/book/3145/</a>).
</p>
</li></ol>
<h3>See Also</h3>

<p><code>DataExam5.2</code>
</p>


<h3>Examples</h3>

<pre><code class="language-R">library(car)
library(dae)
library(dplyr)
library(emmeans)
library(ggplot2)
library(lmerTest)
library(magrittr)
library(predictmeans)

data(DataExam5.2)

# Pg. 75
fm5.7 &lt;-
 lm(
     formula = ht ~ site*seedlot
   , data    = DataExam5.2
   )

# Pg. 77
anova(fm5.7)

fm5.9 &lt;-
 lm(
     formula = ht ~ site*seedlot
   , data    = DataExam5.2
   )
# Pg. 77
anova(fm5.9)

ANOVAfm5.9 &lt;- anova(fm5.9)

ANOVAfm5.9[4, 1:3] &lt;- c(384, 384*964, 964)
ANOVAfm5.9[3, 4]   &lt;- ANOVAfm5.9[3, 3]/ANOVAfm5.9[4, 3]
ANOVAfm5.9[3, 5]   &lt;-
    pf(
        q = ANOVAfm5.9[3, 4]
    , df1 = ANOVAfm5.9[3, 1]
    , df2 = ANOVAfm5.9[4, 1]
    , lower.tail = FALSE
    )
# Pg. 77
ANOVAfm5.9


Tab5.14 &lt;-
  DataExam5.2 %&gt;%
  summarise(
       Mean = round(mean(ht, na.rm = TRUE), 0)
     , .by  = seedlot
     ) %&gt;%
   left_join(
      DataExam5.2 %&gt;%
      nest_by(seedlot) %&gt;%
      mutate(fm2 = list(lm(ht ~ sitemean, data = data))) %&gt;%
      summarise(Slope = round(coef(fm2)[2], 2))
    , by = "seedlot"
     ) %&gt;%
  as.data.frame()

# Pg. 81
Tab5.14


DevSS2 &lt;-
  DataExam5.2 %&gt;%
  nest_by(seedlot) %&gt;%
  mutate(fm2 = list(lm(ht ~ sitemean, data = data))) %&gt;%
  summarise(SSE = anova(fm2)[2, 2]) %&gt;%
  ungroup() %&gt;%
  summarise(Dev = sum(SSE)) %&gt;%
  as.numeric()


ANOVAfm5.9.1 &lt;-
  rbind(
     ANOVAfm5.9[1:3, ]
   , c(
        ANOVAfm5.9[2, 1]
      , ANOVAfm5.9[3, 2] - DevSS2
      , (ANOVAfm5.9[3, 2] - DevSS2)/ANOVAfm5.9[2, 1]
      , NA
      , NA
      )
   , c(
        ANOVAfm5.9[3, 1]-ANOVAfm5.9[2, 1]
      , DevSS2
      , DevSS2/(ANOVAfm5.9[3, 1]-ANOVAfm5.9[2, 1])
      , DevSS2/(ANOVAfm5.9[3, 1]-ANOVAfm5.9[2, 1])/ANOVAfm5.9[4, 3]
      , pf(
              q = DevSS2/(ANOVAfm5.9[3, 1]-ANOVAfm5.9[2, 1])/ANOVAfm5.9[4, 3]
          , df1 = ANOVAfm5.9[3, 1]-ANOVAfm5.9[2, 1]
          , df2 = ANOVAfm5.9[4, 1]
          , lower.tail = FALSE
          )
      )
   , ANOVAfm5.9[4, ]
  )
rownames(ANOVAfm5.9.1) &lt;-
  c(
     "site"
   , "seedlot"
   , "site:seedlot"
   , "  regressions"
   , "  deviations"
   , "Residuals"
   )

# Pg. 82
ANOVAfm5.9.1

Code &lt;-
 c(
   "a","a","a","a","b","b","b","b"
 , "c","d","d","d","d","e","f","g"
 , "h","h","i","i","j","k","l","m"
 ,"n","n","n","o","p","p","q","r"
 , "s","t","t","u","v"
 )

Tab5.14$Code &lt;- Code

ggplot(
   data = Tab5.14
 , mapping = aes(x = Mean, y = Slope)
 ) +
 geom_point(size = 2) +
 geom_text(
    mapping = aes(label = Code)
  , hjust   = -0.5
  , vjust   = -0.5
 ) +
 theme_bw() +
 labs(
     x = "SeedLot Mean"
   , y = "Regression Coefficient"
   )
</code></pre>


</div>