<div class="container">

<table style="width: 100%;"><tr>
<td>KRDetect.outliers.changepoint</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Identification of outliers using changepoint analysis</h2>

<h3>Description</h3>

<p>Identification of outliers in environmental data using method based on kernel smoothing, changepoint analysis of smoothing residuals and subsequent analysis of residuals on homogeneous segments (Campulova et al., 2018).
</p>


<h3>Usage</h3>

<pre><code class="language-R">KRDetect.outliers.changepoint(x, perform.smoothing = TRUE,
  perform.cp.analysis = TRUE, bandwidth.type = "local",
  bandwidth.value = NULL, kernel.order = 2,
  cp.analysis.type = "parametric", pen.value = "5*log(n)",
  alpha.edivisive = 0.3, min.segment.length = 30,
  segment.length.for.merge = 15, method = "auto",
  prefer.grubbs = TRUE, alpha.default = NULL, L.default = NULL)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>x</code></td>
<td>
<p>data values.
Supported data types
</p>

<ul>
<li>
<p>a numeric vector
</p>
</li>
<li>
<p>a time series object <code>ts</code>
</p>
</li>
<li>
<p>a time series object <code>xts</code>
</p>
</li>
<li>
<p>a time series object <code>zoo</code>
</p>
</li>
</ul>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>perform.smoothing</code></td>
<td>
<p>a logical value specifying if data smoothing is performed. If <code>TRUE</code> (default), data are smoothed.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>perform.cp.analysis</code></td>
<td>
<p>a logical value specifying if changepoint analysis is performed. If <code>TRUE</code> (default), smoothing residuals are partitioned into homogeneous segments.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>bandwidth.type</code></td>
<td>
<p>a character string specifying the type of bandwidth.
</p>
<p>Possible options are
</p>

<ul>
<li>
<p><code>"local"</code> (default) to use local bandwidth
</p>
</li>
<li>
<p><code>"global"</code> to use global bandwidth
</p>
</li>
</ul>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>bandwidth.value</code></td>
<td>
<p>a local bandwidth array (for <code>bandwidth.type = "local"</code>) or global bandwidth value (for <code>bandwidth.type = "global"</code>) for kernel regression estimation. If <code>bandwidth.type = "NULL"</code> (default) a data-adaptive local plug-in (Herrmann, 1997) (for <code>bandwidth.type = "local"</code>) or data-adaptive global plug-in (Gasser et al., 1991) (for <code>bandwidth.type = "global"</code>) bandwidth is used instead.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>kernel.order</code></td>
<td>
<p>a nonnegative integer giving the order of the optimal kernel (Gasser et al., 1985) used for smoothing.
</p>
<p>Possible options are
</p>

<ul>
<li>
<p><code>kernel.order = 2</code> (default)
</p>
</li>
<li>
<p><code>kernel.order = 4</code>
</p>
</li>
</ul>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>cp.analysis.type</code></td>
<td>
<p>a character string specifying the type of changepoint analysis.
</p>
<p>Possible options are
</p>

<ul>
<li>
<p><code>"parametric"</code> (default) to perform changepoint analysis using PELT algorithm (Killick et al., 2012)
</p>
</li>
<li>
<p><code>"nonparametric"</code> to perform a nonparametric approach for multiple changepoins (Matteson and James, 2014)
</p>
</li>
</ul>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>pen.value</code></td>
<td>
<p>a character string giving the formula for manual penalty used in PELT algorithm.
Only required for <code>cp.analysis.type = "parametric"</code>. Default is <code>pen.value = "5*log(n)"</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>alpha.edivisive</code></td>
<td>
<p>a numeric value giving the moment index used for determining the distance between and within segments in nonparametric changepoint model. Default is <code>alpha.edivisive = 0.3</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>min.segment.length</code></td>
<td>
<p>a numeric value giving minimal required number of observations on segments from changepoint analysis.
If a segment contains less than <code>min.segment.length</code> observations and the variances of data on the segment and the previous one are supposed to be equal (based on Levene´s test (Fox, 2016) for homogeneity of variances), the segment is merged with previous one.
Analogous, the first segment can be merged with the second one. Default is <code>min.segment.length = 30</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>segment.length.for.merge</code></td>
<td>
<p>a numeric value giving minimal required number of observations on segments for performing the homogeneity test within changepoint split control.
A segment with less data than <code>segment.length.for.merge</code> is merged with the previous one without testing the homogeneity of variances (the first segment is merged with the second one). Default is <code>min.segment.length.for.merge = 15</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>method</code></td>
<td>
<p>a character string specifying the method for identification of outlier residuals.
</p>
<p>Possible options are
</p>

<ul>
<li>
<p><code>"auto"</code> (default) for automatic selection based on the structure of the residuals
</p>
</li>
<li>
<p><code>"grubbs.test"</code> for Grubbs test
</p>
</li>
<li>
<p><code>"normal.distribution"</code> for quantiles of normal distribution
</p>
</li>
<li>
<p><code>"chebyshev.inequality"</code> for chebyshev inequality
</p>
</li>
</ul>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>prefer.grubbs</code></td>
<td>
<p>a logical variable specyfing if Grubbs test for identification of outlier residuals is preferred to quantiles of normal distribution.
<code>TRUE</code> (default) means that Grubbs test is preferred. Only required for <code>method = "auto"</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>alpha.default</code></td>
<td>
<p>a numeric value from interval (0,1) of <em>alpha</em> parameter determining the criterion for (residual) outlier detection:
the limits for outlier residuals on individual segments are set as <code class="reqn">+/- (alpha/2-quantile of normal distribution with parameters corresponding to residuals on studied segment) * (sample standard deviation of residuals on corresponding segment)</code>.
If <code>alpha.default = NULL</code> (default), its value on individual segments is estimated using Modified Algorithm A1 (Campulova et al., 2018).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>L.default</code></td>
<td>
<p>a numeric value of <em>L</em> parameter determining the criterion for outlier (residual) detection:
the limits for outlier residuals on individual segments are set as <code class="reqn">+/- L * sample standard deviation of residuals on corresponding segment</code>.
If <code>L.default = NULL</code> (default), its value on individual segments is estimated using Algorithm A1 (Campulova et al., 2018).</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>This function identifies outliers in time series using procedure based on kernel smoothing, changepoint analysis of smoothing residuals and subsequent analysis of residuals on homogeneous segments (Campulova et al., 2018).
Three different approaches (Grubbs test, quantiles of normal distribution, Chebyshev inequality), that can be selected automatically based on data structure or specified by the user, can be used to detect outlier residuals.
Crucial for the method is the choice of parameters alpha and <em>L</em> for quantiles of normal distribution and Chebyshev inequality approach, that define the criterion for outlier detection. These values can be specified by the user
or estimated automatically using data driven algorithms (Campulova et al., 2018).
</p>


<h3>Value</h3>

<p>A <code>"KRDetect"</code> object which contains a list with elements:
</p>
<table>
<tr style="vertical-align: top;">
<td><code>method.type</code></td>
<td>
<p>a character string giving the type of method used for outlier idetification</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>x</code></td>
<td>
<p>a numeric vector of observations</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>index</code></td>
<td>
<p>a numeric vector of index design points assigned to individual observations</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>smoothed</code></td>
<td>
<p>a numeric vector of estimates of the kernel regression function (smoothed data)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>changepoints</code></td>
<td>
<p>an integer membership vector for individual segments</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>normality.results</code></td>
<td>
<p>a data.frame of normality results of residuals on individual segments</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>detection.method</code></td>
<td>
<p>a character string giving the type of method used for identification of outlier residuals</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>alpha</code></td>
<td>
<p>a numeric vector of alpha parameters used for outlier identification on individual segments</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>L</code></td>
<td>
<p>a numeric vector of <em>L</em> parameters used for outlier identification on individual segments</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>outlier</code></td>
<td>
<p>a logical vector specyfing the identified outliers, <code>TRUE</code> means that corresponding observation from vector <code>x</code> is detected as outlier</p>
</td>
</tr>
</table>
<h3>References</h3>

<p>Campulova M, Michalek J, Mikuska P, Bokal D (2018). Nonparametric algorithm for identification of outliers in environmental data. Journal of Chemometrics, 32, 453-463.
</p>
<p>Gasser T, Kneip A, Kohler W (1991). A flexible and fast method for automatic smoothing. Journal of the American Statistical Association, 86, 643–652.
</p>
<p>Herrmann E (1997). Local bandwidth choice in kernel regression estimation. Journal of Computational and Graphical Statistics, 6(1), 35–54.
</p>
<p>Eva Herrmann; Packaged for R and enhanced by Martin Maechler (2016). lokern: Kernel Regression Smoothing with Local or Global Plug-in Bandwidth. R package version 1.1-8. https://CRAN.R-project.org/package=lokern.
</p>
<p>Killick R, Fearnhead P, Eckley IA (2012). Optimal detection of changepoints with a linear computational cost. Journal of the American Statistical Association, 107(500), 1590–1598.
</p>
<p>Killick R, Haynes K, Eckley IA (2016). changepoint: An R package for changepoint analysis. R package version 2.2.2, &lt;URL: https://CRAN.R-project.org/package=changepoint&gt;.
</p>
<p>Matteson D, James N (2014). A Nonparametric Approach for Multiple Change Point Analysis of Multivariate Data. Journal of the American Statistical Association, 109(505), 334–345.
</p>
<p>Nicholas A. James, David S. Matteson (2014). ecp: An R Package for Nonparametric Multiple Change Point Analysis of Multivariate Data. Journal of Statistical Software, 62(7), 1-25, URL "http://www.jstatsoft.org/v62/i07/".
</p>
<p>Brys G, Hubert M, Struyf A (2008). Goodness-of-fit tests based on a robust measure of skewness. Computational Statistics, 23(3), 429–442.
</p>
<p>Todorov V, Filzmoser P (2009). An Object-Oriented Framework for Robust Multivariate Analysis. Journal of Statistical Software, 32(3), 1-47. URL http://www.jstatsoft.org/v32/i03/.
</p>
<p>Box G, Cox D (1964). An analysis of transformations. Journal of the Royal Statistical Society: Series B, 26, 211–234.
</p>
<p>Venables WN, Ripley BD (2002). Modern Applied Statistics with S. New York, fourth edition. ISBN 0-387-95457-0, URL http://www.stats.ox.ac.uk/pub/MASS4.
</p>
<p>Grubbs F (1950). Sample criteria for testing outlying observations. The Annals of Mathematical Statistics, 21(1), 27-58.
</p>
<p>Fox J (2016). Applied regression analysis and generalized linear models. 3 edition. Los Angeles: SAGE. ISBN 9781452205663.
</p>


<h3>Examples</h3>

<pre><code class="language-R">data("mydata", package = "openair")
x = mydata$o3[format(mydata$date, "%m %Y") == "12 2002"]
result = KRDetect.outliers.changepoint(x)
summary(result)
plot(result)
plot(result, show.segments = FALSE)
</code></pre>


</div>