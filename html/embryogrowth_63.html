<div class="container">

<table style="width: 100%;"><tr>
<td>STRN</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Estimate the parameters that best describe the sexualisation thermal reaction norm within the TSP</h2>

<h3>Description</h3>

<p>Estimate the parameters that best describe the sexualisation thermal reaction norm within the TSP.<br>
The sexratio parameter is a character string which can be:<br></p>

<ul>
<li> <p><code>TSP.TimeWeighted.sexratio.mean</code> Sex ratio based on average temperature during the TSP
</p>
</li>
<li> <p><code>TSP.GrowthWeighted.sexratio.mean</code> Sex ratio based on average temperature weighted by the actual growth during the TSP
</p>
</li>
<li> <p><code>TSP.TimeWeighted.GrowthRateWeighted.sexratio.mean</code> Sex ratio based on average temperature weighted by the growth rate during the TSP
</p>
</li>
<li> <p><code>TSP.TimeWeighted.STRNWeighted.sexratio.mean</code> Sex ratio based on average temperature weighted by the thermal reaction norm of sexualization during the TSP
</p>
</li>
<li> <p><code>TSP.GrowthWeighted.STRNWeighted.sexratio.mean</code> Sex ratio based on average temperature weighted by the actual growth and thermal reaction norm of sexualization during the TSP
</p>
</li>
<li> <p><code>TSP.TimeWeighted.GrowthRateWeighted.STRNWeighted.sexratio.mean</code> Sex ratio based on average temperature weighted by the growth rate and the thermal reaction norm of sexualization during the TSP
</p>
</li>
<li> <p><code>MiddleThird.TimeWeighted.sexratio.mean</code> Sex ratio based on average temperature during the middle third incubation
</p>
</li>
<li> <p><code>MiddleThird.GrowthWeighted.sexratio.mean</code> Sex ratio based on average temperature weighted by actual growth during the middle third incubation
</p>
</li>
<li> <p><code>MiddleThird.TimeWeighted.GrowthRateWeighted.sexratio.mean</code> Sex ratio based on average temperature weighted by growth rate during the middle third incubation
</p>
</li>
<li> <p><code>TimeWeighted.sexratio.mean</code> Sex ratio based on average temperature during all incubation
</p>
</li>
<li> <p><code>GrowthWeighted.sexratio.mean</code> Sex ratio based on average temperature weighted by actual growth during all incubation
</p>
</li>
<li> <p><code>TimeWeighted.GrowthRateWeighted.sexratio.mean</code> Sex ratio based on average temperature weighted by growth rate during all incubation
</p>
</li>
<li> <p><code>TSP.PM.TimeWeighted.mean</code> Average sex ratio based on temperature during the TSP
</p>
</li>
<li> <p><code>TSP.PM.GrowthWeighted.mean</code> Average sex ratio based on temperature weighted by the actual growth during the TSP
</p>
</li>
<li> <p><code>TSP.PM.TimeWeighted.GrowthRateWeighted.mean</code> Average sex ratio based on temperature weighted by the growth rate during the TSP
</p>
</li>
</ul>
<p>If information for sex is not known for some timeseries, set NA for Sexed.<br>
Sexed, Males and Females must be vectors with names. The names must be the same as
the names of timeseries of temperatures in EmbryoGrowthTRN.<br>
Only two of these 3 parameters are required: Males, Females and Sexed<br>
Note: four species have predefined embryo stages. embryo.stages parameter can take the values:<br></p>

<ul>
<li> <p><code>Caretta caretta.SCL</code>
</p>
</li>
<li> <p><code>Chelonia mydas.SCL</code>
</p>
</li>
<li> <p><code>Emys orbicularis.SCL</code>
</p>
</li>
<li> <p><code>Emys orbicularis.mass</code>
</p>
</li>
<li> <p><code>Podocnemis expansa.SCL</code>
</p>
</li>
<li> <p><code>Lepidochelys olivacea.SCL</code>
</p>
</li>
<li> <p><code>Generic.ProportionDevelopment</code>
</p>
</li>
</ul>
<p>A fifth name <code>fitted</code> must be used when limits of TSP are fitted using <code>BeginTSP</code> and <code>EndTSP</code> parameters.<br>
The parameters that can be used in STRN are:<br><code>BeginTSP</code>, <code>EndTSP</code> are the logit of the proportion of development; <br>
To ensure that <code>BeginTSP</code> &lt; <code>EndTSP</code>, it is better to use:<br><code>BeginTSP</code>, <code>LengthTSP</code> and then <code>EndTSP</code> is estimated using <code>BeginTSP</code> + <code>abs(LengthTSP)</code><br><code>DHA</code>, <code>DHH</code>, <code>T12H</code> are the SSM parameters of sexualisation thermal reaction norm; <br><code>dbeta_mu</code>, <code>dbeta_v</code> are the beta mean and variance of the impact of sexualisation according to TSP progress.<br>
Or any parameter that can be used in a TSD model.
</p>


<h3>Usage</h3>

<pre><code class="language-R">STRN(
  EmbryoGrowthTRN = stop("Embryo Growth Thermal Reaction Norm must be provided"),
  Initial_STRN = NULL,
  fixed.parameters = NULL,
  TSP.borders = NULL,
  embryo.stages = NULL,
  TSP.begin = 0,
  TSP.end = 0.5,
  tsd = NULL,
  equation = "logistic",
  Sexed = NULL,
  Males = NULL,
  Females = NULL,
  sexratio = "TSP.TimeWeighted.GrowthRateWeighted.STRNWeighted.sexratio.mean",
  fill = 60,
  parallel = TRUE,
  itnmax = 1000,
  method = c("Nelder-Mead", "BFGS"),
  control = list(trace = 1, REPORT = 10),
  zero = 1e-09,
  verbose = FALSE,
  hessian = TRUE
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>EmbryoGrowthTRN</code></td>
<td>
<p>The Embryo Growth Thermal Reaction Norm obtained with searchR()</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>Initial_STRN</code></td>
<td>
<p>Values for initial model of Sexualisation Thermal Reaction Norm or tsd model</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>fixed.parameters</code></td>
<td>
<p>Value for Sexualisation Thermal Reaction Norm or tsd model that will not be changed</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>TSP.borders</code></td>
<td>
<p>The limits of TSP in stages. See embryo.stages parameter.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>embryo.stages</code></td>
<td>
<p>The embryo stages. At least TSP.borders stages must be provided to estimate TSP borders. See note.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>TSP.begin</code></td>
<td>
<p>Where TSP begin during the stage of beginning? In relative proportion of the stage.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>TSP.end</code></td>
<td>
<p>Where TSP begin during the stage of ending? In relative proportion of the stage.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>tsd</code></td>
<td>
<p>The model used to predict sex ratio, obtained from tsd()</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>equation</code></td>
<td>
<p>If tsd parameter is not provided, equation and parameters in Initial_STRN for tsd model must be provided.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>Sexed</code></td>
<td>
<p>The number of sexed embryos with names identifying timeseries</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>Males</code></td>
<td>
<p>The number of males embryos with names identifying timeseries</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>Females</code></td>
<td>
<p>The number of females embryos with names identifying timeseries</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>sexratio</code></td>
<td>
<p>The sex ratio to be used</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>fill</code></td>
<td>
<p>See info.nests()</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>parallel</code></td>
<td>
<p>Should parallel computing for info.nests() be used</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>itnmax</code></td>
<td>
<p>Maximum number of iterations for each method; if 0, just return the likelihood</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>method</code></td>
<td>
<p>Methods to be used with optimx</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>control</code></td>
<td>
<p>List for control parameters for optimx</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>zero</code></td>
<td>
<p>The value to replace a null sex ratio</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>verbose</code></td>
<td>
<p>If TRUE, will show all intermediate parameters during fit</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>hessian</code></td>
<td>
<p>If TRUE, the Hessian approximation is estimated atthe end of the fit.</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>STRN estimates the parameters that best describe the sexualisation thermal reaction norm within the TSP
</p>


<h3>Value</h3>

<p>The list with object return by optim()
</p>


<h3>Author(s)</h3>

<p>Marc Girondot <a href="mailto:marc.girondot@gmail.com">marc.girondot@gmail.com</a>
</p>


<h3>Examples</h3>

<pre><code class="language-R">## Not run: 
library(embryogrowth)
MedIncubation_Cc &lt;- subset(DatabaseTSD, Species=="Caretta caretta" &amp; 
RMU=="Mediterranean" &amp; Sexed!=0)
Med_Cc &lt;- tsd(males=MedIncubation_Cc$Males, 
             females=MedIncubation_Cc$Females, 
             temperatures=MedIncubation_Cc$Incubation.temperature, 
             par=c(P=29.5, S=-0.1))
plot(Med_Cc, xlim=c(25, 35))
males &lt;- c(7, 0, 0, 0, 0, 5, 6, 3, 5, 3, 2, 3, 0, 0, 0, 0, 0, 0, 0, 0, 0)
names(males) &lt;- rev(rev(names(resultNest_4p_SSM$data))[-(1:2)])
sexed &lt;- rep(10, length(males))
names(sexed) &lt;- rev(rev(names(resultNest_4p_SSM$data))[-(1:2)])

Initial_STRN &lt;- c('DHA' = 1174.6461503413307, 
                  'DHH' = 2001.0619192107047, 
                  'T12H' = 3731.353104743393)
fp &lt;- c(Rho25=100)
fitSTRN &lt;- STRN(Initial_STRN=Initial_STRN, 
                EmbryoGrowthTRN=resultNest_4p_SSM, 
                tsd=Med_Cc, 
                embryo.stages="Caretta caretta.SCL", 
                Sexed=sexed, Males=males, 
                fixed.parameters=fp, 
                sexratio="TSP.GrowthWeighted.STRNWeighted.sexratio.mean")
plotR(fitSTRN, curve ="ML", ylim=c(0,2))
plotR(fitSTRN)
out &lt;- info.nests(NestsResult=resultNest_4p_SSM, 
                  SexualisationTRN=fitSTRN,
                  SexualisationTRN.CI="Hessian",
                  embryo.stages="Caretta caretta.SCL", 
                  GTRN.CI="Hessian", 
                  tsd=Med_Cc, 
                  tsd.CI="Hessian", 
                  replicate.CI=100, 
                  progressbar=TRUE, 
                  warnings=TRUE, 
                  out="summary")$summary
# CTE with growth-weighted temperature average
plot(Med_Cc, xlim=c(25, 35))
points(x=out[, "TSP.GrowthWeighted.STRNWeighted.temperature.mean"], y=males/sexed, 
         col="red", pch=19)
legend("topright", legend=c("CTE with growth-weighted and Sexualization TRN"), 
         pch=19, col=c("red"))
       
#  Fit the beginning and end of TSP

Initial_STRN &lt;- c('BeginTSP' = invlogit(0.33), 
                  'EndTSP' = invlogit(0.66))
fp &lt;- NULL
fitSTRN &lt;- STRN(Initial_STRN=Initial_STRN, 
                EmbryoGrowthTRN=resultNest_4p_SSM, 
                tsd=Med_Cc, 
                embryo.stages="fitted", 
                Sexed=sexed, Males=males, 
                fixed.parameters=fp, 
                sexratio="TSP.TimeWeighted.GrowthRateWeighted.STRNWeighted.sexratio.mean")
invlogit(fitSTRN$par)
invlogit(fitSTRN$par-2*fitSTRN$SE)
invlogit(fitSTRN$par+2*fitSTRN$SE)

Initial_STRN &lt;- c('dbeta_mu' = logit(0.5), 
                  'dbeta_v' = 1/12)
fp &lt;- NULL
fitSTRN &lt;- STRN(Initial_STRN=Initial_STRN, 
                EmbryoGrowthTRN=resultNest_4p_SSM, 
                tsd=Med_Cc, 
                embryo.stages="Caretta caretta.SCL", 
                Sexed=sexed, Males=males, 
                fixed.parameters=fp, 
                sexratio="TSP.TimeWeighted.GrowthRateWeighted.STRNWeighted.sexratio.mean")
                mu &lt;- invlogit(fitSTRN$par["dbeta_mu"]), 
                v &lt;- abs(fitSTRN$par["dbeta_v"])
                shape1 &lt;- mu * (((mu * (1 - mu))/v) - 1)
                shape2 &lt;- shape1 * (1 - mu)/mu
plot(seq(from=0, to=1, length.out=100), 
     dbeta(seq(from=0, to=1, length.out=100), 
               shape1=shape1, shape2=shape2), 
     type="l", xlab="Progress of TSP", 
     ylab="Force of sexualisation", bty="n", ylim=c(0, 6), las=1)
               
 Initial_STRN &lt;- c('dbeta_mu' = 7.2194053298953236, 
                   'dbeta_v' = 0.00050390986089928467)
fp &lt;- NULL
fitSTRN &lt;- STRN(Initial_STRN=Initial_STRN                                                 , 
                EmbryoGrowthTRN=resultNest_4p_SSM                                         , 
                tsd=Med_Cc                                                                , 
                embryo.stages="Caretta caretta.SCL"                                       , 
                Sexed=sexed                                                               , 
                Males=males                                                               , 
                fixed.parameters=fp                                                       , 
                sexratio="TSP.TimeWeighted.GrowthRateWeighted.STRNWeighted.sexratio.mean" )
                
                mu &lt;- invlogit(fitSTRN$par["dbeta_mu"]), 
                v &lt;- abs(fitSTRN$par["dbeta_v"])
                shape1 &lt;- mu * (((mu * (1 - mu))/v) - 1)
                shape2 &lt;- shape1 * (1 - mu)/mu
                
plot(seq(from=0, to=1, length.out=100), 
     dbeta(seq(from=0, to=1, length.out=100), 
               shape1=shape1, shape2=shape2), 
     type="l", xlab="Progress of TSP", 
     ylab="Force of sexualisation", bty="n", ylim=c(0, 0.04), las=1)
               
Initial_STRN &lt;- c('dbeta_mu' = logit(0.5), 
                  'dbeta_v' = 1/12)
L &lt;- STRN(Initial_STRN=NULL                                                        , 
          fixed.parameters=Initial_STRN                                            , 
          EmbryoGrowthTRN=resultNest_4p_SSM                                        , 
          tsd=Med_Cc                                                               , 
          embryo.stages="Caretta caretta.SCL"                                                   , 
          Sexed=sexed                                                              ,
          Males=males                                                              , 
          sexratio="TSP.TimeWeighted.GrowthRateWeighted.STRNWeighted.sexratio.mean")
Initial_STRN &lt;- c('dbeta_mu' = logit(0.6), 
                  'dbeta_v' = 1/12)
L &lt;- STRN(Initial_STRN=NULL                                                        , 
          fixed.parameters=Initial_STRN                                            , 
          EmbryoGrowthTRN=resultNest_4p_SSM                                        , 
          tsd=Med_Cc                                                               , 
          embryo.stages="Caretta caretta.SCL"                                                   , 
          Sexed=sexed                                                              ,
          Males=males                                                              , 
          sexratio="TSP.TimeWeighted.GrowthRateWeighted.STRNWeighted.sexratio.mean")
 Initial_STRN &lt;- c('dbeta_mu' = 7.2192972077000004, 
                    'dbeta_v' = 0.00050396969999999997)
L &lt;- STRN(Initial_STRN=NULL                                                        , 
          fixed.parameters=Initial_STRN                                            , 
          EmbryoGrowthTRN=resultNest_4p_SSM                                        , 
          tsd=Med_Cc                                                               , 
          embryo.stages="Caretta caretta.SCL"                                      , 
          Sexed=sexed                                                              ,
          Males=males                                                              , 
          sexratio="TSP.TimeWeighted.GrowthRateWeighted.STRNWeighted.sexratio.mean")
                mu &lt;- invlogit(fitSTRN$par["dbeta_mu"]), 
                v &lt;- abs(fitSTRN$par["dbeta_v"])
                shape1 &lt;- mu * (((mu * (1 - mu))/v) - 1)
                shape2 &lt;- shape1 * (1 - mu)/mu
 
   tsp_progress &lt;- seq(from=0, to=1, length.out=100)     
  plot(tsp_progress, 
     dbeta(tsp_progress, 
           shape1=shape1, shape2=shape2), 
       type="l", xlab="Progress of TSP", 
       ylab="Force of sexualisation", bty="n", ylim=c(0, 0.04), las=1)
 segments(x0=0, x1=1, y0=0, y1=0, lty=2)

## End(Not run)
</code></pre>


</div>