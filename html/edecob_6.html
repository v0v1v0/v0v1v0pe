<div class="container">

<table style="width: 100%;"><tr>
<td>mov_med</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Moving Median over a Time Window</h2>

<h3>Description</h3>

<p>Calculates the moving median over a time window around a time point for the
all time points between the first and last time point provided.
</p>


<h3>Usage</h3>

<pre><code class="language-R">mov_med(data, med_win = c(-42, 42), min_pts_in_win = 1)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>data</code></td>
<td>
<p>A data frame in long format containing the data for which events
is to be detected. This means that each measurement corresponds to a row
and the columns are (in order): source (the device or person from which the
data was collected), point in time, and
measurement value. If custom detection bounds are chosen, the folloing two
columns must be added: lower detection bound, and upper detection bound.
</p>
<p>The source is expected to
be a string; the time point are integers; measurements, and detection bounds are expected to be numerical.
The detection bounds are in absolute value in the same unit as the
values and each is expected to be identical for the same source.
</p>
<p>In case detection is wanted for a one sided change (e.g. give an event if
the confidence bounds drop below a threshold) then the upper or lower detection
bound can be chosen to be Inf or -Inf respectively.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>med_win</code></td>
<td>
<p>A vector containing two numbers specifying the window over
which the moving median is to be taken. More specifically, when given a
certain time point, the numbers specify the maximum number of time units
difference that a time point can have such that that data point will be
considered for the moving median. Note that the first number must be smaller
than the second number. The numbers may be negative.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>min_pts_in_win</code></td>
<td>
<p>The minimal number of measurements required to be in
the time window in order for the median to be calculated.</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>Consider a sample <code class="reqn">X_1,\dots, X_n</code> of size <code class="reqn">n</code> and the
reordering <code class="reqn">X_{(1)},\dots, X_{(n)}</code> such
that <code class="reqn">X_{(1)} \le X_{(2)} \le \dots \le X_{(n)}</code>, commonly
called the order statistic. Then for <code class="reqn">n</code> even the median usually
defined as </p>
<p style="text-align: center;"><code class="reqn">median(X_1,\dots, X_n) = X_{(k)}, \mathrm{where } \;  k = n/2.</code>
</p>
<p> In the
case where <code class="reqn">n</code> is odd the median is
defined as </p>
<p style="text-align: center;"><code class="reqn">median(X_1,\dots, X_n) = 1/2(X_{(k)} + X_{(k+1)}), \mathrm{where } \;  k = n/2.</code>
</p>
<p> Let the
study days at which the measurements <code class="reqn">X_1, \dots, X_n</code> were taken
be <code class="reqn">t_1, \dots, t_n</code>.
Let <code class="reqn">T</code> a fixed positive amount of time. Then the moving median at time
point <code class="reqn">t</code> with window size <code class="reqn">T</code> is defined as
</p>
<p style="text-align: center;"><code class="reqn">S(t) = median({X_j | t - T/2 \le t_j \le t + T/2}).</code>
</p>

<p>For the initial time points where the time difference between the first data
point and the time point for which we are calculating the median is less than
half the <code>width</code>, we do not have enough data points to form a window
which has the same size to both sides of the time point. In this case fewer
data points are used to calculate the median and the time window is not
symmetric around the time point for which we are calculating the median.
</p>
<p>No median is calculated if the time difference between the last data point
and the current time point for which we are calculating the median is less
than half the <code>width</code>. We do not calculate the median using a smaller
time window so that the values do not change upon receiving new data with
time points newer than that of the old data.
</p>


<h3>Value</h3>

<p>A data frame containing the values of the moving median, the study
day to which it corresponds, the time window from which it was calculated,
and the subject id corresponding to the data.
</p>


</div>