<div class="container">

<table style="width: 100%;"><tr>
<td>gofTestCensored</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>
Goodness-of-Fit Test for Normal or Lognormal Distribution Based on Censored Data
</h2>

<h3>Description</h3>

<p>Perform a goodness-of-fit test to determine whether a data set 
appears to come from a normal distribution,  
lognormal distribution, or 
lognormal distribution (alternative parameterization) 
based on a sample of data that has been subjected to Type I or Type II 
censoring.
</p>


<h3>Usage</h3>

<pre><code class="language-R">  gofTestCensored(x, censored, censoring.side = "left", test = "sf", 
    distribution = "norm", est.arg.list = NULL, 
    prob.method = "hirsch-stedinger", plot.pos.con = 0.375, 
    keep.data = TRUE, data.name = NULL, censoring.name = NULL)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>x</code></td>
<td>

<p>numeric vector of observations.  
Missing (<code>NA</code>), undefined (<code>NaN</code>), 
and infinite (<code>Inf</code>, <code>-Inf</code>) values are allowed but will be 
removed.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>censored</code></td>
<td>

<p>numeric or logical vector indicating which values of <code>x</code> are censored.  
This must be the same length as <code>x</code>.  If the mode of <code>censored</code> is 
<code>"logical"</code>, <code>TRUE</code> values correspond to elements of <code>x</code> that 
are censored, and <code>FALSE</code> values correspond to elements of <code>x</code> that 
are not censored.  If the mode of <code>censored</code> is <code>"numeric"</code>, 
it must contain only <code>1</code>'s and <code>0</code>'s; <code>1</code> corresponds to 
<code>TRUE</code> and <code>0</code> corresponds to <code>FALSE</code>.  Missing (<code>NA</code>) 
values are allowed but will be removed.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>censoring.side</code></td>
<td>

<p>character string indicating on which side the censoring occurs.  The possible 
values are <code>"left"</code> (the default) and <code>"right"</code>. 
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>test</code></td>
<td>

<p>character string defining which goodness-of-fit test to perform.  Possible values are:  
<code>"sw"</code> Shapiro-Wilk. 
<code>"sf"</code> Shapiro-Francia; the default. 
<code>"ppcc"</code> Probability Plot Correlation Coefficient.  
</p>
<p>The Shapiro-Wilk test is only available for singly censored data.  
</p>
<p>See the DETAILS section for more information.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>distribution</code></td>
<td>

<p>a character string denoting the abbreviation of the assumed distribution.  
Only continous distributions are allowed.  See the help file for 
<code>Distribution.df</code> for a list of distributions and their abbreviations. 
Examples of possible values are:<br><code>distribution="norm"</code> (Normal distribution; the default), <br><code>distribution="lnorm"</code> (Lognormal distribution), <br><code>distribution="lnormAlt"</code> (Lognormal distribution, 
alternative parameterization, <br><code>distribution="gamma"</code> (Gamma distribution), <br><code>distribution="gammaAlt"</code> (Gamma distribution,
alternative parameterization).
</p>
<p>The results for the goodness-of-fit test are 
identical for <code>distribution="lnorm"</code> and <code>distribution="lnormAlt"</code>, the 
only difference in ouput is that when <code>distribution="lnorm"</code> the 
returned estimated parameters are the mean and standard deviation based on the 
log-scale of the data, whereas when <code>distribution="lnormAlt"</code> the 
returned estimated parameters are the mean and coefficient of variation 
based on the original scale of the data.
</p>
<p>Also, the results for the goodness-of-fit test are 
identical for <code>distribution="gamma"</code> and <code>distribution="gammaAlt"</code>, the 
only difference in ouput is that when <code>distribution="gamma"</code> the 
returned estimated parameters are the shape and scale, whereas when 
<code>distribution="lnormAlt"</code> the returned estimated parameters are the 
mean and coefficient of variation.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>est.arg.list</code></td>
<td>

<p>a list of arguments to be passed to the function estimating the distribution 
parameters.  For example, if <code>distribution="lnormAlt"</code> setting <br><code>est.arg.list=list(method="bcmle")</code> indicates using the bias-corrected 
maximum likelihood estimators (see the help file for <code>elnormAltCensored</code>).    
The default value is <code>est.arg.list=NULL</code> so that all default values for the 
estimating function are used.  The estimated parameters are provided in the 
output merely for information, and the choice of the method of estimation has no 
effect on the goodness-of-fit test statistic or p-value.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>prob.method</code></td>
<td>

<p>character string indicating what method to use to compute the plotting positions 
(empirical probabilities) when <code>test="sf"</code> or <code>test="ppcc"</code>.  
Possible values are: <br><code>"modified kaplan-meier"</code> (modification of product-limit method of Kaplan and Meier (1958)), <br><code>"nelson"</code> (hazard plotting method of Nelson (1972)), <br><code>"michael-schucany"</code> (generalization of the product-limit method due to Michael and Schucany (1986)), and <br><code>"hirsch-stedinger"</code> (generalization of the product-limit method due to Hirsch and Stedinger (1987)). <br>
The default value is <code>prob.method="hirsch-stedinger"</code>.  
</p>
<p>The <code>"nelson"</code> method is only available for <code>censoring.side="right"</code>, and 
the <code>"modified kaplan-meier"</code> method is only available for 
<code>censoring.side="left"</code>.  See the DETAILS section and the help file for 
<code>ppointsCensored</code> for more information.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>plot.pos.con</code></td>
<td>

<p>numeric scalar between 0 and 1 containing the value of the plotting position 
constant to use when <code>test="sf"</code> or <code>test="ppcc"</code>.  The default value is <br><code>plot.pos.con=0.375</code>.  See the DETAILS section and the help file for <br><code>ppointsCensored</code> for more information.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>keep.data</code></td>
<td>

<p>logical scalar indicating whether to return the original data.  The 
default value is <code>keep.data=TRUE</code>.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>data.name</code></td>
<td>

<p>optional character string indicating the name for the data used for argument <code>x</code>.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>censoring.name</code></td>
<td>

<p>optional character string indicating the name for the data used for argument <code>censored</code>.
</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>Let <code class="reqn">\underline{x} = c(x_1, x_2, \ldots, x_N)</code> denote a vector of <code class="reqn">N</code> 
observations from from some distribution with cdf <code class="reqn">F</code>.  
Suppose we want to test the null hypothesis that 
<code class="reqn">F</code> is the cdf of a normal (Gaussian) distribution with 
some arbitrary mean <code class="reqn">\mu</code> and standard deviation <code class="reqn">\sigma</code> against the 
alternative hypothesis that <code class="reqn">F</code> is the cdf of some other distribution.  The 
table below shows the random variable for which <code class="reqn">F</code> is the assumed cdf, given 
the value of the argument <code>distribution</code>.
</p>

<table>
<tr>
<td style="text-align: left;">
  <b>Value of</b>     </td>
<td style="text-align: left;">                           </td>
<td style="text-align: left;"> <b>Random Variable for</b> </td>
</tr>
<tr>
<td style="text-align: left;">
  <code>distribution</code> </td>
<td style="text-align: left;"> <b>Distribution Name</b>  </td>
<td style="text-align: left;"> <b>which</b> <code class="reqn">F</code> <b>is the cdf</b> </td>
</tr>
<tr>
<td style="text-align: left;">
  <code>"norm"</code>       </td>
<td style="text-align: left;"> Normal                    </td>
<td style="text-align: left;"> <code class="reqn">X</code> </td>
</tr>
<tr>
<td style="text-align: left;">
  <code>"lnorm"</code>      </td>
<td style="text-align: left;"> Lognormal (Log-space)     </td>
<td style="text-align: left;"> <code class="reqn">log(X)</code> </td>
</tr>
<tr>
<td style="text-align: left;">
  <code>"lnormAlt"</code>   </td>
<td style="text-align: left;"> Lognormal (Untransformed) </td>
<td style="text-align: left;"> <code class="reqn">log(X)</code> </td>
</tr>
<tr>
<td style="text-align: left;">
  </td>
</tr>
</table>
<p>Assume <code class="reqn">n</code> (<code class="reqn">0 &lt; n &lt; N</code>) of these observations are known and <code class="reqn">c</code> 
(<code class="reqn">c=N-n</code>) of these observations are all censored below (left-censored) or 
all censored above (right-censored) at <code class="reqn">k</code> fixed censoring levels
</p>
<p style="text-align: center;"><code class="reqn">T_1, T_2, \ldots, T_k; \; k \ge 1 \;\;\;\;\;\; (1)</code>
</p>

<p>For the case when <code class="reqn">k \ge 2</code>, the data are said to be Type I 
<b><em>multiply censored</em></b>.  For the case when <code class="reqn">k=1</code>, 
set <code class="reqn">T = T_1</code>.  If the data are left-censored 
and all <code class="reqn">n</code> known observations are greater 
than or equal to <code class="reqn">T</code>, or if the data are right-censored and all <code class="reqn">n</code> 
known observations are less than or equal to <code class="reqn">T</code>, then the data are 
said to be Type I <b><em>singly censored</em></b> (Nelson, 1982, p.7), otherwise 
they are considered to be Type I multiply censored.
</p>
<p>Let <code class="reqn">c_j</code> denote the number of observations censored below or above censoring 
level <code class="reqn">T_j</code> for <code class="reqn">j = 1, 2, \ldots, k</code>, so that
</p>
<p style="text-align: center;"><code class="reqn">\sum_{i=1}^k c_j = c \;\;\;\;\;\; (2)</code>
</p>

<p>Let <code class="reqn">x_{(1)}, x_{(2)}, \ldots, x_{(N)}</code> denote the “ordered” observations, 
where now “observation” means either the actual observation (for uncensored 
observations) or the censoring level (for censored observations).  For 
right-censored data, if a censored observation has the same value as an 
uncensored one, the uncensored observation should be placed first.  
For left-censored data, if a censored observation has the same value as an 
uncensored one, the censored observation should be placed first.
</p>
<p>Note that in this case the quantity <code class="reqn">x_{(i)}</code> does not necessarily represent 
the <code class="reqn">i</code>'th “largest” observation from the (unknown) complete sample.
</p>
<p>Note that for singly left-censored data:
</p>
<p style="text-align: center;"><code class="reqn">x_{(1)} = x_{(2)} = \cdots = x_{(c)} = T \;\;\;\;\;\; (3)</code>
</p>

<p>and for singly right-censored data:
</p>
<p style="text-align: center;"><code class="reqn">x_{(n+1)} = x_{(n+2)} = \cdots = x_{(N)} = T \;\;\;\;\;\; (4)</code>
</p>

<p>Finally, let <code class="reqn">\Omega</code> (omega) denote the set of <code class="reqn">n</code> subscripts in the 
“ordered” sample that correspond to uncensored observations. 
<br></p>
<p><b>Shapiro-Wilk Goodness-of-Fit Test for Singly Censored Data</b> (<code>test="sw"</code>) <br>
Equation (8) in the help file for <code>gofTest</code> shows that for the case of 
<b>complete</b> ordered data <code class="reqn">\underline{x}</code>, the Shapiro-Wilk 
<code class="reqn">W</code>-statistic is the same as 
the square of the sample product-moment correlation between the vectors 
<code class="reqn">\underline{a}</code> and <code class="reqn">\underline{x}</code>:
</p>
<p style="text-align: center;"><code class="reqn">W = r(\underline{a}, \underline{x})^2 \;\;\;\;\;\; (5)</code>
</p>

<p>where 
</p>
<p style="text-align: center;"><code class="reqn">r(\underline{x}, \underline{y}) = \frac{\sum_{i=1}^N (x_i - \bar{x})(y_i - \bar{y})}{[\sum_{i=1}^n (x_i - \bar{x})^2 \sum_{i=1}^n (y_i - \bar{y})^2]^{1/2}} \;\;\;\;\;\;\; (6)</code>
</p>

<p>and <code class="reqn">\underline{a}</code> is defined by:
</p>
<p style="text-align: center;"><code class="reqn">\underline{a} = \frac{\underline{m}^T V^{-1}}{[\underline{m}^T V^{-1} V^{-1} \underline{m}]^{1/2}} \;\;\;\;\;\; (7)</code>
</p>

<p>where <code class="reqn">^T</code> denotes the transpose operator, and <code class="reqn">\underline{m}</code> is the vector 
of expected values and <code class="reqn">V</code> is the variance-covariance matrix of the order 
statistics of a random sample of size <code class="reqn">N</code> from a standard normal distribution.  
That is, the values of <code class="reqn">\underline{a}</code> are the expected values of the standard 
normal order statistics weighted by their variance-covariance matrix, and 
normalized so that 
</p>
<p style="text-align: center;"><code class="reqn">\underline{a}^T \underline{a} = 1 \;\;\;\;\;\; (8)</code>
</p>

<p><em>Computing Shapiro-Wilk W-Statistic for Singly Censored Data</em> <br>
For the case of singly censored data, following Smith and Bain (1976) and 
Verrill and Johnson (1988), Royston (1993) generalizes the Shapiro-Wilk 
<code class="reqn">W</code>-statistic to:  
</p>
<p style="text-align: center;"><code class="reqn">W = r(\underline{a}_{\Delta}, \underline{x}_{\Delta})^2 \;\;\;\;\;\; (9)</code>
</p>

<p>where for left singly-censored data:
</p>
<p style="text-align: center;"><code class="reqn">\underline{a}_{\Delta} = (a_{c+1}, a_{c+2}, \ldots, a_{N}) \;\;\;\;\;\; (10)</code>
</p>

<p style="text-align: center;"><code class="reqn">\underline{x}_{\Delta} = (x_{(c+1)}, x_{(c+2)}, \ldots, x_{(N)}) \;\;\;\;\;\; (11)</code>
</p>

<p>and for right singly-censored data:
</p>
<p style="text-align: center;"><code class="reqn">\underline{a}_{\Delta} = (a_1, a_2, \ldots, a_n) \;\;\;\;\;\; (12)</code>
</p>

<p style="text-align: center;"><code class="reqn">\underline{x}_{\Delta} = (x_{(1)}, x_{(2)}, \ldots, x_{(n)}) \;\;\;\;\;\; (13)</code>
</p>

<p>Just like the function <code>gofTest</code>, 
when <code>test="sw"</code>, the function <code>gofTestCensored</code> uses Royston's (1992a) 
approximation for the coefficients <code class="reqn">\underline{a}</code> (see the help file for 
<code>gofTest</code>). 
</p>
<p><em>Computing P-Values for the Shapiro-Wilk Test</em> <br>
Verrill and Johnson (1988) show that the asymptotic distribution of the statistic 
in Equation (9) above is normal, but the rate of convergence is 
“surprisingly slow” even for complete samples.  They provide a table of 
empirical percentiles of the distribution for the <code class="reqn">W</code>-statistic shown in 
Equation (9) above for several sample sizes and percentages of censoring.
</p>
<p>Based on the tables given in Verrill and Johnson (1988), Royston (1993) approximated 
the 90'th, 95'th, and 99'th percentiles of the distribution of the z-statistic 
computed from the <code class="reqn">W</code>-statistic.  (The distribution of this z-statistic is 
assumed to be normal, but not necessarily a standard normal.)  Denote these 
percentiles by <code class="reqn">Z_{0.90}</code>, <code class="reqn">Z_{0.95}</code>, and <code class="reqn">Z_{0.99}</code>.  The true mean and 
standard deviation of the z-statistic are estimated by the intercept and slope, 
respectively, from the linear regression of <code class="reqn">Z_{\alpha}</code> on 
<code class="reqn">\Phi^{-1}(\alpha)</code> for <code class="reqn">\alpha</code> = 0.9, 0.95, and 0.99, where <code class="reqn">\Phi</code> 
denotes the cumulative distribution function of the standard normal distribution.  
The p-value associated with this test is then computed as:
</p>
<p style="text-align: center;"><code class="reqn">p = 1 - \Phi(\frac{z - \mu_z}{\sigma_z}) \;\;\;\;\;\; (14)</code>
</p>

<p>Note: Verrill and Johnson (1988) produced their tables based on Type II censoring.  
Royston's (1993) approximation to the p-value of these tests, however, should be 
fairly accurate for Type I censored data as well.
<br></p>
<p><em>Testing Goodness-of-Fit for Any Continuous Distribution</em> <br>
The function <code>gofTestCensored</code> extends the Shapiro-Wilk test that 
accounts for censoring to test for goodness-of-fit for any continuous 
distribution by using the idea of Chen and Balakrishnan (1995), 
who proposed a general purpose approximate goodness-of-fit test based on 
the Cramer-von Mises or Anderson-Darling goodness-of-fit tests for normality.  
The function <code>gofTestCensored</code> modifies the approach of 
Chen and Balakrishnan (1995) by using the same first 2 steps, and then 
applying the Shapiro-Wilk test that accounts for censoring:
</p>

<ol>
<li>
<p> Let <code class="reqn">\underline{x} = x_1, x_2, \ldots, x_n</code> denote the vector of 
<code class="reqn">n</code> <b><em>ordered</em></b> observations, ignoring censoring status.  
Compute cumulative probabilities for each <code class="reqn">x_i</code> based on the 
cumulative distribution function for the hypothesized distribution.  That is, 
compute <code class="reqn">p_i = F(x_i, \hat{\theta})</code>, where <code class="reqn">F(x, \theta)</code> denotes the 
hypothesized cumulative distribution function with parameter(s) <code class="reqn">\theta</code>, 
and <code class="reqn">\hat{\theta}</code> denotes the estimated parameter(s) using an estimation 
method that accounts for censoring (e.g., assuming a Gamma 
distribution with alternative parameterization, call the function 
<code>link{egammaAltCensored}</code>).
</p>
</li>
<li>
<p> Compute standard normal deviates based on the computed cumulative 
probabilities: <br><code class="reqn">y_i = \Phi^{-1}(p_i)</code>
</p>
</li>
<li>
<p> Perform the Shapiro-Wilk goodness-of-fit test (that accounts for 
censoring) on the <code class="reqn">y_i</code>'s.
</p>
</li>
</ol>
<p><b>Shapiro-Francia Goodness-of-Fit Test</b> (<code>test="sf"</code>) <br>
Equation (15) in the help file for <code>gofTest</code> shows that for the complete 
ordered data <code class="reqn">\underline{x}</code>, the Shapiro-Francia <code class="reqn">W'</code>-statistic is the 
same as the squared Pearson correlation coefficient associated with a normal 
probability plot.  
</p>
<p><em>Computing Shapiro-Francia W'-Statistic for Censored Data</em> <br>
For the case of singly censored data, following Smith and Bain (1976) and 
Verrill and Johnson (1988), Royston (1993) extends the computation of the 
Weisberg-Bingham Approximation to the <code class="reqn">W'</code>-statistic to the case of singly 
censored data:
</p>
<p style="text-align: center;"><code class="reqn">\tilde{W}' = r(\underline{c}_{\Delta}, \underline{x}_{\Delta})^2 \;\;\;\;\;\; (14)</code>
</p>

<p>where for left singly-censored data:
</p>
<p style="text-align: center;"><code class="reqn">\underline{c}_{\Delta} = (c_{c+1}, c_{c+2}, \ldots, c_{N}) \;\;\;\;\;\; (15)</code>
</p>

<p style="text-align: center;"><code class="reqn">\underline{x}_{\Delta} = (x_{(c+1)}, x_{(c+2)}, \ldots, x_{(N)}) \;\;\;\;\;\; (16)</code>
</p>

<p>and for right singly-censored data:
</p>
<p style="text-align: center;"><code class="reqn">\underline{a}_{\Delta} = (a_1, a_2, \ldots, a_n) \;\;\;\;\;\; (17)</code>
</p>

<p style="text-align: center;"><code class="reqn">\underline{x}_{\Delta} = (x_{(1)}, x_{(2)}, \ldots, x_{(n)}) \;\;\;\;\;\; (18)</code>
</p>

<p>and <code class="reqn">\underline{c}</code> is defined as:
</p>
<p style="text-align: center;"><code class="reqn">\underline{c} = \frac{\underline{\tilde{m}}}{[\underline{\tilde{m}}' \underline{\tilde{m}}]^{1/2}} \;\;\;\;\;\; (19)</code>
</p>

<p>where 
</p>
<p style="text-align: center;"><code class="reqn">\tilde{m}_i = \Phi^{-1}(\frac{i - (3/8)}{n + (1/4)}) \;\;\;\;\;\;  (20)</code>
</p>

<p>and <code class="reqn">\Phi</code> denotes the standard normal cdf.  <b>Note:</b>  Do not confuse the elements 
of the vector <code class="reqn">\underline{c}</code> with the scalar <code class="reqn">c</code> which denotes the number 
of censored observations.  We use <code class="reqn">\underline{c}</code> here to be consistent with the 
notation in the help file for <code>gofTest</code>.
</p>
<p>Just like the function <code>gofTest</code>, 
when <code>test="sf"</code>, the function <code>gofTestCensored</code> uses Royston's (1992a) 
approximation for the coefficients <code class="reqn">\underline{c}</code> (see the help file for 
<code>gofTest</code>). 
</p>
<p>In general, the Shapiro-Francia test statistic can be extended to multiply 
censored data using Equation (14) with <code class="reqn">\underline{c}_{\Delta}</code> defined as 
the orderd values of <code class="reqn">c_i</code> associated with uncensored observations, and 
<code class="reqn">\underline{x}_{\Delta}</code> defined as the ordered values of <code class="reqn">x_i</code> 
associated with uncensored observations:  
</p>
<p style="text-align: center;"><code class="reqn">\underline{c}_{\Delta} = \cup_{i \in \Omega} \;\; c_{(i)} \;\;\;\;\;\; (21)</code>
</p>

<p style="text-align: center;"><code class="reqn">\underline{x}_{\Delta} = \cup_{i \in \Omega} \;\; x_{(i)} \;\;\;\;\;\; (22)</code>
</p>

<p>and where the plotting positions in Equation (20) are replaced with any of the 
plotting positions available in <code>ppointsCensored</code> 
(see the description for the argument <code>prob.method</code>).
<br></p>
<p><em>Computing P-Values for the Shapiro-Francia Test</em> <br>
Verrill and Johnson (1988) show that the asymptotic distribution of the statistic 
in Equation (14) above is normal, but the rate of convergence is 
“surprisingly slow” even for complete samples.  They provide a table of 
empirical percentiles of the distribution for the <code class="reqn">\tilde{W}'</code>-statistic shown 
in Equation (14) above for several sample sizes and percentages of censoring.
</p>
<p>As for the Shapiro-Wilk test, based on the tables given in Verrill and Johnson (1988), 
Royston (1993) approximated the 90'th, 95'th, and 99'th percentiles of the 
distribution of the z-statistic computed from the <code class="reqn">\tilde{W}'</code>-statistic.  
(The distribution of this z-statistic is 
assumed to be normal, but not necessarily a standard normal.)  Denote these 
percentiles by <code class="reqn">Z_{0.90}</code>, <code class="reqn">Z_{0.95}</code>, and <code class="reqn">Z_{0.99}</code>.  The true mean and 
standard deviation of the z-statistic are estimated by the intercept and slope, 
respectively, from the linear regression of <code class="reqn">Z_{\alpha}</code> on 
<code class="reqn">\Phi^{-1}(\alpha)</code> for <code class="reqn">\alpha</code> = 0.9, 0.95, and 0.99, where <code class="reqn">\Phi</code> 
denotes the cumulative distribution function of the standard normal distribution.  
The p-value associated with this test is then computed as:
</p>
<p style="text-align: center;"><code class="reqn">p = 1 - \Phi(\frac{z - \mu_z}{\sigma_z}) \;\;\;\;\;\; (23)</code>
</p>

<p>Note: Verrill and Johnson (1988) produced their tables based on Type II censoring.  
Royston's (1993) approximation to the p-value of these tests, however, should be 
fairly accurate for Type I censored data as well, although this is an area that 
requires further investigation.
<br></p>
<p><em>Testing Goodness-of-Fit for Any Continuous Distribution</em> <br>
The function <code>gofTestCensored</code> extends the Shapiro-Francia test that 
accounts for censoring to test for goodness-of-fit for any continuous 
distribution by using the idea of Chen and Balakrishnan (1995), 
who proposed a general purpose approximate goodness-of-fit test based on 
the Cramer-von Mises or Anderson-Darling goodness-of-fit tests for normality.  
The function <code>gofTestCensored</code> modifies the approach of 
Chen and Balakrishnan (1995) by using the same first 2 steps, and then 
applying the Shapiro-Francia test that accounts for censoring:
</p>

<ol>
<li>
<p> Let <code class="reqn">\underline{x} = x_1, x_2, \ldots, x_n</code> denote the vector of 
<code class="reqn">n</code> <b><em>ordered</em></b> observations, ignoring censoring status.  
Compute cumulative probabilities for each <code class="reqn">x_i</code> based on the 
cumulative distribution function for the hypothesized distribution.  That is, 
compute <code class="reqn">p_i = F(x_i, \hat{\theta})</code> where <code class="reqn">F(x, \theta)</code> denotes the 
hypothesized cumulative distribution function with parameter(s) <code class="reqn">\theta</code>, 
and <code class="reqn">\hat{\theta}</code> denotes the estimated parameter(s) using an estimation 
method that accounts for censoring (e.g., assuming a Gamma 
distribution with alternative parameterization, call the function 
<code>link{egammaAltCensored}</code>).
</p>
</li>
<li>
<p> Compute standard normal deviates based on the computed cumulative 
probabilities: <br><code class="reqn">y_i = \Phi^{-1}(p_i)</code>
</p>
</li>
<li>
<p> Perform the Shapiro-Francia goodness-of-fit test (that accounts for 
censoring) on the <code class="reqn">y_i</code>'s.
</p>
</li>
</ol>
<p><b>Probability Plot Correlation Coefficient (PPCC) Goodness-of-Fit Test</b> (<code>test="ppcc"</code>) <br>
The function <code>gofTestCensored</code> computes the PPCC test statistic using Blom 
plotting positions.  It can be shown that the square of this statistic is equivalent 
to the Weisberg-Bingham Approximation to the Shapiro-Francia <code class="reqn">W'</code>-test 
(Weisberg and Bingham, 1975; Royston, 1993).  Thus the PPCC goodness-of-fit test 
is equivalent to the Shapiro-Francia goodness-of-fit test. 
</p>


<h3>Value</h3>

<p>a list of class <code>"gofCensored"</code> containing the results of the goodness-of-fit 
test.  See the help files for <code>gofCensored.object</code> for details.
</p>


<h3>Note</h3>

<p>The Shapiro-Wilk test (Shapiro and Wilk, 1965) and the Shapiro-Francia test 
(Shapiro and Francia, 1972) are probably the two most commonly used hypothesis tests to 
test departures from normality.  The Shapiro-Wilk test is most powerful at detecting 
short-tailed (platykurtic) and skewed distributions, and least powerful against 
symmetric, moderately long-tailed (leptokurtic) distributions.  Conversely, the 
Shapiro-Francia test is more powerful against symmetric long-tailed distributions and 
less powerful against short-tailed distributions (Royston, 1992b; 1993).
</p>
<p>In practice, almost any goodness-of-fit test will <em>not</em> reject the null hypothesis 
if the number of observations is relatively small.  Conversely, almost any goodness-of-fit 
test <em>will</em> reject the null hypothesis if the number of observations is very large, 
since “real” data are never distributed according to any theoretical distribution 
(Conover, 1980, p.367).  For most cases, however, the distribution of “real” data 
is close enough to some theoretical distribution that fairly accurate results may be 
provided by assuming that particular theoretical distribution.  One way to asses the 
goodness of the fit is to use goodness-of-fit tests.  Another way is to look at 
quantile-quantile (Q-Q) plots (see <code>qqPlotCensored</code>).
</p>


<h3>Author(s)</h3>

<p>Steven P. Millard (<a href="mailto:EnvStats@ProbStatInfo.com">EnvStats@ProbStatInfo.com</a>)
</p>


<h3>References</h3>

<p>Birnbaum, Z.W., and F.H. Tingey. (1951). 
One-Sided Confidence Contours for Probability Distribution Functions. 
<em>Annals of Mathematical Statistics</em> <b>22</b>, 592-596.
</p>
<p>Blom, G. (1958). <em>Statistical Estimates and Transformed Beta Variables</em>. 
John Wiley and Sons, New York.
</p>
<p>Conover, W.J. (1980). <em>Practical Nonparametric Statistics</em>. Second Edition. 
John Wiley and Sons, New York.
</p>
<p>Dallal, G.E., and L. Wilkinson. (1986). 
An Analytic Approximation to the Distribution of Lilliefor's Test for Normality. 
<em>The American Statistician</em> <b>40</b>, 294-296.
</p>
<p>D'Agostino, R.B. (1970). Transformation to Normality of the Null Distribution of <code class="reqn">g1</code>. 
<em>Biometrika</em> <b>57</b>, 679-681.
</p>
<p>D'Agostino, R.B. (1971). An Omnibus Test of Normality for Moderate and Large Size Samples. 
<em>Biometrika</em> <b>58</b>, 341-348.
</p>
<p>D'Agostino, R.B. (1986b). Tests for the Normal Distribution. In: D'Agostino, R.B., and M.A. Stephens, eds. 
<em>Goodness-of Fit Techniques</em>. Marcel Dekker, New York.
</p>
<p>D'Agostino, R.B., and E.S. Pearson (1973). Tests for Departures from Normality. 
Empirical Results for the Distributions of <code class="reqn">b2</code> and <code class="reqn">\sqrt{b1}</code>. 
<em>Biometrika</em> <b>60</b>(3), 613-622.
</p>
<p>D'Agostino, R.B., and G.L. Tietjen (1973). Approaches to the Null Distribution of <code class="reqn">\sqrt{b1}</code>. 
<em>Biometrika</em> <b>60</b>(1), 169-173.
</p>
<p>Fisher, R.A. (1950). <em>Statistical Methods for Research Workers</em>. 11'th Edition. 
Hafner Publishing Company, New York, pp.99-100.
</p>
<p>Gibbons, R.D., D.K. Bhaumik, and S. Aryal. (2009). 
<em>Statistical Methods for Groundwater Monitoring</em>, Second Edition.  
John Wiley &amp; Sons, Hoboken.
</p>
<p>Kendall, M.G., and A. Stuart. (1991). 
<em>The Advanced Theory of Statistics, Volume 2: Inference and Relationship</em>. 
Fifth Edition. Oxford University Press, New York.
</p>
<p>Royston, J.P. (1992a). Approximating the Shapiro-Wilk W-Test for Non-Normality. 
<em>Statistics and Computing</em> <b>2</b>, 117-119.
</p>
<p>Royston, J.P. (1992b). 
Estimation, Reference Ranges and Goodness of Fit for the Three-Parameter Log-Normal Distribution. 
<em>Statistics in Medicine</em> <b>11</b>, 897-912.
</p>
<p>Royston, J.P. (1992c). 
A Pocket-Calculator Algorithm for the Shapiro-Francia Test of Non-Normality: An Application to Medicine. 
<em>Statistics in Medicine</em> <b>12</b>, 181-184.
</p>
<p>Royston, P. (1993). A Toolkit for Testing for Non-Normality in Complete and Censored Samples. 
<em>The Statistician</em> <b>42</b>, 37-43.
</p>
<p>Ryan, T., and B. Joiner. (1973). <em>Normal Probability Plots and Tests for Normality</em>. 
Technical Report, Pennsylvannia State University, Department of Statistics.
</p>
<p>Shapiro, S.S., and R.S. Francia. (1972). An Approximate Analysis of Variance Test for Normality. 
<em>Journal of the American Statistical Association</em> <b>67</b>(337), 215-219.
</p>
<p>Shapiro, S.S., and M.B. Wilk. (1965). An Analysis of Variance Test for Normality (Complete Samples). 
<em>Biometrika</em> <b>52</b>, 591-611.
</p>
<p>Verrill, S., and R.A. Johnson. (1987). 
The Asymptotic Equivalence of Some Modified Shapiro-Wilk Statistics – Complete and Censored Sample Cases. 
<em>The Annals of Statistics</em> <b>15</b>(1), 413-419.
</p>
<p>Verrill, S., and R.A. Johnson. (1988). 
Tables and Large-Sample Distribution Theory for Censored-Data Correlation Statistics for Testing Normality. 
<em>Journal of the American Statistical Association</em> <b>83</b>, 1192-1197.
</p>
<p>Weisberg, S., and C. Bingham. (1975). 
An Approximate Analysis of Variance Test for Non-Normality Suitable for Machine Calculation. 
<em>Technometrics</em> <b>17</b>, 133-134.
</p>


<h3>See Also</h3>

<p><code>gofTest</code>, <code>gofCensored.object</code>, 
<code>print.gofCensored</code>, <code>plot.gofCensored</code>, 
<code>shapiro.test</code>, Normal, Lognormal, 
<code>enormCensored</code>, <code>elnormCensored</code>, 
<code>elnormAltCensored</code>, <code>qqPlotCensored</code>.
</p>


<h3>Examples</h3>

<pre><code class="language-R">  # Generate 30 observations from a gamma distribution with 
  # parameters mean=10 and cv=1 and then censor observations less than 5.
  # Then test the hypothesis that these data came from a gamma 
  # distribution using the Shapiro-Wilk test.
  #
  # The p-value for the complete data is p = 0.86, while  
  # the p-value for the censored data is p = 0.52.
  # (Note:  the call to set.seed lets you reproduce this example.)

  set.seed(598)

  dat &lt;- sort(rgammaAlt(30, mean = 10, cv = 1))
  dat
  # [1]  0.5313509  1.4741833  1.9936208  2.7980636  3.4509840
  # [6]  3.7987348  4.5542952  5.5207531  5.5253596  5.7177872
  #[11]  5.7513827  9.1086375  9.8444090 10.6247123 10.9304922
  #[16] 11.7925398 13.3432689 13.9562777 14.6029065 15.0563342
  #[21] 15.8730642 16.0039936 16.6910715 17.0288922 17.8507891
  #[26] 19.1105522 20.2657141 26.3815970 30.2912797 42.8726101

  dat.censored &lt;- dat
  censored &lt;- dat.censored &lt; 5
  dat.censored[censored] &lt;- 5

  # Results for complete data:
  #---------------------------
  gofTest(dat, test = "sw", dist = "gammaAlt")

  #Results of Goodness-of-Fit Test
  #-------------------------------
  #
  #Test Method:                     Shapiro-Wilk GOF Based on 
  #                                 Chen &amp; Balakrisnan (1995)
  #
  #Hypothesized Distribution:       Gamma
  #
  #Estimated Parameter(s):          mean = 12.4248552
  #                                 cv   =  0.7901752
  #
  #Estimation Method:               MLE
  #
  #Data:                            dat
  #
  #Sample Size:                     30
  #
  #Test Statistic:                  W = 0.981471
  #
  #Test Statistic Parameter:        n = 30
  #
  #P-value:                         0.8631802
  #
  #Alternative Hypothesis:          True cdf does not equal the
  #                                 Gamma Distribution.


  # Results for censored data:
  #---------------------------
  gof.list &lt;- gofTestCensored(dat.censored, censored, test = "sw", 
    distribution = "gammaAlt")
  gof.list  

  #Results of Goodness-of-Fit Test
  #Based on Type I Censored Data
  #-------------------------------
  #
  #Test Method:                     Shapiro-Wilk GOF
  #                                 (Singly Censored Data)
  #                                 Based on Chen &amp; Balakrisnan (1995)
  #
  #Hypothesized Distribution:       Gamma
  #
  #Censoring Side:                  left
  #
  #Censoring Level(s):              5 
  #
  #Estimated Parameter(s):          mean = 12.4911448
  #                                 cv   =  0.7617343
  #
  #Estimation Method:               MLE
  #
  #Data:                            dat.censored
  #
  #Censoring Variable:              censored
  #
  #Sample Size:                     30
  #
  #Percent Censored:                23.3%
  #
  #Test Statistic:                  W = 0.9613711
  #
  #Test Statistic Parameters:       N     = 30.0000000
  #                                 DELTA =  0.2333333
  #
  #P-value:                         0.522329
  #
  #Alternative Hypothesis:          True cdf does not equal the
  #                                 Gamma Distribution.

  # Plot the results for the censored data
  #---------------------------------------
  dev.new()
  plot(gof.list)

  #==========

  # Continue the above example, but now test the hypothesis that 
  # these data came from a lognormal distribution 
  # (alternative parameterization) using the Shapiro-Wilk test.
  #
  # The p-value for the complete data is p = 0.056, while  
  # the p-value for the censored data is p = 0.11.

  # Results for complete data:
  #---------------------------
  gofTest(dat, test = "sw", dist = "lnormAlt")

  #Results of Goodness-of-Fit Test
  #-------------------------------
  #
  #Test Method:                     Shapiro-Wilk GOF
  #
  #Hypothesized Distribution:       Lognormal
  #
  #Estimated Parameter(s):          mean = 13.757239
  #                                 cv   =  1.148872
  #
  #Estimation Method:               mvue
  #
  #Data:                            dat
  #
  #Sample Size:                     30
  #
  #Test Statistic:                  W = 0.9322226
  #
  #Test Statistic Parameter:        n = 30
  #
  #P-value:                         0.05626823
  #
  #Alternative Hypothesis:          True cdf does not equal the
  #                                 Lognormal Distribution.


  # Results for censored data:
  #---------------------------
  gof.list &lt;- gofTestCensored(dat.censored, censored, test = "sw", 
    distribution = "lnormAlt")
  gof.list  

  #Results of Goodness-of-Fit Test
  #Based on Type I Censored Data
  #-------------------------------
  #
  #Test Method:                     Shapiro-Wilk GOF
  #                                 (Singly Censored Data)
  #
  #Hypothesized Distribution:       Lognormal
  #
  #Censoring Side:                  left
  #
  #Censoring Level(s):              5 
  #
  #Estimated Parameter(s):          mean = 13.0382221
  #                                 cv   =  0.9129512
  #
  #Estimation Method:               MLE
  #
  #Data:                            dat.censored
  #
  #Censoring Variable:              censored
  #
  #Sample Size:                     30
  #
  #Percent Censored:                23.3%
  #
  #Test Statistic:                  W = 0.9292406
  #
  #Test Statistic Parameters:       N     = 30.0000000
  #                                 DELTA =  0.2333333
  #
  #P-value:                         0.114511
  #
  #Alternative Hypothesis:          True cdf does not equal the
  #                                 Lognormal Distribution.

  # Plot the results for the censored data
  #---------------------------------------
  dev.new()
  plot(gof.list)

  #----------

  # Redo the above example, but specify the quasi-minimum variance 
  # unbiased estimator of the mean.  Note that the method of 
  # estimating the parameters has no effect on the goodness-of-fit 
  # test (see the DETAILS section above).

  gofTestCensored(dat.censored, censored, test = "sw", 
    distribution = "lnormAlt", est.arg.list = list(method = "qmvue"))

  #Results of Goodness-of-Fit Test
  #Based on Type I Censored Data
  #-------------------------------
  #
  #Test Method:                     Shapiro-Wilk GOF
  #                                 (Singly Censored Data)
  #
  #Hypothesized Distribution:       Lognormal
  #
  #Censoring Side:                  left
  #
  #Censoring Level(s):              5 
  #
  #Estimated Parameter(s):          mean = 12.8722749
  #                                 cv   =  0.8712549
  #
  #Estimation Method:               Quasi-MVUE
  #
  #Data:                            dat.censored
  #
  #Censoring Variable:              censored
  #
  #Sample Size:                     30
  #
  #Percent Censored:                23.3%
  #
  #Test Statistic:                  W = 0.9292406
  #
  #Test Statistic Parameters:       N     = 30.0000000
  #                                 DELTA =  0.2333333
  #
  #P-value:                         0.114511
  #
  #Alternative Hypothesis:          True cdf does not equal the
  #                                 Lognormal Distribution.

  #----------
  # Clean up

  rm(dat, dat.censored, censored, gof.list)
  graphics.off()

  #==========

  # Check the assumption that the silver data stored in Helsel.Cohn.88.silver.df 
  # follows a lognormal distribution and plot the goodness-of-fit test results.  
  # Note that the small p-value and the shape of the Q-Q plot 
  # (an inverted S-shape) suggests that the log transformation is not quite strong 
  # enough to "bring in" the tails (i.e., the log-transformed silver data has tails 
  # that are slightly too long relative to a normal distribution).  
  # Helsel and Cohn (1988, p.2002) note that the gross outlier of 560 mg/L tends to 
  # make the shape of the data resemble a gamma distribution.

  dum.list &lt;- with(Helsel.Cohn.88.silver.df, 
    gofTestCensored(Ag, Censored, test = "sf", dist = "lnorm"))

  dum.list
  #Results of Goodness-of-Fit Test
  #Based on Type I Censored Data
  #-------------------------------
  #
  #Test Method:                     Shapiro-Francia GOF
  #                                 (Multiply Censored Data)
  #
  #Hypothesized Distribution:       Lognormal
  #
  #Censoring Side:                  left
  #
  #Censoring Level(s):               0.1  0.2  0.3  0.5  1.0  2.0  2.5  5.0  
  #                                  6.0 10.0 20.0 25.0 
  #
  #Estimated Parameter(s):          meanlog = -1.040572
  #                                 sdlog   =  2.354847
  #
  #Estimation Method:               MLE
  #
  #Data:                            Ag
  #
  #Censoring Variable:              Censored
  #
  #Sample Size:                     56
  #
  #Percent Censored:                60.7%
  #
  #Test Statistic:                  W = 0.8957198
  #
  #Test Statistic Parameters:       N     = 56.0000000
  #                                 DELTA =  0.6071429
  #
  #P-value:                         0.03490314
  #
  #Alternative Hypothesis:          True cdf does not equal the
  #                                 Lognormal Distribution.

  dev.new()
  plot(dum.list)

  #----------
  
  # Clean up
  #---------

  rm(dum.list)
  graphics.off()

  #==========

  # Chapter 15 of USEPA (2009) gives several examples of looking 
  # at normal Q-Q plots and estimating the mean and standard deviation 
  # for manganese concentrations (ppb) in groundwater at five background wells. 
  # In EnvStats these data are stored in the data frame 
  # EPA.09.Ex.15.1.manganese.df.

  # Here we will test whether the data appear to come from a normal 
  # distribution, then we will test to see whether they appear to come 
  # from a lognormal distribution.
  #--------------------------------------------------------------------


  # First look at the data:
  #-----------------------

  EPA.09.Ex.15.1.manganese.df

  #   Sample   Well Manganese.Orig.ppb Manganese.ppb Censored
  #1       1 Well.1                 &lt;5           5.0     TRUE
  #2       2 Well.1               12.1          12.1    FALSE
  #3       3 Well.1               16.9          16.9    FALSE
  #...
  #23      3 Well.5                3.3           3.3    FALSE
  #24      4 Well.5                8.4           8.4    FALSE
  #25      5 Well.5                 &lt;2           2.0     TRUE

  longToWide(EPA.09.Ex.15.1.manganese.df, 
    "Manganese.Orig.ppb", "Sample", "Well",
    paste.row.name = TRUE)  

  #         Well.1 Well.2 Well.3 Well.4 Well.5
  #Sample.1     &lt;5     &lt;5     &lt;5    6.3   17.9
  #Sample.2   12.1    7.7    5.3   11.9   22.7
  #Sample.3   16.9   53.6   12.6     10    3.3
  #Sample.4   21.6    9.5  106.3     &lt;2    8.4
  #Sample.5     &lt;2   45.9   34.5   77.2     &lt;2


  # Now test whether the data appear to come from 
  # a normal distribution.  Note that these data 
  # are multiply censored, so we'll use the 
  # Shapiro-Francia test.  
  #----------------------------------------------

  gof.normal &lt;- with(EPA.09.Ex.15.1.manganese.df,
    gofTestCensored(Manganese.ppb, Censored, test = "sf"))

  gof.normal

  #Results of Goodness-of-Fit Test
  #Based on Type I Censored Data
  #-------------------------------
  #
  #Test Method:                     Shapiro-Francia GOF
  #                                 (Multiply Censored Data)
  #
  #Hypothesized Distribution:       Normal
  #
  #Censoring Side:                  left
  #
  #Censoring Level(s):              2 5 
  #
  #Estimated Parameter(s):          mean = 15.23508
  #                                 sd   = 30.62812
  #
  #Estimation Method:               MLE
  #
  #Data:                            Manganese.ppb
  #
  #Censoring Variable:              Censored
  #
  #Sample Size:                     25
  #
  #Percent Censored:                24%
  #
  #Test Statistic:                  W = 0.8368016
  #
  #Test Statistic Parameters:       N     = 25.00
  #                                 DELTA =  0.24
  #
  #P-value:                         0.004662658
  #
  #Alternative Hypothesis:          True cdf does not equal the
  #                                 Normal Distribution.

  # Plot the results:
  #------------------

  dev.new()
  plot(gof.normal)

  #----------

  # Now test to see whether the data appear to come from 
  # a lognormal distribuiton.
  #-----------------------------------------------------

  gof.lognormal &lt;- with(EPA.09.Ex.15.1.manganese.df,
    gofTestCensored(Manganese.ppb, Censored, test = "sf", 
    distribution = "lnorm"))

  gof.lognormal

  #Results of Goodness-of-Fit Test
  #Based on Type I Censored Data
  #-------------------------------
  #
  #Test Method:                     Shapiro-Francia GOF
  #                                 (Multiply Censored Data)
  #
  #Hypothesized Distribution:       Lognormal
  #
  #Censoring Side:                  left
  #
  #Censoring Level(s):              2 5 
  #
  #Estimated Parameter(s):          meanlog = 2.215905
  #                                 sdlog   = 1.356291
  #
  #Estimation Method:               MLE
  #
  #Data:                            Manganese.ppb
  #
  #Censoring Variable:              Censored
  #
  #Sample Size:                     25
  #
  #Percent Censored:                24%
  #
  #Test Statistic:                  W = 0.9864426
  #
  #Test Statistic Parameters:       N     = 25.00
  #                                 DELTA =  0.24
  #
  #P-value:                         0.9767731
  #
  #Alternative Hypothesis:          True cdf does not equal the
  #                                 Lognormal Distribution.

  # Plot the results:
  #------------------

  dev.new()
  plot(gof.lognormal)

  #----------

  # Clean up
  #---------

  rm(gof.normal, gof.lognormal)
  graphics.off()
</code></pre>


</div>