<div class="container">

<table style="width: 100%;"><tr>
<td>psdengpd</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>P-Splines Density Estimate and GPD Tail Extreme Value Mixture Model</h2>

<h3>Description</h3>

<p>Density, cumulative distribution function, quantile function and
random number generation for the extreme value mixture model with P-splines density estimate for bulk
distribution upto the threshold and conditional GPD above threshold. The parameters
are the B-spline coefficients <code>beta</code> (and associated features), threshold <code>u</code>
GPD scale <code>sigmau</code> and shape <code>xi</code> and tail fraction <code>phiu</code>.
</p>


<h3>Usage</h3>

<pre><code class="language-R">dpsdengpd(x, beta = NULL, nbinwidth = NULL, xrange = NULL,
  nseg = 10, degree = 3, u = NULL, sigmau = NULL, xi = 0,
  phiu = TRUE, design.knots = NULL, log = FALSE)

ppsdengpd(q, beta = NULL, nbinwidth = NULL, xrange = NULL,
  nseg = 10, degree = 3, u = NULL, sigmau = NULL, xi = 0,
  phiu = TRUE, design.knots = NULL, lower.tail = TRUE)

qpsdengpd(p, beta = NULL, nbinwidth = NULL, xrange = NULL,
  nseg = 10, degree = 3, u = NULL, sigmau = NULL, xi = 0,
  phiu = TRUE, design.knots = NULL, lower.tail = TRUE)

rpsdengpd(n = 1, beta = NULL, nbinwidth = NULL, xrange = NULL,
  nseg = 10, degree = 3, u = NULL, sigmau = NULL, xi = 0,
  phiu = TRUE, design.knots = NULL)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>x</code></td>
<td>
<p>quantiles</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>beta</code></td>
<td>
<p>vector of B-spline coefficients (required)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>nbinwidth</code></td>
<td>
<p>scaling to convert count frequency into proper density</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>xrange</code></td>
<td>
<p>vector of minimum and maximum of B-spline (support of density)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>nseg</code></td>
<td>
<p>number of segments between knots</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>degree</code></td>
<td>
<p>degree of B-splines (0 is constant, 1 is linear, etc.)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>u</code></td>
<td>
<p>threshold</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>sigmau</code></td>
<td>
<p>scale parameter (positive)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>xi</code></td>
<td>
<p>shape parameter</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>phiu</code></td>
<td>
<p>probability of being above threshold <code class="reqn">[0, 1]</code> or <code>TRUE</code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>design.knots</code></td>
<td>
<p>spline knots for splineDesign function</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>log</code></td>
<td>
<p>logical, if TRUE then log density</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>q</code></td>
<td>
<p>quantiles</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>lower.tail</code></td>
<td>
<p>logical, if FALSE then upper tail probabilities</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>p</code></td>
<td>
<p>cumulative probabilities</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>n</code></td>
<td>
<p>sample size (positive integer)</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>Extreme value mixture model combining P-splines density estimate for the bulk
below the threshold and GPD for upper tail.
</p>
<p>The user can pre-specify <code>phiu</code> 
permitting a parameterised value for the tail fraction <code class="reqn">\phi_u</code>. Alternatively, when
<code>phiu=TRUE</code> the tail fraction is estimated as the tail fraction from the
KDE bulk model.
</p>
<p>The cumulative distribution function with tail fraction <code class="reqn">\phi_u</code> defined by the
upper tail fraction of the P-splines density estimate (<code>phiu=TRUE</code>), upto the 
threshold <code class="reqn">x \le u</code>, given by:
</p>
<p style="text-align: center;"><code class="reqn">F(x) = H(x)</code>
</p>

<p>and above the threshold <code class="reqn">x &gt; u</code>:
</p>
<p style="text-align: center;"><code class="reqn">F(x) = H(u) + [1 - H(u)] G(x)</code>
</p>

<p>where <code class="reqn">H(x)</code> and <code class="reqn">G(X)</code> are the P-splines density estimate and conditional GPD
cumulative distribution functions respectively.
</p>
<p>The cumulative distribution function for pre-specified <code class="reqn">\phi_u</code>, upto the
threshold <code class="reqn">x \le u</code>, is given by:
</p>
<p style="text-align: center;"><code class="reqn">F(x) = (1 - \phi_u) H(x)/H(u)</code>
</p>

<p>and above the threshold <code class="reqn">x &gt; u</code>:
</p>
<p style="text-align: center;"><code class="reqn">F(x) = \phi_u + [1 - \phi_u] G(x)</code>
</p>

<p>Notice that these definitions are equivalent when <code class="reqn">\phi_u = 1 - H(u)</code>.
</p>
<p>See <code>gpd</code> for details of GPD upper tail component. 
The specification of the underlying B-splines and the P-splines density estimator
are discussed in the <code>psden</code> function help.
</p>


<h3>Value</h3>

<p><code>dpsdengpd</code> gives the density, 
<code>ppsdengpd</code> gives the cumulative distribution function,
<code>qpsdengpd</code> gives the quantile function and 
<code>rpsdengpd</code> gives a random sample.
</p>


<h3>Note</h3>

<p>Unlike most of the other extreme value mixture model functions the 
<code>psdengpd</code> functions have not been vectorised as
this is not appropriate. The main inputs (<code>x</code>, <code>p</code> or <code>q</code>)
must be either a scalar or a vector, which also define the output length.
The B-splines coefficients <code>beta</code> and knots <code>design.knots</code> are vectors.
</p>
<p>Default values are provided for P-spline inputs of <code>degree</code> and <code>nseg</code> only, 
but all others must be provided by the user. The default sample size for
<code>rpsdengpd</code> is 1.
</p>
<p>Missing (<code>NA</code>) and Not-a-Number (<code>NaN</code>) values in <code>x</code>,
<code>p</code> and <code>q</code> are passed through as is and infinite values are set to
<code>NA</code>. None of these are permitted for the parameters/B-spline criteria.
</p>
<p>Due to symmetry, the lower tail can be described by GPD by negating the quantiles. 
</p>
<p>Error checking of the inputs (e.g. invalid probabilities) is carried out and
will either stop or give warning message as appropriate.
</p>


<h3>Author(s)</h3>

<p>Alfadino Akbar and Carl Scarrott <a href="mailto:carl.scarrott@canterbury.ac.nz">carl.scarrott@canterbury.ac.nz</a>.
</p>


<h3>References</h3>

<p><a href="http://en.wikipedia.org/wiki/B-spline">http://en.wikipedia.org/wiki/B-spline</a>
</p>
<p><a href="http://statweb.lsu.edu/faculty/marx/">http://statweb.lsu.edu/faculty/marx/</a>
</p>
<p><a href="http://en.wikipedia.org/wiki/Generalized_Pareto_distribution">http://en.wikipedia.org/wiki/Generalized_Pareto_distribution</a>
</p>
<p>Scarrott, C.J. and MacDonald, A. (2012). A review of extreme value
threshold estimation and uncertainty quantification. REVSTAT - Statistical
Journal 10(1), 33-59. Available from <a href="http://www.ine.pt/revstat/pdf/rs120102.pdf">http://www.ine.pt/revstat/pdf/rs120102.pdf</a>
</p>
<p>Eilers, P.H.C. and Marx, B.D. (1996). Flexible smoothing with B-splines and penalties.
Statistical Science 11(2), 89-121.
</p>


<h3>See Also</h3>

<p><code>psden</code> and <code>fpsden</code>.
</p>
<p>Other psden: <code>fpsdengpd</code>, <code>fpsden</code>,
<code>psden</code>
</p>
<p>Other psdengpd: <code>fpsdengpd</code>,
<code>psden</code>
</p>
<p>Other fpsdengpd: <code>fpsdengpd</code>
</p>


<h3>Examples</h3>

<pre><code class="language-R">## Not run: 
set.seed(1)
par(mfrow = c(1, 1))

x = rnorm(1000)
xx = seq(-6, 6, 0.01)
y = dnorm(xx)

# Plenty of histogram bins (100)
breaks = seq(-4, 4, length.out=101)

# P-spline fitting with cubic B-splines, 2nd order penalty and 8 internal segments
# CV search for penalty coefficient. 
fit = fpsdengpd(x, lambdaseq = 10^seq(-5, 5, 0.25), breaks = breaks,
             xrange = c(-4, 4), nseg = 10, degree = 3, ord = 2)
hist(x, freq = FALSE, breaks = seq(-4, 4, length.out=101), xlim = c(-6, 6))

# P-splines only
with(fit, lines(xx, dpsden(xx, beta, nbinwidth, design = design.knots), lwd = 2, col = "blue"))

# P-splines+GPD
with(fit, lines(xx, dpsdengpd(xx, beta, nbinwidth, design = design.knots, 
   u = u, sigmau = sigmau, xi = xi, phiu = phiu), lwd = 2, col = "red"))
abline(v = fit$u, col = "red")

legend("topleft", c("True Density","P-spline density", "P-spline+GPD"),
 col=c("black", "blue", "red"), lty = 1)

## End(Not run)

</code></pre>


</div>