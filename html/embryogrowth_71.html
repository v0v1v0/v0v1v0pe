<div class="container">

<table style="width: 100%;"><tr>
<td>tsd_MHmcmc</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Metropolis-Hastings algorithm for Sex ratio</h2>

<h3>Description</h3>

<p>Run the Metropolis-Hastings algorithm for tsd.<br>
Deeply modified from a MCMC script by Olivier Martin (INRA, Paris-Grignon).<br>
The number of iterations is n.iter+n.adapt+1 because the initial likelihood is also displayed.<br>
I recommend that thin=1 because the method to estimate SE uses resampling.<br>
If initial point is maximum likelihood, n.adapt = 0 is a good solution.<br>
To get the SE from result_mcmc &lt;- tsd_MHmcmc(result=try), use:<br>
result_mcmc$BatchSE or result_mcmc$TimeSeriesSE<br>
The batch standard error procedure is usually thought to be not as accurate as the time series methods.<br>
Based on Jones, Haran, Caffo and Neath (2005), the batch size should be equal to sqrt(n.iter).<br>
Jones, G.L., Haran, M., Caffo, B.S. and Neath, R. (2006) Fixed Width Output Analysis for Markov chain Monte Carlo , Journal of the American Statistical Association, 101:1537-1547.<br>
coda package is necessary for this function.<br>
The parameters intermediate and filename are used to save intermediate results every 'intermediate' iterations (for example 1000). Results are saved in a file of name filename.<br>
The parameter previous is used to indicate the list that has been save using the parameters intermediate and filename. It permits to continue a mcmc search.<br>
These options are used to prevent the consequences of computer crash or if the run is very very long and processes at time limited.<br></p>


<h3>Usage</h3>

<pre><code class="language-R">tsd_MHmcmc(
  result = stop("A result of tsd() fit must be provided"),
  n.iter = 10000,
  parametersMCMC = NULL,
  n.chains = 1,
  n.adapt = 0,
  thin = 1,
  trace = FALSE,
  traceML = FALSE,
  batchSize = sqrt(n.iter),
  adaptive = FALSE,
  adaptive.lag = 500,
  adaptive.fun = function(x) {
     ifelse(x &gt; 0.234, 1.3, 0.7)
 },
  intermediate = NULL,
  filename = "intermediate.Rdata",
  previous = NULL
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>result</code></td>
<td>
<p>An object obtained after a SearchR fit</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>n.iter</code></td>
<td>
<p>Number of iterations for each step</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>parametersMCMC</code></td>
<td>
<p>A set of parameters used as initial point for searching with information on priors</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>n.chains</code></td>
<td>
<p>Number of replicates</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>n.adapt</code></td>
<td>
<p>Number of iterations before to store outputs</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>thin</code></td>
<td>
<p>Number of iterations between each stored output</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>trace</code></td>
<td>
<p>TRUE or FALSE or period, shows progress</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>traceML</code></td>
<td>
<p>TRUE or FALSE to show ML</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>batchSize</code></td>
<td>
<p>Number of observations to include in each batch fo SE estimation</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>adaptive</code></td>
<td>
<p>Should an adaptive process for SDProp be used</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>adaptive.lag</code></td>
<td>
<p>Lag to analyze the SDProp value in an adaptive content</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>adaptive.fun</code></td>
<td>
<p>Function used to change the SDProp</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>intermediate</code></td>
<td>
<p>Period for saving intermediate result, NULL for no save</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>filename</code></td>
<td>
<p>If intermediate is not NULL, save intermediate result in this file</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>previous</code></td>
<td>
<p>Previous result to be continued. Can be the filename in which intermediate results are saved.</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>tsd_MHmcmc runs the Metropolis-Hastings algorithm for tsd (Bayesian MCMC)
</p>


<h3>Value</h3>

<p>A list with resultMCMC being mcmc.list object, resultLnL being likelihoods and parametersMCMC being the parameters used
</p>


<h3>Author(s)</h3>

<p>Marc Girondot <a href="mailto:marc.girondot@gmail.com">marc.girondot@gmail.com</a>
</p>


<h3>See Also</h3>

<p>Other Functions for temperature-dependent sex determination: 
<code>DatabaseTSD</code>,
<code>DatabaseTSD.version()</code>,
<code>P_TRT()</code>,
<code>ROSIE</code>,
<code>ROSIE.version()</code>,
<code>TSP.list</code>,
<code>plot.tsd()</code>,
<code>predict.tsd()</code>,
<code>stages</code>,
<code>tsd()</code>,
<code>tsd_MHmcmc_p()</code>
</p>


<h3>Examples</h3>

<pre><code class="language-R">## Not run: 
library(embryogrowth)
eo &lt;- subset(DatabaseTSD, Species=="Emys orbicularis", c("Males", "Females", 
                                       "Incubation.temperature"))
eo_logistic &lt;- tsd(eo)
pMCMC &lt;- tsd_MHmcmc_p(eo_logistic, accept=TRUE)
# Take care, it can be very long
result_mcmc_tsd &lt;- tsd_MHmcmc(result=eo_logistic, 
		parametersMCMC=pMCMC, n.iter=10000, n.chains = 1,  
		n.adapt = 0, thin=1, trace=FALSE, adaptive=TRUE)
# summary() permits to get rapidly the standard errors for parameters
summary(result_mcmc_tsd)
plot(result_mcmc_tsd, parameters="S", scale.prior=TRUE, xlim=c(-3, 3), las=1)
plot(result_mcmc_tsd, parameters="P", scale.prior=TRUE, xlim=c(25, 35), las=1)

plot(eo_logistic, resultmcmc = result_mcmc_tsd)

1-rejectionRate(as.mcmc(result_mcmc_tsd))
raftery.diag(as.mcmc(result_mcmc_tsd))
heidel.diag(as.mcmc(result_mcmc_tsd))
library(car)
o &lt;- P_TRT(x=eo_logistic, resultmcmc=result_mcmc_tsd)
outEo &lt;- dataEllipse(x=o$P_TRT[, "PT"], 
                     y=o$P_TRT[, "TRT"], 
                     levels=c(0.95), 
                     draw=FALSE)
plot(x = o$P_TRT[, "PT"], 
     y=o$P_TRT[, "TRT"], 
     pch=".", las=1, bty="n", 
     xlab="Pivotal temperature", 
     ylab=paste0("TRT ", as.character(100*eo_logistic$l), "%"), 
     xlim=c(28.4, 28.6), 
     ylim=c(0.8, 1.8))
lines(outEo[, 1], outEo[, 2], col="green", lwd=2)
legend("topleft", legend = c("Emys orbicularis", "95% confidence ellipse"), 
       pch=c(19, NA), col=c("black", "green"), lty=c(0, 1), lwd=c(0, 2))

logistic &lt;- function(x, P, S) {
   return(1/(1+exp((1/S)*(P-x))))
}

q &lt;- as.quantile(result_mcmc_tsd, fun=logistic, 
                 xlim=seq(from=25, to=35, by=0.1), nameparxlim="x")
plot(x=seq(from=25, to=35, by=0.1), y=q[1, ], type="l", las=1, 
     xlab="Temperatures", ylab="Male proportion", bty="n")
lines(x=seq(from=25, to=35, by=0.1), y=q[2, ])


## End(Not run)
</code></pre>


</div>