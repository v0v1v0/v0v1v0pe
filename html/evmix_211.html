<div class="container">

<table style="width: 100%;"><tr>
<td>fhpdcon</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>MLE Fitting of Hybrid Pareto Extreme Value Mixture Model with Single Continuity Constraint</h2>

<h3>Description</h3>

<p>Maximum likelihood estimation for fitting the Hybrid Pareto extreme
value mixture model, with only continuity at threshold and not necessarily
continuous in first derivative. With options for profile likelihood estimation for
threshold and fixed threshold approach.
</p>


<h3>Usage</h3>

<pre><code class="language-R">fhpdcon(x, useq = NULL, fixedu = FALSE, pvector = NULL,
  std.err = TRUE, method = "BFGS", control = list(maxit = 10000),
  finitelik = TRUE, ...)

lhpdcon(x, nmean = 0, nsd = 1, u = qnorm(0.9, nmean, nsd), xi = 0,
  log = TRUE)

nlhpdcon(pvector, x, finitelik = FALSE)

profluhpdcon(u, pvector, x, method = "BFGS", control = list(maxit =
  10000), finitelik = TRUE, ...)

nluhpdcon(pvector, u, x, finitelik = FALSE)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>x</code></td>
<td>
<p>vector of sample data</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>useq</code></td>
<td>
<p>vector of thresholds (or scalar) to be considered in profile likelihood or
<code>NULL</code> for no profile likelihood</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>fixedu</code></td>
<td>
<p>logical, should threshold be fixed (at either scalar value in <code>useq</code>,
or estimated from maximum of profile likelihood evaluated at
sequence of thresholds in <code>useq</code>)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>pvector</code></td>
<td>
<p>vector of initial values of parameters or <code>NULL</code> for default
values, see below</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>std.err</code></td>
<td>
<p>logical, should standard errors be calculated</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>method</code></td>
<td>
<p>optimisation method (see <code>optim</code>)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>control</code></td>
<td>
<p>optimisation control list (see <code>optim</code>)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>finitelik</code></td>
<td>
<p>logical, should log-likelihood return finite value for invalid parameters</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>optional inputs passed to <code>optim</code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>nmean</code></td>
<td>
<p>scalar normal mean</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>nsd</code></td>
<td>
<p>scalar normal standard deviation (positive)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>u</code></td>
<td>
<p>scalar threshold value</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>xi</code></td>
<td>
<p>scalar shape parameter</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>log</code></td>
<td>
<p>logical, if <code>TRUE</code> then log-likelihood rather than likelihood is output</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>The hybrid Pareto model is fitted to the entire dataset using maximum
likelihood estimation, with only continuity at threshold and not necessarily
continuous in first derivative. The estimated parameters, variance-covariance matrix
and their standard errors are automatically output.
</p>
<p>Note that the key difference between this model (<code>hpdcon</code>) and the 
normal with GPD tail and continuity at threshold (<code>normgpdcon</code>) is that the
latter includes the rescaling of the conditional GPD component
by the tail fraction to make it an unconditional tail model. However, for the hybrid
Pareto with single continuity constraint use the GPD in it's conditional form with no
differential scaling compared to the bulk model.
</p>
<p>See help for <code>fnormgpd</code> for details, type <code>help fnormgpd</code>. Only
the different features are outlined below for brevity.
</p>
<p>The profile likelihood and fixed threshold approach functionality are implemented for this
version of the hybrid Pareto as it includes the threshold as a parameter. Whereas the usual
hybrid Pareto does not naturally have a threshold parameter.
</p>
<p>The GPD <code>sigmau</code> parameter is now specified as function of other parameters, see 
help for <code>dhpdcon</code> for details, type <code>help hpdcon</code>.
Therefore, <code>sigmau</code> should not be included in the parameter vector if initial values
are provided, making the full parameter vector 
(<code>nmean</code>, <code>nsd</code>, <code>u</code>, <code>xi</code>) if threshold is also estimated and
(<code>nmean</code>, <code>nsd</code>, <code>xi</code>) for profile likelihood or fixed threshold approach.
</p>


<h3>Value</h3>

<p><code>lhpdcon</code>, <code>nlhpdcon</code>,
and <code>nluhpdcon</code> give the log-likelihood,
negative log-likelihood and profile likelihood for threshold. Profile likelihood
for single threshold is given by <code>profluhpdcon</code>.
<code>fhpdcon</code> returns a simple list with the following elements
</p>

<table>
<tr>
<td style="text-align: left;">
 <code>call</code>:    </td>
<td style="text-align: left;"> <code>optim</code> call</td>
</tr>
<tr>
<td style="text-align: left;">
 <code>x</code>:       </td>
<td style="text-align: left;"> data vector <code>x</code>
</td>
</tr>
<tr>
<td style="text-align: left;">
 <code>init</code>:    </td>
<td style="text-align: left;"> <code>pvector</code>
</td>
</tr>
<tr>
<td style="text-align: left;">
 <code>fixedu</code>:  </td>
<td style="text-align: left;"> fixed threshold, logical</td>
</tr>
<tr>
<td style="text-align: left;">
 <code>useq</code>:    </td>
<td style="text-align: left;"> threshold vector for profile likelihood or scalar for fixed threshold</td>
</tr>
<tr>
<td style="text-align: left;">
 <code>nllhuseq</code>:  </td>
<td style="text-align: left;"> profile negative log-likelihood at each threshold in useq</td>
</tr>
<tr>
<td style="text-align: left;">
 <code>optim</code>:   </td>
<td style="text-align: left;"> complete <code>optim</code> output</td>
</tr>
<tr>
<td style="text-align: left;">
 <code>mle</code>:     </td>
<td style="text-align: left;"> vector of MLE of parameters</td>
</tr>
<tr>
<td style="text-align: left;">
 <code>cov</code>:     </td>
<td style="text-align: left;"> variance-covariance matrix of MLE of parameters</td>
</tr>
<tr>
<td style="text-align: left;">
 <code>se</code>:      </td>
<td style="text-align: left;"> vector of standard errors of MLE of parameters</td>
</tr>
<tr>
<td style="text-align: left;">
 <code>rate</code>:    </td>
<td style="text-align: left;"> <code>phiu</code> to be consistent with <code>evd</code>
</td>
</tr>
<tr>
<td style="text-align: left;">
 <code>nllh</code>:    </td>
<td style="text-align: left;"> minimum negative log-likelihood</td>
</tr>
<tr>
<td style="text-align: left;">
 <code>n</code>:       </td>
<td style="text-align: left;"> total sample size</td>
</tr>
<tr>
<td style="text-align: left;">
 <code>nmean</code>:   </td>
<td style="text-align: left;"> MLE of normal mean</td>
</tr>
<tr>
<td style="text-align: left;">
 <code>nsd</code>:     </td>
<td style="text-align: left;"> MLE of normal standard deviation</td>
</tr>
<tr>
<td style="text-align: left;">
 <code>u</code>:       </td>
<td style="text-align: left;"> threshold (fixed or MLE)</td>
</tr>
<tr>
<td style="text-align: left;">
 <code>sigmau</code>:  </td>
<td style="text-align: left;"> MLE of GPD scale (estimated from other parameters)</td>
</tr>
<tr>
<td style="text-align: left;">
 <code>xi</code>:      </td>
<td style="text-align: left;"> MLE of GPD shape</td>
</tr>
<tr>
<td style="text-align: left;">
 <code>phiu</code>:    </td>
<td style="text-align: left;"> MLE of tail fraction (implied by <code>1/(1+pnorm(u,nmean,nsd))</code>)</td>
</tr>
<tr>
<td style="text-align: left;">
</td>
</tr>
</table>
<h3>Acknowledgments</h3>

<p>See Acknowledgments in
<code>fnormgpd</code>, type <code>help fnormgpd</code>.
</p>


<h3>Note</h3>

<p>When <code>pvector=NULL</code> then the initial values are:
</p>

<ul>
<li>
<p> threshold 90% quantile (not relevant for profile likelihood for threshold or fixed threshold approaches);
</p>
</li>
<li>
<p> MLE of normal parameters assuming entire population is normal; and
</p>
</li>
<li>
<p> MLE of GPD parameters above threshold. 
</p>
</li>
</ul>
<p>Avoid setting the starting value for the shape parameter to
<code>xi=0</code> as depending on the optimisation method it may be get stuck.
</p>


<h3>Author(s)</h3>

<p>Yang Hu and Carl Scarrott <a href="mailto:carl.scarrott@canterbury.ac.nz">carl.scarrott@canterbury.ac.nz</a>
</p>


<h3>References</h3>

<p><a href="http://www.math.canterbury.ac.nz/~c.scarrott/evmix">http://www.math.canterbury.ac.nz/~c.scarrott/evmix</a>
</p>
<p><a href="http://en.wikipedia.org/wiki/Normal_distribution">http://en.wikipedia.org/wiki/Normal_distribution</a>
</p>
<p><a href="http://en.wikipedia.org/wiki/Generalized_Pareto_distribution">http://en.wikipedia.org/wiki/Generalized_Pareto_distribution</a>
</p>
<p>Scarrott, C.J. and MacDonald, A. (2012). A review of extreme value
threshold estimation and uncertainty quantification. REVSTAT - Statistical
Journal 10(1), 33-59. Available from <a href="http://www.ine.pt/revstat/pdf/rs120102.pdf">http://www.ine.pt/revstat/pdf/rs120102.pdf</a>
</p>
<p>Hu, Y. (2013). Extreme value mixture modelling: An R package and simulation study.
MSc (Hons) thesis, University of Canterbury, New Zealand.
<a href="http://ir.canterbury.ac.nz/simple-search?query=extreme&amp;submit=Go">http://ir.canterbury.ac.nz/simple-search?query=extreme&amp;submit=Go</a>
</p>
<p>Carreau, J. and Y. Bengio (2008). A hybrid Pareto model for asymmetric fat-tailed data:
the univariate case. Extremes 12 (1), 53-76.
</p>


<h3>See Also</h3>

<p><code>dnorm</code>,
<code>fgpd</code> and <code>gpd</code>
</p>
<p>The condmixt package written by one of the
original authors of the hybrid Pareto model (Carreau and Bengio, 2008) also has 
similar functions for the likelihood of the hybrid Pareto 
(hpareto.negloglike) and fitting (hpareto.fit).
</p>
<p>Other hpd: <code>fhpd</code>, <code>hpdcon</code>,
<code>hpd</code>
</p>
<p>Other hpdcon: <code>fhpd</code>, <code>hpdcon</code>,
<code>hpd</code>
</p>
<p>Other normgpdcon: <code>fgngcon</code>,
<code>flognormgpdcon</code>, <code>fnormgpdcon</code>,
<code>fnormgpd</code>, <code>gngcon</code>,
<code>gng</code>, <code>hpdcon</code>,
<code>hpd</code>, <code>normgpdcon</code>,
<code>normgpd</code>
</p>
<p>Other fhpdcon: <code>hpdcon</code>
</p>


<h3>Examples</h3>

<pre><code class="language-R">## Not run: 
set.seed(1)
par(mfrow = c(2, 1))

x = rnorm(1000)
xx = seq(-4, 4, 0.01)
y = dnorm(xx)

# Hybrid Pareto provides reasonable fit for some asymmetric heavy upper tailed distributions
# but not for cases such as the normal distribution

# Continuity constraint
fit = fhpdcon(x)
hist(x, breaks = 100, freq = FALSE, xlim = c(-4, 4))
lines(xx, y)
with(fit, lines(xx, dhpdcon(xx, nmean, nsd, u, xi), col="red"))
abline(v = fit$u, col = "red")
  
# No continuity constraint
fit2 = fhpd(x)
with(fit2, lines(xx, dhpd(xx, nmean, nsd, xi), col="blue"))
abline(v = fit2$u, col = "blue")
legend("topleft", c("True Density","No continuity constraint","With continuty constraint"),
  col=c("black", "blue", "red"), lty = 1)
  
# Profile likelihood for initial value of threshold and fixed threshold approach
fitu = fhpdcon(x, useq = seq(-2, 2, length = 20))
fitfix = fhpdcon(x, useq = seq(-2, 2, length = 20), fixedu = TRUE)

hist(x, breaks = 100, freq = FALSE, xlim = c(-4, 4))
lines(xx, y)
with(fit, lines(xx, dhpdcon(xx, nmean, nsd, u, xi), col="red"))
abline(v = fit$u, col = "red")
with(fitu, lines(xx, dhpdcon(xx, nmean, nsd, u, xi), col="purple"))
abline(v = fitu$u, col = "purple")
with(fitfix, lines(xx, dhpdcon(xx, nmean, nsd, u, xi), col="darkgreen"))
abline(v = fitfix$u, col = "darkgreen")
legend("topleft", c("True Density","Default initial value (90% quantile)",
 "Prof. lik. for initial value", "Prof. lik. for fixed threshold"),
 col=c("black", "red", "purple", "darkgreen"), lty = 1)
  
# Notice that if tail fraction is included a better fit is obtained
fittailfrac = fnormgpdcon(x)

par(mfrow = c(1, 1))
hist(x, breaks = 100, freq = FALSE, xlim = c(-4, 4))
lines(xx, y)
with(fit, lines(xx, dhpdcon(xx, nmean, nsd, u, xi), col="red"))
abline(v = fit$u, col = "red")
with(fittailfrac, lines(xx, dnormgpdcon(xx, nmean, nsd, u, xi), col="blue"))
abline(v = fittailfrac$u)
legend("topright", c("Standard Normal", "Hybrid Pareto Continuous", "Normal+GPD Continuous"),
  col=c("black", "red", "blue"), lty = 1)

## End(Not run)

</code></pre>


</div>