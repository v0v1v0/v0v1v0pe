<div class="container">

<table style="width: 100%;"><tr>
<td>step_umap</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Supervised and unsupervised uniform manifold approximation and projection
(UMAP)</h2>

<h3>Description</h3>

<p><code>step_umap()</code> creates a <em>specification</em> of a recipe step that will project a
set of features into a smaller space.
</p>


<h3>Usage</h3>

<pre><code class="language-R">step_umap(
  recipe,
  ...,
  role = "predictor",
  trained = FALSE,
  outcome = NULL,
  neighbors = 15,
  num_comp = 2,
  min_dist = 0.01,
  metric = "euclidean",
  learn_rate = 1,
  epochs = NULL,
  initial = "spectral",
  target_weight = 0.5,
  options = list(verbose = FALSE, n_threads = 1),
  seed = sample(10^5, 2),
  prefix = "UMAP",
  keep_original_cols = FALSE,
  retain = deprecated(),
  object = NULL,
  skip = FALSE,
  id = rand_id("umap")
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>recipe</code></td>
<td>
<p>A recipe object. The step will be added to the
sequence of operations for this recipe.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>One or more selector functions to choose variables
for this step. See <code>selections()</code> for more details.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>role</code></td>
<td>
<p>For model terms created by this step, what analysis role should
they be assigned? By default, the new columns created by this step from
the original variables will be used as <em>predictors</em> in a model.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>trained</code></td>
<td>
<p>A logical to indicate if the quantities for
preprocessing have been estimated.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>outcome</code></td>
<td>
<p>A call to <code>vars</code> to specify which variable is used as the
outcome in the encoding process (if any).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>neighbors</code></td>
<td>
<p>An integer for the number of nearest neighbors used to
construct the target simplicial set. If <code>neighbors</code> is greater than the
number of data points, the smaller value is used.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>num_comp</code></td>
<td>
<p>An integer for the number of UMAP components. If <code>num_comp</code>
is greater than the number of selected columns minus one, the smaller value
is used.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>min_dist</code></td>
<td>
<p>The effective minimum distance between embedded points.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>metric</code></td>
<td>
<p>Character, type of distance metric to use to find nearest
neighbors. See <code>uwot::umap()</code> for more details. Default to <code>"euclidean"</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>learn_rate</code></td>
<td>
<p>Positive number of the learning rate for the optimization
process.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>epochs</code></td>
<td>
<p>Number of iterations for the neighbor optimization. See
<code>uwot::umap()</code> for more details.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>initial</code></td>
<td>
<p>Character, Type of initialization for the coordinates. Can be
one of <code>"spectral"</code>, <code>"normlaplacian"</code>, <code>"random"</code>, <code>"lvrandom"</code>,
<code>"laplacian"</code>, <code>"pca"</code>, <code>"spca"</code>, <code>"agspectral"</code>, or a matrix of initial
coordinates. See <code>uwot::umap()</code> for more details. Default to <code>"spectral"</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>target_weight</code></td>
<td>
<p>Weighting factor between data topology and target
topology. A value of 0.0 weights entirely on data, a value of 1.0 weights
entirely on target. The default of 0.5 balances the weighting equally
between data and target.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>options</code></td>
<td>
<p>A list of options to pass to <code>uwot::umap()</code>. The arguments
<code>X</code>, <code>n_neighbors</code>, <code>n_components</code>, <code>min_dist</code>, <code>n_epochs</code>, <code>ret_model</code>,
and <code>learning_rate</code> should not be passed here. By default, <code>verbose</code> and
<code>n_threads</code> are set.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>seed</code></td>
<td>
<p>Two integers to control the random numbers used by the numerical
methods. The default pulls from the main session's stream of numbers and
will give reproducible results if the seed is set prior to calling <code>prep()</code>
or <code>bake()</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>prefix</code></td>
<td>
<p>A character string for the prefix of the resulting new
variables. See notes below.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>keep_original_cols</code></td>
<td>
<p>A logical to keep the original variables in the
output. Defaults to <code>FALSE</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>retain</code></td>
<td>
<p>Use <code>keep_original_cols</code> instead to specify whether the
original predictors should be retained along with the new embedding
variables.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>object</code></td>
<td>
<p>An object that defines the encoding. This is <code>NULL</code> until the
step is trained by <code>recipes::prep()</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>skip</code></td>
<td>
<p>A logical. Should the step be skipped when the
recipe is baked by <code>bake()</code>? While all operations are baked
when <code>prep()</code> is run, some operations may not be able to be
conducted on new data (e.g. processing the outcome variable(s)).
Care should be taken when using <code>skip = TRUE</code> as it may affect
the computations for subsequent operations.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>id</code></td>
<td>
<p>A character string that is unique to this step to identify it.</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>UMAP, short for Uniform Manifold Approximation and Projection, is a nonlinear
dimension reduction technique that finds local, low-dimensional
representations of the data. It can be run unsupervised or supervised with
different types of outcome data (e.g. numeric, factor, etc).
</p>
<p>The argument <code>num_comp</code> controls the number of components that will be retained
(the original variables that are used to derive the components are removed from
the data). The new components will have names that begin with <code>prefix</code> and a
sequence of numbers. The variable names are padded with zeros. For example, if
<code>num_comp &lt; 10</code>, their names will be <code>UMAP1</code> - <code>UMAP9</code>. If <code>num_comp = 101</code>,
the names would be <code>UMAP1</code> - <code>UMAP101</code>.
</p>


<h3>Value</h3>

<p>An updated version of <code>recipe</code> with the new step added to the
sequence of any existing operations.
</p>


<h3>Tidying</h3>

<p>When you <code>tidy()</code> this step, a tibble is retruned with
columns <code>terms</code> and <code>id</code>:
</p>

<dl>
<dt>terms</dt>
<dd>
<p>character, the selectors or variables selected</p>
</dd>
<dt>id</dt>
<dd>
<p>character, id of this step</p>
</dd>
</dl>
<h3>Tuning Parameters</h3>

<p>This step has 5 tuning parameters:
</p>

<ul>
<li> <p><code>num_comp</code>: # Components (type: integer, default: 2)
</p>
</li>
<li> <p><code>neighbors</code>: # Nearest Neighbors (type: integer, default: 15)
</p>
</li>
<li> <p><code>min_dist</code>: Min Distance between Points (type: double, default: 0.01)
</p>
</li>
<li> <p><code>learn_rate</code>: Learning Rate (type: double, default: 1)
</p>
</li>
<li> <p><code>epochs</code>: # Epochs (type: integer, default: NULL)
</p>
</li>
</ul>
<h3>Case weights</h3>

<p>The underlying operation does not allow for case weights.
</p>


<h3>Saving prepped recipe object</h3>

<p>This recipe step may require native serialization when saving for
use in another R session. To learn more about serialization for
prepped recipes, see the <a href="https://rstudio.github.io/bundle/">bundle</a> package.
</p>


<h3>References</h3>

<p>McInnes, L., &amp; Healy, J. (2018). UMAP: Uniform Manifold
Approximation and Projection for Dimension Reduction.
<a href="https://arxiv.org/abs/1802.03426">https://arxiv.org/abs/1802.03426</a>.
</p>
<p>"How UMAP Works"
<a href="https://umap-learn.readthedocs.io/en/latest/how_umap_works.html">https://umap-learn.readthedocs.io/en/latest/how_umap_works.html</a>
</p>


<h3>Examples</h3>

<pre><code class="language-R">
library(recipes)
library(ggplot2)

split &lt;- seq.int(1, 150, by = 9)
tr &lt;- iris[-split, ]
te &lt;- iris[split, ]

set.seed(11)
supervised &lt;-
  recipe(Species ~ ., data = tr) %&gt;%
  step_center(all_predictors()) %&gt;%
  step_scale(all_predictors()) %&gt;%
  step_umap(all_predictors(), outcome = vars(Species), num_comp = 2) %&gt;%
  prep(training = tr)

theme_set(theme_bw())

bake(supervised, new_data = te, Species, starts_with("umap")) %&gt;%
  ggplot(aes(x = UMAP1, y = UMAP2, col = Species)) +
  geom_point(alpha = .5)

</code></pre>


</div>