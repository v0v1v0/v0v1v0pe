<div class="container">

<table style="width: 100%;"><tr>
<td>ensemble_create</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Create ensemble of SDM predictions</h2>

<h3>Description</h3>

<p>Create a weighted or unweighted ensemble of SDM predictions, including associated uncertainty values
</p>


<h3>Usage</h3>

<pre><code class="language-R">ensemble_create(x, x.idx, w = NULL, x.var.idx = NULL, ...)

## S3 method for class 'sf'
ensemble_create(x, x.idx, w = NULL, x.var.idx = NULL, ...)

## S3 method for class 'data.frame'
ensemble_create(x, x.idx, w = NULL, x.var.idx = NULL, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>x</code></td>
<td>
<p>object of class <code>sf</code> or class <code>data.frame</code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>x.idx</code></td>
<td>
<p>vector of column names or numerical indices;
indicates which columns in <code>x</code> will be used to create the ensemble</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>w</code></td>
<td>
<p>weights for the ensemble; either a numeric vector the same length as <code>x</code> or
a data frame (or tibble) with the same number of rows as <code>x</code> and <code>ncol(w) == length(x.idx)</code>.
If w is a numeric vector, its values (i.e. the weights) must sum to 1.
The default value is <code>1 / length(x.idx)</code>, i.e. an unweighted ensemble</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>x.var.idx</code></td>
<td>
<p>vector of column names or column indices;
indicates columns in <code>x</code> with variance values with which to
calculate uncertainty values for the ensemble.
If <code>x.var.idx</code> is specified, it must be the same length as <code>x.idx</code>.
Use <code>x.var.idx = NULL</code> (the default) if none of the predictions have associated uncertainty values;
in this case the uncertainty values for the ensemble will be calculated using the among-model uncertainty.
See the 'Details' section for more information</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>Arguments to be passed to methods; specifically designed for passing
<code>na.rm</code> argument to <code>sum</code></p>
</td>
</tr>
</table>
<h3>Details</h3>

<p><code>ensemble_create</code> is designed to be used after overlaying predictions with <code>overlay_sdm</code> and
(if desired) rescaling the overlaid predictions with <code>ensemble_rescale</code>.
</p>
<p>This function implements ensemble methods provided in eSDM_GUI.
Note that it does not implement regional exclusion, which must be done manually if not using the GUI.
</p>
<p>Ensemble uncertainty is calculated using either the within-model uncertainty (if <code>x.var.idx</code> is specified) or
the among-model uncertainty (if <code>x.var.idx</code> is <code>NULL</code>).
See the eSDM GUI manual for applicable formulas.
</p>


<h3>Value</h3>

<p>An object of the same class as <code>x</code> with two columns appended to the data frame:
</p>

<ul>
<li>
<p> 'Pred_ens' - The ensemble predictions
</p>
</li>
<li>
<p> 'Var_ens' - The variance of the ensemble predictions,
calculated using either the within-model uncertainty (if <code>x.var.idx</code> is specified) or
the among-model uncertainty (if <code>x.var.idx</code> is <code>NULL</code>)
</p>
</li>
</ul>
<p>Note that all other columns of <code>x</code> will be included in the returned object.
Also, if <code>x</code> is of class <code>sf</code> then
1) the geometry list-column will be the last column of the returned object and
2) the <code>agr</code> attribute will be set as 'constant' for 'Pred_ens' and 'Var_ens'
</p>


<h3>Examples</h3>

<pre><code class="language-R">ensemble_create(preds.1, c("Density", "Density2"), c(0.2, 0.8))
ensemble_create(preds.1, 1:2, c(0.2, 0.8), c("Var1", "Var2"))
ensemble_create(data.frame(a = 1:5, b = 3:7), c(1, 2))

weights.df &lt;- data.frame(runif(325), c(rep(NA, 100), runif(225)))
ensemble_create(preds.1, c("Density", "Density2"), weights.df, na.rm = TRUE)

</code></pre>


</div>