<div class="container">

<table style="width: 100%;"><tr>
<td>echepoi</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>
Echelon spatial scan statistic based on Poisson model
</h2>

<h3>Description</h3>

<p><code>echepoi</code> detects spatial clusters using echelon spatial scan statistic based on Poisson model.
</p>


<h3>Usage</h3>

<pre><code class="language-R">echepoi(echelon.obj, cas, pop = NULL, ex = NULL, K = length(cas)/2, n.sim = 99,
        cluster.type = "high", cluster.legend.pos = "bottomleft",
        dendrogram = TRUE, cluster.info = FALSE, coo = NULL, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>echelon.obj</code></td>
<td>

<p>An object of class <code>echelon</code>. See <code>echelon</code>.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>cas</code></td>
<td>

<p>A numeric (integer) vector of case counts.
<code>NA</code>s are not allowed.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>pop</code></td>
<td>

<p>A numeric (integer) vector for population.
<code>NA</code>s are not allowed.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>ex</code></td>
<td>

<p>A numeric vector for expected cases.
<code>NA</code>s are not allowed.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>K</code></td>
<td>

<p>Maximum cluster size. if <code>K</code> &gt;= 1 (integer), the cluster size is limit to less than or equal to number of regions <code>K</code>. On the other hand, if 0 &lt; <code>K</code> &lt; 1, the cluster size is limit to less than or equal to <code>K *</code> 100% of the total population.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>n.sim</code></td>
<td>

<p>Number of Monte Carlo replications used for significance testing of detected clusters. If 0, the significance is not assessed.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>cluster.type</code></td>
<td>

<p>A character string specifying the cluster type. If <code>"high"</code>, the detected clusters have high rates (hotspot clusters). On the other hand, If <code>"low"</code>, the detected clusters have low rates (coldspot cluster).
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>cluster.legend.pos</code></td>
<td>

<p>A location of the legend on the dendrogram. (See the help for <code>legend</code>)
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>dendrogram</code></td>
<td>

<p>Logical. if TRUE, draw an echelon dendrogram with detected clusters.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>cluster.info</code></td>
<td>

<p>Logical. if TRUE, return the result of detected clusters for detail.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>coo</code></td>
<td>

<p>An array of (x,y)-coordinates of the region centroid to draw a cluster map.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>

<p>Related to dendrogram drawing. (See the help for <code>echelon</code>)
</p>
</td>
</tr>
</table>
<h3>Value</h3>



<table>
<tr style="vertical-align: top;">
<td><code>clusters</code></td>
<td>
<p>Each detected cluster.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>scanned.regions</code></td>
<td>
<p>A region list of all scanning processes.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>simulated.LLR</code></td>
<td>
<p>Monte Carlo samples of the log-likelihood ratio.</p>
</td>
</tr>
</table>
<h3>Note</h3>

<p><code>echepoi</code> requires either <code>pop</code> or <code>ex</code>.
</p>
<p>Typical values of <code>n.sim</code> are 99, 999, 9999, ...
</p>


<h3>Author(s)</h3>

<p>Fumio Ishioka
</p>


<h3>References</h3>

<p>[1] Kulldorff M. (1997). A spatial scan statistic. <em>Communications in Statistics: Theory and Methods</em>, <strong>26</strong>, 1481–1496.
</p>
<p>[2] Ishioka F, Kawahara J, Mizuta M, Minato S, and Kurihara K. (2019) Evaluation of hotspot cluster detection using spatial scan statistic based on exact counting. <em>Japanese Journal of Statistics and Data Science</em>, <strong>2</strong>, 241–262.
</p>


<h3>See Also</h3>

<p><code>echelon</code> for the echelon analysis.
</p>
<p><code>echebin</code> for cluster detection based on echelons using Binomial model.
</p>


<h3>Examples</h3>

<pre><code class="language-R">##Hotspot detection for SIDS data of North Carolina using echelon scan

#Mortality rate per 1,000 live births from 1974 to 1984
library(spData)
data("nc.sids")
SIDS.cas &lt;- nc.sids$SID74 + nc.sids$SID79
SIDS.pop &lt;- nc.sids$BIR74 + nc.sids$BIR79
SIDS.rate &lt;- SIDS.cas * 1000 / SIDS.pop

#Hotspot detection based on Poisson model
SIDS.echelon &lt;- echelon(x = SIDS.rate, nb = ncCR85.nb, name = row.names(nc.sids))
echepoi(SIDS.echelon, cas = SIDS.cas, pop = SIDS.pop, K = 20,
  main = "Hgih rate clusters", ens = FALSE)
text(SIDS.echelon$coord, labels = SIDS.echelon$regions.name,
  adj = -0.1, cex = 0.7)

#Detected clusters and neighbors map
#XY coordinates of each polygon centroid point
NC.coo &lt;- cbind(nc.sids$lon, nc.sids$lat)
echepoi(SIDS.echelon, cas = SIDS.cas, pop = SIDS.pop, K = 20,
  coo = NC.coo, dendrogram = FALSE)


##Detected clusters map
#Here is an example using the sf class "sf"
SIDS.clusters &lt;- echepoi(SIDS.echelon, cas = SIDS.cas,
  pop = SIDS.pop, K = 20, dendrogram = FALSE)
MLC &lt;- SIDS.clusters$clusters[[1]]
Secondary &lt;- SIDS.clusters$clusters[[2]]
cluster.col &lt;- rep(0,times=length(SIDS.rate))
cluster.col[MLC$regionsID] &lt;- 2
cluster.col[Secondary$regionsID] &lt;- 3

library(sf)
nc &lt;- st_read(system.file("shape/nc.shp", package = "sf"))
plot(nc$geometry, col = cluster.col,
main = "Detected high rate clusters")
text(st_coordinates(st_centroid(st_geometry(nc))),
  labels = nc$CRESS_ID, cex =0.75)
legend("bottomleft",
  c(paste("1- p-value:", MLC$p),
  paste("2- p-value:", Secondary$p)),
  text.col = c(2,3))

</code></pre>


</div>