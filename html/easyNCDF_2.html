<div class="container">

<table style="width: 100%;"><tr>
<td>ArrayToNc</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Save multidimensional R arrays into NetCDF files</h2>

<h3>Description</h3>

<p>This function takes as input one or a list of multidimensional R
arrays and stores them in a NetCDF file, using the <code>ncdf4</code> package. The
full path and name of the resulting file must be specified. Metadata can be 
attached to the arrays and propagated into the NetCDF file in 3 possible 
ways:<br></p>

<ul>
<li>
<p>Via the list names if a list of arrays is provided:Each name in 
the input list, corresponding to one multidimensional array, will be
interpreted as the name of the variable it contains.<br>
E.g:<br><code>
ArrayToNc(arrays = list(temperature = array(1:9, c(3, 3))),
         file_path = 'example.nc')
     </code>

</p>
</li>
<li>
<p>Via the dimension names of each provided array:The dimension names
of each of the provided arrays will be interpreted as names for the 
dimensions of the NetCDF files. Read further for special dimension 
names that will trigger special behaviours, such as 'time' and 'var'.
<br>
E.g:<br><code>
temperature &lt;- array(rnorm(100 * 50 * 10), dim = c(100, 50, 10))
names(dim(temperature)) &lt;- c('longitude', 'latitude', 'time')
ArrayToNc(list(temperature = temperature), file_path = 'example.nc')
     </code>

</p>
</li>
<li>
<p>Via the attribute 'variables' of each provided array:The arrays 
can be provided with metadata in an attribute named 'variables', which
is expected to be a named list of named lists, where the names of the 
container list are the names of the variables present in the provided
array, and where each sub-list contains metadata for each of the 
variables. The attribute names and values supported in the sub-lists 
must follow the same format the package <code>ncdf4</code> uses to represent
the NetCDF file headers.<br>
E.g:<br><code>
a &lt;- array(1:400, dim = c(5, 10, 4, 2))
metadata &lt;- list(
             tos = list(addOffset = 100,
                        scaleFact = 10,
                        dim = list(list(name = 'time',
                                        unlim = FALSE))),
             tas = list(addOffset = 100,
                        scaleFact = 10,
                        dim = list(list(name = 'time',
                                        unlim = FALSE)))
           )
attr(a, 'variables') &lt;- metadata
names(dim(a)) &lt;- c('lat', 'lon', 'time', 'var')
ArrayToNc(a, 'tmp.nc')
     </code>

</p>
</li>
</ul>
<p>The special dimension names are 'var'/'variable' and 'time'.<br>
If a dimension is named 'var' or 'variable', <code>ArrayToNc</code> will interpret 
each array entry along such dimension corresponds to a separate new variable,
hence will create a new variable inside the NetCDF file and will use it to 
store all the data in the provided array for the corresponding entry along the
'var'/'variable' dimension.<br>
If a dimension is named 'time', by default it will be interpreted and built as
an unlimited dimension. The 'time' dimension must be the last dimension of the
array (the right-most). If a 'var'/'variable' dimension is present, the 'time'
dimension can be also placed on its left (i.e. the one before the last
dimension). The default behaviour of creating the 'time' as unlimited 
dimension can be disabled by setting manually the attribute 
<code>unlim = FALSE</code>, as shown in the previous example.<br><br><code>a2nc</code> is an alias of <code>ArrayToNc</code>.
</p>


<h3>Usage</h3>

<pre><code class="language-R">ArrayToNc(arrays, file_path)

a2nc(arrays, file_path)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>arrays</code></td>
<td>
<p>One or a list of multidimensional data arrays. The list can be 
provided with names, which will be interpreted as variable names. The arrays
can be provided with dimension names. The arrays can be provided with
metadata in the attribute 'variables' (read section Description for details).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>file_path</code></td>
<td>
<p>Path and name of the NetCDF file to be created.</p>
</td>
</tr>
</table>
<h3>Value</h3>

<p>This function returns NULL.
</p>


<h3>Author(s)</h3>

<p>N. Manubens <a href="mailto:nicolau.manubens@bsc.es">nicolau.manubens@bsc.es</a>
</p>


<h3>Examples</h3>

<pre><code class="language-R"> ## Not run: 
# Minimal use case
ArrayToNc(array(1:9, c(3, 3)), 'tmp.nc')
# Works with arrays of any number of dimensions
ArrayToNc(array(1:27, c(3, 3, 3)), 'tmp.nc')

# Arrays can also be provided in [named] lists
ArrayToNc(list(tos = array(1:27, c(3, 3, 3))), 'tmp.nc')

# Or with dimension names
# 'var' dimension name will generate multiple variables in the 
# resulting NetCDF file
a &lt;- array(1:27, dim = c(3, 3, 3))
names(dim(a)) &lt;- c('lon', 'lat', 'var')
ArrayToNc(a, 'tmp.nc')

# 'variable' as dimension name will do the same
a &lt;- array(1:27, dim = c(3, 3, 3))
names(dim(a)) &lt;- c('lon', 'lat', 'variable')
ArrayToNc(a, 'tmp.nc')

# The 'time' dimension will be built as unlimited dimension, by default
a &lt;- array(1:1600, dim = c(10, 20, 4, 2))
names(dim(a)) &lt;- c('lat', 'lon', 'time', 'var')
ArrayToNc(a, 'tmp.nc')

# The dimension 'var'/'variable' can be in any position and can have any 
# length.
a &lt;- array(1:1600, dim = c(10, 20, 4, 2))
names(dim(a)) &lt;- c('lat', 'var', 'lon', 'time')
ArrayToNc(a, 'tmp.nc')

# Multiple arrays can be provided in a list
a &lt;- array(1:400, dim = c(5, 10, 4, 2))
names(dim(a)) &lt;- c('lat', 'lon', 'time', 'var')
ArrayToNc(list(a, a), 'tmp.nc')

# If no dimension names are given to an array, new names will be automatically
# generated
a &lt;- array(1:400, dim = c(5, 10, 4, 2))
b &lt;- array(1:400, dim = c(5, 11, 4, 2))
names(dim(a)) &lt;- c('lat', 'lon', 'time', 'var')
ArrayToNc(list(a, b), 'tmp.nc')

# Metadata can be provided for each variable in each array, via the
# attribute 'variables'. In this example the metadata is empty.
a &lt;- array(1:400, dim = c(5, 10, 4, 2))
metadata &lt;- list(
             tos = list(),
             tas = list())
attr(a, 'variables') &lt;- metadata
names(dim(a)) &lt;- c('lat', 'lon', 'time', 'var')
ArrayToNc(a, 'tmp.nc')

# Variable names can be manually specified
a &lt;- array(1:400, dim = c(5, 10, 4, 2))
metadata &lt;- list(
            tos = list(name = 'name1'),
             tas = list(name = 'name2'))
attr(a, 'variables') &lt;- metadata
names(dim(a)) &lt;- c('lat', 'lon', 'time', 'var')
ArrayToNc(a, 'tmp.nc')
# Units can be specified
a &lt;- array(1:400, dim = c(5, 10, 4, 2))
metadata &lt;- list(
             tos = list(units = 'K'),
             tas = list(units = 'K'))
attr(a, 'variables') &lt;- metadata
names(dim(a)) &lt;- c('lat', 'lon', 'time', 'var')
ArrayToNc(a, 'tmp.nc')

# addOffset and scaleFactor can be specified
a &lt;- array(1:400, dim = c(5, 10, 4, 2))
metadata &lt;- list(
             tos = list(addOffset = 100,
                        scaleFact = 10),
            tas = list(addOffset = 100,
                        scaleFact = 10))
attr(a, 'variables') &lt;- metadata
names(dim(a)) &lt;- c('lat', 'lon', 'time', 'var')
ArrayToNc(a, 'tmp.nc')

# Global attributes can be specified
a &lt;- array(rnorm(10), dim = c(a = 5, b = 2))
attrs &lt;- list(variables =
          list(tas = list(var_attr_1 = 'test_1_var',
                          var_attr_2 = 2)),
          global_attrs = list(global_attr_name_1 = 'test_1_global',
                              global_attr_name_2 = 2))
attributes(a) &lt;- c(attributes(a), attrs)
ArrayToNc(a, 'tmp.nc')

# Unlimited dimensions can be manually created
a &lt;- array(1:400, dim = c(5, 10, 4, 2))
metadata &lt;- list(
             tos = list(addOffset = 100,
                        scaleFact = 10,
                        dim = list(list(name = 'unlimited',
                                        unlim = TRUE))),
             tas = list(addOffset = 100,
                        scaleFact = 10,
                        dim = list(list(name = 'unlimited',
                                        unlim = TRUE))))
attr(a, 'variables') &lt;- metadata
names(dim(a)) &lt;- c('lat', 'lon', 'unlimited', 'var')
ArrayToNc(a, 'tmp.nc')

# A 'time' dimension can be built without it necessarily being unlimited
a &lt;- array(1:400, dim = c(5, 10, 4, 2))
metadata &lt;- list(
             tos = list(addOffset = 100,
                        scaleFact = 10,
                        dim = list(list(name = 'time',
                                        unlim = FALSE))),
             tas = list(addOffset = 100,
                       scaleFact = 10,
                        dim = list(list(name = 'time',
                                        unlim = FALSE))))
attr(a, 'variables') &lt;- metadata
names(dim(a)) &lt;- c('lat', 'lon', 'time', 'var')
ArrayToNc(a, 'tmp.nc')

tos &lt;- array(1:400, dim = c(5, 10, 4))
metadata &lt;- list(tos = list(units = 'K'))
attr(tos, 'variables') &lt;- metadata
names(dim(tos)) &lt;- c('lat', 'lon', 'time')
lon &lt;- seq(0, 360 - 360 / 10, length.out = 10)
dim(lon) &lt;- length(lon)
metadata &lt;- list(lon = list(units = 'degrees_east'))
attr(lon, 'variables') &lt;- metadata
names(dim(lon)) &lt;- 'lon'
lat &lt;- seq(-90, 90, length.out = 5)
dim(lat) &lt;- length(lat)
metadata &lt;- list(lat = list(units = 'degrees_north'))
attr(lat, 'variables') &lt;- metadata
names(dim(lat)) &lt;- 'lat'
ArrayToNc(list(tos, lon, lat), 'tmp.nc')

## End(Not run)

</code></pre>


</div>