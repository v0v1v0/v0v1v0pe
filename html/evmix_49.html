<div class="container">

<table style="width: 100%;"><tr>
<td>gngcon</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Normal Bulk with GPD Upper and Lower Tails Extreme Value Mixture Model
with Single Continuity Constraint at Thresholds</h2>

<h3>Description</h3>

<p>Density, cumulative distribution function, quantile function and
random number generation for the extreme value mixture model with normal
for bulk distribution between the upper and lower thresholds with
conditional GPD's for the two tails with continuity at the lower and upper thresholds.
The parameters are the normal mean
<code>nmean</code> and standard deviation <code>nsd</code>, lower tail (threshold <code>ul</code>, 
GPD shape <code>xil</code> and tail fraction <code>phiul</code>)
and upper tail (threshold <code>ur</code>, GPD shape 
<code>xiR</code> and tail fraction <code>phiuR</code>).
</p>


<h3>Usage</h3>

<pre><code class="language-R">dgngcon(x, nmean = 0, nsd = 1, ul = qnorm(0.1, nmean, nsd),
  xil = 0, phiul = TRUE, ur = qnorm(0.9, nmean, nsd), xir = 0,
  phiur = TRUE, log = FALSE)

pgngcon(q, nmean = 0, nsd = 1, ul = qnorm(0.1, nmean, nsd),
  xil = 0, phiul = TRUE, ur = qnorm(0.9, nmean, nsd), xir = 0,
  phiur = TRUE, lower.tail = TRUE)

qgngcon(p, nmean = 0, nsd = 1, ul = qnorm(0.1, nmean, nsd),
  xil = 0, phiul = TRUE, ur = qnorm(0.9, nmean, nsd), xir = 0,
  phiur = TRUE, lower.tail = TRUE)

rgngcon(n = 1, nmean = 0, nsd = 1, ul = qnorm(0.1, nmean, nsd),
  xil = 0, phiul = TRUE, ur = qnorm(0.9, nmean, nsd), xir = 0,
  phiur = TRUE)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>x</code></td>
<td>
<p>quantiles</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>nmean</code></td>
<td>
<p>normal mean</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>nsd</code></td>
<td>
<p>normal standard deviation (positive)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>ul</code></td>
<td>
<p>lower tail threshold</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>xil</code></td>
<td>
<p>lower tail GPD shape parameter</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>phiul</code></td>
<td>
<p>probability of being below lower threshold <code class="reqn">[0, 1]</code> or <code>TRUE</code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>ur</code></td>
<td>
<p>upper tail threshold</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>xir</code></td>
<td>
<p>upper tail GPD shape parameter</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>phiur</code></td>
<td>
<p>probability of being above upper threshold <code class="reqn">[0, 1]</code> or <code>TRUE</code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>log</code></td>
<td>
<p>logical, if TRUE then log density</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>q</code></td>
<td>
<p>quantiles</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>lower.tail</code></td>
<td>
<p>logical, if FALSE then upper tail probabilities</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>p</code></td>
<td>
<p>cumulative probabilities</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>n</code></td>
<td>
<p>sample size (positive integer)</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>Extreme value mixture model combining normal distribution for the bulk
between the lower and upper thresholds and GPD for upper and lower tails with Continuity Constraints at the lower and upper threshold. The
user can pre-specify <code>phiul</code> and <code>phiur</code> permitting a parameterised
value for the lower and upper tail fraction respectively. Alternatively, when
<code>phiul=TRUE</code> or <code>phiur=TRUE</code> the corresponding tail fraction is
estimated as from the normal bulk model.
</p>
<p>Notice that the tail fraction cannot be 0 or 1, and the sum of upper and lower tail
fractions <code>phiul+phiur&lt;1</code>, so the lower threshold must be less than the upper, 
<code>ul&lt;ur</code>.
</p>
<p>The cumulative distribution function now has three components. The lower tail with 
tail fraction <code class="reqn">\phi_{ul}</code> defined by the normal bulk model (<code>phiul=TRUE</code>)
upto the lower threshold <code class="reqn">x &lt; u_l</code>:
</p>
<p style="text-align: center;"><code class="reqn">F(x) = H(u_l) G_l(x).</code>
</p>

<p>where <code class="reqn">H(x)</code> is the normal cumulative distribution function (i.e. 
<code>pnorm(ur, nmean, nsd)</code>). The 
<code class="reqn">G_l(X)</code> is the conditional GPD cumulative distribution function with negated
data and threshold, i.e. <code>dgpd(-x, -ul, sigmaul, xil, phiul)</code>. The normal
bulk model between the thresholds <code class="reqn">u_l \le x \le u_r</code> given by:
</p>
<p style="text-align: center;"><code class="reqn">F(x) = H(x).</code>
</p>

<p>Above the threshold <code class="reqn">x &gt; u_r</code> the usual conditional GPD:
</p>
<p style="text-align: center;"><code class="reqn">F(x) = H(u_r) + [1 - H(u_r)] G(x)</code>
</p>

<p>where <code class="reqn">G(X)</code>.
</p>
<p>The cumulative distribution function for the pre-specified tail fractions 
<code class="reqn">\phi_{ul}</code> and <code class="reqn">\phi_{ur}</code> is more complicated.  The unconditional GPD
is used for the lower tail <code class="reqn">x &lt; u_l</code>:
</p>
<p style="text-align: center;"><code class="reqn">F(x) = \phi_{ul} G_l(x).</code>
</p>

<p>The normal bulk model between the thresholds <code class="reqn">u_l \le x \le u_r</code> given by:
</p>
<p style="text-align: center;"><code class="reqn">F(x) = \phi_{ul}+ (1-\phi_{ul}-\phi_{ur}) (H(x) - H(u_l)) / (H(u_r) - H(u_l)).</code>
</p>

<p>Above the threshold <code class="reqn">x &gt; u_r</code> the usual conditional GPD:
</p>
<p style="text-align: center;"><code class="reqn">F(x) = (1-\phi_{ur}) + \phi_{ur} G(x)</code>
</p>

<p>Notice that these definitions are equivalent when <code class="reqn">\phi_{ul} = H(u_l)</code> and
<code class="reqn">\phi_{ur} = 1 - H(u_r)</code>.
</p>
<p>The continuity constraint at <code>ur</code> means that:
</p>
<p style="text-align: center;"><code class="reqn">\phi_{ur} g_r(x) = (1-\phi_{ul}-\phi_{ur}) h(u_r)/ (H(u_r) - H(u_l)).</code>
</p>

<p>By rearrangement, the GPD scale parameter <code>sigmaur</code> is then:
</p>
<p style="text-align: center;"><code class="reqn">\sigma_ur = \phi_{ur} (H(u_r) - H(u_l))/ h(u_r) (1-\phi_{ul}-\phi_{ur}).</code>
</p>

<p>where <code class="reqn">h(x)</code>, <code class="reqn">g_l(x)</code> and <code class="reqn">g_r(x)</code> are the normal and conditional GPD
density functions for lower and upper tail respectively. 
In the special case of where the tail fraction is defined by the bulk model this reduces to
</p>
<p style="text-align: center;"><code class="reqn">\sigma_ur = [1-H(u_r)] / h(u_r)</code>
</p>
<p>.
</p>
<p>The continuity constraint at <code>ul</code> means that:
</p>
<p style="text-align: center;"><code class="reqn">\phi_{ul} g_l(x) = (1-\phi_{ul}-\phi_{ur}) h(u_l)/ (H(u_r) - H(u_l)).</code>
</p>

<p>The GPD scale parameter <code>sigmaul</code> is replaced by:
</p>
<p style="text-align: center;"><code class="reqn">\sigma_ul = \phi_{ul} (H(u_r) - H(u_l))/ h(u_l) (1-\phi_{ul}-\phi_{ur}).</code>
</p>

<p>In the special case of where the tail fraction is defined by the bulk model this reduces to
</p>
<p style="text-align: center;"><code class="reqn">\sigma_ul = H(u_l)/ h(u_l)</code>
</p>
<p>. 
</p>
<p>See <code>gpd</code> for details of GPD upper tail component, 
<code>dnorm</code> for details of normal bulk component,
<code>dnormgpd</code> for normal with GPD extreme value
mixture model and <code>dgng</code> for normal bulk with GPD 
upper and lower tails extreme value mixture model.
</p>


<h3>Value</h3>

<p><code>dgngcon</code> gives the density, 
<code>pgngcon</code> gives the cumulative distribution function,
<code>qgngcon</code> gives the quantile function and 
<code>rgngcon</code> gives a random sample.
</p>


<h3>Note</h3>

<p>All inputs are vectorised except <code>log</code> and <code>lower.tail</code>.
The main inputs (<code>x</code>, <code>p</code> or <code>q</code>) and parameters must be either
a scalar or a vector. If vectors are provided they must all be of the same length,
and the function will be evaluated for each element of vector. In the case of 
<code>rgngcon</code> any input vector must be of length <code>n</code>.
</p>
<p>Default values are provided for all inputs, except for the fundamentals 
<code>x</code>, <code>q</code> and <code>p</code>. The default sample size for 
<code>rgngcon</code> is 1.
</p>
<p>Missing (<code>NA</code>) and Not-a-Number (<code>NaN</code>) values in <code>x</code>,
<code>p</code> and <code>q</code> are passed through as is and infinite values are set to
<code>NA</code>. None of these are not permitted for the parameters.
</p>
<p>Error checking of the inputs (e.g. invalid probabilities) is carried out and
will either stop or give warning message as appropriate.
</p>


<h3>Author(s)</h3>

<p>Yang Hu and Carl Scarrott <a href="mailto:carl.scarrott@canterbury.ac.nz">carl.scarrott@canterbury.ac.nz</a>
</p>


<h3>References</h3>

<p><a href="http://en.wikipedia.org/wiki/Normal_distribution">http://en.wikipedia.org/wiki/Normal_distribution</a>
</p>
<p><a href="http://en.wikipedia.org/wiki/Generalized_Pareto_distribution">http://en.wikipedia.org/wiki/Generalized_Pareto_distribution</a>
</p>
<p>Scarrott, C.J. and MacDonald, A. (2012). A review of extreme value
threshold estimation and uncertainty quantification. REVSTAT - Statistical
Journal 10(1), 33-59. Available from <a href="http://www.ine.pt/revstat/pdf/rs120102.pdf">http://www.ine.pt/revstat/pdf/rs120102.pdf</a>
</p>
<p>Zhao, X., Scarrott, C.J. Reale, M. and Oxley, L. (2010). Extreme value modelling
for forecasting the market crisis. Applied Financial Econometrics 20(1), 63-72.
</p>


<h3>See Also</h3>

<p><code>gpd</code> and <code>dnorm</code>
</p>
<p>Other normgpd: <code>fgng</code>, <code>fhpd</code>,
<code>fitmnormgpd</code>, <code>flognormgpd</code>,
<code>fnormgpdcon</code>, <code>fnormgpd</code>,
<code>gng</code>, <code>hpdcon</code>,
<code>hpd</code>, <code>itmnormgpd</code>,
<code>lognormgpdcon</code>, <code>lognormgpd</code>,
<code>normgpdcon</code>, <code>normgpd</code>
</p>
<p>Other normgpdcon: <code>fgngcon</code>,
<code>fhpdcon</code>, <code>flognormgpdcon</code>,
<code>fnormgpdcon</code>, <code>fnormgpd</code>,
<code>gng</code>, <code>hpdcon</code>,
<code>hpd</code>, <code>normgpdcon</code>,
<code>normgpd</code>
</p>
<p>Other gng: <code>fgngcon</code>, <code>fgng</code>,
<code>fitmgng</code>, <code>fnormgpd</code>,
<code>gng</code>, <code>itmgng</code>,
<code>normgpd</code>
</p>
<p>Other gngcon: <code>fgngcon</code>, <code>fgng</code>,
<code>fnormgpdcon</code>, <code>gng</code>,
<code>normgpdcon</code>
</p>
<p>Other fgngcon: <code>fgngcon</code>
</p>


<h3>Examples</h3>

<pre><code class="language-R">## Not run: 
set.seed(1)
par(mfrow = c(2, 2))

x = rgngcon(1000, phiul = 0.15, phiur = 0.15)
xx = seq(-6, 6, 0.01)
hist(x, breaks = 100, freq = FALSE, xlim = c(-6, 6))
lines(xx, dgngcon(xx, phiul = 0.15, phiur = 0.15))

# three tail behaviours
plot(xx, pgngcon(xx), type = "l")
lines(xx, pgngcon(xx, xil = 0.3, xir = 0.3), col = "red")
lines(xx, pgngcon(xx, xil = -0.3, xir = -0.3), col = "blue")
legend("topleft", paste("Symmetric xil=xir=",c(0, 0.3, -0.3)),
  col=c("black", "red", "blue"), lty = 1)

x = rgngcon(1000, xil = -0.3, phiul = 0.2, xir = 0.3, phiur = 0.2)
xx = seq(-6, 6, 0.01)
hist(x, breaks = 100, freq = FALSE, xlim = c(-6, 6))
lines(xx, dgngcon(xx, xil = -0.3, phiul = 0.2, xir = 0.3, phiur = 0.2))

plot(xx, dgngcon(xx, xil = -0.3, phiul = 0.2, xir = 0.3, phiur = 0.2), type = "l", ylim = c(0, 0.4))
lines(xx, dgngcon(xx, xil = -0.3, phiul = 0.3, xir = 0.3, phiur = 0.3), col = "red")
lines(xx, dgngcon(xx, xil = -0.3, phiul = TRUE, xir = 0.3, phiur = TRUE), col = "blue")
legend("topleft", c("phiul = phiur = 0.2", "phiul = phiur = 0.3", "Bulk Tail Fraction"),
  col=c("black", "red", "blue"), lty = 1)

## End(Not run)

</code></pre>


</div>