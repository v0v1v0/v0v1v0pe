<div class="container">

<table style="width: 100%;"><tr>
<td>eicm.fit</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Estimate a EICM model</h2>

<h3>Description</h3>

<p>Estimates the parameter values of a EICM model from the provided observation data.
This is the low-level estimation function. Users should use <code>eicm</code> instead, particularly
if estimating latent variables and species interactions.
</p>


<h3>Usage</h3>

<pre><code class="language-R">eicm.fit(
  occurrences,
  env = NULL,
  traits = NULL,
  intercept = TRUE,
  n.latent = 0,
  forbidden = NULL,
  allowed = NULL,
  mask.sp = NULL,
  exclude.prevalence = 0,
  options = NULL,
  initial.values = NULL,
  regularization = c(ifelse(n.latent &gt; 0, 0.5, 0), 1),
  regularization.type = "hybrid",
  fast = FALSE,
  n.cores = 1,
  optim.method = "L-BFGS-B",
  optim.control = list(trace = 1, maxit = 10000, ndeps = 1e-04, factr = ifelse(fast,
    1e-04, 1e-06)/.Machine$double.eps)
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>occurrences</code></td>
<td>
<p>a binary (0/1) sample x species matrix, possibly including NAs.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>env</code></td>
<td>
<p>an optional sample x environmental variable matrix, for the known environmental predictors.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>traits</code></td>
<td>
<p>an optional species x trait matrix. Currently, it is only used for excluding
species interactions <em>a priori</em>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>intercept</code></td>
<td>
<p>logical specifying whether to add a column for the species-level intercepts.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>n.latent</code></td>
<td>
<p>the number of latent variables to estimate.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>forbidden</code></td>
<td>
<p>a formula (or list of) defining which species interactions are not to be estimated. See details.
This constraint is cumulative with other constraints (<code>mask.sp</code> and <code>exclude.prevalence</code>).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>allowed</code></td>
<td>
<p>a formula (or list of) defining which species interactions are to be estimated. See details.
This constraint is cumulative with other constraints (<code>mask.sp</code> and <code>exclude.prevalence</code>).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>mask.sp</code></td>
<td>
<p>a scalar or a binary square species x species matrix defining which species interactions to exclude
(0) or include (1) <em>a priori</em>. If a scalar (0 or 1), 0 excludes all interactions, 1 allows all interactions.
If a matrix, species in the columns affect species in the rows, so, setting <code>mask.sp[3, 8] &lt;- 0</code>
means that species #8 is assumed <em>a priori</em> to not affect species #3.
This constraint is cumulative with other constraints (<code>forbidden</code> and <code>exclude.prevalence</code>).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>exclude.prevalence</code></td>
<td>
<p>exclude species interactions which are caused by species
with prevalence equal or lower than this value. This constraint is cumulative with
other constraints (<code>forbidden</code> and <code>mask.sp</code>)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>options</code></td>
<td>
<p>a <code>eicm.options</code> object defining options for fitting. Usually not needed, use
<code>forbidden</code>, <code>mask.sp</code> and <code>exclude.prevalence</code> instead.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>initial.values</code></td>
<td>
<p>the starting values for all parameters. Used only for speeding up
fitting when there are previous estimates available.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>regularization</code></td>
<td>
<p>a two-element numeric vector defining the regularization lambdas used for
environmental coefficients and for species interactions respectively. See details.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>regularization.type</code></td>
<td>
<p>one of "lasso", "ridge" or "hybrid", defining the type of penalty to apply.
Type "hybrid" applies ridge penalty to environmental coefficients and LASSO to interaction coefficients.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>fast</code></td>
<td>
<p>a logical defining whether to do a fast - but less accurate - estimation, or a normal estimation.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>n.cores</code></td>
<td>
<p>the number of CPU cores to use in the L-BFGS-B optimization. This may be reduced to prevent
excessive memory usage.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>optim.method</code></td>
<td>
<p>the optimization function to use. Should be set to the default.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>optim.control</code></td>
<td>
<p>the optimization parameters to use. Should be set to the defaults.</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>By default, all species interactions are estimated. Uers can control which species interactions
are to be estimated with the arguments <code>forbidden</code>, <code>mask.sp</code> and <code>exclude.prevalence</code>,
which place cumulative restrictions on which interactions to estimate. See <code>vignette("eicm")</code>
for commented examples.
</p>


<h3>Value</h3>

<p>A fitted <code>eicm</code> object.
</p>


<h3>Note</h3>

<p>If estimating latent variables and species interactions, use <code>eicm</code> instead.
</p>


<h3>See Also</h3>

<p><code>eicm</code>, <code>confint.eicm</code>, <code>plot.eicm</code>
</p>


<h3>Examples</h3>

<pre><code class="language-R"># Simulate some random occurrence data
nenv &lt;- 2
nsp &lt;- 10
nsamples &lt;- 200

env &lt;- matrix(rnorm(nenv * nsamples), ncol=nenv, nrow=nsamples)
env.coefs &lt;- matrix(runif((nenv + 1) * nsp, -4, 4), nrow=nsp)
sp.coefs &lt;- matrix(0, nrow=nsp, ncol=nsp)
sp.coefs[3, 5] &lt;- 3
sp.coefs[4, 8] &lt;- 2

# Define a true model
truemodel &lt;- as.eicm(env=env, env.coefs=env.coefs, sp.coefs=sp.coefs)

# realize the model
simulated.data &lt;- predict(truemodel, nrepetitions=1)


# fit the model without species interactions
fittedNoInt &lt;- eicm.fit(simulated.data, env, mask.sp=0)

# fit the model with all species interactions
fittedInt &lt;- eicm.fit(simulated.data, env, mask.sp=1)

# compute confidence intervals for all parameters
fittedInt &lt;- confint(fittedInt, ncores=2)

# plot estimated parameters and confidence intervals
plot(fittedInt, type="confint", truemodel=truemodel)

</code></pre>


</div>