<div class="container">

<table style="width: 100%;"><tr>
<td>eqnormCensored</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>
Estimate Quantiles of a Normal Distribution Based on Type I Censored Data
</h2>

<h3>Description</h3>

<p>Estimate quantiles of a normal distribution given a 
sample of data that has been subjected to Type I censoring, and optionally 
construct a confidence interval for a quantile.
</p>


<h3>Usage</h3>

<pre><code class="language-R">  eqnormCensored(x, censored, censoring.side = "left", p = 0.5, method = "mle", 
    ci = FALSE, ci.method = "exact.for.complete", ci.type = "two-sided", 
    conf.level = 0.95, digits = 0, nmc = 1000, seed = NULL)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>x</code></td>
<td>

<p>a numeric vector of observations.  
Missing (<code>NA</code>), undefined (<code>NaN</code>), and infinite (<code>Inf</code>, <code>-Inf</code>) 
values are allowed but will be removed.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>censored</code></td>
<td>

<p>numeric or logical vector indicating which values of <code>x</code> are censored.  
This must be the same length as <code>x</code>.  If the mode of <code>censored</code> is 
<code>"logical"</code>, <code>TRUE</code> values correspond to elements of <code>x</code> that 
are censored, and <code>FALSE</code> values correspond to elements of <code>x</code> that 
are not censored.  If the mode of <code>censored</code> is <code>"numeric"</code>, 
it must contain only <code>1</code>'s and <code>0</code>'s; <code>1</code> corresponds to 
<code>TRUE</code> and <code>0</code> corresponds to <code>FALSE</code>.  Missing (<code>NA</code>) 
values are allowed but will be removed.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>censoring.side</code></td>
<td>

<p>character string indicating on which side the censoring occurs.  The possible 
values are <code>"left"</code> (the default) and <code>"right"</code>. 
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>p</code></td>
<td>

<p>numeric vector of probabilities for which quantiles will be estimated.  
All values of <code>p</code> must be between 0 and 1.  When <code>ci=TRUE</code>, <code>p</code> 
must be a scalar. The default value is <code>p=0.5</code>.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>method</code></td>
<td>

<p>character string specifying the method of estimating the mean and standard deviation.  
</p>
<p>For singly censored data, the possible values are: <br><code>"mle"</code> (maximum likelihood; the default), <br><code>"bcmle"</code> (bias-corrected maximum likelihood), <br><code>"qq.reg"</code> (quantile-quantile regression), <br><code>"qq.reg.w.cen.level"</code> (quantile-quantile regression including the 
censoring level), <br><code>"impute.w.qq.reg"</code> (moment estimation based on imputation using the 
<code>qq.reg method</code>), <br><code>"impute.w.qq.reg.w.cen.level"</code> (moment estimation based on imputation 
using the <code>qq.reg.w.cen.level method</code>), <br><code>"impute.w.mle"</code> (moment estimation based on imputation using the mle), <br><code>"iterative.impute.w.qq.reg"</code> (moment estimation based on iterative 
imputation using the <code>qq.reg method</code>), <br><code>"m.est"</code> (robust M-estimation), and <br><code>"half.cen.level"</code> (moment estimation based on setting the censored 
observations to half the censoring level).  <br></p>
<p>For multiply censored data, the possible values are: <br><code>"mle"</code> (maximum likelihood; the default), <br><code>"qq.reg"</code> (quantile-quantile regression), <br><code>"impute.w.qq.reg"</code> (moment estimation based on imputation using the 
<code>qq.reg method</code>), and <br><code>"half.cen.level"</code> (moment estimation based on setting the censored 
observations to half the censoring level). <br></p>
<p>See the DETAILS section for more information.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>ci</code></td>
<td>

<p>logical scalar indicating whether to compute a confidence interval for the quantile.  
The default value is <code>ci=FALSE</code>.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>ci.method</code></td>
<td>

<p>character string indicating what method to use to construct the confidence interval 
for the quantile.  The possible values are: <br><code>"exact.for.complete"</code> (exact method for complete (i.e., uncensored) data; the default), <br><code>"gpq"</code> (method based on generalized pivotal quantities), and <br><code>"normal.approx"</code> (normal approximation).  
</p>
<p>See the DETAILS section for more information.  This argument is ignored if <br><code>ci=FALSE</code>.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>ci.type</code></td>
<td>

<p>character string indicating what kind of confidence interval for the quantile to compute.  
The possible values are <code>"two-sided"</code> (the default), <code>"lower"</code>, and 
<code>"upper"</code>.  This argument is ignored if <code>ci=FALSE</code>.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>conf.level</code></td>
<td>

<p>a scalar between 0 and 1 indicating the confidence level of the confidence interval.  
The default value is <code>conf.level=0.95</code>.  This argument is ignored if <code>ci=FALSE</code>.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>digits</code></td>
<td>

<p>an integer indicating the number of decimal places to round to when printing out 
the value of <code>100*p</code>. The default value is <code>digits=0</code>.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>nmc</code></td>
<td>

<p>numeric scalar indicating the number of Monte Carlo simulations to run when 
<code>ci.method="gpq"</code>.  The default is <code>nmc=1000</code>.  This argument is ignored 
if <code>ci=FALSE</code>.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>seed</code></td>
<td>

<p>integer supplied to the function <code>set.seed</code> and used when 
<code>ci.method="gpq"</code>.  The default value is 
<code>seed=NULL</code>, in which case the current value of <code>.Random.seed</code> is used.  
This argument is ignored when <code>ci=FALSE</code>.
</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p><b>Estimating Quantiles</b> <br>
Quantiles are estimated by:
</p>

<ol>
<li>
<p> estimating the mean and standard deviation parameters by 
calling <code>enormCensored</code>, and then 
</p>
</li>
<li>
<p> calling the function <code>qnorm</code> and using the estimated 
values for the mean and standard deviation.  
</p>
</li>
</ol>
<p>The estimated quantile thus depends on the method of estimating the mean and 
standard deviation.
<br></p>
<p><b>Confidence Intervals for Quantiles</b> <br></p>
<p><em>Exact Method When Data are Complete</em> (<code>ci.method="exact.for.complete"</code>) <br>
When <code>ci.method="exact.for.complete"</code>, the function <code>eqnormCensored</code> 
calls the function <code>eqnorm</code>, supplying it with the estimated mean 
and standard deviation, and setting the argument <br><code>ci.method="exact"</code>.  Thus, this 
is the exact method for computing a confidence interval for a quantile had the data 
been complete.  Because the data have been subjected to Type I censoring, this method 
of constructing a confidence interval for the quantile is an approximation.
<br></p>
<p><em>Normal Approximation</em> (<code>ci.method="normal.approx"</code>) <br>
When <code>ci.method="normal.approx"</code>, the function <code>eqnormCensored</code> 
calls the function <code>eqnorm</code>, supplying it with the estimated mean 
and standard deviation, and setting the argument <br><code>ci.method="normal.approx"</code>.  
Thus, this is the normal approximation method for computing a confidence interval 
for a quantile had the data been complete.  Because the data have been subjected 
to Type I censoring, this method of constructing a confidence interval for the 
quantile is an approximation both because of the normal approximation and because 
the estimates of the mean and standard devation are based on censored, instead of 
complete, data.
<br></p>
<p><em>Generalized Pivotal Quantity</em> (<code>ci.method="gpq"</code>) <br>
When <code>ci.method="gpq"</code>, the function <code>eqnormCensored</code> uses the 
relationship between confidence intervals for quantiles and tolerance intervals 
and calls the function <code>tolIntNormCensored</code> with the argument 
<code>ti.method="gpq"</code> to construct the confidence interval.  
Specifically, it can be shown 
(e.g., Conover, 1980, pp.119-121) that an upper confidence interval for the 
<code class="reqn">p</code>'th quantile with confidence level <code class="reqn">100(1-\alpha)\%</code> is equivalent to 
an upper <code class="reqn">\beta</code>-content tolerance interval with coverage <code class="reqn">100p\%</code> and 
confidence level <code class="reqn">100(1-\alpha)\%</code>.  Also, a lower confidence interval for 
the <code class="reqn">p</code>'th quantile with confidence level <code class="reqn">100(1-\alpha)\%</code> is equivalent 
to a lower <code class="reqn">\beta</code>-content tolerance interval with coverage <code class="reqn">100(1-p)\%</code> and 
confidence level <code class="reqn">100(1-\alpha)\%</code>.
</p>


<h3>Value</h3>

<p><code>eqnormCensored</code> returns a list of class <code>"estimateCensored"</code> 
containing the estimated quantile(s) and other information.  
See <code>estimateCensored.object</code> for details.
</p>


<h3>Note</h3>

<p>Percentiles are sometimes used in environmental standards and regulations.  
For example, Berthouex and Brown (2002, p.71) note that England has water 
quality limits based on the 90th and 95th percentiles of monitoring data not 
exceeding specified levels.  They also note that the U.S. EPA has specifications 
for air quality monitoring, aquatic standards on toxic chemicals, and maximum 
daily limits for industrial effluents that are all based on percentiles.  Given 
the importance of these quantities, it is essential to characterize the amount 
of uncertainty associated with the estimates of these quantities.  This is done 
with confidence intervals.
</p>
<p>A sample of data contains censored observations if some of the observations are 
reported only as being below or above some censoring level.  In environmental 
data analysis, Type I left-censored data sets are common, with values being 
reported as “less than the detection limit” (e.g., Helsel, 2012).  Data 
sets with only one censoring level are called <em>singly censored</em>; data sets with 
multiple censoring levels are called <em>multiply</em> or <em>progressively censored</em>.
</p>
<p>Statistical methods for dealing with censored data sets have a long history in the 
field of survival analysis and life testing.  More recently, researchers in the 
environmental field have proposed alternative methods of computing estimates and 
confidence intervals in addition to the classical ones such as maximum likelihood 
estimation.
</p>
<p>Helsel (2012, Chapter 6) gives an excellent review of past studies of the 
properties of various estimators based on censored environmental data.
</p>
<p>In practice, it is better to use a confidence interval for a percentile, rather 
than rely on a single point-estimate of percentile.  Confidence intervals 
for percentiles of a normal distribution depend on the properties of the estimators 
for both the mean and standard deviation.
</p>
<p>Few studies have been done to evaluate the performance of methods for constructing 
confidence intervals for the mean or joint confidence regions for the mean and 
standard deviation when data are subjected to single or multiple censoring (see, 
for example, Singh et al., 2006).  Studies to evaluate the performance of a 
confidence interval for a percentile include:  Caudill et al. (2007), Hewett and 
Ganner (2007), Kroll and Stedinger (1996), and Serasinghe (2010).
</p>


<h3>Author(s)</h3>

<p>Steven P. Millard (<a href="mailto:EnvStats@ProbStatInfo.com">EnvStats@ProbStatInfo.com</a>)
</p>


<h3>References</h3>

<p>Berthouex, P.M., and L.C. Brown. (2002). <em>Statistics for Environmental Engineers</em>. 
Lewis Publishers, Boca Raton.
</p>
<p>Caudill, S.P., L.-Y. Wong, W.E. Turner, R. Lee, A. Henderson, D. G. Patterson Jr. 
(2007).  Percentile Estimation Using Variable Censored Data.  
<em>Chemosphere</em> <b>68</b>, 169–180.
</p>
<p>Conover, W.J. (1980). <em>Practical Nonparametric Statistics</em>. Second Edition. 
John Wiley and Sons, New York.
</p>
<p>Draper, N., and H. Smith. (1998). <em>Applied Regression Analysis</em>. Third Edition. 
John Wiley and Sons, New York.
</p>
<p>Ellison, B.E. (1964). On Two-Sided Tolerance Intervals for a Normal Distribution. 
<em>Annals of Mathematical Statistics</em> <b>35</b>, 762-772.
</p>
<p>Gibbons, R.D., D.K. Bhaumik, and S. Aryal. (2009). 
<em>Statistical Methods for Groundwater Monitoring</em>, Second Edition.  
John Wiley &amp; Sons, Hoboken.
</p>
<p>Gilbert, R.O. (1987). <em>Statistical Methods for Environmental Pollution Monitoring</em>. 
Van Nostrand Reinhold, New York, NY, pp.132-136.
</p>
<p>Guttman, I. (1970). <em>Statistical Tolerance Regions: Classical and Bayesian</em>. 
Hafner Publishing Co., Darien, CT.
</p>
<p>Hahn, G.J. (1970b). Statistical Intervals for a Normal Population, Part I: Tables, Examples 
and Applications. <em>Journal of Quality Technology</em> <b>2</b>(3), 115-125.
</p>
<p>Hahn, G.J. (1970c). Statistical Intervals for a Normal Population, Part II: Formulas, Assumptions, 
Some Derivations. <em>Journal of Quality Technology</em> <b>2</b>(4), 195-206.
</p>
<p>Hahn, G.J., and W.Q. Meeker. (1991). <em>Statistical Intervals: A Guide for Practitioners</em>. 
John Wiley and Sons, New York.
</p>
<p>Helsel, D.R., and R.M. Hirsch. (1992). <em>Statistical Methods in Water Resources Research</em>. 
Elsevier, New York, NY, pp.88-90.
</p>
<p>Hewett, P., and G.H. Ganser. (2007).  A Comparison of Several Methods for Analyzing 
Censored Data.  <em>Annals of Occupational Hygiene</em> <b>51</b>(7), 611–632.
</p>
<p>Johnson, N.L., and B.L. Welch. (1940). Applications of the Non-Central t-Distribution. 
<em>Biometrika</em> <b>31</b>, 362-389.
</p>
<p>Krishnamoorthy K., and T. Mathew. (2009). 
<em>Statistical Tolerance Regions: Theory, Applications, and Computation</em>. 
John Wiley and Sons, Hoboken.
</p>
<p>Kroll, C.N., and J.R. Stedinger. (1996).  Estimation of Moments and Quantiles 
Using Censored Data.  <em>Water Resources Research</em> <b>32</b>(4), 1005–1012.
</p>
<p>Millard, S.P., and N.K. Neerchal. (2001). <em>Environmental Statistics with S-PLUS</em>. 
CRC Press, Boca Raton.
</p>
<p>Odeh, R.E., and D.B. Owen. (1980). <em>Tables for Normal Tolerance Limits, Sampling Plans, 
and Screening</em>. Marcel Dekker, New York.
</p>
<p>Owen, D.B. (1962). <em>Handbook of Statistical Tables</em>. Addison-Wesley, Reading, MA.
</p>
<p>Serasinghe, S.K. (2010).  <em>A Simulation Comparison of Parametric and 
Nonparametric Estimators of Quantiles from Right Censored Data</em>.  A Report 
submitted in partial fulfillment of the requirements for the degree Master of 
Science, Department of Statistics, College of Arts and Sciences, Kansas State 
University, Manhattan, Kansas.
</p>
<p>Singh, A., R. Maichle, and S. Lee. (2006).  <em>On the Computation of a 95% 
Upper Confidence Limit of the Unknown Population Mean Based Upon Data Sets 
with Below Detection Limit Observations</em>.  EPA/600/R-06/022, March 2006.  
Office of Research and Development, U.S. Environmental Protection Agency, 
Washington, D.C.
</p>
<p>Singh, A., R. Maichle, and N. Armbya. (2010a). 
<em>ProUCL Version 4.1.00 User Guide (Draft)</em>. EPA/600/R-07/041, May 2010. 
Office of Research and Development, U.S. Environmental Protection Agency, Washington, D.C.
</p>
<p>Singh, A., N. Armbya, and A. Singh. (2010b). 
<em>ProUCL Version 4.1.00 Technical Guide (Draft)</em>. EPA/600/R-07/041, May 2010.  
Office of Research and Development, U.S. Environmental Protection Agency, Washington, D.C.
</p>
<p>Stedinger, J. (1983). Confidence Intervals for Design Events. 
<em>Journal of Hydraulic Engineering</em> <b>109</b>(1), 13-27.
</p>
<p>Stedinger, J.R., R.M. Vogel, and E. Foufoula-Georgiou. (1993). 
Frequency Analysis of Extreme Events. In: Maidment, D.R., ed. <em>Handbook of Hydrology</em>. 
McGraw-Hill, New York, Chapter 18, pp.29-30.
</p>
<p>USEPA. (2009).  <em>Statistical Analysis of Groundwater Monitoring Data at RCRA Facilities, Unified Guidance</em>.
EPA 530/R-09-007, March 2009.  Office of Resource Conservation and Recovery Program Implementation and Information Division.  
U.S. Environmental Protection Agency, Washington, D.C.
</p>
<p>USEPA. (2010).  <em>Errata Sheet - March 2009 Unified Guidance</em>.
EPA 530/R-09-007a, August 9, 2010.  Office of Resource Conservation and Recovery, Program Information and Implementation Division.
U.S. Environmental Protection Agency, Washington, D.C. 
</p>
<p>Wald, A., and J. Wolfowitz. (1946). Tolerance Limits for a Normal Distribution. 
<em>Annals of Mathematical Statistics</em> <b>17</b>, 208-215.
</p>


<h3>See Also</h3>

<p><code>enormCensored</code>, <code>tolIntNormCensored</code>, <code>Normal</code>,  
<code>estimateCensored.object</code>.
</p>


<h3>Examples</h3>

<pre><code class="language-R">  # Generate 15 observations from a normal distribution with 
  # parameters mean=10 and sd=2, and censor observations less than 8. 
  # Then generate 15 more observations from this distribution and  censor 
  # observations less than 7.
  # Then estimate the 90th percentile and create a one-sided upper 95% 
  # confidence interval for that percentile. 
  # (Note: the call to set.seed simply allows you to reproduce this example.)

  set.seed(47) 

  x.1 &lt;- rnorm(15, mean = 10, sd = 2) 
  sort(x.1)
  # [1]  6.343542  7.068499  7.828525  8.029036  8.155088  9.436470
  # [7]  9.495908 10.030262 10.079205 10.182946 10.217551 10.370811
  #[13] 10.987640 11.422285 13.989393
  censored.1 &lt;- x.1 &lt; 8
  x.1[censored.1] &lt;- 8

  x.2 &lt;- rnorm(15, mean = 10, sd = 2) 
  sort(x.2)
  # [1]  5.355255  6.065562  6.783680  6.867676  8.219412  8.593224
  # [7]  9.319168  9.347066  9.837844  9.918844 10.055054 10.498296
  #[13] 10.834382 11.341558 12.528482
  censored.2 &lt;- x.2 &lt; 7
  x.2[censored.2] &lt;- 7

  x &lt;- c(x.1, x.2)
  censored &lt;- c(censored.1, censored.2)

  eqnormCensored(x, censored, p = 0.9, ci = TRUE, ci.type = "upper")

  #Results of Distribution Parameter Estimation
  #Based on Type I Censored Data
  #--------------------------------------------
  #
  #Assumed Distribution:            Normal
  #
  #Censoring Side:                  left
  #
  #Censoring Level(s):              7 8 
  #
  #Estimated Parameter(s):          mean = 9.390624
  #                                 sd   = 1.827156
  #
  #Estimation Method:               MLE
  #
  #Estimated Quantile(s):           90'th %ile = 11.73222
  #
  #Quantile Estimation Method:      Quantile(s) Based on
  #                                 MLE Estimators
  #
  #Data:                            x
  #
  #Censoring Variable:              censored
  #  
  #Sample Size:                     30
  #
  #Percent Censored:                16.66667%
  #
  #Confidence Interval for:         90'th %ile
  #
  #Assumed Sample Size:             30
  #
  #Confidence Interval Method:      Exact for
  #                                 Complete Data
  #
  #Confidence Interval Type:        upper
  #
  #Confidence Level:                95%
  #
  #Confidence Interval:             LCL =     -Inf
  #                                 UCL = 12.63808

  #----------

  # Compare these results with the true 90'th percentile:

  qnorm(p = 0.9, mean = 10, sd = 2)
  #[1] 12.56310

  #----------

  # Clean up
  rm(x.1, censored.1, x.2, censored.2, x, censored)
  
  #==========

  # Chapter 15 of USEPA (2009) gives several examples of estimating the mean
  # and standard deviation of a lognormal distribution on the log-scale using 
  # manganese concentrations (ppb) in groundwater at five background wells. 
  # In EnvStats these data are stored in the data frame 
  # EPA.09.Ex.15.1.manganese.df.

  # Here we will estimate the mean and standard deviation using the MLE, 
  # and then construct an upper 95% confidence limit for the 90th percentile. 

  # We will log-transform the original observations and then call 
  # eqnormCensored.  Alternatively, we could have more simply called 
  # eqlnormCensored.

  # First look at the data:
  #-----------------------

  EPA.09.Ex.15.1.manganese.df

  #   Sample   Well Manganese.Orig.ppb Manganese.ppb Censored
  #1       1 Well.1                 &lt;5           5.0     TRUE
  #2       2 Well.1               12.1          12.1    FALSE
  #3       3 Well.1               16.9          16.9    FALSE
  #...
  #23      3 Well.5                3.3           3.3    FALSE
  #24      4 Well.5                8.4           8.4    FALSE
  #25      5 Well.5                 &lt;2           2.0     TRUE

  longToWide(EPA.09.Ex.15.1.manganese.df, 
    "Manganese.Orig.ppb", "Sample", "Well",
    paste.row.name = TRUE)  

  #         Well.1 Well.2 Well.3 Well.4 Well.5
  #Sample.1     &lt;5     &lt;5     &lt;5    6.3   17.9
  #Sample.2   12.1    7.7    5.3   11.9   22.7
  #Sample.3   16.9   53.6   12.6     10    3.3
  #Sample.4   21.6    9.5  106.3     &lt;2    8.4
  #Sample.5     &lt;2   45.9   34.5   77.2     &lt;2


  # Now estimate the mean, standard deviation, and 90th percentile 
  # on the log-scale using the MLE, and construct an upper 95% 
  # confidence limit for the 90th percentile on the log-scale:
  #---------------------------------------------------------------

  est.list &lt;- with(EPA.09.Ex.15.1.manganese.df,
    eqnormCensored(log(Manganese.ppb), Censored, 
      p = 0.9, ci = TRUE, ci.type = "upper"))

  est.list

  #Results of Distribution Parameter Estimation
  #Based on Type I Censored Data
  #--------------------------------------------
  #
  #Assumed Distribution:            Normal
  #
  #Censoring Side:                  left
  #
  #Censoring Level(s):              0.6931472 1.6094379 
  #
  #Estimated Parameter(s):          mean = 2.215905
  #                                 sd   = 1.356291
  #
  #Estimation Method:               MLE
  #
  #Estimated Quantile(s):           90'th %ile = 3.954062
  #
  #Quantile Estimation Method:      Quantile(s) Based on
  #                                 MLE Estimators
  #
  #Data:                            log(Manganese.ppb)
  #
  #Censoring Variable:              censored
  #
  #Sample Size:                     25
  #
  #Percent Censored:                24%
  #
  #Confidence Interval for:         90'th %ile
  #
  #Assumed Sample Size:             25
  #
  #Confidence Interval Method:      Exact for
  #                                 Complete Data
  #
  #Confidence Interval Type:        upper
  #
  #Confidence Level:                95%
  #
  #Confidence Interval:             LCL =     -Inf
  #                                 UCL = 4.708904

  # To estimate the 90th percentile on the original scale, 
  # we need to exponentiate the results
  #-------------------------------------------------------
  exp(est.list$quantiles)
  #90'th %ile 
  #  52.14674 

  exp(est.list$interval$limits)
  #     LCL      UCL 
  #  0.0000 110.9305

  #----------

  # Clean up
  #---------
  rm(est.list)
</code></pre>


</div>