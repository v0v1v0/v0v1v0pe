<div class="container">

<table style="width: 100%;"><tr>
<td>statistic.sim</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Simulates statistics related to exceedance region.</h2>

<h3>Description</h3>

<p><code>statistic.sim</code> simulates statistics related to the construction of confidence regions for exceedance sets and contour lines.
</p>


<h3>Usage</h3>

<pre><code class="language-R">statistic.sim(krige.obj, level, alternative = "less", ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>krige.obj</code></td>
<td>
<p>An object from the function <code>krige.uk</code> in the <code>SpatialTools</code> package.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>level</code></td>
<td>
<p>The threshold/exceedance level under consideration.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>alternative</code></td>
<td>
<p>Indicates the type of exceedance region or level curve under consideration.  For exceedances above a threshold, use (<code>alternative = "less"</code>).  For exceedances below a threshold, use (<code>alternative = "greater"</code>).  For contour lines, use (<code>alternative = "two.sided"</code>). Defaults to "less".</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>Additional arguments when <code>alternative = "two.sided"</code>. See Details.</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>When <code>alternative = "two.sided"</code>, the <code>...</code> argument must include <code>user.cov</code> (a user-specified covariance function), <code>pgrid</code> (the grid of locations to be predicted, produced by <code>create.pgrid</code> or <code>create.pgrid2</code>), <code>X</code> (the matrix of covariates for the observed data), and any other arguments needed by <code>user.cov</code>. Note that <code>user.cov</code> should take <code>cLcoords</code> as its first argument (a matrix containing the coordinates of contour lines under consideration). Additional arguments to <code>user.cov</code> are passed internally using the <code>...</code> argument. The <code>user.cov</code> function should return a list with values <code>V</code> (the covariance matrix of the observed data), <code>Vop</code> (the cross-covariance matrix between the observed data and the responses with coordinates in cL), <code>Vp</code> (the covariance matrix of the responses with coordinates in <code>cL</code>), and <code>Xp</code> (the matrix of covariates for the coordinates contained in <code>cL</code>). See the Examples section.
</p>


<h3>Value</h3>

<p>Returns a list with components: 
</p>
<table>
<tr style="vertical-align: top;">
<td><code>statistic</code></td>
<td>
<p>A vector with the observed values of the test statistic.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>statistic.sim</code></td>
<td>
<p>A vector with the observed values of the test statistic.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>alternative</code></td>
<td>
<p>The alternative hypothesis provided to <code>statistic.sim</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>level</code></td>
<td>
<p>The threshold level under consideration.</p>
</td>
</tr>
</table>
<h3>Author(s)</h3>

<p>Joshua French
</p>


<h3>Examples</h3>

<pre><code class="language-R">library(SpatialTools)

# Example for exceedance regions

set.seed(10)
# Load data
data(sdata)
# Create prediction grid
pgrid &lt;- create.pgrid(0, 1, 0, 1, nx = 26, ny = 26)
pcoords &lt;- pgrid$pgrid
# Create design matrices
coords = cbind(sdata$x1, sdata$x2)
X &lt;- cbind(1, coords)
Xp &lt;- cbind(1, pcoords)

# Generate covariance matrices V, Vp, Vop using appropriate parameters for
# observed data and responses to be predicted
spcov &lt;- cov.sp(coords = coords, sp.type = "exponential", sp.par = c(1, 1.5),
 error.var = 1/3, finescale.var = 0, pcoords = pcoords)

# Predict responses at pgrid locations
krige.obj &lt;- krige.uk(y = as.vector(sdata$y), V = spcov$V, Vp = spcov$Vp, 
 Vop = spcov$Vop, X = X, Xp = Xp, nsim = 50, 
 Ve.diag = rep(1/3, length(sdata$y)) , method = "chol")
                
# Simulate distribution of test statistic for different alternatives
statistic.sim.obj.less &lt;- statistic.sim(krige.obj = krige.obj, level = 5,
 alternative = "less")
statistic.sim.obj.greater &lt;- statistic.sim(krige.obj = krige.obj, level = 5,
 alternative = "greater")
# Construct null and rejection sets for two scenarios
n90 &lt;- exceedance.ci(statistic.sim.obj.less, conf.level = .90, type = "null")
r90 &lt;- exceedance.ci(statistic.sim.obj.greater,conf.level = .90, 
 type = "rejection")       
# Plot results
plot(pgrid, n90, col="blue", add = FALSE, xlab = "x", ylab = "y")
plot(pgrid, r90, col="orange", add = TRUE)
legend("bottomleft", 
 legend = c("contains true exceedance region with 90 percent confidence", 
 "is contained in true exceedance region with 90 percent confidence"),
 col = c("blue", "orange"), lwd = 10)  

# Example for level curves
data(colorado)
ocoords &lt;- colorado$ocoords
odata &lt;- colorado$odata    

# Set up example
nsim &lt;- 50
u &lt;- log(16)
np &lt;- 26
conf.level &lt;- 0.90   
x.min &lt;- min(ocoords[,1])
x.max &lt;- max(ocoords[,1])
y.min &lt;- min(ocoords[,2])
y.max &lt;- max(ocoords[,2])   

#pixelize the domain
pgrid &lt;- create.pgrid(x.min, x.max, y.min, y.max, nx = np, ny = np)
pcoords &lt;- pgrid$pgrid; upx &lt;- pgrid$upx; upy &lt;- pgrid$upy
names(pcoords) &lt;- c("lon", "lat")    

# Set up covariates matrices
X &lt;- cbind(1, ocoords)
Xp &lt;- cbind(1, pcoords)           

# Estimate covariance parameters
cov.est &lt;- maxlik.cov.sp(X, odata, sp.type = "exponential", range.par = 1.12,
 error.ratio = 0.01, reml = TRUE, coords = ocoords)

# Create covariance matrices
myCov &lt;- cov.sp(coords = ocoords, sp.type = "exponential", 
 sp.par = cov.est$sp.par, error.var = cov.est$error.var, pcoords = pcoords)

# Krige and do conditional simulation 
krige.obj &lt;- krige.uk(y = odata, V = myCov$V, Vp = myCov$Vp, Vop = myCov$Vop, 
 X = X, Xp = Xp, nsim = nsim, Ve.diag = rep(cov.est$error.var, 
 length(odata)))

# Create user covariance function for simulating statistic for confidence 
# regions
user.cov &lt;- function(cLcoords,...)
{
   arglist &lt;- list(...)
   coords &lt;- arglist$coords
   sp.type &lt;- arglist$sp.type
   sp.par &lt;- arglist$sp.par
   V &lt;- arglist$V
   out &lt;- list(V = arglist$V,
               Vp = sp.par[1] * exp(-dist1(cLcoords)/sp.par[2]),
               Vop = sp.par[1] * exp(-dist2(coords, cLcoords)/sp.par[2]))
   out$Xp &lt;- cbind(1, cLcoords)
   return(out)
}

# Simulation statistic for confidence regions
statistic.sim.obj &lt;- statistic.sim(krige.obj = krige.obj, level = u, 
 alternative = "two.sided", user.cov = user.cov, y = odata, pgrid = pgrid, 
 X = X, coords = ocoords, pcoords = pcoords, V = myCov$V, 
 sp.type = "exponential", sp.par = cov.est$sp.par)

# Create 90% confidence region
n90 &lt;- exceedance.ci(statistic.sim.obj, conf.level = conf.level, 
 type = "null")
# Get estimated contour lines
cL &lt;- contourLines(pgrid$upx, pgrid$upy, matrix(krige.obj$pred, nrow = np), 
 level = u)

# Plot results
plot(ocoords, xlab = "longitude", ylab = "latitude", type = "n", 
 cex.lab = 1.5, cex.axis = 1.5)
plot(pgrid, n90, col = "grey", add = TRUE)
plot.contourLines(cL, col="black", lwd=2, lty = 2, add = TRUE)
</code></pre>


</div>