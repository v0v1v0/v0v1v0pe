<div class="container">

<table style="width: 100%;"><tr>
<td>to_munich</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Export emissions to Model of Urban Network of Intersecting Canyons and Highways (MUNICH)</h2>

<h3>Description</h3>

<p><code>to_munich</code> Export spatial emissions objects
according the format required by MUNICH. This function was designed to
read street emissions from VEIN by it can be used to read any other.
</p>


<h3>Usage</h3>

<pre><code class="language-R">to_munich(sdf, idbrin, typo, width, height, crs = 4326)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>sdf</code></td>
<td>
<p>Street Emissions object class 'sf' LINESTRING or "SpatialLinesdataFrame".
The columns are the emissions.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>idbrin</code></td>
<td>
<p>Integer; id.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>typo</code></td>
<td>
<p>Integer; id2.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>width</code></td>
<td>
<p>Integer; width.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>height</code></td>
<td>
<p>Integer; heigth.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>crs</code></td>
<td>
<p>Numeric; Coordenade Reference System to project data or not.</p>
</td>
</tr>
</table>
<h3>Value</h3>

<p>A list with a data frame with columns "i", "idbrin", "typo", "xa",
"ya", "xb", "yb" and the pollutants; and another data.frame with "i",
"length" (m), "width" (with value 0) and "height" (with value 0). Width and
height must be obtained by the user.
</p>


<h3>Note</h3>

<p>The user must ensure that the spatial object has one line feature
per vertex and lines with more than one vertex must be previously splitted.
the resulting units must be <strong>ug/km/h</strong>
</p>


<h3>References</h3>

<p>Kim, Y., Wu, Y., Seigneur, C., and Roustan, Y.:
Multi-scale modeling of urban air pollution: development and application of
a Street-in-Grid model (v1.0) by coupling MUNICH (v1.0) and Polair3D
(v1.8.1), Geosci. Model Dev., 11, 611-629,
https://doi.org/10.5194/gmd-11-611-2018, 2018.
</p>


<h3>Examples</h3>

<pre><code class="language-R">## Not run: 
# Not run
library(vein)
library(units)
library(sf)
data(net)
data(pc_profile)
data(profiles)
data(fkm)
PC_G &lt;- c(33491,22340,24818,31808,46458,28574,24856,28972,37818,49050,87923,
          133833,138441,142682,171029,151048,115228,98664,126444,101027,
          84771,55864,36306,21079,20138,17439, 7854,2215,656,1262,476,512,
          1181, 4991, 3711, 5653, 7039, 5839, 4257,3824, 3068)
pc1 &lt;- my_age(x = net$ldv,
              y = PC_G,
              name = "PC")

# Estimation for morning rush hour and local emission factors and speed
speed &lt;- data.frame(S8 = net$ps)
lef &lt;- EmissionFactorsList(ef_cetesb("CO",
                                     "PC_G",
                                     agemax = ncol(pc1)))
E_CO &lt;- emis(veh = pc1,
             lkm = net$lkm,
             ef = lef,
             speed = speed)

# rowSums drop units
net$CO  &lt;- set_units(rowSums(E_CO), g/h)

# selecting only CO and exploding lines and updating emissions
df &lt;- st_explode(net["CO"])

# st_explode should not drop units, must fix
df$CO  &lt;- set_units(df$CO, g/h)

# now we have split line in vertex
# selecting 1000 links
dfco &lt;- df[1:1000,"CO"]

###########
#MUNICH relies in a python script that reads emissions with units ug/km/h
# Therefore
dfco$CO &lt;- set_units(dfco$CO, ug/h)
dfco$CO&lt;- dfco$CO/set_units(st_length(dfco), km)
etm &lt;- to_munich(sdf = dfco)

names(etm)
class(etm)
head(etm$Emissions)
head(etm$Street)

write.table(x = etm$Emissions,
            file = paste0(tempfile(), "_Emissions.txt"),
            row.names = FALSE,
            sep = " ",
            quote = FALSE)

write.table(x = etm$Street,
            file = paste0(tempfile(), "_Street.txt"),
            row.names = FALSE,
            sep = " ",
            quote = FALSE)

## End(Not run)
</code></pre>


</div>