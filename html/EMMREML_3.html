<div class="container">

<table style="width: 100%;"><tr>
<td>emmremlMultiKernel</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>
Function to fit Gaussian mixed model with multiple mixed effects with known covariances.
</h2>

<h3>Description</h3>

<p>This function is a wrapper for the emmreml to fit Gaussian mixed model with multiple mixed effects with known covariances. The model fitted is <code class="reqn">y=X\beta+Z_1 u_1 +Z_2 u_2+...Z_k u_k+ e</code> where <code class="reqn">y</code> is the <code class="reqn">n</code> vector of response variable, <code class="reqn">X</code> is a <code class="reqn">n x q</code> known design matrix of fixed effects,  <code class="reqn">Z_j</code> is a <code class="reqn">n x l_j</code> known design matrix of random effects for <code class="reqn">j=1,2,...,k</code>, <code class="reqn">\beta</code> is <code class="reqn">n x 1</code> vector of fixed effects coefficients and  <code class="reqn">U=(u^t_1, u^t_2,..., u^t_k)^t</code> and <code class="reqn">e</code> are independent variables with <code class="reqn">N_L(0, blockdiag(\sigma^2_{u_1} K_1,\sigma^2_{u_2} K_2,...,\sigma^2_{u_k} K_k))</code> and <code class="reqn">N_n(0, \sigma^2_e I_n)</code> correspondingly. The function produces the BLUPs for the <code class="reqn">L=l_1+l_2+...+l_k</code> dimensional random effect <code class="reqn">U</code>.
The variance parameters for random effects are estimated as <code class="reqn">(\hat{w}_1, \hat{w}_2,...,\hat{w}_k)*\hat{\sigma^2_u}</code> where <code class="reqn">w=(w_1,w_2,..., w_k)</code> are the kernel weights. The function also provides some useful statistics like large sample estimates of variances and PEV.
</p>


<h3>Usage</h3>

<pre><code class="language-R">emmremlMultiKernel(y, X, Zlist, Klist,
varbetahat=FALSE,varuhat=FALSE, PEVuhat=FALSE, test=FALSE)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>y</code></td>
<td>

<p><code class="reqn">n x 1</code> numeric vector
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>X</code></td>
<td>

<p><code class="reqn">n x q</code> matrix
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>Zlist</code></td>
<td>

<p>list of random effects design matrices of  dimensions <code class="reqn">n x l_1</code>,...,<code class="reqn">n x l_k</code>
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>Klist</code></td>
<td>

<p>list of known relationship matrices of  dimensions <code class="reqn">l_1 x l_1</code>,...,<code class="reqn">l_k x l_k</code>
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>varbetahat</code></td>
<td>

<p>TRUE or FALSE
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>varuhat</code></td>
<td>

<p>TRUE or FALSE
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>PEVuhat</code></td>
<td>

<p>TRUE or FALSE
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>test</code></td>
<td>

<p>TRUE or FALSE
</p>
</td>
</tr>
</table>
<h3>Value</h3>

<table>
<tr style="vertical-align: top;">
<td><code>Vu </code></td>
<td>
<p>Estimate of <code class="reqn">\sigma^2_u</code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>Ve</code></td>
<td>
<p>Estimate of <code class="reqn">\sigma^2_e</code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>betahat</code></td>
<td>
<p>BLUEs for <code class="reqn">\beta</code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>uhat</code></td>
<td>
<p>BLUPs for <code class="reqn">u</code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>weights</code></td>
<td>
<p>Estimates of kernel weights</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>Xsqtestbeta</code></td>
<td>
<p>A <code class="reqn">\chi^2</code> test statistic based for testing whether the fixed effect coefficients are equal to zero.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>pvalbeta</code></td>
<td>
<p>pvalues obtained from large sample theory for the fixed effects. We report the pvalues adjusted by the "padjust" function for all fixed effect coefficients.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>Xsqtestu</code></td>
<td>
<p>A <code class="reqn">\chi^2</code> test statistic based for testing whether the BLUPs are equal to zero.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>pvalu</code></td>
<td>
<p>pvalues obtained from large sample theory for the BLUPs. We report the pvalues adjusted by the "padjust" function.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>varuhat</code></td>
<td>
<p>Large sample variance for the BLUPs.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>varbetahat</code></td>
<td>
<p>Large sample variance for the <code class="reqn">\beta</code>'s.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>PEVuhat</code></td>
<td>
<p>Prediction error variance estimates for the BLUPs.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>loglik</code></td>
<td>
<p>loglikelihood for the model.</p>
</td>
</tr>
</table>
<h3>Examples</h3>

<pre><code class="language-R">
####example
#Data from Gaussian process with three 
#(total four, including residuals) independent 
#sources of variation 

n=80
M1&lt;-matrix(rnorm(n*10), nrow=n)

M2&lt;-matrix(rnorm(n*20), nrow=n)

M3&lt;-matrix(rnorm(n*5), nrow=n)


#Relationship matrices
K1&lt;-cov(t(M1))
K2&lt;-cov(t(M2))
K3&lt;-cov(t(M3))
K1=K1/mean(diag(K1))
K2=K2/mean(diag(K2))
K3=K3/mean(diag(K3))


#Generate data
covY&lt;-2*(.2*K1+.7*K2+.1*K3)+diag(n)

Y&lt;-10+crossprod(chol(covY),rnorm(n))

#training set
Trainsamp&lt;-sample(1:80, 60)

funout&lt;-emmremlMultiKernel(y=Y[Trainsamp], X=matrix(rep(1, n)[Trainsamp], ncol=1), 
Zlist=list(diag(n)[Trainsamp,], diag(n)[Trainsamp,], diag(n)[Trainsamp,]),
Klist=list(K1,K2, K3),
varbetahat=FALSE,varuhat=FALSE, PEVuhat=FALSE, test=FALSE)
#weights
funout$weights
#Correlation of predictions with true values in test set
uhatmat&lt;-matrix(funout$uhat, ncol=3)
uhatvec&lt;-rowSums(uhatmat)

cor(Y[-Trainsamp], uhatvec[-Trainsamp])
</code></pre>


</div>