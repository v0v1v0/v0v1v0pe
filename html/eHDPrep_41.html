<div class="container">

<table style="width: 100%;"><tr>
<td>metavariable_agg</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Aggregate Data by Metavariable</h2>

<h3>Description</h3>

<p>Variables in a numeric data frame are aggregated into metavariables via
their most informative common ancestors identified in an ontological graph
object (see <code>metavariable_info</code>). Metavariables are appended to
the data frame.
</p>


<h3>Usage</h3>

<pre><code class="language-R">metavariable_agg(graph, data, label_attr = "name", normalize_vals = TRUE)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>graph</code></td>
<td>
<p>Graph containing ontological and dataset nodes. Must be in
<code>tidygraph</code> format or coercible to this format. Must have been
processed using <code>metavariable_info</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>data</code></td>
<td>
<p>Numeric data frame or matrix containing variables which are also
in <code>graph</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>label_attr</code></td>
<td>
<p>Node attribute containing labels used for column names when
creating metavariable aggregations. Default: "name"</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>normalize_vals</code></td>
<td>
<p>Should values be normalized before aggregation?
Default: TRUE</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>Metavariables are created from the aggregation of data variables via their
most informative common ancestor (expected to have been calculated in
<code>metavariable_info</code>). Metavariables are labelled using the
syntax: <code>MV_[label_attr]_[Aggregation function]</code>. The data variables are
aggregated row-wise by their maximum, minimum, mean, sum, and product.
Metavariables with zero entropy (no information) are not appended to the
data. See examples for where this function should be applied in the semantic
enrichment workflow.
</p>


<h3>Value</h3>

<p><code>data</code> with semantic aggregations derived from common
ontological ancestry (metavariables) appended as new columns, each
prefixed with "MV_" and suffixed by their aggregation function (e.g. "_SUM").
</p>


<h3>Note</h3>

<p>A warning may be shown regarding the '.add' argument being deprecated,
this is believed to be an issue with
<code>tidygraph</code> which may be resolved in a
future release: &lt;https://github.com/thomasp85/tidygraph/issues/131&gt;.
Another warning may be shown regarding the 'neimode' argument being
deprecated, this is believed to be an issue with
<code>tidygraph</code> which may be resolved in a
future release: &lt;https://github.com/thomasp85/tidygraph/issues/156&gt;. These
warning messages are not believed to have an effect on the functionality of
'eHDPrep'.
</p>


<h3>See Also</h3>

<p>Other semantic enrichment functions: 
<code>join_vars_to_ontol()</code>,
<code>metavariable_info()</code>,
<code>metavariable_variable_descendants()</code>
</p>


<h3>Examples</h3>

<pre><code class="language-R">require(magrittr)
require(dplyr)
data(example_ontology)
data(example_mapping_file)
data(example_data)

#' # define datatypes
tibble::tribble(~"var", ~"datatype",
"patient_id", "id",
"tumoursize", "numeric",
"t_stage", "ordinal_tstage",
"n_stage", "ordinal_nstage",
"diabetes_merged", "character",
"hypertension", "factor",
"rural_urban", "factor",
"marital_status", "factor",
"SNP_a", "genotype",
"SNP_b", "genotype",
"free_text", "freetext") -&gt; data_types

# create post-QC data
example_data %&gt;%
  merge_cols(diabetes_type, diabetes, "diabetes_merged", rm_in_vars = TRUE) %&gt;%
  apply_quality_ctrl(patient_id, data_types,
                     bin_cats =c("No" = "Yes", "rural" = "urban"),
                     to_numeric_matrix = TRUE) %&gt;%
                     suppressMessages() -&gt;
                     post_qc_data

# minimal example on first four coloums of example data:
dplyr::slice(example_ontology, 1:7,24) %&gt;%
   join_vars_to_ontol(example_mapping_file[1:3,], root = "root") %&gt;%
   metavariable_info() %&gt;%
   metavariable_agg(post_qc_data[1:10,1:4]) -&gt; res
# see Note section of documentation for information on possible warnings.

# summary of result:
tibble::glimpse(res)


# full example:
example_ontology %&gt;%
   join_vars_to_ontol(example_mapping_file, root = "root") %&gt;%
   metavariable_info() %&gt;%
   metavariable_agg(post_qc_data) -&gt; res
 # see Note section of documentation for information on possible warnings.

# summary of result:
tibble::glimpse(res)

</code></pre>


</div>