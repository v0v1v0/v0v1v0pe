<div class="container">

<table style="width: 100%;"><tr>
<td>SMR</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Standardized Mortality Ratio (SMR)</h2>

<h3>Description</h3>

<p>Calculates the standardized mortality ratio and its confidence interval. SMR, for a group, is defined as the ratio of the observed deaths in this group and the sum of the predicted individual probabilities of death by any model (expected deaths).
</p>
<p><code>SMR.table</code> estimates at once the overall SMR and the SMR across several groups, e.g. ICU units or clinical characteristics. The <code>SMR.table</code> can be ordered by the SMR estimate or its confidence intervals, facilitating the comparison of the units ranks.
</p>
<p><code>forest.SMR</code> shows the <code>SMR.table</code> output as a forest plot. The plot opens two windows and plot at the left side the values from the <code>SMR.table</code> and at the right side the points and lines graphically representing each SMR and its confidence interval.
</p>


<h3>Usage</h3>

<pre><code class="language-R">SMR(
  obs.var,
  pred.var,
  digits = 5,
  ci.method = c("Hosmer", "Byar"),
  ci.level = 0.95
)

SMR.table(
  data,
  group.var,
  obs.var,
  pred.var,
  digits = 5,
  use.label = FALSE,
  var.labels = attr(data, "var.labels")[match(group.var, names(data))],
  ci.method = c("Hosmer", "Byar"),
  ci.level = 0.95,
  reorder = c("no", "SMR", "lower.Cl", "upper.Cl"),
  decreasing = FALSE
)

forest.SMR(
  x,
  mar1 = c(5.1, 1, 4.1, 1),
  mar.SMR = c(5.1, 7, 4.1, 1),
  overall.arg = list(x = 0.01, font = 2, las = 1, labels = var.labels[1], xpd = NA, adj
    = 0),
  NOE.overall.args = list(x = c(N.values.arg$x, O.values.arg$x, E.values.arg$x), font =
    2, las = 1, xpd = NA),
  var.labels.arg = list(x = 0.01, font = 2, las = 1, cex = 1, xpd = NA, adj = 0),
  cat.labels.arg = list(x = 0.1, font = 3, las = 1, cex = 0.95, col = gray(0.4), xpd =
    NA, adj = 0),
  N.values.arg = list(x = 0.5, col = gray(0.4), xpd = NA),
  O.values.arg = list(x = 0.675, col = gray(0.4), xpd = NA),
  E.values.arg = list(x = 0.85, col = gray(0.4), xpd = NA),
  NOE.head.arg = list(font = 2, labels = c("N", "O", "E"), xpd = NA),
  Overall.seg.arg = list(col = "navyblue", xpd = NA, lwd = 2),
  Overall.p.arg = list(pch = 23, cex = 2, col = "black", bg = gray(0.4), xpd = NA),
  Overall.est.arg = list(x = smr.xlim[1] - 0.06, las = 1, font = 2, xpd = NA, adj = 1),
  cat.seg.arg = list(col = "navyblue", xpd = NA, lwd = 2),
  cat.p.arg = list(pch = 22, cex = 1, col = "black", bg = gray(0.4), xpd = NA),
  cat.est.arg = list(x = smr.xlim[1] - 0.06, las = 1, col = gray(0.4), xpd = NA, adj =
    1),
  SMR.head.arg = list(smr.xlim[1] - 0.06, font = 2, labels = "SMR [95% CIs]", xpd =
    NA, adj = 1),
  smr.xlab = "Standardized Mortality Ratio",
  smr.xlim = "auto",
  grid = TRUE,
  digits = 3
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>obs.var</code></td>
<td>
<p>Observed death. Accepted values are 0 (absence) or 1 (presence) in a vector. For <code>SMR.table</code> it must be a character indicating the name of the variable in the data.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>pred.var</code></td>
<td>
<p>Death individual predictions (ranging from 0 to 1) in a vector. For <code>SMR.table</code> it must be a character indicating the name of the variable in the data.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>digits</code></td>
<td>
<p>Number of digits for rounding the output.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>ci.method</code></td>
<td>
<p>Method to estimate the confidence interval. "Hosmer" (default) or "Byar" are acceptable values.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>ci.level</code></td>
<td>
<p>Level of the confidence interval. Default is 0.95.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>data</code></td>
<td>
<p>For <code>SMR.table</code>, a dataset where pred.var, obs.var and group.var are in.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>group.var</code></td>
<td>
<p>For <code>SMR.table</code>, this is a character vector indicating the name(s) of the variable(s) in the data that will form the groups where SMR will be calculated. The variables must be factors.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>use.label</code></td>
<td>
<p>Logical. Default is FALSE. For <code>SMR.table</code> this option will replace the variables names by its labels in var.labels argument.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>var.labels</code></td>
<td>
<p>A character vector with variables labels. The default is to replace the variable name by the label stored at attr(data, "var.labels"). But one may specify labels directly.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>reorder</code></td>
<td>
<p>Default is "no". Possible values are: "no", "SMR","lower.Cl", and "upper.Cl". It will make the <code>SMR.table</code> to be ordered within each varibale by its original order, or by SMR order, or by lower.Cl order, or by upper.Cl.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>decreasing</code></td>
<td>
<p>Logical. When 'reorderd' is TRUE, should the order be decreasing or incresing? See <code>order</code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>x</code></td>
<td>
<p>For the <code>forest.SMR</code> this is the output of <code>SMR.table</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>mar1, mar.SMR</code></td>
<td>
<p>Values to set the margins (mar parameter) of left and right windows. See <code>par</code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>overall.arg</code></td>
<td>
<p>A list of arguments passed to <code>text</code> for plotting the overall label. Internally, 'y' coordinate is replaced.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>NOE.overall.args</code></td>
<td>
<p>A list of arguments passed to <code>text</code> for plotting the overall N (number of observations), O (observed deaths) and E (expected deaths). Internally, 'labels' and 'y' arguments are replaced.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>var.labels.arg</code></td>
<td>
<p>A list of arguments passed to <code>text</code> for plotting the variables labels. Internally, 'y' coordinate is replaced.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>cat.labels.arg</code></td>
<td>
<p>A list of arguments passed to <code>text</code> for plotting the categories labels. Internally, 'y' coordinate is replaced.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>N.values.arg</code></td>
<td>
<p>A list of arguments passed to <code>text</code> for plotting the values of N (number of observations) of each subgroup. Internally, the arguments 'label' and 'y' coordinate are replaced.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>O.values.arg</code></td>
<td>
<p>A list of arguments passed to <code>text</code> for plotting the values of Observed deaths of each subgroup. Internally, the arguments 'label'  and 'y' coordinate are replaced.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>E.values.arg</code></td>
<td>
<p>A list of arguments passed to <code>text</code> for plotting the values of Expected deaths of each subgroup. Internally, the arguments 'label' and 'y' coordinate are replaced.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>NOE.head.arg</code></td>
<td>
<p>A list of arguments passed to <code>text</code> for plotting the labels of the columns N, E and O on the top of the graph. Internally, the 'x' and 'y' coordinates are replaced. The x coordinates are taken from the x in <code>N.values.arg</code>, <code>O.values.arg</code> and <code>E.values.arg</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>Overall.seg.arg</code></td>
<td>
<p>A list of arguments passed to <code>segments</code> for plotting the lines corresponding to overall SMR confidence intervals. Internally, 'x' and 'y' coordinates are replaced.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>Overall.p.arg</code></td>
<td>
<p>A list of arguments passed to <code>points</code> for plotting the points corresponding to overall SMR. Internally, 'x' and 'y' coordinates are replaced.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>Overall.est.arg</code></td>
<td>
<p>A list of arguments passed to <code>text</code> for plotting the overall SMR beside the graph. Internally, 'y' coordinate and 'label' argument are replaced.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>cat.seg.arg</code></td>
<td>
<p>A list of arguments passed to <code>segments</code> for plotting the lines corresponding to SMR confidence intervals for all groups. Internally, 'x' and 'y' coordinates are replaced.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>cat.p.arg</code></td>
<td>
<p>A list of arguments passed to <code>points</code> for plotting the points corresponding to all categoreis SMR. Internally, 'x' and 'y' coordinates are replaced.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>cat.est.arg</code></td>
<td>
<p>A list of arguments passed to <code>text</code> for plotting the categories SMR beside the graph. Internally, 'y' coordinate and 'label' arguments are replaced.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>SMR.head.arg</code></td>
<td>
<p>A list of arguments passed to <code>text</code> for plotting the label of the SMR column on the top of the graph. Internally, the 'y' coordinate is replaced.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>smr.xlab</code></td>
<td>
<p>Label of the x axis. Default is "Standardized Mortality Ratio".</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>smr.xlim</code></td>
<td>
<p>Limits of x axis of the <code>forest.SMR</code> plot. Default is "auto", which internally will pick the highest values of all upper.Cl and the lowest lower.Cl. Besides "auto", only a vector of 2 numbers is valid, and will be passed to <code>plot.default</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>grid</code></td>
<td>
<p>Logical. If TRUE (default), it will draw a grid with the <code>grid</code> default arguments.</p>
</td>
</tr>
</table>
<h3>Value</h3>

<p>If SMR, then:
</p>

<ul>
<li> <p><code>N</code> Number of subjects analyzed.
</p>
</li>
<li>
<p><code>O</code> Observed number of deaths.
</p>
</li>
<li> <p><code>E</code> Expected number of deaths.
</p>
</li>
<li> <p><code>SMR</code> Standardized mortality ratio.
</p>
</li>
<li> <p><code>lower.Cl</code> lower confidence limit.
</p>
</li>
<li> <p><code>upper.Cl</code> upper confidence limit.
</p>
</li>
</ul>
<p>If SMR.table, then a data.frame with the same information as above, and the
additional information is returned: "Variables" (variables names), "Levels" (variables levels).
</p>
<p>If forest.SMR, then a plot is returned.
</p>


<h3>Author(s)</h3>

<p>Lunna Borges and Pedro Brasil
</p>


<h3>References</h3>

<p>David W. Hosmer and Stanley Lemeshow. Confidence intervals estimates of an index of quality performance basend on logistic regression models. Statistics in Medicine , vol. 14, 2161-2172 (1995)
</p>


<h3>See Also</h3>

<p><code>SRU</code>, <code>reclass</code>, <code>funnel</code>
</p>


<h3>Examples</h3>

<pre><code class="language-R"># Loading a example data
data(icu)

# Setting variable labels to data
attr(icu, "var.labels")[match(c("Unit", "IsMechanicalVentilation1h",
          "AdmissionTypeName_pri","Vasopressors_D1"), names(icu))] &lt;-
  c("ICU unit","Mechanichal ventilation","Admission type","Vasopressors at admission")

# Some editing
icu$Saps3DeathProbabilityStandardEquation &lt;- icu$Saps3DeathProbabilityStandardEquation /100
icu$IsMechanicalVentilation1h &lt;- as.factor(ifelse(icu$IsMechanicalVentilation1h == 1, "Yes", "No"))
icu$AdmissionTypeName_pri &lt;- as.factor(icu$AdmissionTypeName_pri)
levels(icu$AdmissionTypeName_pri) &lt;- c("Clinical","Elective surgery", "Urgent surgery")
icu$Vasopressors_D1 &lt;- as.factor(ifelse(icu$Vasopressors_D1 == 1, "Yes", "No"))

# The overall SMR for the whole sample
SMR(icu$UnitDischargeName, icu$Saps3DeathProbabilityStandardEquation)

# The overall SMR and for some subgroups
x &lt;- SMR.table(data = icu, obs.var = "UnitDischargeName",
               pred.var = "Saps3DeathProbabilityStandardEquation",
               group.var = c( "IsMechanicalVentilation1h",
               "AdmissionTypeName_pri","Vasopressors_D1"),
               reorder = "no",
               decreasing = TRUE,
               use.label = TRUE)
x

# A forest plot for all groups SMR (resize the window may be required)
forest.SMR(x, digits = 2)

# The same thing but reordering the categories
x &lt;- SMR.table(data = icu, obs.var = "UnitDischargeName",
               pred.var = "Saps3DeathProbabilityStandardEquation",
               group.var = c( "IsMechanicalVentilation1h",
               "AdmissionTypeName_pri", "Vasopressors_D1"),
               reorder = "SMR",
               decreasing = TRUE,
               use.label = TRUE)
forest.SMR(x, digits = 2)

# The overall SMR and for all Units
x &lt;- SMR.table(data = icu, obs.var = "UnitDischargeName",
               pred.var = "Saps3DeathProbabilityStandardEquation",
               group.var = "Unit",
               reorder = "no",
               decreasing = TRUE,
               use.label = TRUE)
x

# A forest plot for all Units
forest.SMR(x, digits = 2)

# The same thing but reordering the categories
x &lt;- SMR.table(data = icu, obs.var = "UnitDischargeName",
               pred.var = "Saps3DeathProbabilityStandardEquation",
               group.var = "Unit",
               reorder = "SMR",
               decreasing = TRUE,
               use.label = TRUE)
forest.SMR(x, digits = 2)

rm(x, icu)
</code></pre>


</div>