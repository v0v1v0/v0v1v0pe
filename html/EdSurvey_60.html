<div class="container">

<table style="width: 100%;"><tr>
<td>mixed.sdf</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>EdSurvey Mixed-Effects Model</h2>

<h3>Description</h3>

<p>Fits a linear weighted mixed-effects model.
</p>


<h3>Usage</h3>

<pre><code class="language-R">mixed.sdf(
  formula,
  data,
  weightVars = NULL,
  weightTransformation = TRUE,
  recode = NULL,
  defaultConditions = TRUE,
  tolerance = 0.01,
  nQuad = NULL,
  verbose = 0,
  family = NULL,
  centerGroup = NULL,
  centerGrand = NULL,
  fast = FALSE,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>formula</code></td>
<td>
<p>a <code>formula</code>
for the multilevel regression or mixed model. See Examples and the vignette titled
<em><a href="https://www.air.org/sites/default/files/EdSurvey-Mixed_Models.pdf">Methods Used for Estimating Mixed-Effects Models in EdSurvey</a></em>
for more details on how to specify a mixed model. If <em>y</em> is
left blank, the default subject scale or subscale variable
will be used. (You can find the default using
<code>showPlausibleValues</code>.) If <em>y</em> is a variable
for a subject scale or subscale (one of the names shown by
<code>showPlausibleValues</code>), then that subject scale
or subscale is used.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>data</code></td>
<td>
<p>an <code>edsurvey.data.frame</code> or a <code>light.edsurvey.data.frame</code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>weightVars</code></td>
<td>
<p>character vector indicating weight variables for
corresponding levels to use. The <code>weightVar</code> must be
the weights for the <code>edsurvey.data.frame</code>. The weight variables
must be in the order of level (from lowest to highest level).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>weightTransformation</code></td>
<td>
<p>a logical value to indicate whether the function
should standardize weights before using it in the
multilevel model. If set to <code>TRUE</code>, the
function will look up standard weight
transformation methods often used for a specific
survey. Weight transformation can be found in the vignette titled
<em><a href="https://www.air.org/sites/default/files/EdSurvey-Mixed_Models.pdf">Methods Used for Estimating Mixed-Effects Models in EdSurvey</a></em>.
If set to <code>FALSE</code> or if the survey of the specified <code>data</code> does
not have a standard weight transformation method,
raw weights will be used.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>recode</code></td>
<td>
<p>a list of lists to recode variables. Defaults to <code>NULL</code>. Can be set as
<code>recode=</code><code>list(</code><code>var1</code> <code>=</code> <code>list(</code><code>from=</code> <code>c("a",</code> <code>"b",</code> <code>"c"),</code> <code>to=</code> <code>"d"))</code>.
See Examples in <code>lm.sdf</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>defaultConditions</code></td>
<td>
<p>a logical value. When set to the default value of
<code>TRUE</code>, uses the default conditions stored in
an <code>edsurvey.data.frame</code> to subset the data.
Use <code>print</code> on an <code>edsurvey.data.frame</code>
to see the default conditions.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>tolerance</code></td>
<td>
<p>depreciated, no effect</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>nQuad</code></td>
<td>
<p>depreciated, no effect</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>verbose</code></td>
<td>
<p>an integer; when set to <code>1</code>, it will print out
the brief progress of the function <code>mix.sdf</code>.
Users can use these traced messages for further diagnosis.
When set to <code>2</code>, it will print
out the detailed progress, including temporary estimates
during the optimization. Defaults to <code>0</code>, which
will run the function without output.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>family</code></td>
<td>
<p>this argument is depreciated; please use the <code>WeMix</code>
package's <code>mix</code> function directly for binomial models.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>centerGroup</code></td>
<td>
<p>a list in which the name of each element is the name of the aggregation level,
and the element is a formula of variable names to be group mean centered. For example, to group mean center
gender and age within the group student: <code>list("student"= ~gender+age)</code>. Defaults to <code>NULL</code>, which means
predictors are not adjusted by group centering. See Examples in the <code>WeMix</code> function <code>mix</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>centerGrand</code></td>
<td>
<p>a formula of variable names to be grand mean centered. For example, to center the
variable education by overall mean of education: <code>~education</code>. Defaults to <code>NULL</code>, which means predictors
are not adjusted by grand centering.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>fast</code></td>
<td>
<p>depreciated, no effect</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>other potential arguments to be used in <code>mix</code></p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>This function uses the <code>mix</code> call in the <code>WeMix</code> package to fit mixed models.
When the outcome does not have plausible values, the variance estimator directly from
the <code>mix</code> function is used; these account for covariance at the top level
of the model specified by the user.
</p>
<p>When the outcome has plausible values, the coefficients are estimated in the same
way as in <code>lm.sdf</code>, that is, averaged across the plausible values.
In addition, the variance of the coefficients is estimated
as the sum of the variance estimate from the <code>mix</code> function and the
imputation variance. The formula for the imputation variance is, again, the same
as for <code>lm.sdf</code>,
with the same estimators as in the vignette titled
<a href="https://www.air.org/sites/default/files/EdSurvey-Statistics.pdf"><em>Statistical Methods Used in EdSurvey</em></a>.
In the section
“Estimation of Standard Errors of Weighted Means When Plausible Values Are Present, Using the Jackknife Method”
in the formula for <code class="reqn">V_{imp}</code>, the variance
and estimates of the variance components are estimated with the same formulas as
the regression coefficients.
</p>


<h3>Value</h3>

<p>A <code>mixedSdfResults</code> object with the following elements:
</p>
<table>
<tr style="vertical-align: top;">
<td><code>call</code></td>
<td>
<p>the original call used in <code>mixed.sdf</code> </p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>formula</code></td>
<td>
<p>the formula used to fit the model</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>coef</code></td>
<td>
<p>a vector of coefficient estimates</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>se</code></td>
<td>
<p>a vector with the standard error estimates of the coefficients and the standard error of the variance components</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>vars</code></td>
<td>
<p>estimated variance components of the model</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>levels</code></td>
<td>
<p>the number of levels in the model</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>ICC</code></td>
<td>
<p>the intraclass correlation coefficient of the model</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>npv</code></td>
<td>
<p>the number of plausible values</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>ngroups</code></td>
<td>
<p>a <code>data.frame</code> that includes the number of observations for each group</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>n0</code></td>
<td>
<p>the number of observations in the original data</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>nused</code></td>
<td>
<p>the number of observations used in the analysis</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>model.frame</code></td>
<td>
<p>the data used in the model</p>
</td>
</tr>
</table>
<p>If the formula does not involve plausible values, the function will return the following additional elements:
</p>
<table>
<tr style="vertical-align: top;">
<td><code>lnlf</code></td>
<td>
<p>the likelihood function </p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>lnl</code></td>
<td>
<p>the log-likelihood of the model </p>
</td>
</tr>
</table>
<p>If the formula involves plausible values, the function will return the following additional elements:
</p>
<table>
<tr style="vertical-align: top;">
<td><code>Vimp</code></td>
<td>
<p>the estimated variance from uncertainty in the scores</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>Vjrr</code></td>
<td>
<p>the estimated variance from sampling</p>
</td>
</tr>
</table>
<h3>Author(s)</h3>

<p>Paul Bailey, Trang Nguyen, and Claire Kelley
</p>


<h3>References</h3>

<p>Rabe-Hesketh, S., &amp; Skrondal, A. (2006). Multilevel modelling of complex
survey data. <em>Journal of the Royal Statistical Society: Series A
(Statistics in Society), 169</em>(4), 805–827.
</p>


<h3>See Also</h3>

<p><code>mix</code> and <code>lm.sdf</code>
</p>


<h3>Examples</h3>

<pre><code class="language-R">## Not run: 
# save TIMSS 2015 data to ~/TIMSS/2015
downloadTIMSS(root="~/", years=2015)
fin &lt;- readTIMSS(path="~/TIMSS/2015", countries="fin", gradeLvl=4)
# uses all plausible values
mix1 &lt;- mixed.sdf(formula=mmat ~ itsex + (1|idschool), data = fin,
                  weightVar=c("totwgt","schwgt"), weightTransformation=FALSE)
summary(mix1)
# uses only one plausible value
mix2 &lt;- mixed.sdf(formula=asmmat01 ~ itsex + (1|idschool), data = fin,
                  weightVar=c("totwgt","schwgt"), weightTransformation=FALSE)
summary(mix2)

## End(Not run)
</code></pre>


</div>