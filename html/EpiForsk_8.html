<div class="container">

<table style="width: 100%;"><tr>
<td>CausalForestDynamicSubgroups</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Calculate CATE in dynamically determined subgroups</h2>

<h3>Description</h3>

<p>Determines subgroups ranked by CATE estimates from a causal_forest object,
then calculates comparable CATE estimates in each subgroup and tests for
differences.
</p>


<h3>Usage</h3>

<pre><code class="language-R">CausalForestDynamicSubgroups(forest, n_rankings = 3, n_folds = 5, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>forest</code></td>
<td>
<p>An object of class <code>causal_forest</code>, as returned by
causal_forest().</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>n_rankings</code></td>
<td>
<p>Integer, scalar with number of groups to rank CATE's into.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>n_folds</code></td>
<td>
<p>Integer, scalar with number of folds to split data into.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>Additional arguments passed to causal_forest() and
regression_forest().</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>To evaluate heterogeneity in treatment effect one can split data
into groups by estimated CATE (for an alternative, see also
RATEOmnibusTest). To compare estimates one must use a
model which is not trained on the subjects we wish to compare. To achieve
this, data is partitioned into n_folds folds and a causal forest is trained
for each fold where the fold is left out. If the data has no existing
clustering, one causal_forest() is trained with the folds as
clustering structure. This enables predictions on each fold where trees
using data from the fold are left out for the prediction. In the case of
preexisting clustering in the data, folds are sampled within each cluster
and combined across clusters afterwards.
</p>


<h3>Value</h3>

<p>A list with elements
</p>

<ul>
<li>
<p> forest_subgroups: A tibble with CATE estimates, ranking, and AIPW-scores
for each subject.
</p>
</li>
<li>
<p> forest_rank_ate: A tibble with the ATE estimate and standard error of
each subgroup.
</p>
</li>
<li>
<p> forest_rank_diff_test: A tibble with estimates of the difference in ATE
between subgroups and p-values for a formal test of no difference.
</p>
</li>
<li>
<p> heatmap_data: A tibble with data used to draw a heatmap of covariate
distribution in each subgroup.
</p>
</li>
<li>
<p> forest_rank_ate_plot: ggplot with the ATE estimates in each subgroup.
</p>
</li>
<li>
<p> heatmap: ggplot with heatmap of covariate distribution in each subgroup.
</p>
</li>
</ul>
<h3>Author(s)</h3>

<p>KIJA
</p>


<h3>Examples</h3>

<pre><code class="language-R">
n &lt;- 800
p &lt;- 3
X &lt;- matrix(rnorm(n * p), n, p) |&gt; as.data.frame()
W &lt;- rbinom(n, 1, 0.5)
event_prob &lt;- 1 / (1 + exp(2 * (pmax(2 * X[, 1], 0) * W - X[, 2])))
Y &lt;- rbinom(n, 1, event_prob)
cf &lt;- grf::causal_forest(X, Y, W)
cf_ds &lt;- CausalForestDynamicSubgroups(cf, 2, 4)


</code></pre>


</div>