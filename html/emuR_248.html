<div class="container">

<table style="width: 100%;"><tr>
<td>serve</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Serve EMU database to EMU-webApp</h2>

<h3>Description</h3>

<p>Serves emuDB media files, SSFF tracks and annotations for 
EMU-webApp browser GUI <a href="http://ips-lmu.github.io/EMU-webApp/">http://ips-lmu.github.io/EMU-webApp/</a>
</p>
<p>Instructions:
</p>
<p>Start and connect (this should happen automatically):
</p>

<ul>
<li>
<p> Call this function to start the server.
</p>
</li>
<li>
<p> Start a suitable HTML5 capable Web-Browser (Google Chrome, Firefox,...).
</p>
</li>
<li>
<p> Navigate to the EMU-Webapp URL: <a href="http://ips-lmu.github.io/EMU-webApp/">http://ips-lmu.github.io/EMU-webApp/</a>.
</p>
</li>
<li>
<p> Press the 'Connect' button in the EMU-webApp and connect with default URL.
</p>
</li>
<li>
<p> EMU-webApp loads the bundle list and the first 
bundles media file, SSFF tracks and annotations.
</p>
</li>
</ul>
<p>Disconnect and stop:
</p>

<ul>
<li>
<p> Disconnect and stop the server with the 'Clear' button of 
the webapp or the reload button of your browser.
</p>
</li>
<li>
<p> The server can also be stopped by 
calling <code>stopAllServers</code> of the httpuv package
</p>
</li>
</ul>
<p>Hints:
</p>

<ul>
<li>
<p> To serve only a subset of sessions or bundles use 
the parameters <code>sessionPattern</code> and/or <code>bundlePattern</code>.
</p>
</li>
<li>
<p> Use the <code>seglist</code> parameter to pass in a segment list
which was generated using the <code>query</code> function. This will
allow quick navigation to those segments.
</p>
</li>
</ul>
<h3>Usage</h3>

<pre><code class="language-R">serve(
  emuDBhandle,
  sessionPattern = ".*",
  bundlePattern = ".*",
  seglist = NULL,
  bundleListName = NULL,
  host = "127.0.0.1",
  port = 17890,
  autoOpenURL = "https://ips-lmu.github.io/EMU-webApp/?autoConnect=true",
  browser = getOption("browser"),
  useViewer = TRUE,
  debug = FALSE,
  debugLevel = 0
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>emuDBhandle</code></td>
<td>
<p>emuDB handle as returned by <code>load_emuDB</code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>sessionPattern</code></td>
<td>
<p>A regular expression pattern matching session names to be served</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>bundlePattern</code></td>
<td>
<p>A regular expression pattern matching bundle names to be served</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>seglist</code></td>
<td>
<p>segment list to use for times anchors and session + bundle restriction (type: emuRsegs)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>bundleListName</code></td>
<td>
<p>name of bundleList stored in emuDB/bundleLists subdir to send to EMU-webApp</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>host</code></td>
<td>
<p>host IP to listen to (default: 127.0.0.1  (localhost))</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>port</code></td>
<td>
<p>the port number to listen on (default: 17890)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>autoOpenURL</code></td>
<td>
<p>URL passed to <code>browseURL</code> function. If NULL or an empty string are passed in
<code>browseURL</code> will not be invoked.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>browser</code></td>
<td>
<p>argument passed on to <code>browser</code> argument of <code>browseURL</code> (see 
it's documentation for details )</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>useViewer</code></td>
<td>
<p>Use the viewer provided by <code>getOption("viewer")</code> (the viewer pane when using RStudio) 
and host a local version of the EMU-webApp in it. This will clone the current 
EMU-webApp build (<a href="https://github.com/IPS-LMU/EMU-webApp/tree/gh-pages/">https://github.com/IPS-LMU/EMU-webApp/tree/gh-pages/</a>) into the directory provided by 
<code>tempdir</code> and serve this local version. A clone will 
only be performed if no <code>file.path(tempdir(), "EMU-webApp")</code> directory is present. An alternative
directory can be also set: <code>options(emuR.emuWebApp.dir="path/to/EMU-webApp")</code> (use if offline functionality is required).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>debug</code></td>
<td>
<p>TRUE to enable debugging (default: no debugging messages)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>debugLevel</code></td>
<td>
<p>integer higher values generate more detailed debug output</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>Function opens a HTTP/websocket and waits in a loop for browser requests. 
Parameter host determines the IP address(es) of hosts allowed to connect to the 
server. By default the server only listens to localhost. If you want to allow 
connection from any host set the host parameter to <code>0.0.0.0</code>. Please note 
that this might be an safety issue! The <code>port</code> parameter determines the port 
the server listens on. The <code>host</code> and <code>port</code> parameters are intended 
only for expert users. When started the R console will be blocked. On successful 
connection the server sends the session and bundle list of the database referenced 
by name by parameter <code>dbName</code> or by UUID parameter <code>dbUUID</code>.
The Web application requests bundle data for viewing or editing. If a bundle 
is modified with the EMU-webApp and the save button is pressed the server modifies 
the internal database and saves the changes to disk.
Communication between server and EMU webApp is defined by EMU-webApp-websocket-protocol 
version 0.0.2 (<a href="https://ips-lmu.github.io/The-EMU-SDMS-Manual/app-chap-wsProtocol.html">https://ips-lmu.github.io/The-EMU-SDMS-Manual/app-chap-wsProtocol.html</a>).
</p>


<h3>Value</h3>

<p>TRUE (invisible) if the server was started
</p>


<h3>Examples</h3>

<pre><code class="language-R">## Not run:  
## Load EMU database 'myDb' and serve it to the EMU-webApp (opens default HTTP/websocket port 17890)

myDb = load_emuDB("/path/to/myDb")
serve(myDb)

## End(Not run)

</code></pre>


</div>