<div class="container">

<table style="width: 100%;"><tr>
<td>Hqz</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>
Similarity-based entropy of a community
</h2>

<h3>Description</h3>

<p>Calculates the entropy of order <code class="reqn">q</code> of a probability vector according to a similarity matrix.
</p>


<h3>Usage</h3>

<pre><code class="language-R">Hqz(NorP, q = 1, Z = diag(length(NorP)),  ...)
bcHqz(Ns, q = 1, Z = diag(length(Ns)), Correction = "Best", SampleCoverage = NULL, 
  CheckArguments = TRUE)
## S3 method for class 'ProbaVector'
Hqz(NorP, q = 1, Z = diag(length(NorP)), 
  ..., CheckArguments = TRUE, Ps = NULL)
## S3 method for class 'AbdVector'
Hqz(NorP, q = 1, Z = diag(length(NorP)), Correction = "Best",
  ..., CheckArguments = TRUE, Ns = NULL)
## S3 method for class 'integer'
Hqz(NorP, q = 1, Z = diag(length(NorP)), Correction = "Best", 
  ..., CheckArguments = TRUE, Ns = NULL)
## S3 method for class 'numeric'
Hqz(NorP, q = 1, Z = diag(length(NorP)), Correction = "Best", 
  ..., CheckArguments = TRUE, Ps = NULL, Ns = NULL) 
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>Ps</code></td>
<td>

<p>A probability vector, summing to 1.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>Ns</code></td>
<td>

<p>A numeric vector containing species abundances.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>NorP</code></td>
<td>

<p>A numeric vector, an integer vector, an abundance vector (<code>AbdVector</code>) or a probability vector (<code>ProbaVector</code>). Contains either abundances or probabilities.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>q</code></td>
<td>

<p>A number: the order of entropy. Default is 1.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>Z</code></td>
<td>

<p>A relatedness matrix, <em>i.e.</em> a square matrix whose terms are all positive, strictly positive on the diagonal. Generally, the matrix is a similarity matrix, <em>i.e.</em> the diagonal terms equal 1 and other terms are between 0 and 1. Default is the identity matrix to calculate neutral entropy.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>Correction</code></td>
<td>

<p>A string containing one of the possible corrections: <code>"None"</code> (no correction), <code>"ChaoShen"</code>, <code>"MarconZhang"</code> or <code>"Best"</code>, the default value. The <code>"MarconZhang"</code> correction assumes a similarity matrix.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>SampleCoverage</code></td>
<td>

<p>The sample coverage of <code>Ns</code> calculated elsewhere. Used to calculate the gamma diversity of meta-communities, see details. 
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>

<p>Additional arguments. Unused.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>CheckArguments</code></td>
<td>

<p>Logical; if <code>TRUE</code>, the function arguments are verified. Should be set to <code>FALSE</code> to save time when the arguments have been checked elsewhere.
</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>Entropy is calculated following Leinster and Cobbold (2012) after Ricotta and Szeidl (2006): it is the entropy of order <code>q</code> of the community, using species ordinariness as the information function.
</p>
<p>A similarity matrix is used (as for <code>Dqz</code>), not a distance matrix as in Ricotta and Szeidl (2006). See the example.
</p>
<p>Bias correction requires the number of individuals. Use <code>bcHqz</code> and choose the <code>Correction</code>.
Correction techniques are from Marcon <em>et al.</em> (2014).
</p>
<p>Currently, the <code>"Best"</code> correction is the max value of <code>"ChaoShen"</code> and <code>"MarconZhang"</code>.
</p>
<p>The functions are designed to be used as simply as possible. <code>Hqz</code> is a generic method. If its first argument is an abundance vector, an integer vector or a numeric vector which does not sum to 1, the bias corrected function <code>bcHqz</code> is called. Explicit calls to <code>bcHqz</code> (with bias correction) or to <code>Hqz.ProbaVector</code> (without correction) are possible to avoid ambiguity. The <code>.integer</code> and <code>.numeric</code> methods accept <code>Ps</code> or <code>Ns</code> arguments instead of <code>NorP</code> for backward compatibility.
</p>
<p>The size of a metacommunity (see <code>MetaCommunity</code>) is unknown so it has to be set according to a rule which does not ensure that its abundances are integer values. Then, classical bias-correction methods do not apply. Providing the <code>SampleCoverage</code> argument allows applying the <code>"ChaoShen"</code> correction to estimate quite well the entropy. <code>DivPart</code> and <code>GammaEntropy</code> functions use this tweak.
</p>


<h3>Value</h3>

<p>A named number equal to the calculated entropy. The name is that of the bias correction used.
</p>


<h3>References</h3>

<p>Leinster, T. and Cobbold, C. (2012). Measuring diversity: the importance of species similarity. <em>Ecology</em> 93(3): 477-489.
</p>
<p>Marcon, E., Zhang, Z. and Herault, B. (2014). The decomposition of similarity-based diversity and its bias correction. <em>HAL</em> hal-00989454(version 3).
</p>
<p>Ricotta, C. and Szeidl, L. (2006). Towards a unifying approach to diversity measures: Bridging the gap between the Shannon entropy and Rao's quadratic index. <em>Theoretical Population Biology</em> 70(3): 237-243.
</p>


<h3>See Also</h3>

<p><code>Dqz</code>, <code>PhyloEntropy</code>
</p>


<h3>Examples</h3>

<pre><code class="language-R"># Load Paracou data (number of trees per species in two 1-ha plot of a tropical forest)
data(Paracou618)
# Prepare the similarity matrix
DistanceMatrix &lt;- as.matrix(EightSpTree$Wdist^2/2)
# Similarity can be 1 minus normalized distances between species
Z &lt;- 1 - DistanceMatrix/max(DistanceMatrix)
# Calculate diversity of order 2
Ps &lt;- EightSpAbundance/sum(EightSpAbundance)
Hqz(Ps, 2, Z)
# Equal to normalized Rao quadratic entropy when q=2
Rao(Ps, EightSpTree)/max(DistanceMatrix)
# But different from PhyloEntropy for all other q, e.g. 1
Hqz(Ps, 1, Z)
summary(PhyloEntropy(Ps, 1, EightSpTree))
</code></pre>


</div>