<div class="container">

<table style="width: 100%;"><tr>
<td>wf_request</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>ECMWF Data Store (DS) request and download</h2>

<h3>Description</h3>

<p>Stage a data request, and optionally download the data to disk. Alternatively
you can only stage requests, logging the request URLs to submit download
queries later on using <code>wf_transfer</code>.
Note that the function will do some basic checks on the <code>request</code> input
to identify possible problems.
</p>


<h3>Usage</h3>

<pre><code class="language-R">wf_request(
  request,
  user = "ecmwfr",
  transfer = TRUE,
  path = tempdir(),
  time_out = 3600,
  retry = 30,
  job_name,
  verbose = TRUE
)

wf_request_batch(
  request_list,
  workers = 2,
  user = "ecmwfr",
  path = tempdir(),
  time_out = 3600,
  retry = 5,
  total_timeout = length(request_list) * time_out/workers
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>request</code></td>
<td>
<p>nested list with query parameters following the layout
as specified on the ECMWF APIs page</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>user</code></td>
<td>
<p>user (default = "ecmwf") provided by the ECMWF data service,
used to retrieve the token set by <code>wf_set_key</code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>transfer</code></td>
<td>
<p>logical, download data TRUE or FALSE (default = TRUE)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>path</code></td>
<td>
<p>path were to store the downloaded data</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>time_out</code></td>
<td>
<p>how long to wait on a download to start (default =
<code>3*3600</code> seconds).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>retry</code></td>
<td>
<p>polling frequency of submitted request for downloading (default =
<code>30</code> seconds).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>job_name</code></td>
<td>
<p>optional name to use as an RStudio job and as output variable
name. It has to be a syntactically valid name.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>verbose</code></td>
<td>
<p>show feedback on processing</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>request_list</code></td>
<td>
<p>a list of requests that will be processed in parallel.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>workers</code></td>
<td>
<p>maximum number of simultaneous request that will be submitted
to the service. Most ECMWF services are limited to 20 concurrent requests
(default = 2).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>total_timeout</code></td>
<td>
<p>overall timeout limit for all the requests in seconds.</p>
</td>
</tr>
</table>
<h3>Value</h3>

<p>the path of the downloaded (requested file) or the an R6 object
with download/transfer information
</p>


<h3>Author(s)</h3>

<p>Koen Hufkens
</p>


<h3>See Also</h3>

<p><code>wf_set_key</code>
<code>wf_transfer</code>
</p>


<h3>Examples</h3>

<pre><code class="language-R">
## Not run: 
# set key
wf_set_key(key = "123")

request &lt;- list(
  dataset_short_name = "reanalysis-era5-pressure-levels",
  product_type = "reanalysis",
  variable = "geopotential",
  year = "2024",
  month = "03",
  day = "01",
  time = "13:00",
  pressure_level = "1000",
  data_format = "grib",
  target = "download.grib"
)

# demo query
wf_request(request = request)

# Run as an RStudio Job. When finished, will create a
# variable named "test" in your environment with the path to
# the downloaded file.
wf_request(request = request, job_name = "test")

## End(Not run)
</code></pre>


</div>