<div class="container">

<table style="width: 100%;"><tr>
<td>docs_bulk_update</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Use the bulk API to update documents</h2>

<h3>Description</h3>

<p>Use the bulk API to update documents
</p>


<h3>Usage</h3>

<pre><code class="language-R">docs_bulk_update(
  conn,
  x,
  index = NULL,
  type = NULL,
  chunk_size = 1000,
  doc_ids = NULL,
  raw = FALSE,
  quiet = FALSE,
  query = list(),
  digits = NA,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>conn</code></td>
<td>
<p>an Elasticsearch connection object, see <code>connect()</code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>x</code></td>
<td>
<p>A list, data.frame, or character path to a file. required.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>index</code></td>
<td>
<p>(character) The index name to use. Required for data.frame
input, but optional for file inputs.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>type</code></td>
<td>
<p>(character) The type. default: <code>NULL</code>. Note that <code>type</code> is
deprecated in Elasticsearch v7 and greater, and removed in Elasticsearch v8</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>chunk_size</code></td>
<td>
<p>(integer) Size of each chunk. If your data.frame is smaller
thank <code>chunk_size</code>, this parameter is essentially ignored. We write in
chunks because at some point, depending on size of each document, and
Elasticsearch setup, writing a very large number of documents in one go
becomes slow, so chunking can help. This parameter is ignored if you
pass a file name. Default: 1000</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>doc_ids</code></td>
<td>
<p>An optional vector (character or numeric/integer) of document
ids to use. This vector has to equal the size of the documents you are
passing in, and will error if not. If you pass a factor we convert to
character. Default: not passed</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>raw</code></td>
<td>
<p>(logical) Get raw JSON back or not. If <code>TRUE</code>
you get JSON; if <code>FALSE</code> you get a list. Default: <code>FALSE</code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>quiet</code></td>
<td>
<p>(logical) Suppress progress bar. Default: <code>FALSE</code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>query</code></td>
<td>
<p>(list) a named list of query parameters. optional.
options include: pipeline, refresh, routing, _source, _source_excludes,
_source_includes, timeout, wait_for_active_shards. See the docs bulk
ES page for details</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>digits</code></td>
<td>
<p>digits used by the parameter of the same name by
<code>jsonlite::toJSON()</code> to convert data to JSON before being submitted to
your ES instance. default: <code>NA</code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>Pass on curl options to crul::HttpClient</p>
</td>
</tr>
</table>
<h3>Details</h3>


<ul><li> <p><code>doc_as_upsert</code> - is set to <code>TRUE</code> for all records
</p>
</li></ul>
<p>For doing updates with a file already prepared for the bulk API,
see <code>docs_bulk()</code>
</p>
<p>Only data.frame's are supported for now.
</p>


<h3>References</h3>

<p><a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/docs-bulk.html#bulk-update">https://www.elastic.co/guide/en/elasticsearch/reference/current/docs-bulk.html#bulk-update</a>
</p>


<h3>See Also</h3>

<p>Other bulk-functions: 
<code>docs_bulk_create()</code>,
<code>docs_bulk_delete()</code>,
<code>docs_bulk_index()</code>,
<code>docs_bulk_prep()</code>,
<code>docs_bulk()</code>
</p>


<h3>Examples</h3>

<pre><code class="language-R">## Not run: 
x &lt;- connect()
if (index_exists(x, "foobar")) index_delete(x, "foobar")

df &lt;- data.frame(name = letters[1:3], size = 1:3, id = 100:102)
invisible(docs_bulk(x, df, 'foobar', es_ids = FALSE))

# add new rows in existing fields
(df2 &lt;- data.frame(size = c(45, 56), id = 100:101))
(df2 &lt;- data.frame(size = c(45, 56)))
df2$`_id` &lt;- 100:101
df2
Search(x, "foobar", asdf = TRUE)$hits$hits
invisible(docs_bulk_update(x, df2, index = 'foobar'))
Search(x, "foobar", asdf = TRUE)$hits$hits

# add new fields (and new rows by extension)
(df3 &lt;- data.frame(color = c("blue", "red", "green"), id = 100:102))
Search(x, "foobar", asdf = TRUE)$hits$hits
invisible(docs_bulk_update(x, df3, index = 'foobar'))
Sys.sleep(2) # wait for a few sec to make sure you see changes reflected
Search(x, "foobar", asdf = TRUE)$hits$hits

## End(Not run)
</code></pre>


</div>