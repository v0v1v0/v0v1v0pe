<div class="container">

<table style="width: 100%;"><tr>
<td>fgkg</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>MLE Fitting of Kernel Density Estimate for Bulk and GPD for Both Tails
Extreme Value Mixture Model</h2>

<h3>Description</h3>

<p>Maximum likelihood estimation for fitting the extreme value 
mixture model with kernel density estimate for bulk distribution between thresholds and conditional
GPDs beyond thresholds. With options for profile likelihood estimation for both thresholds and
fixed threshold approach.
</p>


<h3>Usage</h3>

<pre><code class="language-R">fgkg(x, phiul = TRUE, phiur = TRUE, ulseq = NULL, urseq = NULL,
  fixedu = FALSE, pvector = NULL, kernel = "gaussian",
  add.jitter = FALSE, factor = 0.1, amount = NULL, std.err = TRUE,
  method = "BFGS", control = list(maxit = 10000), finitelik = TRUE,
  ...)

lgkg(x, lambda = NULL, ul = 0, sigmaul = 1, xil = 0,
  phiul = TRUE, ur = 0, sigmaur = 1, xir = 0, phiur = TRUE,
  bw = NULL, kernel = "gaussian", log = TRUE)

nlgkg(pvector, x, phiul = TRUE, phiur = TRUE, kernel = "gaussian",
  finitelik = FALSE)

proflugkg(ulr, pvector, x, phiul = TRUE, phiur = TRUE,
  kernel = "gaussian", method = "BFGS", control = list(maxit =
  10000), finitelik = TRUE, ...)

nlugkg(pvector, ul, ur, x, phiul = TRUE, phiur = TRUE,
  kernel = "gaussian", finitelik = FALSE)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>x</code></td>
<td>
<p>vector of sample data</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>phiul</code></td>
<td>
<p>probability of being below lower threshold <code class="reqn">(0, 1)</code> or logical, see Details in 
help for <code>fgng</code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>phiur</code></td>
<td>
<p>probability of being above upper threshold <code class="reqn">(0, 1)</code> or logical, see Details in 
help for <code>fgng</code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>ulseq</code></td>
<td>
<p>vector of lower thresholds (or scalar) to be considered in profile likelihood or
<code>NULL</code> for no profile likelihood</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>urseq</code></td>
<td>
<p>vector of upper thresholds (or scalar) to be considered in profile likelihood or
<code>NULL</code> for no profile likelihood</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>fixedu</code></td>
<td>
<p>logical, should threshold be fixed (at either scalar value in <code>ulseq</code>/<code>urseq</code>,
or estimated from maximum of profile likelihood evaluated at
sequence of thresholds in <code>ulseq</code>/<code>urseq</code>)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>pvector</code></td>
<td>
<p>vector of initial values of parameters or <code>NULL</code> for default
values, see below</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>kernel</code></td>
<td>
<p>kernel name (<code>default = "gaussian"</code>)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>add.jitter</code></td>
<td>
<p>logical, whether jitter is needed for rounded kernel centres</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>factor</code></td>
<td>
<p>see <code>jitter</code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>amount</code></td>
<td>
<p>see <code>jitter</code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>std.err</code></td>
<td>
<p>logical, should standard errors be calculated</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>method</code></td>
<td>
<p>optimisation method (see <code>optim</code>)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>control</code></td>
<td>
<p>optimisation control list (see <code>optim</code>)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>finitelik</code></td>
<td>
<p>logical, should log-likelihood return finite value for invalid parameters</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>optional inputs passed to <code>optim</code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>lambda</code></td>
<td>
<p>scalar bandwidth for kernel (as half-width of kernel)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>ul</code></td>
<td>
<p>scalar lower tail threshold</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>sigmaul</code></td>
<td>
<p>scalar lower tail GPD scale parameter (positive)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>xil</code></td>
<td>
<p>scalar lower tail GPD shape parameter</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>ur</code></td>
<td>
<p>scalar upper tail threshold</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>sigmaur</code></td>
<td>
<p>scalar upper tail GPD scale parameter (positive)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>xir</code></td>
<td>
<p>scalar upper tail GPD shape parameter</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>bw</code></td>
<td>
<p>scalar bandwidth for kernel (as standard deviations of kernel)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>log</code></td>
<td>
<p>logical, if <code>TRUE</code> then log-likelihood rather than likelihood is output</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>ulr</code></td>
<td>
<p>vector of length 2 giving lower and upper tail thresholds or
<code>NULL</code> for default values</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>The extreme value mixture model with kernel density estimate for bulk and
GPD for both tails is 
fitted to the entire dataset using maximum likelihood estimation. The estimated
parameters, variance-covariance matrix and their standard errors are automatically
output.
</p>
<p>See help for <code>fnormgpd</code> and <code>fgkg</code> 
for details, type <code>help fnormgpd</code> and <code>help fgkg</code>. 
Only the different features are outlined below for brevity.
</p>
<p>The full parameter vector is
(<code>lambda</code>, <code>ul</code>, <code>sigmaul</code>, <code>xil</code>, <code>ur</code>, <code>sigmaur</code>, <code>xir</code>)
if thresholds are also estimated and
(<code>lambda</code>, <code>sigmaul</code>, <code>xil</code>, <code>sigmaur</code>, <code>xir</code>)
for profile likelihood or fixed threshold approach.
</p>
<p>Cross-validation likelihood is used for KDE, but standard likelihood is used
for GPD components. See help for <code>fkden</code> for details,
type <code>help fkden</code>.
</p>
<p>The alternate bandwidth definitions are discussed in the 
<code>kernels</code>, with the <code>lambda</code> as the default
used in the likelihood fitting. The <code>bw</code> specification is the same as
used in the <code>density</code> function.
</p>
<p>The possible kernels are also defined in <code>kernels</code>
with the <code>"gaussian"</code> as the default choice.
</p>
<p>The tail fractions <code>phiul</code> and <code>phiur</code> are treated separately to the other parameters, 
to allow for all their representations. In the fitting functions 
<code>fgkg</code> and
<code>proflugkg</code> they are logical:
</p>

<ul>
<li>
<p> default values <code>phiul=TRUE</code> and <code>phiur=TRUE</code> - tail fractions specified by 
KDE distribution and survivior functions respectively and
standard error is output as <code>NA</code>.
</p>
</li>
<li> <p><code>phiul=FALSE</code> and <code>phiur=FALSE</code> - treated as extra parameters estimated using
the MLE which is the sample proportion beyond the thresholds and 
standard error is output.
</p>
</li>
</ul>
<p>In the likelihood functions <code>lgkg</code>,
<code>nlgkg</code> and <code>nlugkg</code> 
it can be logical or numeric:
</p>

<ul>
<li>
<p> logical - same as for fitting functions with default values <code>phiul=TRUE</code> and <code>phiur=TRUE</code>.
</p>
</li>
<li>
<p> numeric - any value over range <code class="reqn">(0, 1)</code>. Notice that the tail
fraction probability cannot be 0 or 1 otherwise there would be no
contribution from either tail or bulk components respectively. Also,
<code>phiul+phiur&lt;1</code> as bulk must contribute.
</p>
</li>
</ul>
<p>If the profile likelihood approach is used, then a grid search over all combinations of both thresholds
is carried out. The combinations which lead to less than 5 in any datapoints beyond the thresholds are not considered.
</p>


<h3>Value</h3>

<p>Log-likelihood is given by <code>lgkg</code> and it's
wrappers for negative log-likelihood from <code>nlgkg</code>
and <code>nlugkg</code>. Profile likelihood for both
thresholds given by <code>proflugkg</code>. Fitting function
<code>fgkg</code> returns a simple list with the
following elements
</p>

<table>
<tr>
<td style="text-align: left;">
 <code>call</code>:      </td>
<td style="text-align: left;"> <code>optim</code> call</td>
</tr>
<tr>
<td style="text-align: left;">
 <code>x</code>:         </td>
<td style="text-align: left;"> data vector <code>x</code>
</td>
</tr>
<tr>
<td style="text-align: left;">
 <code>init</code>:      </td>
<td style="text-align: left;"> <code>pvector</code>
</td>
</tr>
<tr>
<td style="text-align: left;">
 <code>fixedu</code>:    </td>
<td style="text-align: left;"> fixed thresholds, logical</td>
</tr>
<tr>
<td style="text-align: left;">
 <code>ulseq</code>:     </td>
<td style="text-align: left;"> lower threshold vector for profile likelihood or scalar for fixed threshold</td>
</tr>
<tr>
<td style="text-align: left;">
 <code>urseq</code>:     </td>
<td style="text-align: left;"> upper threshold vector for profile likelihood or scalar for fixed threshold</td>
</tr>
<tr>
<td style="text-align: left;">
 <code>nllhuseq</code>:  </td>
<td style="text-align: left;"> profile negative log-likelihood at each threshold pair in (ulseq, urseq)</td>
</tr>
<tr>
<td style="text-align: left;">
 <code>optim</code>:     </td>
<td style="text-align: left;"> complete <code>optim</code> output</td>
</tr>
<tr>
<td style="text-align: left;">
 <code>mle</code>:       </td>
<td style="text-align: left;"> vector of MLE of parameters</td>
</tr>
<tr>
<td style="text-align: left;">
 <code>cov</code>:       </td>
<td style="text-align: left;"> variance-covariance matrix of MLE of parameters</td>
</tr>
<tr>
<td style="text-align: left;">
 <code>se</code>:        </td>
<td style="text-align: left;"> vector of standard errors of MLE of parameters</td>
</tr>
<tr>
<td style="text-align: left;">
 <code>rate</code>:      </td>
<td style="text-align: left;"> <code>phiu</code> to be consistent with <code>evd</code>
</td>
</tr>
<tr>
<td style="text-align: left;">
 <code>nllh</code>:      </td>
<td style="text-align: left;"> minimum negative log-likelihood</td>
</tr>
<tr>
<td style="text-align: left;">
 <code>n</code>:         </td>
<td style="text-align: left;"> total sample size</td>
</tr>
<tr>
<td style="text-align: left;">
 <code>lambda</code>:    </td>
<td style="text-align: left;"> MLE of lambda (kernel half-width)</td>
</tr>
<tr>
<td style="text-align: left;">
 <code>ul</code>:        </td>
<td style="text-align: left;"> lower threshold (fixed or MLE)</td>
</tr>
<tr>
<td style="text-align: left;">
 <code>sigmaul</code>:   </td>
<td style="text-align: left;"> MLE of lower tail GPD scale</td>
</tr>
<tr>
<td style="text-align: left;">
 <code>xil</code>:       </td>
<td style="text-align: left;"> MLE of lower tail GPD shape</td>
</tr>
<tr>
<td style="text-align: left;">
 <code>phiul</code>:     </td>
<td style="text-align: left;"> MLE of lower tail fraction (bulk model or parameterised approach)</td>
</tr>
<tr>
<td style="text-align: left;">
 <code>se.phiul</code>:  </td>
<td style="text-align: left;"> standard error of MLE of lower tail fraction</td>
</tr>
<tr>
<td style="text-align: left;">
 <code>ur</code>:        </td>
<td style="text-align: left;"> upper threshold (fixed or MLE)</td>
</tr>
<tr>
<td style="text-align: left;">
 <code>sigmaur</code>:   </td>
<td style="text-align: left;"> MLE of upper tail GPD scale</td>
</tr>
<tr>
<td style="text-align: left;">
 <code>xir</code>:       </td>
<td style="text-align: left;"> MLE of upper tail GPD shape</td>
</tr>
<tr>
<td style="text-align: left;">
 <code>phiur</code>:     </td>
<td style="text-align: left;"> MLE of upper tail fraction (bulk model or parameterised approach)</td>
</tr>
<tr>
<td style="text-align: left;">
 <code>se.phiur</code>:  </td>
<td style="text-align: left;"> standard error of MLE of upper tail fraction</td>
</tr>
<tr>
<td style="text-align: left;">
 <code>bw</code>:        </td>
<td style="text-align: left;"> MLE of bw (kernel standard deviations)</td>
</tr>
<tr>
<td style="text-align: left;">
 <code>kernel</code>:    </td>
<td style="text-align: left;"> kernel name</td>
</tr>
<tr>
<td style="text-align: left;">
</td>
</tr>
</table>
<h3>Warning</h3>

<p>See important warnings about cross-validation likelihood estimation in 
<code>fkden</code>, type <code>help fkden</code>.
</p>


<h3>Acknowledgments</h3>

<p>See Acknowledgments in
<code>fnormgpd</code>, type <code>help fnormgpd</code>. Based on code
by Anna MacDonald produced for MATLAB.
</p>


<h3>Note</h3>

<p>The data and kernel centres are both vectors. Infinite and missing sample values
(and kernel centres) are dropped.
</p>
<p>When <code>pvector=NULL</code> then the initial values are:
</p>

<ul>
<li>
<p> normal reference rule for bandwidth, using the <code>bw.nrd0</code> function, which is
consistent with the <code>density</code> function. At least two kernel
centres must be provided as the variance needs to be estimated.
</p>
</li>
<li>
<p> lower threshold 10% quantile (not relevant for profile likelihood for threshold or fixed threshold approaches);
</p>
</li>
<li>
<p> upper threshold 90% quantile (not relevant for profile likelihood for threshold or fixed threshold approaches);
</p>
</li>
<li>
<p> MLE of GPD parameters beyond thresholds. 
</p>
</li>
</ul>
<h3>Author(s)</h3>

<p>Yang Hu and Carl Scarrott <a href="mailto:carl.scarrott@canterbury.ac.nz">carl.scarrott@canterbury.ac.nz</a>
</p>


<h3>References</h3>

<p><a href="http://www.math.canterbury.ac.nz/~c.scarrott/evmix">http://www.math.canterbury.ac.nz/~c.scarrott/evmix</a>
</p>
<p><a href="http://en.wikipedia.org/wiki/Kernel_density_estimation">http://en.wikipedia.org/wiki/Kernel_density_estimation</a>
</p>
<p><a href="http://en.wikipedia.org/wiki/Cross-validation_(statistics)">http://en.wikipedia.org/wiki/Cross-validation_(statistics)</a>
</p>
<p><a href="http://en.wikipedia.org/wiki/Generalized_Pareto_distribution">http://en.wikipedia.org/wiki/Generalized_Pareto_distribution</a>
</p>
<p>Scarrott, C.J. and MacDonald, A. (2012). A review of extreme value
threshold estimation and uncertainty quantification. REVSTAT - Statistical
Journal 10(1), 33-59. Available from <a href="http://www.ine.pt/revstat/pdf/rs120102.pdf">http://www.ine.pt/revstat/pdf/rs120102.pdf</a>
</p>
<p>Hu, Y. (2013). Extreme value mixture modelling: An R package and simulation study.
MSc (Hons) thesis, University of Canterbury, New Zealand.
<a href="http://ir.canterbury.ac.nz/simple-search?query=extreme&amp;submit=Go">http://ir.canterbury.ac.nz/simple-search?query=extreme&amp;submit=Go</a>
</p>
<p>Bowman, A.W. (1984). An alternative method of cross-validation for the smoothing of
density estimates. Biometrika 71(2), 353-360.
</p>
<p>Duin, R.P.W. (1976). On the choice of smoothing parameters for Parzen estimators of
probability density functions. IEEE Transactions on Computers C25(11), 1175-1179.
</p>
<p>MacDonald, A., Scarrott, C.J., Lee, D., Darlow, B., Reale, M. and Russell, G. (2011).
A flexible extreme value mixture model. Computational Statistics and Data Analysis
55(6), 2137-2157.
</p>
<p>Wand, M. and Jones, M.C. (1995). Kernel Smoothing. Chapman &amp;&amp; Hall.
</p>


<h3>See Also</h3>

<p><code>kernels</code>, <code>kfun</code>,
<code>density</code>, <code>bw.nrd0</code>
and <code>dkde</code> in <code>ks</code> package.
<code>fgpd</code> and <code>gpd</code>.
</p>
<p>Other kden: <code>bckden</code>, <code>fbckden</code>,
<code>fgkgcon</code>, <code>fkdengpdcon</code>,
<code>fkdengpd</code>, <code>fkden</code>,
<code>kdengpdcon</code>, <code>kdengpd</code>,
<code>kden</code>
</p>
<p>Other kdengpd: <code>bckdengpd</code>,
<code>fbckdengpd</code>, <code>fkdengpdcon</code>,
<code>fkdengpd</code>, <code>fkden</code>,
<code>gkg</code>, <code>kdengpdcon</code>,
<code>kdengpd</code>, <code>kden</code>
</p>
<p>Other gkg: <code>fgkgcon</code>, <code>fkdengpd</code>,
<code>gkgcon</code>, <code>gkg</code>,
<code>kdengpd</code>, <code>kden</code>
</p>
<p>Other gkgcon: <code>fgkgcon</code>,
<code>fkdengpdcon</code>, <code>gkgcon</code>,
<code>gkg</code>, <code>kdengpdcon</code>
</p>
<p>Other fgkg: <code>gkg</code>
</p>


<h3>Examples</h3>

<pre><code class="language-R">## Not run: 
set.seed(1)
par(mfrow = c(2, 1))

x = rnorm(1000)
xx = seq(-4, 4, 0.01)
y = dnorm(xx)

# Bulk model based tail fraction
fit = fgkg(x)
hist(x, breaks = 100, freq = FALSE, xlim = c(-4, 4))
lines(xx, y)
with(fit, lines(xx, dgkg(xx, x, lambda, ul, sigmaul, xil, phiul,
   ur, sigmaur, xir, phiur), col="red"))
abline(v = c(fit$ul, fit$ur), col = "red")
  
# Parameterised tail fraction
fit2 = fgkg(x, phiul = FALSE, phiur = FALSE)
with(fit2, lines(xx, dgkg(xx, x, lambda, ul, sigmaul, xil, phiul,
   ur, sigmaur, xir, phiur), col="blue"))
abline(v = c(fit2$ul, fit2$ur), col = "blue")
legend("topright", c("True Density","Bulk Tail Fraction","Parameterised Tail Fraction"),
  col=c("black", "red", "blue"), lty = 1)
  
# Profile likelihood for initial value of threshold and fixed threshold approach
fitu = fgkg(x, ulseq = seq(-2, -0.2, length = 10), 
 urseq = seq(0.2, 2, length = 10))
fitfix = fgkg(x, ulseq = seq(-2, -0.2, length = 10), 
 urseq = seq(0.2, 2, length = 10), fixedu = TRUE)

hist(x, breaks = 100, freq = FALSE, xlim = c(-4, 4))
lines(xx, y)
with(fit, lines(xx, dgkg(xx, x, lambda, ul, sigmaul, xil, phiul,
   ur, sigmaur, xir, phiur), col="red"))
abline(v = c(fit$ul, fit$ur), col = "red")
with(fitu, lines(xx, dgkg(xx, x, lambda, ul, sigmaul, xil, phiul,
   ur, sigmaur, xir, phiur), col="purple"))
abline(v = c(fitu$ul, fitu$ur), col = "purple")
with(fitfix, lines(xx, dgkg(xx, x, lambda, ul, sigmaul, xil, phiul,
   ur, sigmaur, xir, phiur), col="darkgreen"))
abline(v = c(fitfix$ul, fitfix$ur), col = "darkgreen")
legend("topright", c("True Density","Default initial value (90% quantile)",
 "Prof. lik. for initial value", "Prof. lik. for fixed threshold"),
 col=c("black", "red", "purple", "darkgreen"), lty = 1)

## End(Not run)
  
</code></pre>


</div>