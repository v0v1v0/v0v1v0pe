<div class="container">

<table style="width: 100%;"><tr>
<td>RATEOmnibusTest</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>RATE based omnibus test of heterogeneity</h2>

<h3>Description</h3>

<p>Provides the P-value for a formal test of heterogeneity based on the RATE
statistic by Yadlowsky et al.
</p>


<h3>Usage</h3>

<pre><code class="language-R">RATEOmnibusTest(
  forest,
  level = 0.95,
  target = c("AUTOC", "QINI"),
  q = seq(0.1, 1, 0.1),
  R = 500,
  num.threads = 1,
  seed = NULL,
  honesty = TRUE,
  stabilize.splits = TRUE,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>forest</code></td>
<td>
<p>An object of class <code>causal_forest</code>, as returned by
causal_forest(), with binary treatment.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>level</code></td>
<td>
<p>numeric, level of RATE confidence interval.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>target</code></td>
<td>
<p>character, see rank_average_treatment_effect.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>q</code></td>
<td>
<p>numeric, see rank_average_treatment_effect.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>R</code></td>
<td>
<p>integer, see rank_average_treatment_effect</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>num.threads</code></td>
<td>
<p>passed to causal_forest. Number of threads used in
training. Default value is 1.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>seed</code></td>
<td>
<p>numeric, either length 1, in which case the same seed is used for
both new forests, or length 2, to train each forest with a different seed.
Default is <code>NULL</code>, in which case two seeds are randomly sampled.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>honesty</code></td>
<td>
<p>Boolean, <code>TRUE</code> if forest was trained using honesty. Otherwise <code>FALSE</code>.
Argument controls if honesty is used to train the new forests on the random
half-samples, so misspecification will lead to invalid results. Default is
<code>TRUE</code>, the default in causal_forest.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>stabilize.splits</code></td>
<td>
<p>Boolean, <code>TRUE</code> if forest was trained taking treatment into
account when determining the imbalance of a split. Otherwise <code>FALSE</code>.
Argument controls if treatment is taken into account when determining the
imbalance of a split during training of the new forests on the random
half-samples, so misspecification will lead to invalid results. Default is
<code>TRUE</code>, the default in causal_forest.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>additional arguments for causal_forest. By default, the
arguments used by forest will be used to train new forests on the random
half-samples. Arguments provided through <code>...</code> will override these. Note that
sample.weights and clusters are passed to both causal_forest and
rank_average_treatment_effect.fit.</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>RATE evaluates the ability of a provided prioritization rule to
prioritize treatment to subjects with a large benefit. In order to test for
heterogeneity, we want estimated CATE's to define the prioritization rule.
However, to obtain valid inference the prioritization scores must be
constructed independently of the evaluating forest training data. To
accomplice this, we split the data and train separate forests on each part.
Then we estimate double robust scores on the observations used to train
each forest, and obtain prioritization scores by predicting CATE's with
each forest on the samples not used for training.
</p>


<h3>Value</h3>

<p>A list of class <code>rank_average_treatment_effect</code> with elements
</p>

<ul>
<li>
<p> estimate: the RATE estimate.
</p>
</li>
<li>
<p> std.err: bootstrapped standard error of RATE.
</p>
</li>
<li>
<p> target: the type of estimate.
</p>
</li>
<li>
<p> TOC: a data.frame with the Targeting Operator Characteristic curve
estimated on grid q, along with bootstrapped SEs.
</p>
</li>
<li>
<p> confint: a data.frame with the lower and upper bounds of the RATE
confidence interval.
</p>
</li>
<li>
<p> pval: the p-value for the test that RATE is non-positive.
</p>
</li>
</ul>
<h3>Author(s)</h3>

<p>KIJA
</p>


<h3>References</h3>

<p>Yadlowsky S, Fleming S, Shah N, Brunskill E, Wager S. Evaluating
Treatment Prioritization Rules via Rank-Weighted Average Treatment Effects.
2021. http://arxiv.org/abs/2111.07966.
</p>


<h3>Examples</h3>

<pre><code class="language-R">
n &lt;- 800
p &lt;- 3
X &lt;- matrix(rnorm(n * p), n, p)
W &lt;- rbinom(n, 1, 0.5)
event_prob &lt;- 1 / (1 + exp(2 * (pmax(2 * X[, 1], 0) * W - X[, 2])))
Y &lt;- rbinom(n, 1, event_prob)
clusters &lt;- sample(1:4, n, replace = TRUE)
cf &lt;- grf::causal_forest(X, Y, W, clusters = clusters)
rate &lt;- RATEOmnibusTest(cf, target = "QINI")
rate


</code></pre>


</div>