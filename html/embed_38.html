<div class="container">

<table style="width: 100%;"><tr>
<td>step_collapse_cart</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Supervised Collapsing of Factor Levels</h2>

<h3>Description</h3>

<p><code>step_collapse_cart()</code> creates a <em>specification</em> of a recipe step that can
collapse factor levels into a smaller set using a supervised tree.
</p>


<h3>Usage</h3>

<pre><code class="language-R">step_collapse_cart(
  recipe,
  ...,
  role = NA,
  trained = FALSE,
  outcome = NULL,
  cost_complexity = 1e-04,
  min_n = 5,
  results = NULL,
  skip = FALSE,
  id = rand_id("step_collapse_cart")
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>recipe</code></td>
<td>
<p>A recipe object. The step will be added to the sequence of
operations for this recipe.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>One or more selector functions to choose which variables are
affected by the step. See <code>selections()</code> for more details. For the <code>tidy</code>
method, these are not currently used.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>role</code></td>
<td>
<p>Not used by this step since no new variables are created.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>trained</code></td>
<td>
<p>A logical to indicate if the quantities for preprocessing have
been estimated.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>outcome</code></td>
<td>
<p>A call to <code>vars</code> to specify which variable is used as the
outcome to train CART models in order to pool factor levels.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>cost_complexity</code></td>
<td>
<p>A non-negative value that regulates the complexity of
the tree when pruning occurs. Values near 0.1 usually correspond to a tree
with a single splits. Values of zero correspond to unpruned tree.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>min_n</code></td>
<td>
<p>An integer for how many data points are required to make further
splits during the tree growing process. Larger values correspond to less
complex trees.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>results</code></td>
<td>
<p>A list of results to convert to new factor levels.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>skip</code></td>
<td>
<p>A logical. Should the step be skipped when the recipe is baked by
<code>bake()</code>? While all operations are baked when <code>prep()</code> is run, some
operations may not be able to be conducted on new data (e.g. processing the
outcome variable(s)). Care should be taken when using <code>skip = TRUE</code> as it
may affect the computations for subsequent operations</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>id</code></td>
<td>
<p>A character string that is unique to this step to identify it.</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>This step uses a CART tree (classification or regression) to group the
existing factor levels into a potentially smaller set. It changes the levels
in the factor predictor (and the <code>tidy()</code> method can be used to understand
the translation).
</p>
<p>There are a few different ways that the step will not be able to collapse
levels. If the model fails or, if the results have each level being in its
own split, the original factor levels are retained. There are also cases
where there is "no admissible split" which means that the model could not
find any signal in the data.
</p>


<h3>Value</h3>

<p>An updated recipe step.
</p>


<h3>Tidying</h3>

<p>When you <code>tidy()</code> this step, a tibble is retruned with
columns <code>terms</code>, <code>old</code>, <code>new</code>, and <code>id</code>:
</p>

<dl>
<dt>terms</dt>
<dd>
<p>character, the selectors or variables selected</p>
</dd>
<dt>old</dt>
<dd>
<p>character, the old levels</p>
</dd>
<dt>new</dt>
<dd>
<p>character, the new levels</p>
</dd>
<dt>id</dt>
<dd>
<p>character, id of this step</p>
</dd>
</dl>
<h3>Case weights</h3>

<p>The underlying operation does not allow for case weights.
</p>


<h3>Examples</h3>

<pre><code class="language-R">
data(ames, package = "modeldata")
ames$Sale_Price &lt;- log10(ames$Sale_Price)

rec &lt;-
  recipe(Sale_Price ~ ., data = ames) %&gt;%
  step_collapse_cart(
    Sale_Type, Garage_Type, Neighborhood,
    outcome = vars(Sale_Price)
  ) %&gt;%
  prep()
tidy(rec, number = 1)

</code></pre>


</div>