<div class="container">

<table style="width: 100%;"><tr>
<td>partitioning</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Use Partitioning Rule to Simulate Ecological Diversification of a Biota.</h2>

<h3>Description</h3>

<p>Implement Monte Carlo simulation of a biota undergoing ecological
diversification using the partitioning rule.
</p>


<h3>Usage</h3>

<pre><code class="language-R">partitioning(
  nreps = 1,
  Sseed,
  Smax,
  ecospace,
  method = "Euclidean",
  rule = "strict",
  strength = 1
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>nreps</code></td>
<td>
<p>Vector of integers (such as a sequence) specifying sample number
produced. Only used when function is applied within <code>lapply</code> or
related function. Default <code>nreps=1</code> or any other integer produces a
single sample.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>Sseed</code></td>
<td>
<p>Integer giving number of species (or other taxa) to use at start
of simulation.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>Smax</code></td>
<td>
<p>Maximum number of species (or other taxa) to include in
simulation.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>ecospace</code></td>
<td>
<p>An ecospace framework (functional trait space) of class
<code>ecospace</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>method</code></td>
<td>
<p>Distance measure to use when calculating functional distances
between species. Default is <code>Euclidean</code> using
<code>stats::dist</code>. <code>Gower</code> or any other value uses
Gower distance (using <code>FD::gowdis</code>). Presence of factor or
ordered factor character types forces use of Gower distance.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>rule</code></td>
<td>
<p>The partitioning implementation to use in the simulation. Default
<code>strict</code> implements the 'minimum distant neighbor' rule;
<code>relaxed</code> implements the "maximum nearest neighbor" rule. See
'Details' below for further explanation.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>strength</code></td>
<td>
<p>Strength parameter controlling probability that partitioning
rule is followed during simulation. Values must range between
<code>strength = 1</code> (default, rules always implemented) and <code>strength = 0</code>
(rules never implemented).</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>Simulations are implemented as Monte Carlo processes in which
species are added iteratively to assemblages, with all added species having
their character states specified by the model rules, here the
'partitioning' rule. Simulations begin with the seeding of <code>Sseed</code>
number of species, chosen at random (with replacement) from either the
species pool (if provided in the <code>weight.file</code> when building the
ecospace framework using <code>create_ecospace</code>) or following the
neutral-rule algorithm (if a pool is not provided). Once seeded, the
simulations proceed iteratively (character-by-character,
species-by-species) by following the appropriate algorithm, as explained
below, until terminated at <code>Smax</code>.
</p>
<p><strong>Partitioning rule algorithm:</strong> Measure distances between all pairs
of species, using <code>Euclidean</code> or <code>Gower</code> distance method
specified by <code>method</code> argument. Use either of the following rules to
identify the position of each additional species. </p>

<dl>
<dt>
<code>strict</code> (minimum distant neighbor) rule</dt>
<dd>
<p>Identify the maximum
distances between all pairs of species (the most-distant neighbors); the
space to be partitioned is the minimum of these distances. This
implementation progressively fills in the largest parts of the ecospace
that are least occupied between neighboring species, and eventually
partitions the ecospace in straight-line gradients between seed species.</p>
</dd>
<dt>
<code>relaxed</code> (maximum nearest neighbor) rule</dt>
<dd>
<p>Identify
nearest-neighbor distances between all pairs of species; the space to be
partitioned is the maximum of these distances. This implementation places
new species in the most unoccupied portion of the ecospace that is within
the cluster of pre-existing species, often the centroid.</p>
</dd>
</dl>
<p> In both rules,
each new species is created as a resampled combination of the character
states of the identified neighbors. If multiple pairs meet the specific
criteria, one of these pairs is chosen at random. Ordered, multistate
character partitioning (such as ordered factors or order numeric character
types) can include any state equal to or between the observed states of
existing species. The probability of following the partitioning rule is
determined by the <code>strength</code> parameter. Default <code>strength = 1</code>
always implements the rule, whereas <code>strength = 0</code> never implements it
(essentially making the simulation follow the <code>neutral</code> rule.)
</p>
<p>Each newly assigned character is compared with the ecospace framework
(<code>ecospace</code>) to confirm that it is an allowed state combination before
proceeding to the next character. If the newly built character is
disallowed from the ecospace framework (i.e., because it has "dual
absences" [0,0], has been excluded based on the species pool
[<code>weight.file</code> in <code>create_ecospace</code>], or is not allowed by the
ecospace <code>constraint</code> parameter), then the character-selection
algorithm is repeated until an allowable character is selected. When
simulations proceed to very large sample sizes (&gt;100), this confirmatory
process can require long computational times, and produce "new"
intermediate species that are functionally identical to pre-existing
species. This can occur, for example, when no life habits, or perhaps only
one, exist that forms an allowable intermediate between the selected
neighbors.
</p>
<p>Partitioning rules tend to produce ecospaces displaying linear gradients
between seed species (in the <code>strict</code> implementation) or concentration
of life habits near the functional centroid (in the <code>relaxed</code>
implementation). Additional details on the partitioning simulation are
provided in Novack-Gottshall (2016a,b), including sensitivity to
ecospace framework (functional trait space) structure, recommendations for
model selection, and basis in ecological and evolutionary theory.
</p>


<h3>Value</h3>

<p>Returns a data frame with <code>Smax</code> rows (representing species) and
as many columns as specified by number of characters/states (functional
traits) in the ecospace framework. Columns will have the same data type
(numeric, factor, ordered numeric, or ordered factor) as specified in the
ecospace framework.
</p>


<h3>Note</h3>

<p>A bug exists within <code>FD::gowdis</code> where nearest-neighbor
distances can not be calculated when certain characters (especially numeric
characters with values other than 0 and 1) share identical traits across
species. The nature of the bug is under investigation, but the current
implementation is reliable under most uses. If you run into problems
because of this bug, a work-around is to manually change the function to
call <code>cluster::daisy</code> using <code>metric = "gower"</code>
instead.
</p>
<p>The function has been written to allow usage (using <code>lapply</code> or
some other list-apply function) in 'embarrassingly parallel' implementations
in a high-performance computing environment.
</p>


<h3>Author(s)</h3>

<p>Phil Novack-Gottshall <a href="mailto:pnovack-gottshall@ben.edu">pnovack-gottshall@ben.edu</a>
</p>


<h3>References</h3>

<p>Bush, A. and P.M. Novack-Gottshall. 2012. Modelling the
ecological-functional diversification of marine Metazoa on geological time
scales. <em>Biology Letters</em> 8: 151-155.
</p>
<p>Novack-Gottshall, P.M. 2016a. General models of ecological
diversification. I. Conceptual synthesis. <em>Paleobiology</em> 42: 185-208.
</p>
<p>Novack-Gottshall, P.M. 2016b. General models of ecological
diversification. II. Simulations and empirical applications.
<em>Paleobiology</em> 42: 209-239.
</p>


<h3>See Also</h3>

<p><code>create_ecospace</code>, <code>neutral</code>,
<code>redundancy</code>, <code>expansion</code>
</p>


<h3>Examples</h3>

<pre><code class="language-R"># Create an ecospace framework with 15 3-state factor characters
# Can also accept following character types: "numeric", "ord.num", "ord.fac"
nchar &lt;- 15
ecospace &lt;- create_ecospace(nchar = nchar, char.state = rep(3, nchar),
  char.type = rep("factor", nchar))

# Single (default) sample produced by partitioning function (with strength = 1 and
#   "strict" partitioning rules):
Sseed &lt;- 5
Smax &lt;- 40
x &lt;- partitioning(Sseed = Sseed, Smax = Smax, ecospace = ecospace, rule = "strict")
head(x, 10)

# Plot results, showing order of assembly
# (Seed species in red, next 5 in black, remainder in gray)
# Notice the 'strict' partitioning model produces an ecospace with life-habit gradients
#   between seed species
seq &lt;- seq(nchar)
types &lt;- sapply(seq, function(seq) ecospace[[seq]]$type)
if(any(types == "ord.fac" | types == "factor")) pc &lt;- prcomp(FD::gowdis(x)) else
  pc &lt;- prcomp(x)
plot(pc$x, type = "n", main = paste("Partitioning model,\n", Smax, "species"))
text(pc$x[,1], pc$x[,2], labels = seq(Smax), col = c(rep("red", Sseed), rep("black", 5),
  rep("slategray", (Smax - Sseed - 5))), pch = c(rep(19, Sseed), rep(21, (Smax - Sseed))),
  cex = .8)

# Same, but following "relaxed" partitioning rules:
# Notice the 'relaxed' partitioning model only fills in the ecospace between seed species
x &lt;- partitioning(Sseed = Sseed, Smax = Smax, ecospace = ecospace, rule = "relaxed")
if(any(types == "ord.fac" | types == "factor")) pc &lt;- prcomp(FD::gowdis(x)) else
  pc &lt;- prcomp(x)
plot(pc$x, type = "n", main = paste("Partitioning model,\n", Smax, "species"))
text(pc$x[,1], pc$x[,2], labels = seq(Smax), col = c(rep("red", Sseed), rep("black", 5),
  rep("slategray", (Smax - Sseed - 5))), pch = c(rep(19, Sseed), rep(21, (Smax - Sseed))),
  cex = .8)

# Change strength parameter so rules followed 95% of time:
x &lt;- partitioning(Sseed = Sseed, Smax = Smax, ecospace = ecospace, strength = 0.95, rule = "strict")
if(any(types == "ord.fac" | types == "factor")) pc &lt;- prcomp(FD::gowdis(x)) else
  pc &lt;- prcomp(x)
plot(pc$x, type = "n", main = paste("Partitioning model,\n", Smax, "species"))
text(pc$x[,1], pc$x[,2], labels = seq(Smax), col = c(rep("red", Sseed), rep("black", 5),
  rep("slategray", (Smax - Sseed - 5))), pch = c(rep(19, Sseed), rep(21, (Smax - Sseed))),
  cex = .8)

# Create 5 samples using multiple nreps and lapply (can be slow)
nreps &lt;- 1:5
samples &lt;- lapply(X = nreps, FUN = partitioning, Sseed = 5, Smax = 40, ecospace)
str(samples)

</code></pre>


</div>