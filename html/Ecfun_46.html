<div class="container">

<table style="width: 100%;"><tr>
<td>mergeVote</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>
Merge Roll Call Vote
</h2>

<h3>Description</h3>

<p>Merge roll call vote record with a 
<code>data.frame</code> containing other 
information.  The <code>vote</code> records are 
typically incomplete, so match first on 
<code>houseSenate</code> and <code>surname</code>.  
If this match is incomplete, try using 
<code>givenName</code>.  If that fails, try
<code>state</code> and <code>district</code>, which may 
not always be present in <code>vote</code>.
</p>


<h3>Usage</h3>

<pre><code class="language-R">mergeVote(x, vote, Office="House", vote.x, 
          check.x=TRUE)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>x</code></td>
<td>

<p>a <code>data.frame</code> whose columns 
include <code>Office</code>, <code>surname</code>, and
<code>givenName</code>.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>vote</code></td>
<td>

<p>a <code>data.frame</code> with column names
which when forced <code>tolower</code> would
match <code>surname</code>, <code>givenname</code>,
and <code>vote</code>.  However, the 
<code>givenname</code> may not be complete, so use 
it only if the <code>surname</code> is not 
sufficient.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>Office</code></td>
<td>

<p>Either "House" or "Senate";  ignored if
<code>vote</code> includes a column <code>Office</code>.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>vote.x</code></td>
<td>

<p>name of a column of <code>x</code> containing a vote
to be updated with the <code>vote</code> column of 
the <code>vote</code> <code>data.frame</code>.
If <code>missing</code> and <code>x</code> has a
column with a name matching "vote", then
<code>vote.x</code> is that column.  If 
<code>missing</code> but <code>x</code> has no such
column, then append a column to <code>x</code> with
the name of the <code>vote</code> column of the
<code>vote</code> <code>data.frame</code>.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>check.x</code></td>
<td>

<p>logical:  If TRUE, check for rows of 
<code>x[, vote.x]</code> that are NOT in 
<code>vote</code> and throw an error if found.
</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>1.  Parse <code>vote.x</code> to get the name of 
the column of <code>x</code> into which to write 
the <code>vote</code> column of the <code>vote</code>
<code>data.frame</code>.
</p>
<p>2.  If the <code>vote</code> <code>data.frame</code> 
contains a column <code>Office</code>, ignore the
<code>Office</code> argument.  Otherwise, add the
argument <code>houseSenate</code> as a column of
<code>vote</code>.
</p>
<p>3. Create <code>keyx &lt;- with(x, paste(Office, 
  surname, sep=":"))</code>, 
<code>keyx2 &lt;- paste(keyx, givenName, sep=":")</code>,
<code>keyx. &lt;-
  paste(houseSenate, state, district, sep=":")</code>, 
and similarly <code>keyv</code>, <code>leyv2</code>, and
<code>keyv.</code> from <code>vote</code>.
</p>
<p>4.  Look for <code>keyv</code> in <code>keyx</code>.  When a
unique match is found, transfer the vote the
<code>vote</code> column of <code>x</code>.  When no
match is found, try for <code>keyv2</code> in 
<code>keyx2</code> or <code>keyv.</code> in <code>keyx.</code>  
If those fail, print an error message with the
information from <code>vote</code> on all failures 
and ask the user to add <code>state</code> and 
<code>district</code> information.
</p>
<p>5. <code>if(check.x)</code>, check for rows in 
<code>x[, vote.x]</code> that are NOT 
<code>notEligible</code> but are also not in 
<code>vote</code>:  Throw an error if any are found.
</p>


<h3>Value</h3>

<p>a <code>data.frame</code> with the same 
columns as <code>x</code> with its vote column 
modified per the <code>vote</code> argument.
</p>


<h3>Author(s)</h3>

<p>Spencer Graves
</p>


<h3>See Also</h3>

<p><code>mergeUShouse.senate</code>
</p>


<h3>Examples</h3>

<pre><code class="language-R">##
## 1.  Test good cases
##
votetst &lt;- data.frame(
  surName=c('Smith', 'Jones', 'Graves', 'Jsn', 'Jsn', 'Gay'),
  givenName=c("Sam", "", "", "John", "John", ''),
  votex=factor(c('Y', 'N', 'abstain', 'Y', 'Y', 'Y')),
  State=factor(rep(c("CA", "", "SC", "NY"), c(1, 2, 1, 2))),
  district=rep(c("13", "1", "2", "1"), c(1, 2, 2, 1)),
  stringsAsFactors=FALSE )

x1 &lt;- data.frame(
  Office=factor(rep(c("House", "Senate"), e=8)),
  state=rep(c("NY", "SC", "SD", "CA", "AK", "AR", "NY", "NJ"), 2),
  District=rep(c("2", "2", "At Large", "13", "1", "9", "1", "3"), 2),
  surname=rep(c('Jsn', 'Jsn', 'Smith', 'Smith', 'Jones',
       'Graves', 'Rx', 'Agnew'), 2),
  givenName=rep(c("John D.", "John J.",
    "Samual", "Samual", "Mary", "Mary", "Susan", 'Spiro'), 2),
  don=1:16, stringsAsFactors=FALSE)

x1. &lt;- mergeVote(x1, votetst)

x2 &lt;- cbind(x1, votex=factor( rep(
   c('Y', 'notEligible', 'Y', 'N', 'abstain', 'Y', 'notEligible'),
   c(2,1,1,1,1,1,9) ) ) )


all.equal(x1., x2)


##
## 2.  Test a case with a vote error in x
##

x1a &lt;- cbind(x1, voterr=rep(
     c('notEligible', 'Y', 'notEligible'), c(7, 1, 8)))

x1a. &lt;- try(mergeVote(x1a, votetst))


class(x1a.)=='try-error'


</code></pre>


</div>