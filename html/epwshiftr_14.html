<div class="container">

<table style="width: 100%;"><tr>
<td>morphing_epw</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Morphing EPW weather variables</h2>

<h3>Description</h3>

<p><code>morphing_epw()</code> takes an <code>epw_cmip6_data</code> object generated using
<code>extract_data()</code> and calculates future core EPW weather variables using
Morphing Method.
</p>


<h3>Usage</h3>

<pre><code class="language-R">morphing_epw(
  data,
  years = NULL,
  labels = NULL,
  methods = NULL,
  warning = FALSE
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>data</code></td>
<td>
<p>An <code>epw_cmip6_data</code>object generated using <code>extract_data()</code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>years</code></td>
<td>
<p>An integer vector indicating the target years to be considered.
If <code>NULL</code>, all years in input data will be considered. Default: <code>NULL</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>labels</code></td>
<td>
<p>A character or factor vector used for grouping input <code>years</code>.
Usually are the outputs of <code>base::cut()</code>. <code>labels</code> should have the
same length as <code>years</code>. If given, climate data of <code>years</code> grouped by
<code>labels</code> will be averaged. Default: <code>NULL</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>methods</code></td>
<td>
<p>A named character giving the methods of morphing procedures of
each variables. Possible variable names are <code>tdb</code>, <code>rh</code>, <code>p</code>,
<code>hor_ir</code>, <code>glob_rad</code>, <code>wind</code>. Possible values are: <code>"stretch"</code>,
<code>"shift"</code> and <code>"combined"</code>. For example: <code>c(tdb = "stretch", rh = "shift")</code>. <code>"combined"</code> is only applicable to <code>tdb</code>. The default
morphing method for each variable is listed in the <em>Return</em> section.
If <code>NULL</code>, the default methods will be used. Default: <code>NULL</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>warning</code></td>
<td>
<p>If <code>TRUE</code>, warnings will be issued for cases with input data
less than a decade (10 years). This is because using data that only
covers a short period of time may not be able to capture the average
of future climate. Default: <code>FALSE</code>.</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>The EPW weather variables that get morphed are listed in details.
</p>


<h3>Value</h3>

<p>An <code>epw_cmip6_morphed</code> object, which is basically a list of 12 elements:</p>

<table>
<tr>
<td style="text-align: right;">
   No. </td>
<td style="text-align: left;"> Element </td>
<td style="text-align: left;"> Type </td>
<td style="text-align: left;"> Morphing Method </td>
<td style="text-align: left;"> Description </td>
</tr>
<tr>
<td style="text-align: right;">
   1 </td>
<td style="text-align: left;"> <code>epw</code> </td>
<td style="text-align: left;"> eplusr::Epw </td>
<td style="text-align: left;"> N/A </td>
<td style="text-align: left;"> The original EPW file used for morphing </td>
</tr>
<tr>
<td style="text-align: right;">
   2 </td>
<td style="text-align: left;"> <code>tdb</code> </td>
<td style="text-align: left;"> <code>data.table::data.table()</code> </td>
<td style="text-align: left;"> Stretch </td>
<td style="text-align: left;"> Data of dry-bulb temperature after morphing </td>
</tr>
<tr>
<td style="text-align: right;">
   3 </td>
<td style="text-align: left;"> <code>tdew</code> </td>
<td style="text-align: left;"> <code>data.table::data.table()</code> </td>
<td style="text-align: left;"> Derived </td>
<td style="text-align: left;"> Data of dew-point temperature after morphing </td>
</tr>
<tr>
<td style="text-align: right;">
   4 </td>
<td style="text-align: left;"> <code>rh</code> </td>
<td style="text-align: left;"> <code>data.table::data.table()</code> </td>
<td style="text-align: left;"> Stretch </td>
<td style="text-align: left;"> Data of relative humidity after morphing </td>
</tr>
<tr>
<td style="text-align: right;">
   5 </td>
<td style="text-align: left;"> <code>p</code> </td>
<td style="text-align: left;"> <code>data.table::data.table()</code> </td>
<td style="text-align: left;"> Stretch </td>
<td style="text-align: left;"> Data of atmospheric pressure after morphing </td>
</tr>
<tr>
<td style="text-align: right;">
   6 </td>
<td style="text-align: left;"> <code>hor_ir</code> </td>
<td style="text-align: left;"> <code>data.table::data.table()</code> </td>
<td style="text-align: left;"> Stretch </td>
<td style="text-align: left;"> Data of horizontal infrared radiation from the sky after morphing </td>
</tr>
<tr>
<td style="text-align: right;">
   7 </td>
<td style="text-align: left;"> <code>glob_rad</code> </td>
<td style="text-align: left;"> <code>data.table::data.table()</code> </td>
<td style="text-align: left;"> Stretch </td>
<td style="text-align: left;"> Data of global horizontal radiation after morphing </td>
</tr>
<tr>
<td style="text-align: right;">
   8 </td>
<td style="text-align: left;"> <code>norm_rad</code> </td>
<td style="text-align: left;"> <code>data.table::data.table()</code> </td>
<td style="text-align: left;"> Derived </td>
<td style="text-align: left;"> Data of direct normal radiation after morphing </td>
</tr>
<tr>
<td style="text-align: right;">
   9 </td>
<td style="text-align: left;"> <code>diff_rad</code> </td>
<td style="text-align: left;"> <code>data.table::data.table()</code> </td>
<td style="text-align: left;"> Stretch </td>
<td style="text-align: left;"> Data of diffuse horizontal radiation after morphing </td>
</tr>
<tr>
<td style="text-align: right;">
   10 </td>
<td style="text-align: left;"> <code>wind</code> </td>
<td style="text-align: left;"> <code>data.table::data.table()</code> </td>
<td style="text-align: left;"> Stretch </td>
<td style="text-align: left;"> Data of wind speed after morphing </td>
</tr>
<tr>
<td style="text-align: right;">
   11 </td>
<td style="text-align: left;"> <code>total_cover</code> </td>
<td style="text-align: left;"> <code>data.table::data.table()</code> </td>
<td style="text-align: left;"> Derived </td>
<td style="text-align: left;"> Data of total sky cover after morphing </td>
</tr>
<tr>
<td style="text-align: right;">
   12 </td>
<td style="text-align: left;"> <code>opaque_cover</code> </td>
<td style="text-align: left;"> <code>data.table::data.table()</code> </td>
<td style="text-align: left;"> Derived </td>
<td style="text-align: left;"> Data of opaque sky cover after morphing </td>
</tr>
<tr>
<td style="text-align: right;">
</td>
</tr>
</table>
<p>Each <code>data.table::data.table()</code> listed above contains 19 columns below or an
empty <code>data.table::data.table()</code> if the corresponding variables cannot be
found in the input <code>epw_cmip6_data</code> object.</p>

<table>
<tr>
<td style="text-align: right;">
   No. </td>
<td style="text-align: left;"> Column </td>
<td style="text-align: left;"> Type </td>
<td style="text-align: left;"> Description </td>
</tr>
<tr>
<td style="text-align: right;">
   1 </td>
<td style="text-align: left;"> <code>activity_drs</code> </td>
<td style="text-align: left;"> Character </td>
<td style="text-align: left;"> Activity DRS (Data Reference Syntax) </td>
</tr>
<tr>
<td style="text-align: right;">
   2 </td>
<td style="text-align: left;"> <code>institution_id</code> </td>
<td style="text-align: left;"> Character </td>
<td style="text-align: left;"> Institution identifier </td>
</tr>
<tr>
<td style="text-align: right;">
   3 </td>
<td style="text-align: left;"> <code>source_id</code> </td>
<td style="text-align: left;"> Character </td>
<td style="text-align: left;"> Model identifier </td>
</tr>
<tr>
<td style="text-align: right;">
   4 </td>
<td style="text-align: left;"> <code>experiment_id</code> </td>
<td style="text-align: left;"> Character </td>
<td style="text-align: left;"> Root experiment identifier </td>
</tr>
<tr>
<td style="text-align: right;">
   5 </td>
<td style="text-align: left;"> <code>member_id</code> </td>
<td style="text-align: left;"> Character </td>
<td style="text-align: left;"> A compound construction from <code>sub_experiment_id</code> and <code>variant_label</code> </td>
</tr>
<tr>
<td style="text-align: right;">
   6 </td>
<td style="text-align: left;"> <code>table_id</code> </td>
<td style="text-align: left;"> Character </td>
<td style="text-align: left;"> Table identifier </td>
</tr>
<tr>
<td style="text-align: right;">
   7 </td>
<td style="text-align: left;"> <code>lon</code> </td>
<td style="text-align: left;"> Double </td>
<td style="text-align: left;"> The <strong>averaged</strong> values of input longitude </td>
</tr>
<tr>
<td style="text-align: right;">
   8 </td>
<td style="text-align: left;"> <code>lat</code> </td>
<td style="text-align: left;"> Double </td>
<td style="text-align: left;"> The <strong>averaged</strong> values of input latitude </td>
</tr>
<tr>
<td style="text-align: right;">
   9 </td>
<td style="text-align: left;"> <code>dist</code> </td>
<td style="text-align: left;"> Double </td>
<td style="text-align: left;"> The <strong>averaged</strong> spherical distances in km between EPW location and grid coordinates </td>
</tr>
<tr>
<td style="text-align: right;">
   10 </td>
<td style="text-align: left;"> <code>interval</code> </td>
<td style="text-align: left;"> Factor </td>
<td style="text-align: left;"> The label value used to average raw input data </td>
</tr>
<tr>
<td style="text-align: right;">
   11 </td>
<td style="text-align: left;"> <code>datetime</code> </td>
<td style="text-align: left;"> POSIXct </td>
<td style="text-align: left;"> The datetime value with <strong>fake year</strong> generated by calling the <code>Epw$data()</code> method with the input EPW </td>
</tr>
<tr>
<td style="text-align: right;">
   12 </td>
<td style="text-align: left;"> <code>year</code> </td>
<td style="text-align: left;"> Integer </td>
<td style="text-align: left;"> The <strong>original</strong> year of the raw EPW data </td>
</tr>
<tr>
<td style="text-align: right;">
   13 </td>
<td style="text-align: left;"> <code>month</code> </td>
<td style="text-align: left;"> Integer </td>
<td style="text-align: left;"> The month value of the morphed data </td>
</tr>
<tr>
<td style="text-align: right;">
   14 </td>
<td style="text-align: left;"> <code>day</code> </td>
<td style="text-align: left;"> Integer </td>
<td style="text-align: left;"> The day of the morphed data </td>
</tr>
<tr>
<td style="text-align: right;">
   15 </td>
<td style="text-align: left;"> <code>hour</code> </td>
<td style="text-align: left;"> Integer </td>
<td style="text-align: left;"> The hour of the morphed data </td>
</tr>
<tr>
<td style="text-align: right;">
   16 </td>
<td style="text-align: left;"> <code>minute</code> </td>
<td style="text-align: left;"> Integer </td>
<td style="text-align: left;"> The minute of the morphed data </td>
</tr>
<tr>
<td style="text-align: right;">
   17 </td>
<td style="text-align: left;"> <strong>Variable Name</strong> </td>
<td style="text-align: left;"> Double </td>
<td style="text-align: left;"> The morphed data, where <code style="white-space: pre;">⁠Variable Name⁠</code> is the corresponding EPW weather variable name </td>
</tr>
<tr>
<td style="text-align: right;">
   18 </td>
<td style="text-align: left;"> <code>delta</code> </td>
<td style="text-align: left;"> Double </td>
<td style="text-align: left;"> The shift factor. Will be <code>NA</code> for derived values </td>
</tr>
<tr>
<td style="text-align: right;">
   19 </td>
<td style="text-align: left;"> <code>alpha</code> </td>
<td style="text-align: left;"> Double </td>
<td style="text-align: left;"> The stretch factor. Will be <code>NA</code> for derived values </td>
</tr>
<tr>
<td style="text-align: right;">
</td>
</tr>
</table>
<h3>The Morphing procedure</h3>

<p>Here <em>Morphing</em> is an algorithm proposed by Belcher etc. 2005
used to morph the present-day observed weather files (here the EPWs)  to
produce future climate weather files. The EPW data is used as the
<em>'baseline climate'</em>.
</p>
<p>The first step before morphing is to calculate the monthly means of
climatological variables in the EPW file, denoted by <code class="reqn">&lt;x_0&gt;_m</code>.
The subscript '0' is to denote the present day weather record, and 'm' is to
denote the month.
</p>
<p>The morphing involves three generic operations, i.e. 1) a shift; 2) a linear
stretch (scaling factor); and 3) a shift and a stretch:
</p>
<p style="text-align: center;"><code class="reqn">
\textrm{Shift: } x = x_0 + \Delta x_m
</code>
</p>

<p style="text-align: center;"><code class="reqn">
\textrm{Stretch: }x = \alpha_m x_m
</code>
</p>

<p style="text-align: center;"><code class="reqn">
\textrm{Shift + Stretch: } x = x_0 + \Delta x_m + \alpha_m (x_0 - &lt;x_0&gt;_m)
</code>
</p>



<h4>Shift</h4>

<p>If using a shift, for each month, a shift <code class="reqn">\Delta x_m</code> is applied to
<code class="reqn">x_0</code>. <code class="reqn">\Delta x_m</code> is the absolute change in the monthly mean value
of the variable for the month <code class="reqn">m</code>,
i.e. <code class="reqn">\Delta x_m = &lt;x_0&gt;_m - &lt;x&gt;_m</code>. Here the monthly variance of the
variable is unchanged.
</p>



<h4>Stretch</h4>

<p>If using a stretch, for each month, a stretch <code class="reqn">\alpha _m</code> is applied to
<code class="reqn">x_0</code>, where <code class="reqn">\alpha _m</code> is the fractional change in the monthly-mean
value of a variable, i.e. <code class="reqn">\alpha _m = &lt;x&gt;_m / &lt;x_0&gt;_m</code>. In this case,
the variance will be multiplied by to <code class="reqn">\alpha^2_m</code>
</p>



<h4>Combined Shift and Stretch</h4>

<p>When using a combined shift and stretch factor, both the mean and the
variance will be switched off altogether.
</p>
<p>For more details about morphing, please see (Belcher etc. 2005)
</p>



<h3>References</h3>

<p>Belcher, S., Hacker, J., Powell, D., 2005. Constructing design weather data
for future climates. Building Services Engineering Research and Technology
26, 49–61. https://doi.org/10.1191/0143624405bt112oa
</p>


</div>