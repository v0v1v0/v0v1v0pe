<div class="container">

<table style="width: 100%;"><tr>
<td>ThreeStage</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Three-Stage Extreme Conditional Quantile Estimator</h2>

<h3>Description</h3>

<p>Provides the estimation of extreme conditional quantile using the three-stage estimation method in Wang and Li (2013). Specifically the function estimates
the tau.e-th conditional quantile of Y given x=xstar based on the power-transformed quantile regression model and extreme value theory. The method is based
on Hill estimator for the extreme value index and works for heavy-tailed distributions (on the original scale).
</p>


<h3>Usage</h3>

<pre><code class="language-R">ThreeStage(y, x, xstar, tau.e, grid.lam = seq(-2, 2, 0.1), grid.k, tau.lam,
  a = 0, tol = 1e-04)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>y</code></td>
<td>
<p>a vector of n responses</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>x</code></td>
<td>
<p>a n x p matrix of n observations and p predictors</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>xstar</code></td>
<td>
<p>a m x p matrix of m observations and p predictors</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>tau.e</code></td>
<td>
<p>the extreme quantile level of interest</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>grid.lam</code></td>
<td>
<p>the set of lambda (transformation parameter) values for grid search</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>grid.k</code></td>
<td>
<p>the grid for the number of upper order statistics involved in Hill estimator;
used for searching for the data-adaptive k. If the lenfth of grid.k is 1, then k is fixed at grid.k and no selection is performed.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>tau.lam</code></td>
<td>
<p>the quantile level used for estimating the transformation parameter</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>a</code></td>
<td>
<p>location shift parameter in the power transformation (introduced to avoid negative y values)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>tol</code></td>
<td>
<p>the tolerance level for checking quantile crossing issue</p>
</td>
</tr>
</table>
<h3>Value</h3>

<p>A list is returned with the following components
</p>
<p>lam: the estimated power-transformation parameter
</p>
<p>k: the selected k, the number of upper order statistics involved in Hill estimator
</p>
<p>gamma.x: the estimated x-dependent extreme value index (EVI)
</p>
<p>cgmma: the pooled EVI estimation
</p>
<p>Q3Stage: the three-stage estimator of the tau.e-th conditional quantile of Y given xstar based on the x-dependent EVI estimation
</p>
<p>Q3StageP: the three-stage estimator of the tau.e-th conditional quantile of Y given xstar based on the pooled EVI estimation
</p>


<h3>References</h3>

<p>Wang, H. and Li, D. (2013). Estimation of conditional high quantiles through power transformation. Journal of the American Statistical Association, 108, 1062-1074.
</p>


<h3>See Also</h3>

<p><code>TwoStage</code>
</p>


<h3>Examples</h3>

<pre><code class="language-R">#A simulation example (sqrt transformation, heteroscedastic error)
library(EXRQ)
n=500
tau.e = c(0.99, 0.993, 0.995)
set.seed(12368819)
x1 = runif(n, -1, 1)
x2 = runif(n, -1, 1)
sqrty = 2 + x1 + x2 + (1+0.8*x1)*rpareto(n, 0.5)
x = as.matrix(cbind(x1, x2))
y = sqrty^2
xstar = rbind(c(-0.5,0),c(0,-0.5),c(0,0),c(0.5,0),c(0,0.5))
## 3Stage estimator
out.3stage &lt;- ThreeStage(y, x, xstar, tau.e, grid.lam=seq(-0.5, 1.5, 0.1), grid.k=50, tau.lam=0.9)
</code></pre>


</div>