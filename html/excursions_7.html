<div class="container">

<table style="width: 100%;"><tr>
<td>excursions</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Excursion Sets and Contour Credibility Regions for Random Fields</h2>

<h3>Description</h3>

<p><code>excursions</code> is one of the main functions in the package with the same name.
For an introduction to the package, see <code>excursions-package</code>. 
The function is used for calculating excursion sets, contour credible regions,
and contour avoiding sets for latent Gaussian models. Details on the function and the
package are given in the sections below.
</p>


<h3>Usage</h3>

<pre><code class="language-R">excursions(
  alpha,
  u,
  mu,
  Q,
  type,
  n.iter = 10000,
  Q.chol,
  F.limit,
  vars,
  rho,
  reo,
  method = "EB",
  ind,
  max.size,
  verbose = 0,
  max.threads = 0,
  seed
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>alpha</code></td>
<td>
<p>Error probability for the excursion set.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>u</code></td>
<td>
<p>Excursion or contour level.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>mu</code></td>
<td>
<p>Expectation vector.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>Q</code></td>
<td>
<p>Precision matrix.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>type</code></td>
<td>
<p>Type of region:
</p>

<dl>
<dt>'&gt;'</dt>
<dd>
<p>positive excursion region</p>
</dd>
<dt>'&lt;'</dt>
<dd>
<p>negative excursion region</p>
</dd>
<dt>'!='</dt>
<dd>
<p>contour avoiding region</p>
</dd>
<dt>'='</dt>
<dd>
<p>contour credibility region</p>
</dd>
</dl>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>n.iter</code></td>
<td>
<p>Number or iterations in the MC sampler that is used for approximating probabilities. The default value is 10000.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>Q.chol</code></td>
<td>
<p>The Cholesky factor of the precision matrix (optional).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>F.limit</code></td>
<td>
<p>The limit value for the computation of the F function. F is set to NA for all nodes where F&lt;1-F.limit. Default is F.limit = <code>alpha</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>vars</code></td>
<td>
<p>Precomputed marginal variances (optional).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>rho</code></td>
<td>
<p>Marginal excursion probabilities (optional). For contour regions, provide <code class="reqn">P(X&gt;u)</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>reo</code></td>
<td>
<p>Reordering (optional).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>method</code></td>
<td>
<p>Method for handeling the latent Gaussian structure:
</p>

<dl>
<dt>'EB'</dt>
<dd>
<p>Empirical Bayes (default)</p>
</dd>
<dt>'QC'</dt>
<dd>
<p>Quantile correction, rho must be provided if QC is used.</p>
</dd>
</dl>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>ind</code></td>
<td>
<p>Indices of the nodes that should be analysed (optional).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>max.size</code></td>
<td>
<p>Maximum number of nodes to include in the set of interest (optional).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>verbose</code></td>
<td>
<p>Set to TRUE for verbose mode (optional).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>max.threads</code></td>
<td>
<p>Decides the number of threads the program can use. Set to 0 for using the maximum number of threads allowed by the system (default).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>seed</code></td>
<td>
<p>Random seed (optional).</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>The estimation of the region is done using sequential importance sampling with
<code>n.iter</code> samples. The procedure requires computing the marginal variances of
the field, which should be supplied if available. If not, they are computed using
the Cholesky factor of the precision matrix. The cost of this step can therefore be
reduced by supplying the Cholesky factor if it is available.
</p>
<p>The latent structure in the latent Gaussian model can be handled in several different
ways. The default strategy is the EB method, which is
exact for problems with Gaussian posterior distributions. For problems with
non-Gaussian posteriors, the QC method can be used for improved results. In order to use
the QC method, the true marginal excursion probabilities must be supplied using the
argument <code>rho</code>.
Other more
complicated methods for handling non-Gaussian posteriors must be implemented manually
unless <code>INLA</code> is used to fit the model. If the model is fitted using <code>INLA</code>,
the method <code>excursions.inla</code> can be used. See the Package section for further details
about the different options.
</p>


<h3>Value</h3>

<p><code>excursions</code> returns an object of class "excurobj" with the following elements
</p>
<table>
<tr style="vertical-align: top;">
<td><code>E</code></td>
<td>
<p>Excursion set, contour credible region, or contour avoiding set</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>G</code></td>
<td>
<p>Contour map set. <code class="reqn">G=1</code> for all nodes where the <code class="reqn">mu &gt; u</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>M</code></td>
<td>
<p>Contour avoiding set. <code class="reqn">M=-1</code> for all non-significant nodes. <code class="reqn">M=0</code> for nodes where the process is significantly below <code>u</code> and <code class="reqn">M=1</code> for all nodes where the field is significantly above <code>u</code>. Which values that should be present depends on what type of set that is calculated.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>F</code></td>
<td>
<p>The excursion function corresponding to the set <code>E</code> calculated or values up to <code>F.limit</code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>rho</code></td>
<td>
<p>Marginal excursion probabilities</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>mean</code></td>
<td>
<p>The mean <code>mu</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>vars</code></td>
<td>
<p>Marginal variances.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>meta</code></td>
<td>
<p>A list containing various information about the calculation.</p>
</td>
</tr>
</table>
<h3>Author(s)</h3>

<p>David Bolin <a href="mailto:davidbolin@gmail.com">davidbolin@gmail.com</a> and Finn Lindgren <a href="mailto:finn.lindgren@gmail.com">finn.lindgren@gmail.com</a>
</p>


<h3>References</h3>

<p>Bolin, D. and Lindgren, F. (2015) <em>Excursion and contour uncertainty regions for latent Gaussian models</em>, JRSS-series B, vol 77, no 1, pp 85-106.
</p>
<p>Bolin, D. and Lindgren, F. (2018), <em>Calculating Probabilistic Excursion Sets and Related Quantities Using excursions</em>, Journal of Statistical Software, vol 86, no 1, pp 1-20.
</p>


<h3>See Also</h3>

<p><code>excursions-package</code>, <code>excursions.inla</code>, <code>excursions.mc</code>
</p>


<h3>Examples</h3>

<pre><code class="language-R">## Create a tridiagonal precision matrix
n &lt;- 21
Q.x &lt;- sparseMatrix(
  i = c(1:n, 2:n), j = c(1:n, 1:(n - 1)), x = c(rep(1, n), rep(-0.1, n - 1)),
  dims = c(n, n), symmetric = TRUE
)
## Set the mean value function
mu.x &lt;- seq(-5, 5, length = n)

## calculate the level 0 positive excursion function
res.x &lt;- excursions(
  alpha = 1, u = 0, mu = mu.x, Q = Q.x,
  type = "&gt;", verbose = 1, max.threads = 2
)

## Plot the excursion function and the marginal excursion probabilities
plot(res.x$F,
  type = "l",
  main = "Excursion function (black) and marginal probabilites (red)"
)
lines(res.x$rho, col = 2)
</code></pre>


</div>