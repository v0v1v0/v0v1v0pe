<div class="container">

<table style="width: 100%;"><tr>
<td>expirest_osle</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Ordinary shelf life estimation (osle)</h2>

<h3>Description</h3>

<p>Based on a linear regression model fitted to a stability data set the
function <code>expirest_osle()</code> estimates the shelf life, or retest period,
following the ICH Q1E guideline. The abbreviation “osle” stands for
“ordinary shelf life estimation”.
</p>


<h3>Usage</h3>

<pre><code class="language-R">expirest_osle(
  data,
  response_vbl,
  time_vbl,
  batch_vbl,
  sl,
  sl_sf,
  srch_range,
  alpha = 0.05,
  alpha_pool = 0.25,
  xform = c("no", "no"),
  shift = c(0, 0),
  sf_option = "tight",
  ivl = "confidence",
  ivl_type = "one.sided",
  ivl_side = "lower",
  ...
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>data</code></td>
<td>
<p>A data frame with the columns specified by <code>response_vbl</code>,
<code>time_vbl</code> and <code>batch_vbl</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>response_vbl</code></td>
<td>
<p>A character string that specifies the response variable
name that must be a column of <code>data</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>time_vbl</code></td>
<td>
<p>A character string that specifies the time variable name
that must be a column of <code>data</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>batch_vbl</code></td>
<td>
<p>A character string that specifies the column in <code>data</code>
with the grouping information (i.e. a factorial variable) for the
differentiation of the observations of the various batches.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>sl</code></td>
<td>
<p>A numeric value or a numeric vector of length <code>2</code> that
specifies the specification limit or limits. If a vector is provided it
must be of the form <code>c(lower limit, upper limit)</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>sl_sf</code></td>
<td>
<p>A positive integer or a vector of positive integers that
specifies the number of “significant figures” (sf) of <code>sl</code>.
It must have the same length as <code>sl</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>srch_range</code></td>
<td>
<p>A vector of length <code>2</code> that specifies the end-points
of the (time) range that is supposed to contain the shelf life or retest
period.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>alpha</code></td>
<td>
<p>A numeric value between 0 and 1 that specifies the significance
level for the calculation of confidence or prediction intervals. The
default is <code>0.05</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>alpha_pool</code></td>
<td>
<p>A numeric value between 0 and 1 that specifies the type I
error rate for the test of the poolability of the batches. The default
is <code>0.25</code>, following ICH Q1E guideline. The value should not be
changed unless supported by well-founded reasons.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>xform</code></td>
<td>
<p>A vector of two character strings that specifies the
transformation of the response and the time variable. The default is
“no” transformation, i.e. <code>c("no", "no")</code>, where the first
element specifies the transformation of the <code class="reqn">x</code> variable and the
second element the transformation of the <code class="reqn">y</code> variable. Valid
alternatives for <code class="reqn">x</code> and/or <code class="reqn">y</code> variable transformation are
<code>"log"</code> (natural logarithm), <code>"sqrt"</code> (square root) and
<code>"sq"</code> (square).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>shift</code></td>
<td>
<p>A vector of two values which will be added to the variables
<code class="reqn">x</code> and/or <code class="reqn">y</code> before they are transformed as specified by the
<code>xform</code> parameter, where the first element will be added to the
<code class="reqn">x</code> variable and the second element to the <code class="reqn">y</code> variable. The
purpose is to prevent an undefined state which could arise when variables
with values of <code class="reqn">\leq 0</code> are log or square root transformed. The
default is <code>c(0, 0)</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>sf_option</code></td>
<td>
<p>A character string that specifies if the limits (<code>rl</code>
or <code>sl</code>) should be regarded as “tight” or “loose”, i.e.
either <code>"tight"</code> or <code>"loose"</code>, respectively. The default is
<code>"tight"</code>. The option <code>"tight"</code> means that the limits are
rounded to the number of significant digits specified by the parameters
<code>rl_sf</code> and <code>sl_sf</code>. If <code>sf_option = "loose"</code>, four on
the order of the last significant digit + 1 is added if
<code>ivl_side = "upper"</code> or five on the order of the last significant
digit + 1 is subtracted if <code>ivl_side = "upper"</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>ivl</code></td>
<td>
<p>A character string of either <code>"confidence"</code> or
<code>"prediction"</code> that specifies the type of interval of interest.
The default is <code>"confidence"</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>ivl_type</code></td>
<td>
<p>A character string that specifies if a “one sided”
or a “two sided” interval should be calculated, i.e. either
<code>"one.sided"</code> or <code>"two.sided"</code>, respectively. The default is
<code>"one.sided"</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>ivl_side</code></td>
<td>
<p>A character string that specifies if the specification
limit, given that the limit has only one side, is an “upper” or a
“lower” bound, i.e. it is specified as either <code>"upper"</code> or
<code>"lower"</code>, respectively. The default is <code>"lower"</code>. If the
specification has two boundaries, then this parameter specifies the
preferred side. If no side is preferred over the other, <code>"both"</code> can
be used.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>Additional named or unnamed arguments passed on to
<code>uniroot()</code>.</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>According to ICH Q1E guideline, “<em>an appropriate
approach to retest period or shelf life estimation is to analyse a
quantitative attribute by determining the earliest time at which the 95
percent confidence limit for the mean intersects the proposed acceptance
criterion</em>” (in this package, this point is called the “point of
intersection” (POI)). Furthermore, it says that “<em>for an
attribute known to increase with time, the upper one-sided 95 percent
confidence limit should be compared to the acceptance criterion. For an
attribute that can either increase or decrease, or whose direction of change
is not known, two-sided 95 percent confidence limits should be calculated
and compared to the upper and lower acceptance criteria.</em>” The approach
can be used to estimate the retest period or shelf life for a single batch
or for multiple batches. According to the guideline, “<em>for a
drug substance or for a drug product available in a single strength and a
single container size and/or fill, the retest period or shelf life is
generally estimated based on the stability data from a minimum of three
batches.</em>”
</p>
<p>Before performing the retest period or shelf life estimation with results
from multiple batches, the most suitable model should be determined. It
should particularly be verified if data of all test batches are poolable or
not. Details on this are described in section “Checking batch
poolability” below.
</p>


<h3>Value</h3>

<p>An object of class ‘<code>expirest_osle</code>’ is returned,
containing the following elements:
</p>
<table>
<tr style="vertical-align: top;">
<td><code>Data</code></td>
<td>
<p>Data frame of the original data including new columns with
transformed variables, if applicable.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>Parameters</code></td>
<td>
<p>A list of the parameters with the elements <code>alpha</code>,
<code>alpha.pool</code>, <code>ivl</code>, <code>ivl.type</code> and <code>ivl.side</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>Variables</code></td>
<td>
<p>A list of the variable names, i.e. the original names of
<code>batch_vbl</code>, <code>time_vbl</code> and <code>response_vbl</code> and, if
applicable, of the transformed variables.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>Model.Type</code></td>
<td>
<p>A list of two elements that specifies which model, based
on the ANCOVA analysis, suits best. The first element (<code>type.spec</code>)
is a numeric vector of length 2 that specifies the best model accepted at
the significance level specified by <code>alpha.pool</code>. The first number
represents the decision on the intercept and the second on the slope,
where <code>1</code> stands for “common” and <code>2</code> stands for
“different”. The second element (<code>type.acronym</code>) is an acronym
representing the first item.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>Models</code></td>
<td>
<p>A list of four elements named <code>cics</code>, <code>dics</code>,
<code>dids.pmse</code> and <code>dids</code>. The first three elements contain the
‘<code>lm</code>’ objects of the “common intercept / common slope”
(<code>cics</code>), “different intercept / common slope” (<code>dics</code>)
and “different intercept / different slope” (<code>dids</code>) models.
The fourth element is a list of the ‘<code>lm</code>’ objects that is
obtained from fitting a regression model to the data of each level of the
categorical variable separately. The <code>cics</code>, <code>dics</code> and
<code>dids.pmse</code> elements are <code>NA</code> if data of only a single batch
is available.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>AIC</code></td>
<td>
<p>A numeric named vector of the Akaike Information Criterion (AIC)
values of the <code>cics</code>, <code>dics</code> and <code>dids.pmse</code> models.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>BIC</code></td>
<td>
<p>A numeric named vector of the Bayesian Information Criterion (BIC)
values of each of the <code>cics</code>, <code>dics</code> and <code>dids.pmse</code>
models.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>wc.icpt</code></td>
<td>
<p>A numeric named vector of the worst case intercepts. The
information about which limit the corresponding confidence interval
crosses is stored in the attribute named <code>side</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>wc.batch</code></td>
<td>
<p>A numeric named vector of the batches with the worst case
intercepts. The information about which limit the corresponding confidence
interval crosses is stored in the attribute named <code>side</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>Limits</code></td>
<td>
<p>A list of all limits.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>Intercepts</code></td>
<td>
<p>A list of the intercepts of all models.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>All.POI</code></td>
<td>
<p>A list of two elements named <code>lower</code> and <code>upper</code>
that contain either NA or lists of the POI values of all models.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>POI</code></td>
<td>
<p>A numeric named vector of the POI values of the worst case
batches of each model. The information about which limit the corresponding
confidence interval crosses is stored in the attribute named <code>side</code>.</p>
</td>
</tr>
</table>
<h3>Checking batch poolability</h3>

<p>According to ICH Q1E guideline, construction of the 95% confidence interval
on the basis of the combined data of all test batches is allowed only if it
has been confirmed by aid of a statistical test whether the regression lines
from the different batches have a common slope and a common intercept. A
significance level of <code>alpha_pool = 0.25</code> should to be used for both
batch-related terms, and the test of the slopes has to precede the test of
the intercepts. From these tests, three possible models may be appropriate,
i.e.
</p>

<ul>
<li>
<p> a <em>common intercept / common slope</em> model (cics),
</p>
</li>
<li>
<p> a <em>different intercept / common slope</em> model (dics) or
</p>
</li>
<li>
<p> a <em>different intercept / different slope</em> model (dids).
</p>
</li>
</ul>
<p>The <em>common intercept / different slope</em> model is not of practical
relevance because the corresponding model is missing an effect. If the
slopes are significantly different, there is no point comparing intercepts.
The dids model has individual intercepts and individual slopes, and the
calculation of confidence intervals is based on the corresponding individual
mean square errors. The <em>different intercept / different slope</em> model
where the mean square error is pooled across batches is reported as
dids.pmse.
</p>
<p>These requirements can be checked by aid of an “ANalysis of
COVAriance” (ANCOVA) including the batch variable as main effect and as
<code class="reqn">batch \times time</code> interaction term. The full ANCOVA model
simultaneously tests all the effects, and non-significant effects can be
identified and removed for fitting of the final regression model that is
used for the estimation of the shelf life or retest period.
</p>
<p>The significance level (<code>alpha_pool = 0.25</code>, Type I error) is used to
increase the power of the test to detect cases where the data should not be
pooled. Setting <code>alpha_pool = 0.25</code> decreases the probability of
incorrectly concluding that stability data from multiple batches can be
pooled. On the other hand, though, it increases the probability of using a
single batch to determine expiry when pooling batches would be more
appropriate.
</p>


<h3>References</h3>

<p>International Council for Harmonisation of Technical Requirements for
Registration of Pharmaceuticals for Human (ICH), Harmonised Tripartite
Guideline, Evaluation of Stability Data Q1E, step 4, February 2003
(CPMP/ICH/420/02).
</p>


<h3>See Also</h3>

<p><code>expirest_wisle</code>, <code>uniroot</code>,
<code>lm</code>, <code>AIC</code>, <code>BIC</code>.
</p>


<h3>Examples</h3>

<pre><code class="language-R"># Successful estimations
# A model with common intercepts / common slopes (cics)
res1 &lt;-
  expirest_osle(data = exp1[exp1$Batch %in% c("b2", "b5", "b7"), ],
                response_vbl = "Potency", time_vbl = "Month",
                batch_vbl = "Batch", sl = 95, sl_sf = 3,
                srch_range = c(0, 500), sf_option = "loose")
res1$Model.Type
res1$POI

# Expected results in res1$Model.Type
# $type.spec
# common.icpt  common.slp
#           1           1
#
# $type.acronym
# [1] "cics"

# Expected results in res1$POI
#     cics      dics dids.pmse      dids
# 26.22410  24.80030  23.66724  23.34184
# attr(,"side")
#     cics      dics dids.pmse      dids
#  "lower"   "lower"   "lower"   "lower"

# The parameter settings sf_option = "loose" and ivl_side = "lower" (the
# default setting of ivl_side) cause the specification limit of 95.0
# (sl_sf = 3, i.e. 3 significant digits) to be reduced by 0.05, i.e. the
# actual specification limit is 94.95.

# A model with different intercepts / different slopes (dids)
res2 &lt;-
  expirest_osle(data = exp1[exp1$Batch %in% c("b4", "b5", "b8"), ],
                response_vbl = "Potency", time_vbl = "Month",
                batch_vbl = "Batch", sl = 95, sl_sf = 3,
                srch_range = c(0, 500), sf_option = "loose")
res2$Model.Type
res2$POI

# Expected results in res2$Model.Type
# $type.spec
# common.icpt  common.slp
#           0           0
#
# $type.acronym
# [1] "dids"

# Expected results in res2$POI
#     cics      dics dids.pmse      dids
# 28.12518  22.47939  15.72348  15.96453
# attr(,"side")
#     cics      dics dids.pmse      dids
#  "lower"   "lower"   "lower"   "lower"

# Estimation where it is not know a priori which limit is crossed first, i.e.
# letting the estimation be done for both specification limits.
res3 &lt;-
  expirest_osle(
    data = exp3, response_vbl = "Moisture", time_vbl = "Month",
    batch_vbl = "Batch", sl = c(1.5, 3.5), sl_sf = c(2, 2),
    srch_range = c(0, 500), sf_option = "loose", ivl = "confidence",
    ivl_type = "two.sided", ivl_side = "both")
res3$Model.Type
res3$POI

# Expected results in res3$Model.Type
# $type.spec
# common.icpt  common.slp
#           1           1
#
# $type.acronym
# [1] "cics"

# Expected results in res3$POI
#     cics      dics dids.pmse      dids
# 46.85172  41.84802  22.41808  22.50966
# attr(,"side")
#     cics      dics dids.pmse      dids
#  "upper"   "upper"   "upper"   "lower"

# The parameter settings sf_option = "loose" and ivl_side = "both" (the
# default setting of ivl_side) cause the specification limits of 1.5 and 3.5
# (sl_sf = 2, i.e. 2 significant digits) to be reduced by 0.05 and increased
# by 0.04, respectively, i.e. the actual specification limits are 1.45 and
# 3.54, respectively.

# Analysis with a single batch
res4 &lt;-
  expirest_osle(
    data = exp3[exp3$Batch == "b1", ], response_vbl = "Moisture",
    time_vbl = "Month", batch_vbl = "Batch", sl = c(1.5, 3.5),
    sl_sf = c(2, 2), srch_range = c(0, 500), sf_option = "tight",
    ivl = "confidence", ivl_type = "two.sided", ivl_side = "both")

# Since only one batch is involved there is no model type. Nevertheless, the
# result is reported under the dids model name.
res4$Model.Type
res4$POI

# Expected results in res4$Model.Type
# $type.spec
# common.icpt  common.slp
#         NA           NA
#
# $type.acronym
# [1] "n.a."

# Expected results in res4$POI
# cics      dics dids.pmse      dids
#   NA        NA        NA  21.42596
# attr(,"side")
# cics      dics dids.pmse      dids
# "NA"      "NA"      "NA"   "lower"

# Unsuccessful estimations
## Not run: 
  # Intervals are wider than the specification limits (no intersection).
  res5 &lt;-
    expirest_osle(
      data = exp3, response_vbl = "Moisture", time_vbl = "Month",
      batch_vbl = "Batch", sl = 1.5, sl_sf = 2, srch_range = c(0, 500),
      sf_option = "tight", ivl = "prediction", ivl_type = "two.sided",
      ivl_side = "lower")
  res5$POI

  # (Expected) results in res5$POI
  #    cics      dics dids.pmse      dids
  #     NA        NA        NA        NA
  # attr(,"side")
  #    cics      dics dids.pmse      dids
  # "lower"   "lower"   "lower"   "lower"

  # Estimation may also fail because of an inappropriate 'srch_range' setting.
  res6 &lt;-
    expirest_osle(data = exp1[exp1$Batch %in% c("b2", "b5", "b7"), ],
                  response_vbl = "Potency", time_vbl = "Month",
                  batch_vbl = "Batch", sl = 95, sl_sf = 3,
                  srch_range = c(0, 5))
  res6$POI

  # (Expected) results in res6$POI
  #    cics      dics dids.pmse      dids
  #     NA        NA        NA        NA
  # attr(,"side")
  #    cics      dics dids.pmse      dids
  # "lower"   "lower"   "lower"   "lower"

## End(Not run)
</code></pre>


</div>