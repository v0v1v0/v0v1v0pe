<div class="container">

<table style="width: 100%;"><tr>
<td>glmnet_fit</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Obtain and use a glmnet prediction model</h2>

<h3>Description</h3>

<p>Function to easily fit and apply glmnet models (including best lambda estimation, etc).</p>


<h3>Usage</h3>

<pre><code class="language-R">glmnet_fit(x, y, family = c("binomial", "cox", "gaussian"),
           nfolds = 10, standardize = TRUE, min.beta = 1e-12)
glmnet_predict(m, x)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>x</code></td>
<td>
<p>input matrix of dimension nobs x nvars; each row is an observation vector. It can be easily obtained with <code>data.frame2glmnet.matrix</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>y</code></td>
<td>
<p>response to be predicted. A binary vector for "binomial", a "Surv" object for "cox", or a numeric vector for "gaussian".</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>family</code></td>
<td>
<p>distribution of y: "binomial", "cox", or "gaussian".</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>m</code></td>
<td>
<p>lasso model to conduct the prediction, obtained with <code>glmnet_fit</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>nfolds</code></td>
<td>
<p>number of folds.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>standardize</code></td>
<td>
<p>logical flag for x variable standardization. The coefficients are always returned on the original scale.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>min.beta</code></td>
<td>
<p>minimum value of betas.</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>The function <code>glmnet_fit</code> mainly calls the function <code>glmnet</code> to fit a generalized linear model with lasso regularization, though with some extra code to make the call easier: it allow <code>x</code> to have a single column, it conducts an internal cross-validation using the function <code>cv.glmnet</code> to select the regularization parameter <code>lambda</code> automatically, and it removes the negligible coefficients.</p>


<h3>Value</h3>

<p>An object of class <code>"glmnet_fit"</code>, which is briefly a list with the intercept (<code>"a0"</code>) and regressors (<code>"beta"</code>) of the model; it also includes the indices of the regressors (<code>"i"</code>) and the <code>"family"</code> of the response.</p>


<h3>Author(s)</h3>

<p>Joaquim Radua and Aleix Solanes</p>


<h3>References</h3>

<p>Solanes, A., Mezquida, G., Janssen, J., Amoretti, S., Lobo, A., Gonzalez-Pinto, A., Arango, C., Vieta, E., Castro-Fornieles, J., Berge, D., Albacete, A., Gine, E., Parellada, M., Bernardo, M.; PEPs group (collaborators); Pomarol-Clotet, E., Radua, J. (2022)
Combining MRI and clinical data to detect high relapse risk after the first episode of psychosis.
<em>Schizophrenia</em>, <b>8</b>, 100, doi:10.1038/s41537-022-00309-w.
</p>
<p>Palau, P., Solanes, A., Madre, M., Saez-Francas, N., Sarro, S., Moro, N., Verdolini, N., Sanchez, M., Alonso-Lana, S., Amann, B.L., Romaguera, A., Martin-Subero, M., Fortea, L., Fuentes-Claramonte, P., Garcia-Leon, M.A., Munuera, J., Canales-Rodriguez, E.J., Fernandez-Corcuera, P., Brambilla, P., Vieta, E., Pomarol-Clotet, E., Radua, J. (2023)
Improved estimation of the risk of manic relapse by combining clinical and brain scan data.
<em>Spanish Journal of Psychiatry and Mental Health</em>, <b>16</b>, 235â€“243, doi:10.1016/j.rpsm.2023.01.001.
</p>


<h3>See Also</h3>

<p><code>cv</code> for conducting a cross-validation.
</p>


<h3>Examples</h3>

<pre><code class="language-R"># Create random x (predictors) and y (binary)
x = matrix(rnorm(25000), ncol = 50)
y = 1 * (plogis(apply(x[,1:5], 1, sum) + rnorm(500, 0, 0.1)) &gt; 0.5)

# Predict y via cross-validation
fit_fun = function (x_training, y_training) {
  list(
    lasso = glmnet_fit(x_training, y_training, family = "binomial")
  )
}
predict_fun = function (m, x_test) {
  glmnet_predict(m$lasso, x_test)
}
# Only 2 folds to ensure the example runs quickly
res = cv(x, y, family = "binomial", fit_fun = fit_fun, predict_fun = predict_fun, nfold = 2)

# Show accuracy
se = mean(res$predictions$y.pred[res$predictions$y == 1] &gt; 0.5)
sp = mean(res$predictions$y.pred[res$predictions$y == 0] &lt; 0.5)
bac = (se + sp) / 2
cat("Sensitivity:", round(se, 2), "\n")
cat("Specificity:", round(sp, 2), "\n")
cat("Balanced accuracy:", round(bac, 2), "\n")
</code></pre>


</div>