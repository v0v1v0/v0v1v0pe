<div class="container">

<table style="width: 100%;"><tr>
<td>virus</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Virus design</h2>

<h3>Description</h3>

<p>Viruses can be considered to be anything that can be transmitted (e.g.,
diseases, as well as ideas.) Most models in epiworldR can feature multiple
viruses.
</p>


<h3>Usage</h3>

<pre><code class="language-R">virus(
  name,
  prevalence,
  as_proportion,
  prob_infecting,
  recovery_rate = 0.5,
  prob_death = 0,
  post_immunity = -1,
  incubation = 7
)

set_name_virus(virus, name)

get_name_virus(virus)

add_virus(model, virus, proportion)

virus_set_state(virus, init, end, removed)

rm_virus(model, virus_pos)

virus_fun_logit(vars, coefs, model)

set_prob_infecting(virus, prob)

set_prob_infecting_ptr(virus, model, param)

set_prob_infecting_fun(virus, model, vfun)

set_prob_recovery(virus, prob)

set_prob_recovery_ptr(virus, model, param)

set_prob_recovery_fun(virus, model, vfun)

set_prob_death(virus, prob)

set_prob_death_ptr(virus, model, param)

set_prob_death_fun(virus, model, vfun)

set_incubation(virus, incubation)

set_incubation_ptr(virus, model, param)

set_incubation_fun(virus, model, vfun)

set_distribution_virus(virus, distfun)

distribute_virus_randomly(prevalence, as_proportion)

distribute_virus_set(agents_ids)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>name</code></td>
<td>
<p>of the virus</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>prevalence</code></td>
<td>
<p>Numeric scalar. Prevalence of the virus.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>as_proportion</code></td>
<td>
<p>Logical scalar. If <code>TRUE</code>, the prevalence is set as a
proportion of the total number of agents in the model.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>prob_infecting</code></td>
<td>
<p>Numeric scalar. Probability of infection (transmission).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>recovery_rate</code></td>
<td>
<p>Numeric scalar. Probability of recovery.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>prob_death</code></td>
<td>
<p>Numeric scalar. Probability of death.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>post_immunity</code></td>
<td>
<p>Numeric scalar. Post immunity (prob of re-infection).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>incubation</code></td>
<td>
<p>Numeric scalar. Incubation period (in days) of the virus.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>virus</code></td>
<td>
<p>An object of class <code>epiworld_virus</code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>model</code></td>
<td>
<p>An object of class <code>epiworld_model</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>proportion</code></td>
<td>
<p>Deprecated.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>init, end, removed</code></td>
<td>
<p>states after acquiring a virus, removing a virus,
and removing the agent as a result of the virus, respectively.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>virus_pos</code></td>
<td>
<p>Positive integer. Index of the virus's position in the model.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>vars</code></td>
<td>
<p>Integer vector. Indices (starting from 0) of the positions of the
variables used to compute the logit probability.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>coefs</code></td>
<td>
<p>Numeric vector. Of the same length of <code>vars</code>, is a vector of
coefficients associated to the logit probability.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>prob</code></td>
<td>
<p>Numeric scalar. A probability (between zero and one).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>param</code></td>
<td>
<p>Character scalar. Name of the parameter featured in <code>model</code> that
will be added to the virus (see details).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>vfun</code></td>
<td>
<p>An object of class <code>epiworld_virus_fun</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>distfun</code></td>
<td>
<p>An object of class <code>epiworld_distribution_virus</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>agents_ids</code></td>
<td>
<p>Integer vector. Indices of the agents that will receive the
virus.</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>The <code>virus()</code> function can be used to initialize a virus. Virus features can
then be modified using the functions <code style="white-space: pre;">⁠set_prob_*⁠</code>.
</p>
<p>The function <code>virus_fun_logit()</code> creates a "virus function" that can be
evaluated for transmission, recovery, and death. As the name sugests, it
computes those probabilities using a logit function (see examples).
</p>
<p>The name of the <code>epiworld_virus</code> object can be manipulated with the functions
<code>set_name_virus()</code> and <code>get_name_virus()</code>.
</p>
<p>In the case of <code>set_prob_infecting_ptr</code>, <code>set_prob_recovery_ptr</code>, and
<code>set_prob_death_ptr</code>, the corresponding parameters is passed as a pointer to
the virus. The implication of using pointers is that the values will be
read directly from the <code>model</code> object, so changes will be reflected.
</p>
<p>The <code>distribute_virus_randomly</code> function is a factory function
used to randomly distribute the virus in the model. The prevalence can be set
as a proportion or as a number of agents. The resulting function can then be
passed to <code>set_distribution_virus</code>.
</p>


<h3>Value</h3>


<ul><li>
<p> The <code>set_name_virus</code> function does not return a value, but merely assigns
a name to the virus of choice.
</p>
</li></ul>
<ul><li>
<p> The <code>get_name_virus</code> function returns the name of the virus of class
epiworld_virus.
</p>
</li></ul>
<ul><li>
<p> The <code>add_virus</code> function does not return a value, instead it adds the
virus of choice to the model object of class epiworld_model.
</p>
</li></ul>
<ul><li>
<p> The <code>virus_set_state</code> function does not return a value but assigns
epidemiological properties to the specified virus of class epiworld_virus.
</p>
</li></ul>
<ul><li>
<p> The <code>rm_virus</code> function does not return a value, but instead removes
a specified virus from the model of class epiworld_model.
</p>
</li></ul>
<ul><li>
<p> The <code>set_prob_infecting</code> function does not return a value, but instead
assigns a probability to infection for the specified virus of class
epiworld_virus.
</p>
</li></ul>
<ul><li>
<p> The <code>set_prob_recovery</code> function does not return a value, but instead
assigns a probability to recovery for the specified virus of class
epiworld_virus.
</p>
</li></ul>
<ul><li>
<p> The <code>set_prob_death</code> function does not return a value, but instead
assigns a probability to death for the specified virus of class
epiworld_virus.
</p>
</li></ul>
<ul><li>
<p> The <code>set_incubation</code> function does not return a value, but instead
assigns an incubation period to the specified virus of class epiworld_virus.
</p>
</li></ul>
<ul><li>
<p> The <code>distribute_virus_randomly</code> function returns a function that can be
used to distribute the virus in the model.
</p>
</li></ul>
<h3>Examples</h3>

<pre><code class="language-R">mseirconn &lt;- ModelSEIRCONN(
  name                = "COVID-19",
  prevalence          = 0.01, 
  n                   = 10000,
  contact_rate        = 4, 
  incubation_days     = 7, 
  transmission_rate   = 0.5,
  recovery_rate       = 0.99
)

delta &lt;- virus(
  "Delta Variant", 0, .5, .2, .01, prevalence = 0.3, as_proportion = TRUE
)

# Adding virus and setting/getting virus name
add_virus(mseirconn, delta)
set_name_virus(delta, "COVID-19 Strain")
get_name_virus(delta)

run(mseirconn, ndays = 100, seed = 992)
mseirconn

rm_virus(mseirconn, 0) # Removing the first virus from the model object
set_distribution_virus(delta, distribute_virus_randomly(100, as_proportion = FALSE))
add_virus(mseirconn, delta) 

# Setting parameters for the delta virus manually
set_prob_infecting(delta, 0.5)
set_prob_recovery(delta, 0.9)
set_prob_death(delta, 0.01)
run(mseirconn, ndays = 100, seed = 992) # Run the model to observe changes

# If the states were (for example):
# 1: Infected
# 2: Recovered
# 3: Dead
delta2 &lt;- virus(
  "Delta Variant 2", 0, .5, .2, .01, prevalence = 0, as_proportion = TRUE
)
virus_set_state(delta2, 1, 2, 3)
# Using the logit function --------------
sir &lt;- ModelSIR(
  name = "COVID-19", prevalence = 0.01, 
  transmission_rate = 0.9, recovery = 0.1
  )

# Adding a small world population
agents_smallworld(
  sir,
  n = 10000,
  k = 5,
  d = FALSE,
  p = .01
)

run(sir, ndays = 50, seed = 11)
plot(sir)

# And adding features
dat &lt;- cbind(
  female = sample.int(2, 10000, replace = TRUE) - 1,
  x      = rnorm(10000)
)

set_agents_data(sir, dat)

# Creating the logit function
vfun &lt;- virus_fun_logit(
  vars  = c(0L, 1L),
  coefs = c(-1, 1),
  model = sir
)

# The infection prob is lower
hist(plogis(dat %*% rbind(-1,1)))

vfun # printing

set_prob_infecting_fun(
  virus = get_virus(sir, 0),
  model = sir,
  vfun  = vfun
  )
  
run(sir, ndays = 50, seed = 11)
plot(sir)


</code></pre>


</div>