<div class="container">

<table style="width: 100%;"><tr>
<td>etasclass</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Mixed estimation of an ETAS model (renewed in version 2.0)</h2>

<h3>Description</h3>

<p><code>etasclass</code> is the main function of the package <code>etasFLP</code>.
</p>
<p><code>etassclass</code> <em>objects of previous versions
are not compatible with the  current version</em>
</p>
<p>Performs the estimation of the components of the ETAS (Epidemic Type Aftershock Sequence) model for the description of the seismicity in a space-time region. Background seismicity is estimated non-parametrically, while triggered seismicity is estimated by MLE. In particular also the bandwidth for a kernel smoothing can be estimated through the Forward Likelihood Predictive (FLP) approach. For each event the probability of being a background event or a triggered one is estimated. 
</p>
<p><strong>New in version 2.0.0:</strong>
<em>Covariates have been introduced to explain the effects of external factors on the induced seismicity. Since the parametrization is changed, the etasclass object created with the previous versions are not compatible with the one obtained with the current version.</em>
</p>
<p><strong>New in version 2.2.0:</strong>
<em>New algoruthm for starting values. A new argument (n.iterweight) and an update method and a <code>timeupdate</code> option</em>
</p>
<p>An ETAS with up to 7+<code>ncov</code> parameters can be estimated, with several options and different methods.
</p>
<p>Returns an <code>etasclass</code> object, for which <code>plot</code>, <code>summary</code>, <code>print</code> and <code>profile</code> methods are defined. 
</p>


<h3>Usage</h3>

<pre><code class="language-R">etasclass(cat.orig,
           time.update=FALSE,
           magn.threshold	=2.5,
           magn.threshold.back=magn.threshold+2,	
           tmax		=max(cat.orig$time),
           long.range=range(cat.orig$long),
           lat.range=range(cat.orig$lat),
           ##### starting values for parameters
           mu		=1,
           k0		=1,
           c		=0.5,
           p		=1.01,
           gamma	=.5,
           d		=1.,
           q		=1.5,
           betacov         =0.7,
           ### indicators: if params.ind[i] i-th parameter will be estimated
           params.ind=replicate(7,TRUE),
#           params.lim=c(0,0,0,1.0,0,0,0),
           ### formula for covariates (magnitude should always be included):
           formula1            ="time~magnitude-1",
           offset              =0,
           hdef=c(1,1),
           w		=replicate(nrow(cat.orig),1),
           hvarx  =replicate(nrow(cat.orig),1),
           hvary  =replicate(nrow(cat.orig),1),
           ### flags for the kind of declustering and smoothing:
           declustering	   =TRUE,
           thinning	       =FALSE,
           flp		         =TRUE,
           m1		           =NULL,
           ndeclust        =5,
           n.iterweight    =1,
           onlytime	=FALSE,
           is.backconstant	=FALSE,
           ##### end of  main input arguments. 
           ##### Control and secondary arguments:
           description	="",
           cat.back   	=NULL,
           back.smooth	=1.0,
           sectoday	=FALSE,
           longlat.to.km   =TRUE,
#           fastML=FALSE, #### not yet implemented
#           fast.eps=0.001, #### not yet implemented
           usenlm		=TRUE,
           method		="BFGS",
           compsqm 	=TRUE,
           epsmax		= 0.0001,
           iterlim		=50,      
           ntheta		=36)  
 				</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>cat.orig</code></td>
<td>

<p>An  earthquake catalog, possibly an object of class <code>eqcat</code>, or however a <code>data.frame</code> with variables of names <code>time</code>,  <code>lat</code>,   <code>long</code>,  <code>z</code>,     <code>magn1</code>. No missing values are allowed.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>time.update</code></td>
<td>

<p>Logical. It is <code>TRUE</code> if the excution is called by <code>time.update</code> to update to new time maximum. Default value = <code>FALSE</code>.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>magn.threshold</code></td>
<td>

<p>Threshold magnitude (only events with a magnitude at least <code>magn.threshold</code> will be used).  Default value = 2.5.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>magn.threshold.back</code></td>
<td>

<p>Threshold magnitude used to build the  catalog <code>cat.back</code> for
the first estimation of the background seismicity. Default value = <code>magn.threshold+2</code>.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>tmax</code></td>
<td>

<p>Maximum value of time. Only observations before <code>tmax</code> will be used for estimation. Default value = <code>max(cat.orig$time)</code>.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>long.range</code></td>
<td>

<p>Longitude range. Only observations with <code>long</code>  in the range <code>long.range</code> will be used for estimation. Default value = <code>range(cat.orig$long)</code>.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>lat.range</code></td>
<td>

<p>Latitude range. Only observations with <code>lat</code>  in the range <code>lat.range</code> will be used for estimation. Default value = <code>range(cat.orig$lat)</code>.
</p>
</td>
</tr>
</table>
<p><em>Values for the 7 parameters of the ETAS   model</em> (starting values or fixed values according to  <code>params.ind</code>):
</p>
<table>
<tr style="vertical-align: top;">
<td><code>mu</code></td>
<td>
<p>Parameter 1 (<code class="reqn">\mu</code>) of the ETAS model: background general intensity; see details. Default value = 1.

</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>k0</code></td>
<td>
<p>Parameter 2 (<code class="reqn">\kappa_0</code>) of the ETAS model: measures the strength
of the aftershock activity; see details. Default value = 1.

</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>c</code></td>
<td>
<p>Parameter 3 of the ETAS model; a shift parameter of the Omori law for temporal decay rate of aftershocks; see details. Default value = 0.5.

</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>p</code></td>
<td>
<p>Parameter 4  of the ETAS model; the exponent of the Omori law for temporal decay rate of aftershocks; see details. Default value = 1.01.

</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>gamma</code></td>
<td>
<p>Parameter 5 (<code class="reqn">\gamma</code>) of the ETAS model; together with  <code>a</code> is related to the efficiency of an event of given magnitude 
in generating aftershocks; see details. Default value = 0.5.

</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>d</code></td>
<td>
<p>Parameter 6 of the ETAS model; parameter related to the spatial influence of the
mainshock; see details. Default value = 1.

</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>q</code></td>
<td>
<p>Parameter 7 of the ETAS model; parameter related to the spatial influence of the
mainshock; see details. Default value = 1.5.

</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>betacov</code></td>
<td>
<p>Numerical array. Parameters of the covariates ETAS model (the parameters <code class="reqn">\beta_j</code>); 
see details. Default value = 0.7. Parameters in <code>betacov</code> are not limited

</p>
</td>
</tr>
</table>
<p><em>End of model pararameter input</em>
</p>
<table>
<tr style="vertical-align: top;">
<td><code>params.ind</code></td>
<td>
<p>vector of 7 logical values: <code>params.ind[i] = TRUE</code> means that the i-th parameter must be estimated.  <code>params.ind[i] = FALSE</code>  means that the i-th parameter is fixed to its input value  (the order of parametrs is: <code>mu</code>, <code>k0</code>, <code>c</code>, <code>p</code>, <code>gamma</code>, <code>d</code>, <code>q</code>).
Default value = <code>replicate(7,TRUE)</code>, that is, <code>etasclass</code> estimates all parameters.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>params.lim</code></td>
<td>
<p>vector of 7 numerical values: <code>params.lim[i] = theta0</code> means that the i-th parameter must be greater than <code>theta0</code>  (the default limits of parametrs are: 0 for <code>mu</code>, <code>k0</code>, <code>c</code>, 1 for <code>p</code>, 0 for <code>gamma</code>, <code>d</code>, <code>q</code>).
Default value = <code>replicate(7,TRUE)</code>, that is, <code>etasclass</code> estimates all parameters.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>formula1</code></td>
<td>
<p>a character variable: Formula which defines the covariates acting on the induced seismicity. In classical etas model   the covariate is the magnitude. The left side (dummy) element must be the time, which is a variable certainly present in the data set. The right part of the formula determines <code>ncov</code> the number of covariates. Default value=<code>"time~magnitude-1"</code>; input <em>must</em> be a character value: it is converted in a formula inside the program</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>offset</code></td>
<td>
<p>An offset, for which no parameter will be estimated. Default value=0</p>
</td>
</tr>
</table>
<p><em>Flags for the kind of declustering and smoothing</em>:

</p>
<table>
<tr style="vertical-align: top;">
<td><code>hdef</code></td>
<td>
<p>Starting values for the <code>x,y</code> bandwidths used in the kernel estimator of background seismicity. Default value = <code>1,1</code>.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>w</code></td>
<td>
<p>Starting values for the weigths used in the kernel estimator of background seismicity. The length must be equal to the number of events of the catalog after event selection (can be less than <code>nrow(cat.orig)</code>). 
</p>
<p>Default value = <code>replicate(nrow(cat.orig),1).</code>
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>hvarx</code></td>
<td>
<p>Longitude bandwidths adjustement used in the kernel estimator of background seismicity. The length must be equal to the number of events of the catalog after event selection (can be less than <code>nrow(cat.orig)</code>). Default value = NULL</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>hvary</code></td>
<td>
<p>Longitude bandwidths adjustement used in the kernel estimator of background seismicity. The length must be equal to the number of events of the catalog after event selection (can be less than <code>nrow(cat.orig)</code>). Default value = NULL</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>declustering</code></td>
<td>
<p>if <code>TRUE</code> the catalog is iteratively declustered to optimally estimate the background intensity (through thinning, if <code>thinning=TRUE</code>, or through weighting if <code>thinning=FALSE</code>). Default value = <code>TRUE</code>.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>thinning</code></td>
<td>
<p>if <code>thinning=TRUE</code> a background catalog is obtained sampling from the original catalog with probabilities estimated during the iterations. Default value =<code>FALSE</code>.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>flp</code></td>
<td>
<p>if <code>flp=TRUE</code> then background seismicity is estimated through Forward Likelihood Predictive (see details). Otherwise the Silverman rule is used. Default value =<code>TRUE</code>.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>m1</code></td>
<td>
<p>Used only if <code>flp=TRUE</code>. Indicates the range of points used for the FLP steps. See details. If missing it is set  to <code>nrow(cat)/2</code>.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>ndeclust</code></td>
<td>
<p>maximum number of iterations for the general declustering procedure. Default=5.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>n.iterweight</code></td>
<td>
<p>New in version 2.2. The weighting and the density computations will be alternated  <code>n.iterweight</code> times after each maximum likelihood step: in many situations this improves the general convergence procedure. Default=1.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>onlytime</code></td>
<td>
<p>if <code>TRUE</code>  then a time process is fitted to data , regardless to space location (in this case <code>is.backconstant</code> is set to <code>TRUE</code> and <code>declustering</code>, <code>flp</code> are set to <code>FALSE</code>). Default value = <code>FALSE</code>.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>is.backconstant</code></td>
<td>
<p>if <code>TRUE</code>  then background seismicity is assumed to be homogeneous in space  (and <code>declustering, flp</code> are set to <code>FALSE</code>).  Default value = <code>FALSE</code>.
</p>
</td>
</tr>
</table>
<p><em>Other control parameters</em>:
</p>
<table>
<tr style="vertical-align: top;">
<td><code>description</code></td>
<td>
<p>a description string used for the output. Default value = "".
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>cat.back</code></td>
<td>
<p> external catalog used for the estimation of the background seismicity. 
Default value = <code>NULL</code>.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>back.smooth</code></td>
<td>

<p>Controls the level of smoothing for the background seismicity (meaningful only if <code>flp=FALSE</code>). Default value = 1.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>sectoday</code></td>
<td>
<p> if <code>TRUE</code>, then <code>time</code> variable of <code>cat.orig</code> is converted from seconds to days.  Default value = <code>FALSE</code>.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>longlat.to.km</code></td>
<td>
<p> if <code>TRUE</code>, then <code>long</code> and <code>lat</code> variables of <code>cat.orig</code> are treated as geographical coordinates and converted to kilometers.  Default value = <code>TRUE</code>.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>usenlm</code></td>
<td>
<p>if <code>TRUE</code>, then <code>nlm</code> function (gauss-newton method) is used in the maximum likelihood steps; if <code>FALSE</code>, then <code>optim</code> function is used (with <code>method</code> <code>=method</code> ).  Default value = <code>TRUE</code>.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>method</code></td>
<td>
<p>used if <code>usenlm=FALSE</code>: method used  by <code>optim</code>.  Default value = <code>"BFGS"</code>.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>compsqm</code></td>
<td>
<p>if <code>TRUE</code>, then standard errors are computed.  Default value = <code>TRUE</code>.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>epsmax</code></td>
<td>
<p>maximum allowed difference between estimates in subsequent iterations (default = 0.0001).
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>iterlim</code></td>
<td>
<p>maximum number of iterations in the maximum likelihood steps (used in <code>nlm</code> or <code>optim</code>). Default value = 100.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>ntheta</code></td>
<td>
<p>number of subdivisions of the round angle, used in the approximation of the integral involved in the likelihood computation of the ETAS model. Default value = 100.
</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>Estimates the components of an ETAS (Epidemic type aftershock sequence)
model for the description of the seismicity of a space-time region. 
Background seismicity is estimated nonparametrically, while triggered seismicity is estimated by MLE.
</p>
<p>From version 2.0 of package <code>etasFLP</code> covariates are allowed to improve the fitting of the triggered part, through the input <code>formula1</code>, which as a default values of <code>"time ~ magnitude - 1"</code>, which corresponds to the previous version of package <code>etasFLP</code>, that is, magnitude as the only covariate which influence the average number of aftershocks.
</p>
<p>The bandwidth of the kernel density estimator is estimated through the 
Forward Likelihood Predictive approach (FLP),
(theoretical reference on Adelfio and Chiodi, 2013) if <code>flp</code> is set to <code>TRUE</code>. 
Otherwise the bandwidth is estimated trough the Silverman's rule.
FLP steps for the estimation of nonparametric background component  is alternated with the Maximum Likelihood step for the estimation
of parametric components (only if <code>declustering=TRUE</code>).
For each event the probability of being a background event or a triggered one is estimated,
according to a declustering procedure in a way similar to the proposal of Zhuang,  Ogata,  and Vere-Jones (2002).
</p>
<p>The ETAS model for conditional space time intensity <code class="reqn">\lambda(x,y,t)</code> is given by:
</p>
<p style="text-align: center;"><code class="reqn">\lambda(x,y,t)=\mu f(x,y)+\kappa_0 \sum_{t_j&lt;t}\frac{ e^{\eta_j}}{(t-t_j +c)^p}
\left\{ \frac{(x-x_j)^2+(y-y_j)^2}{e^{\gamma \ (m_j-m_0)}}+d \right\}^{-q}</code>
</p>

<p>where <code class="reqn">\eta_j=\sum_{j=1,ncov}\beta_j cov_{ij}</code>
</p>
<p>parameters <code class="reqn">\beta_j</code> are the elements of the array variable <code>betacov</code>
</p>
<p><code class="reqn">f(x,y)</code> is estimated through a weighted kernel gaussian estimator; if <code>flp</code> is set to <code>TRUE</code>
then the bandwidth is estimated through a FLP step.
</p>
<p>Weights (computed only if <code>declustering=TRUE</code>) are given by the estimated probabilities of being  a background event; for the i-th event this is given by
<code class="reqn">\rho_i=\frac{\mu f(x_i,y_i)}{\lambda(x_i,y_i,t_i)}</code>.
The weights <code class="reqn">\rho_i</code> are updated after a whole iteration. 
</p>
<p><code>mu</code> (<code class="reqn">\mu</code>) measures the background general intensity (which is assumed temporally homogeneous);
</p>
<p><code>k0</code> (<code class="reqn">\kappa_0</code>) is a scale parameter related to the importance of the induced seismicity;
</p>
<p><code>c</code> and <code>p</code> are the characteristic parameters of the seismic
activity of the given region; <code>c</code> is a shift parameter while <code>p</code>, which characterizes the pattern of seismicity, is the exponent parameter of the modified Omori law for temporal decay rate of aftershocks; 
</p>
<p><code class="reqn">\eta_j=\sum_{j=1,ncov}\beta_j cov_{ij}</code> measures the efficiency of an event of a given magnitude in generating aftershock sequences;
</p>
<p><code>d</code> and <code>q</code> are two parameters related to the spatial influence of the mainshocks.
</p>
<p>Many kinds of ETAS models can be estimated, managing some control input arguments. 
The eight ETAS parameters can be fixed  to some input value, or can be estimated, according to <code>params.ind</code>:
if <code>params.ind</code>[i]=FALSE the i-th parameter is kept fixed to its input value, otherwise, if <code>params.ind[i]</code> <code> = TRUE</code>,  the i-th parameter is estimated and the input value is used as a starting value. 
</p>
<p>By default <code>params.ind=c(TRUE,TRUE,TRUE,TRUE,TRUE,TRUE,TRUE)</code>, and so a full 7+<code>ncov</code> parameters ETAS model will be estimated.
</p>
<p>The seven parameters are internally ordered in this way: <code>params</code> = (<code>mu</code>, <code>k0</code>, <code>c</code>, <code>p</code>,  <code>gamma</code>, <code>d</code>, <code>q</code>); for example
a model with a fixed value <code>p=1</code> (and  <code>params.ind</code>[4] = FALSE) can be estimated  and compared with the model where <code>p</code> is estimated (<code>params.ind</code>[4]=TRUE);
</p>
<p>for example  a 6+<code>ncov</code> parameters model can be fitted with <code>gamma=0</code> and <code>params.ind[5]</code>=<code>FALSE</code>, 
so that  input must be in this case: <code>params.ind=c(TRUE,TRUE,TRUE,TRUE,FALSE,TRUE,TRUE)</code>; 
</p>
<p>if <code>onlytime=TRUE</code> a time process is fitted to data (with a maximum of 5 parameters), regardless to space location (however the input catalog <code>cat.orig</code> must contain  three columns named <code>long</code>, <code>lat, z</code>);
</p>
<p>if <code>is.backconstant=TRUE</code> a process (space-time or time) with a constant background intensity <code class="reqn">\mu</code> is fitted;
</p>
<p>if <code>mu</code> is fixed to a very low value a process with very low background intensity is fitted, that is  with only clustered intensity (useful to fit a model to a single  cluster of events).
</p>
<p>If <code>flp=TRUE</code> the bandwidth for the kernel estimation of the background intensity is evaluated maximizing the  
Forward Likelihood Predictive (FLP) quantity, given by
(Chiodi, Adelfio, 2011; Adelfio, Chiodi, 2013):
</p>
<p style="text-align: center;"><code class="reqn">FLP_{k_1,k_2}(\hat{\boldsymbol{\psi}})\equiv\sum_{k=k_1}^{n-1}\delta_{k,{k+1}}(\hat{\boldsymbol{\psi}}(H_{t_k});
H_{t_{k+1}})</code>
</p>

<p>with <code class="reqn">k_1=\frac{n}{2},k_2=n-1</code> and where <code class="reqn">\delta_{k,k+1}(\hat{\boldsymbol{\psi}}(H_{t_k});
H_{t_{k+1}})</code> is 
the <em>predictive information</em>
of the first <code class="reqn">k</code> observations on the <code class="reqn">k+1</code>-th observation, and is so defined:
</p>
<p style="text-align: center;"><code class="reqn">\delta_{k,k+1}(\hat{\boldsymbol{\psi}}(H_{t_k});
H_{t_{k+1}})\equiv \log L(\hat{\boldsymbol{\psi}}(H_{t_k}); H_{t_{k+1}} )-\log L(\hat{\boldsymbol{\psi}}(H_{t_k});H_{t_k})</code>
</p>

<p>where <code class="reqn">H_k</code> is the  history of the process until time <code class="reqn">t_k</code> and 
<code class="reqn">\hat{\boldsymbol{\psi}}(H_{t_k})</code> is an estimate based only on history until the <code class="reqn">k-th</code> observation.
</p>
<p>In the ML step, the vector of parameter <code class="reqn">\theta=(\mu, \kappa_0, c , p, \alpha, \gamma, d, q)</code> is estimated maximizing the sample log-likelihood given by:
</p>
<p style="text-align: center;"><code class="reqn">\log L(\boldsymbol{\theta}; H_{t_n}) = \sum_{i=1}^{n}
\log \lambda(x_i,y_i,t_i; \boldsymbol{\theta})-
\int_{T_0}^{T_{max}} \int \int_{\Omega_{(x,y)}}\,
\lambda(x,y,t;\boldsymbol{\theta})\,d x \, d y \,d t
</code>
</p>



<h3>Value</h3>

<p>returns an object of class <code>etasclass</code>.
</p>
<p>The main items of the output are:
</p>
<table>
<tr style="vertical-align: top;">
<td><code>this.call</code></td>
<td>
<p>reports the exact call of the function</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>params.ind</code></td>
<td>
<p>indicates which parameters have been estimated (see details)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>params</code></td>
<td>
<p>ML estimates of the ETAS parameters.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>sqm</code></td>
<td>
<p>Estimates of standard errors of the ML estimates of the ETAS parameters (<code>sqm[i]</code>=0 if <code>params.ind[i]</code>=<code>FALSE</code> or where the hessian is not computed or near to singularity). </p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>AIC.iter</code></td>
<td>
<p>AIC values at each iteration.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>hdef</code></td>
<td>
<p>final bandwidth used for the kernel estimation of background spatial intensity (however estimated, with <code>flp=TRUE</code> or <code>flp=FALSE</code>).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>rho.weights</code></td>
<td>
<p>Estimated probability for each event to be a background event (<code class="reqn">\rho</code>).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>time.res</code></td>
<td>
<p>rescaled time residuals (for time processes only).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>params.iter</code></td>
<td>
<p>A matrix with estimates values at each iteration.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>sqm.iter</code></td>
<td>
<p>A matrix with the estimates of the standard errors at each iteration.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>rho.weights.iter</code></td>
<td>
<p>A matrix with the values of <code>rho.weights</code> at each iteration.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>l</code></td>
<td>
<p>A vector with estimated intensities, corresponding to observed points</p>
</td>
</tr>
</table>
<p><code>summary</code>,
<code>print</code> and
<code>plot</code> methods are defined for an object of class <code>etasclass</code> to obtain main output. 
</p>
<p>A <code>profile</code> method (<code>profile.etasclass</code>
) is also defined  to make approximate inference on a single parameter   
</p>


<h3>Note</h3>

<p>In this version the x-y space region, where the point process is defined, is  a rectangle embedding the catalog values.
</p>
<p>The optimization algorithm  depends on the choice of initial values. Some default guess choice is performed 
inside the function for parameters without input starting values; the function <code>etas.starting</code> gives rough first guess for initial values. If convergence problem are experienced, a useful strategy can be starting  with an higher magnitude threshold value <code class="reqn">m_0</code> (that is, with a smaller catalog with bigger earthquakes), and then using this first output as starting  guess for a running with a lower magnitude threshold value <code class="reqn">m_0</code>. 
In this trial executions avoid declustering (<code>declustering=FALSE</code>) or at least use a small value of <code>ndeclust</code>; small values of <code>iterlim</code> and <code>ntheta</code> can speed first executions.
</p>
<p>Quicker executions are obtained using smaller values of <code>iterlim</code> and <code>ntheta</code> in the input.
</p>
<p>Also a first execution with <code>is.backconstant = TRUE</code>, to fit a first approximation model with constant background, can be useful.
</p>
<p>Some other useful information can be obtained estimating a pure time process, that can give a good guess at least for some  parameters, like  <code class="reqn">\mu, \kappa_0, \alpha,c,p</code>.
</p>
<p>Input times are expected in days, and so final intensities are expected number of events per day. If input values are in seconds, then set <code>sectoday=TRUE</code>
</p>


<h3>Author(s)</h3>

<p>Marcello Chiodi, Giada Adelfio</p>


<h3>References</h3>

<p>Adelfio, G. and Chiodi, M. (2013) Mixed estimation technique in semi-parametric space-time point processes for earthquake description. 
<em>Proceedings of the 28th International Workshop on Statistical Modelling 8-13 July, 2013, Palermo</em> (Muggeo V.M.R., Capursi V., Boscaino G., Lovison G., editors). Vol. <b>1</b> pp.65-70. 
</p>
<p>Adelfio G, Chiodi M (2015). Alternated Estimation in Semi-Parametric Space-Time
Branching-Type Point Processes with Application to Seismic Catalogs. <em>Stochastic Environmental Research and Risk Assessment</em>, <b>29</b>(2), 443-450. doi:10.1007/s00477-014-0873-8.
</p>
<p>Adelfio G, Chiodi M (2015). FLP Estimation of Semi-Parametric Models for Space-Time
Point Processes and Diagnostic Tools. <em>Spatial Statistics</em>, <b>14</b>(B), 119-132. doi:10.1016/j.spasta.2015.06.004.
</p>
<p>Adelfio G., Chiodi, M. (2020). Including covariates in a space-time point process with application to seismicity. <em>Statistical Methods and Applications</em>,  doi:10.1007/s10260-020-00543-5.
</p>
<p>Chiodi, M. and Adelfio, G., (2011) Forward Likelihood-based predictive approach for space-time processes. <em>Environmetrics</em>, vol. <b>22</b> (6), pp. 749-757. DOI:10.1002/env.1121.
</p>
<p>Chiodi, M. and Adelfio, G., (2017) Mixed Non-Parametric and Parametric Estimation Techniques in R Package etasFLP for Earthquakes' Description. <em>Journal of Statistical Software</em>, vol. <b>76</b> (3), pp. 1-29.
DOI: 10.18637/jss.v076.i03.
</p>
<p>Zhuang, J., Ogata, Y.  and Vere-Jones, D.
Stochastic declustering of space-time earthquake occurrences.
<em>Journal of the American Statistical Association</em>,
<b>97</b>,  369â€“379 (2002). DOI:10.1198/016214502760046925.
</p>


<h3>See Also</h3>

 <p><code>eqcat</code>, <code>plot.etasclass</code>,<code>print.etasclass</code>, <code>summary.etasclass</code>, <code>profile.etasclass</code>, <code>etas.starting</code></p>


<h3>Examples</h3>

<pre><code class="language-R">## Not run: 
data("italycatalog")
# load a sample catalog of the italian seismicity
esecov1&lt;-etasclass(cat.orig = catalog.withcov, magn.threshold = 2.5, magn.threshold.back = 3.9, 
mu = 0.3, k0 = 0.02, c = 0.015, p = 0.99, gamma = 0, d = 1, 
q = 1.5, params.ind = c(TRUE, TRUE, TRUE, TRUE, FALSE, TRUE, 
TRUE), formula1 = "time ~  magnitude- 1", declustering = TRUE, 
thinning = FALSE, flp = TRUE, ndeclust = 15, onlytime = FALSE, 
is.backconstant = FALSE, sectoday = FALSE, usenlm = TRUE, 
compsqm = TRUE, epsmax = 1e-04, iterlim = 100, ntheta = 36)

# execution of etasclass for events with minimum magnitude of 3.0. 
# The events with magnitude at least 3.5 are used to build a first approximation
# for the background intensity function
# (magn.threshold.back=3.5)
# The magnitude effect is given by the covariate magnitude 
# in the formula "time ~  magnitude- 1"
# magnitude is the internal name for magn1-magn.threshold
# print method for the etasclass object

print(esecov1)

&gt; print(esecov1)
Call: 
 
etasclass(cat.orig = catalog.withcov, magn.threshold = 2.5, magn.threshold.back = 3.9, 
    mu = 0.3, k0 = 0.02, c = 0.015, p = 0.99, gamma = 0, d = 1, 
    q = 1.5, params.ind = c(TRUE, TRUE, TRUE, TRUE, FALSE, TRUE, 
        TRUE), formula1 = "time ~  magnitude- 1", declustering = TRUE, 
    thinning = FALSE, flp = TRUE, ndeclust = 15, onlytime = FALSE, 
    is.backconstant = FALSE, sectoday = FALSE, usenlm = TRUE, 
    compsqm = TRUE, epsmax = 1e-04, iterlim = 100, ntheta = 36)

 
 
 
Number of observations             2226 
ETAS Parameters: 
        mu         k0          c          p      gamma          d          q 
  0.667509   0.022393   0.014769   1.110059   0.000000   1.905461   1.947223 
magnitude 
  0.740109 
# summary method for more informative output etasclass object

summary(esecov1)
# plot results with maps of intensities and diagnostic tools 

plot(esecov1)

## an application with 5 covariates
esecov5&lt;-etasclass(cat.orig = catalog.withcov, magn.threshold = 2.5, magn.threshold.back = 3.9, 
mu = 0.3, k0 = 0.02, c = 0.015, p = 0.99, gamma = 0, d = 1, 
q = 1.5, params.ind = c(TRUE, TRUE, TRUE, TRUE, FALSE, TRUE, TRUE), 
formula1 = "time ~ z + magnitude +nstaloc_rev +min_distance_rev+distmin- 1", 
declustering = TRUE, thinning = FALSE, flp = TRUE, ndeclust = 15, 
onlytime = FALSE, is.backconstant = FALSE, sectoday = FALSE, 
usenlm = TRUE, compsqm = TRUE, epsmax = 1e-04, iterlim = 100, 
ntheta = 36)

## print results, more out put with summary
 print(esecov5)
Call: 
 
etasclass(cat.orig = catalog.withcov, magn.threshold = 2.5, magn.threshold.back = 3.9, 
    mu = 0.3, k0 = 0.02, c = 0.015, p = 0.99, gamma = 0, d = 1, 
    q = 1.5, params.ind = c(TRUE, TRUE, TRUE, TRUE, FALSE, TRUE, 
        TRUE), formula1 = "time ~ z + magnitude +nstaloc_rev +min_distance_rev+distmin- 1", 
    declustering = TRUE, thinning = FALSE, flp = TRUE, ndeclust = 15, 
    onlytime = FALSE, is.backconstant = FALSE, sectoday = FALSE, 
    usenlm = TRUE, compsqm = TRUE, epsmax = 1e-04, iterlim = 100, 
    ntheta = 36)

 
 
 
Number of observations             2226 
ETAS Parameters: 
              mu               k0                c                p 
        0.705351         0.073070         0.019396         1.154186 
           gamma                d                q                z 
        0.000000         1.942929         2.004915        -0.041256 
      magnitude      nstaloc_rev min_distance_rev          distmin 
        1.157698        -0.009010        -0.011020        -1.826717 


## End(Not run)
</code></pre>


</div>