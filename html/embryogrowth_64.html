<div class="container">

<table style="width: 100%;"><tr>
<td>STRN_MHmcmc</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Metropolis-Hastings algorithm for Sexualisation Thermal Reaction Norm</h2>

<h3>Description</h3>

<p>Run the Metropolis-Hastings algorithm for Sexualisation Thermal Reaction Norm.<br>
The number of iterations is n.iter+n.adapt+1 because the initial likelihood is also displayed.<br>
I recommend that thin=1 because the method to estimate SE uses resampling.<br>
If initial point is maximum likelihood, n.adapt = 0 is a good solution.<br>
To get the SE of the point estimates from <code>result_mcmc &lt;- STRN_MHmcmc(result=try)</code>, use:<br><code>result_mcmc$SD</code><br>
coda package is necessary for this function.<br>
The parameters intermediate and filename are used to save intermediate results every 'intermediate' iterations (for example 1000). Results are saved in a file of name filename.<br>
The parameter previous is used to indicate the list that has been save using the parameters intermediate and filename. It permits to continue a mcmc search.<br>
These options are used to prevent the consequences of computer crash or if the run is very very long and processes at time limited.<br>
If fill is NA, it will use the stored fill value in result.<br></p>


<h3>Usage</h3>

<pre><code class="language-R">STRN_MHmcmc(
  result = NULL,
  n.iter = 10000,
  parametersMCMC = NULL,
  n.chains = 1,
  n.adapt = 0,
  thin = 1,
  trace = NULL,
  traceML = FALSE,
  batchSize = sqrt(n.iter),
  adaptive = FALSE,
  adaptive.lag = 500,
  adaptive.fun = function(x) {
     ifelse(x &gt; 0.234, 1.3, 0.7)
 },
  parallel = TRUE,
  intermediate = NULL,
  filename = "intermediate.Rdata",
  previous = NULL,
  fill = NA
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>result</code></td>
<td>
<p>An object obtained after a STRN fit</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>n.iter</code></td>
<td>
<p>Number of iterations for each step</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>parametersMCMC</code></td>
<td>
<p>A set of parameters used as initial point for searching with information on priors</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>n.chains</code></td>
<td>
<p>Number of replicates</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>n.adapt</code></td>
<td>
<p>Number of iterations before to store outputs</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>thin</code></td>
<td>
<p>Number of iterations between each stored output</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>trace</code></td>
<td>
<p>TRUE or FALSE or period, shows progress</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>traceML</code></td>
<td>
<p>TRUE or FALSE to show ML</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>batchSize</code></td>
<td>
<p>Number of observations to include in each batch fo SE estimation</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>adaptive</code></td>
<td>
<p>Should an adaptive process for SDProp be used</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>adaptive.lag</code></td>
<td>
<p>Lag to analyze the SDProp value in an adaptive content</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>adaptive.fun</code></td>
<td>
<p>Function used to change the SDProp</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>parallel</code></td>
<td>
<p>Should parallel computing for info.nests() be used</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>intermediate</code></td>
<td>
<p>Period for saving intermediate result, NULL for no save</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>filename</code></td>
<td>
<p>If intermediate is not NULL, save intermediate result in this file</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>previous</code></td>
<td>
<p>Previous result to be continued. Can be the filename in which intermediate results are saved.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>fill</code></td>
<td>
<p>Parameters to be sent to STRN().</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>STRN_MHmcmc runs the Metropolis-Hastings algorithm for STRN (Bayesian MCMC)
</p>


<h3>Value</h3>

<p>A list with resultMCMC being mcmc.list object, resultLnL being likelihoods and parametersMCMC being the parameters used
</p>


<h3>Author(s)</h3>

<p>Marc Girondot <a href="mailto:marc.girondot@gmail.com">marc.girondot@gmail.com</a>
</p>


<h3>Examples</h3>

<pre><code class="language-R">## Not run: 
library(embryogrowth)
MedIncubation_Cc &lt;- subset(DatabaseTSD, Species=="Caretta caretta" &amp; 
RMU=="Mediterranean" &amp; Sexed!=0)
Med_Cc &lt;- tsd(males=MedIncubation_Cc$Males, 
             females=MedIncubation_Cc$Females, 
             temperatures=MedIncubation_Cc$Incubation.temperature, 
             par=c(P=29.5, S=-0.1))
plot(Med_Cc, xlim=c(25, 35))
males &lt;- c(7, 0, 0, 0, 0, 5, 6, 3, 5, 3, 2, 3, 0, 0, 0, 0, 0, 0, 0, 0, 0)
names(males) &lt;- rev(rev(names(resultNest_4p_SSM$data))[-(1:2)])
sexed &lt;- rep(10, length(males))
names(sexed) &lt;- rev(rev(names(resultNest_4p_SSM$data))[-(1:2)])
Initial_STRN &lt;- resultNest_4p_SSM$par[c("DHA", "DHH", "T12H")]
Initial_STRN &lt;- structure(c(582.567096666926, 2194.0806711639, 3475.28414940385), 
                          .Names = c("DHA", "DHH", "T12H"))
fp &lt;- c(Rho25=100)
fitSTRN &lt;- STRN(Initial_STRN=Initial_STRN, 
                EmbryoGrowthTRN=resultNest_4p_SSM, 
                tsd=Med_Cc, 
                embryo.stages="Caretta caretta.SCL", 
                Sexed=sexed, Males=males, 
                fixed.parameters=fp, 
                sexratio="TSP.GrowthWeighted.STRNWeighted.sexratio")
                
pMCMC &lt;- TRN_MHmcmc_p(fitSTRN, accept=TRUE)
pMCMC[, "Density"] &lt;- "dunif"
pMCMC[, "Prior2"] &lt;- pMCMC[, "Max"]&lt;- 10000
pMCMC[, "Prior1"] &lt;- pMCMC[, "Min"] &lt;- 1
outMCMC &lt;- STRN_MHmcmc(result = fitSTRN, n.iter = 10000, parametersMCMC = pMCMC,
                n.chains = 1, n.adapt = 0, thin = 1, trace = TRUE,
                adaptive = TRUE, adaptive.lag = 500, 
                intermediate = 1000,
                filename = "intermediate_mcmcSTRN.Rdata")
plot(outMCMC, parameters=1)
plot(outMCMC, parameters=2)
plot(outMCMC, parameters=3)
1-rejectionRate(as.mcmc(x = outMCMC))


## End(Not run)
</code></pre>


</div>