<div class="container">

<table style="width: 100%;"><tr>
<td>dsaddle</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Evaluating the Extended Empirical Saddlepoint (EES) density</h2>

<h3>Description</h3>

<p>Gives a pointwise evaluation of the EES density (and optionally of its gradient) at one or more 
locations.
</p>


<h3>Usage</h3>

<pre><code class="language-R">dsaddle(
  y,
  X,
  decay,
  deriv = FALSE,
  log = FALSE,
  normalize = FALSE,
  control = list(),
  multicore = !is.null(cluster),
  ncores = detectCores() - 1,
  cluster = NULL
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>y</code></td>
<td>
<p>points at which the EES is evaluated (d dimensional vector) or an n by d matrix, each row indicating
a different position.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>X</code></td>
<td>
<p>n by d matrix containing the data.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>decay</code></td>
<td>
<p>rate at which the EES falls back on a normal density approximation, fitted to <code>X</code>. 
It must be a positive number, and it is inversely proportional to the complexity of the fit.
Setting it to <code>Inf</code> leads to a Gaussian fit.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>deriv</code></td>
<td>
<p>If TRUE also the gradient of the log-saddlepoint density is returned.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>log</code></td>
<td>
<p>If TRUE the log of the saddlepoint density is returned.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>normalize</code></td>
<td>
<p>If TRUE the normalizing constant of the EES density will be computed. FALSE by 
default.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>control</code></td>
<td>
<p>A list of control parameters with entries:
</p>

<ul>
<li> <p><code>method</code> the method used to calculate the normalizing constant. 
Either "LAP" (laplace approximation) or "IS" (importance sampling).
</p>
</li>
<li> <p><code>nNorm</code> if control$method == "IS", this is the number of importance samples used.
</p>
</li>
<li> <p><code>tol</code> the tolerance used to assess the convergence of the solution to the saddlepoint equation.
The default is 1e-6.
</p>
</li>
<li> <p><code>maxit</code> maximal number of iterations used to solve the saddlepoint equation.
The default is 100;
</p>
</li>
<li> <p><code>ml</code> Relevant only if <code>control$method=="IS"</code>. n random variables are generated from 
a Gaussian importance density with covariance matrix <code>ml*cov(X)</code>. 
By default the inflation factor is <code>ml=2</code>.
</p>
</li>
</ul>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>multicore</code></td>
<td>
<p>if TRUE the empirical saddlepoint density at each row of y will be evaluated in parallel.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>ncores</code></td>
<td>
<p>number of cores to be used.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>cluster</code></td>
<td>
<p>an object of class <code>c("SOCKcluster", "cluster")</code>. This allowes the user to pass her own cluster,
which will be used if <code>multicore == TRUE</code>. The user has to remember to stop the cluster.</p>
</td>
</tr>
</table>
<h3>Value</h3>

<p>A list with entries:
</p>

<ul>
<li> <p><code>llk</code> the value of the EES log-density at each location y;
</p>
</li>
<li> <p><code>mix</code> for each location y, the fraction of saddlepoint used: 
1 means that only ESS is used and 0 means that only a Gaussian fit is used;
</p>
</li>
<li> <p><code>iter</code> for each location y, the number of iteration needed to solve the 
saddlepoint equation;
</p>
</li>
<li> <p><code>lambda</code> an n by d matrix, where the i-th row is the solution of the saddlepoint 
equation corresponding to the i-th row of y;
</p>
</li>
<li> <p><code>grad</code> the gradient of the log-density at y (optional);
</p>
</li>
<li> <p><code>logNorm</code> the estimated log normalizing constant (optional);
</p>
</li>
</ul>
<h3>Author(s)</h3>

<p>Matteo Fasiolo &lt;matteo.fasiolo@gmail.com&gt; and Simon N. Wood.
</p>


<h3>References</h3>

<p>Fasiolo, M., Wood, S. N., Hartig, F. and Bravington, M. V. (2016). 
An Extended Empirical Saddlepoint Approximation for Intractable Likelihoods. ArXiv http://arxiv.org/abs/1601.01849.
</p>


<h3>Examples</h3>

<pre><code class="language-R">library(esaddle)

### Simple univariate example
set.seed(4141)
x &lt;- rgamma(1000, 2, 1)

# Evaluating EES at several point
xSeq &lt;- seq(-2, 8, length.out = 200)
tmp &lt;- dsaddle(y = xSeq, X = x, decay = 0.05, log = TRUE)  # Un-normalized EES
tmp2 &lt;- dsaddle(y = xSeq, X = x, decay = 0.05,             # EES normalized by importance sampling
                normalize = TRUE, control = list("method" = "IS", nNorm = 500), log = TRUE)

# Plotting true density, EES and normal approximation
plot(xSeq, exp(tmp$llk), type = 'l', ylab = "Density", xlab = "x")
lines(xSeq, dgamma(xSeq, 2, 1), col = 3)
lines(xSeq, dnorm(xSeq, mean(x), sd(x)), col = 2)
lines(xSeq, exp(tmp2$llk), col = 4)
suppressWarnings( rug(x) )
legend("topright", c("EES un-norm", "EES normalized", "Truth", "Gaussian"), 
        col = c(1, 4, 3, 2), lty = 1)
</code></pre>


</div>