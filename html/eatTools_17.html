<div class="container">

<table style="width: 100%;"><tr>
<td>mergeAttr</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Merge Two Data Frames with additional messages and maintain variable attributes</h2>

<h3>Description</h3>

<p>This is a wrapper for the <code>merge</code> function. <code>merge</code>
does not maintain variable attributes. <code>mergeAttr</code> might be useful if variable
attributes should be maintained. For example, if SPSS data are imported via
<code>read.spss</code>, variable and value labels are stored
as attributes which get lost if data are merged subsequently. Moreover, function gives
additional messages if (combinations of) by-variables are not unique in at least one data.frame,
or if by-variables have different classes, or if some units of the by-variables are missing in
one of the data sets. Users are free to specify which kind of messages are desirable.</p>


<h3>Usage</h3>

<pre><code class="language-R">mergeAttr(x, y, by = intersect(names(x), names(y)),
      by.x = by, by.y = by, all = FALSE, all.x = all, all.y = all,
      sort = TRUE, suffixes = c(".x",".y"), setAttr = TRUE, onlyVarValLabs = TRUE,
      homoClass = TRUE, unitName = "unit", xName = "x", yName = "y",
      verbose = c("match", "unique", "class", "dataframe", "common", "convert"))</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>x</code></td>
<td>

<p>first data frame to be merged.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>y</code></td>
<td>

<p>second data frame to be merged.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>by</code></td>
<td>

<p>specifications of the columns used for merging
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>by.x</code></td>
<td>

<p>specifications of the columns used for merging
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>by.y</code></td>
<td>

<p>specifications of the columns used for merging
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>all</code></td>
<td>

<p>logical; <code>all = L</code> is shorthand for <code>all.x = L</code> and <code>all.y = L</code>,
where <code>L</code> is either <code>TRUE</code> or <code>FALSE</code>.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>all.x</code></td>
<td>

<p>logical; if <code>TRUE</code>, then extra rows will be added to the output, one for each
row in <code>x</code> that has no matching row in <code>y</code>. These rows will have <code>NAs</code> 
in those columns that are usually filled with values from <code>y</code>. The default 
is <code>FALSE</code>, so that only rows with data from both <code>x</code> and <code>y</code> are 
included in the output.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>all.y</code></td>
<td>

<p>logical; analogous to <code>all.x</code>.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>sort</code></td>
<td>

<p>logical. Should the result be sorted on the <code>by</code> columns?
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>suffixes</code></td>
<td>

<p>a character vector of length 2 specifying the suffixes to be used for making unique
the names of columns in the result which not used for merging (appearing in <code>by</code> etc).
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>setAttr</code></td>
<td>

<p>Logical: restore the variable attributes? If FALSE, the behavior of <code>mergeAttr</code> equals
the behavior of <code>merge</code>.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>onlyVarValLabs</code></td>
<td>

<p>Logical: If TRUE, only the variable and value labels as captured by <code>read.spss</code> and
stored by <code>convertLabel</code> from the <code>eatAnalysis</code> package will be restored.
If FALSE, all variable attributes will be restored.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>homoClass</code></td>
<td>

<p>Logical: Beginning with R version 3.5, <code>merge</code> may give an error if the class of the
by-variables differs in both data.frames. If TRUE, class of by-variable(s) will be homogenized
before merging.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>unitName</code></td>
<td>

<p>Optional: Set the name for the unit variable to get more informative messages. This is mainly
relevant if <code>mergeAttr</code> is called from other functions.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>xName</code></td>
<td>

<p>Optional: Set the name for the x data.frame to get more informative messages. This is mainly
relevant if <code>mergeAttr</code> is called from other functions.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>yName</code></td>
<td>

<p>Optional: Set the name for the y data.frame to get more informative messages. This is mainly
relevant if <code>mergeAttr</code> is called from other functions.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>verbose</code></td>
<td>

<p>Optional: Choose whether messages concerning missing levels in by-variables should be printed
on console (<code>"match"</code>), or messages concerning uniqueness of by-variables (<code>"unique"</code>),
or messages concerning different classes of by-variables (<code>"class"</code>), or messages concerning
appropriate class (<code>data.frame</code>) of <code>x</code> and <code>y</code> (<code>"dataframe"</code>), or messages
concerning additional common variables (except by-variables; <code>"common"</code>)), or messages
concerning converting of tibbles, tbls to data.frames (<code>"convert"</code>). Multiple choices
are possible, e.g. <code>verbose = c("match", "class")</code>. If <code>verbose = TRUE</code>, all
messages are printed, if <code>verbose = FALSE</code>, no messages are printed at all. The default
is equivalent to <code>verbose = TRUE</code>.
</p>
</td>
</tr>
</table>
<h3>Value</h3>

<p>data frame. See the help page of <code>merge</code> for further details.
</p>


<h3>Examples</h3>

<pre><code class="language-R">### data frame 1, variable 'y' with variable.label 'test participation'
df1 &lt;- data.frame ( id = 1:3, sex = factor ( c("male", "male", "female")),
       happy = c("low", "low", "medium"))
attr(df1[,"happy"], "variable.label") &lt;- "happieness in the workplace"

### data frame 2 without labels 
df2 &lt;- data.frame ( id = as.factor(c(2,2,4)), status = factor ( c("married", "married", "single")),
       convicted = c(FALSE, FALSE, TRUE))

### lost label after merging
df3 &lt;- merge(df1, df2, all = TRUE)
attr(df3[,"happy"], "variable.label")

### maintain label
df4 &lt;- mergeAttr(df1, df2, all = TRUE, onlyVarValLabs = FALSE)
attr(df4[,"happy"], "variable.label")

### adapt messages
df5 &lt;- mergeAttr(df1, df2, all = TRUE, onlyVarValLabs = FALSE, unitName = "student",
       xName = "student questionnaire", yName = "school questionnaire",
       verbose = c("match", "unique"))
</code></pre>


</div>