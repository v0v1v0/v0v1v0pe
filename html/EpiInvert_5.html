<div class="container">

<table style="width: 100%;"><tr>
<td>EpiInvert</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>
<code>EpiInvert</code> estimates the reproduction number Rt and a restored 
incidence curve from the original daily incidence curve and the serial 
interval distribution. EpiInvert also corrects the festive and weekly biases 
present in the registered  daily incidence.</h2>

<h3>Description</h3>

<p><code>EpiInvert</code> estimates the reproduction number Rt and a restored 
incidence curve from the original daily incidence curve and the serial 
interval distribution. EpiInvert also corrects the festive and weekly biases 
present in the registered  daily incidence.
</p>


<h3>Usage</h3>

<pre><code class="language-R">EpiInvert(
  incid,
  last_incidence_date,
  festive_days = rep("1000-01-01", 2),
  config = EpiInvert::select_params()
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>incid</code></td>
<td>
<p>The original daily incidence curve (a numeric vector).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>last_incidence_date</code></td>
<td>
<p>The date of the last value of the incidence curve
in the format YYYY-MM-DD. EpiInvert does not 
allow missing values. On days when a country does not report data, a zero must
be registered as the value associated with the incidence of that day.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>festive_days</code></td>
<td>
<p>The festive or anomalous dates in the format YYYY-MM-DD 
(a character vector). In these dates we "a priori" expect that the incidence
value is perturbed.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>config</code></td>
<td>
<p>An object of class <code>estimate_R_config</code>, as returned by 
function <code>select_params</code>. The element of config are : 
</p>

<ul>
<li>
<p>si_distr: a numeric vector with the distribution of the serial 
interval (the default value is an empty vector). If this vector is empty, 
the serial interval is estimated using a parametric shifted log-normal. 
</p>
</li>
<li>
<p>shift_si_distr: shift of the above user provided serial interval. 
This shift can be negative, which means that secondary cases can show 
symptoms before the primary cases (the default value is 0). 
</p>
</li>
<li>
<p>max_time_interval: Maximum number of days used by 
EpiInvert (the default value is 150, which means that EpiInvert uses the 
last 150 days. The computational cost strongly depends on this value). 
</p>
</li>
<li>
<p>mean_si: mean of the parametric shifted log-normal to approximate
the serial interval (in the case the above si_distr vector is empty),
(the default value is 12.267893). 
</p>
</li>
<li>
<p>sd_si: standard deviation of the parametric shifted log-normal to 
approximate the serial interval (in the case the above si_distr vector is empty),
(the default value is  5.667547). 
</p>
</li>
<li>
<p>shift_si=: shift of the parametric shifted log-normal to approximate
the serial interval (in the case the above si_distr vector is empty),
(the default value is -5). 
</p>
</li>
<li>
<p>Rt_regularization_weight: regularization weight for Rt in the 
variational model used by EpiInvert (the default value is 5). 
</p>
</li>
<li>
<p>seasonality_regularization_weight: regularization weight for the 
weekly bias correction factors in the variational model used by EpiInvert (the default value is 5).
</p>
</li>
<li>
<p>incidence_weekly_aggregated: a boolean value which determines if we use weekly aggregated 
incidence. In such case  every week a single data is stored with the accumulated incidence in the last 
7 days (the default value is FALSE).
</p>
</li>
<li>
<p>NweeksToKeepIncidenceSum: number of weeks to keep the value of the incidence accumulation. 
The default is 2.
</p>
</li>
</ul>
</td>
</tr>
</table>
<h3>Details</h3>

<p>EpiInvert estimates the reproduction number Rt and a 
restored incidence curve by inverting the renewal equation : 
</p>
<p style="text-align: center;"><code class="reqn">{i(t) = \sum_k i(t-k)R(t-k)\Phi(k)}</code>
</p>

<p>using a variational 
formulation. The theoretical foundations of the method can be found 
in references [1] and [2].
</p>


<h3>Value</h3>


<p>an object of class <code>estimate_EpiInvert</code>, given by a list with 
components:
</p>

<ul>
<li>
<p>i_original: the original daily incidence curve. In the case of weekly aggregated incidence, 
we initialize the original curve assigning each day of the week 1/7 of the weekly aggregated value.
</p>
</li>
<li>
<p>i_festive: the incidence after correction of the festive days bias.
</p>
</li>
<li>
<p>i_bias_free: the incidence after correction of the festive and 
weekly biases.
</p>
</li>
<li>
<p>i_restored: the restored incidence obtained using the renewal 
equation.
</p>
</li>
<li>
<p>Rt: the reproduction number Rt obtained by inverting the renewal 
equation.
</p>
</li>
<li>
<p>Rt_CI95: 95% confidence interval radius for the value of Rt taking 
into account the variation of Rt when more days are added to the estimation. 

</p>
</li>
<li>
<p>seasonality: the weekly bias correction factors.
</p>
</li>
<li>
<p>dates: a vector of dates corresponding to the incidence curve. 
</p>
</li>
<li>
<p>festive: boolean associated to each incidence value to check if it 
has been considered as a festive or anomalous day. 
</p>
</li>
<li>
<p>epsilon: normalized error curve obtained as 
(i_bias_free-i_restored)/i_restored^a.
</p>
</li>
<li>
<p>power_a: the power, a, which appears in the above expression of the 
normalized error. 
</p>
</li>
<li>
<p>si_distr: values of the distribution of the serial interval used in
the EpiInvert estimation.
</p>
</li>
<li>
<p>shift_si_distr: shift of the above distribution of the serial 
interval si_distr.
</p>
</li>
</ul>
<h3>Author(s)</h3>

<p>Luis Alvarez <a href="mailto:lalvarez@ulpgc.es">lalvarez@ulpgc.es</a>
</p>


<h3>References</h3>


<p>[1] Alvarez, L.; Colom, M.; Morel, J.D.; Morel, J.M. Computing the daily 
reproduction number of COVID-19 by inverting the renewal
equation using a variational technique. Proc. Natl. Acad. Sci. USA, 2021.
</p>
<p>[2] Alvarez, Luis, Jean-David Morel, and Jean-Michel Morel. "Modeling 
COVID-19 Incidence by the Renewal Equation after Removal of Administrative 
Bias and Noise" Biology 11, no. 4: 540. 2022. 
</p>
<p>[3] Ritchie, H. et al. Coronavirus Pandemic (COVID-19), OurWorldInData.org. 
Available online: 
https://ourworldindata.org/coronavirus-source-data 
(accessed on 5 May 2022).
</p>



<h3>Examples</h3>

<pre><code class="language-R">## load data on COVID-19 daily incidence up to 2022-05-05 for France, 
## and Germany (taken from the official government data) and for UK and 
## the USA taken from reference [3]
data(incidence)

## EpiInvert execution for USA with no festive days specification
## using the incidence 70 days in the past
res &lt;- EpiInvert(incidence$USA,
"2022-05-05",
"1000-01-01",
select_params(list(max_time_interval = 70))
)

## Plot of the results
EpiInvert_plot(res)

## load data of festive days for France, Germany, UK and the USA
data(festives)

## EpiInvert execution for France with festive days specification using
## 70 days in the past 
res &lt;- EpiInvert(incidence$FRA,"2022-05-05",festives$FRA,
                 select_params(list(max_time_interval = 70)))

## Plot of the incidence between "2022-04-01" and "2022-05-01"
EpiInvert_plot(res,"incid","2022-04-01","2022-05-01")

## load data of a serial interval
data("si_distr_data")

## EpiInvert execution for Germany using the uploaded serial interval shifted
## -2 days, using the incidence 70 days in the past
res &lt;- EpiInvert(incidence$DEU,"2022-05-05",festives$DEU,
       EpiInvert::select_params(list(si_distr = si_distr_data,
       shift_si_distr=-2,max_time_interval = 70)))
       
## Plot of the serial interval used (including the shift)
EpiInvert_plot(res,"SI")     
       
## EpiInvert execution for UK changing the default values of the parametric
## serial interval (using a shifted log-normal) using 70 days in the past
res &lt;- EpiInvert(incidence$UK,"2022-05-05",festives$UK,
       EpiInvert::select_params(list(mean_si = 11,sd_si=6,shift_si=-1,max_time_interval = 70))
       )
       
## Plot of the reproduction number Rt including an empiric 95\% confidence 
## interval of the variation of Rt. To calculate Rt on each day t, EpiInvert 
## uses the past days (t'&lt;=t) and the future days (t'&gt;t) when available. 
## Therefore, the EpiInvert estimate of Rt varies when there are more days 
## available. This confidence interval reflects the expected variation of Rt 
## as a function of the number of days after t available.
EpiInvert_plot(res,"R")

</code></pre>


</div>