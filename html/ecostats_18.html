<div class="container">

<table style="width: 100%;"><tr>
<td>qqenvelope</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Normal Quantile-Quantile Plots with Global Simulation Envelopes</h2>

<h3>Description</h3>

<p>Produces a normal QQ plot of data, or of residuals from a fitted model <code>y</code>, with a user-specified 
line to compare to "theoretical" quantiles, and global envelopes constructed
by simulating new residuals. Global envelopes are constructed using the
<code>GET</code> package for simultaneous control of error rates over the whole curve.
</p>


<h3>Usage</h3>

<pre><code class="language-R">qqenvelope(y, n.sim = 199, conf.level = 0.95, ylab = "Sample Quantiles", ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>y</code></td>
<td>
<p>can be a set of values for which we wish to check (multivariate) normality, 
or it can be <em>any</em> object that responds to the <code>residuals</code>, <code>simulate</code> and <code>update</code>
functions.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>n.sim</code></td>
<td>
<p>the number of simulated sets of residuals to be generated, to which
the observed residuals will be compared. The default is 199 datasets.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>conf.level</code></td>
<td>
<p>the confidence level to use in constructing the envelope.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>ylab</code></td>
<td>
<p><code>y</code> axis label (if a plot is produced).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>further arguments sent through to <code>plotenvelope</code></p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>A challenge when interpreting a <code>qqplot</code> is understanding the extent to which
deviations from expected values could be due to random noise (sampling variation)
rather than actual assumption violations. This function is intended to assess this, 
by simulating multiple realizations of residuals in situations where assumptions 
are satisfied, and plotting a global (or "simultaneous") simulation envelope around these at level <code>conf.level</code>.
All data points should lie if assumptions are satisfied, and will do so for a proportion <code>conf.level</code> of
datasets which satisfy their assumptions.
</p>
<p>This function can take data (univariate or multivariate) and check for (multivariate)
normality, or it can take a fitted model and use qq plots to interrogate residuals and
see if they are behaving as we would expect them to if the model were true.
</p>
<p>The envelope is global, constructed using the <code>GET-package</code>. So if <em>any</em> data points lie outside the
envelope we have evidence that assumptions are not satisfied. 
The <code>GET-package</code> was originally constructed to place envelopes around functions, motivated by
the problem of diagnostic testing of spatial processes (Myllymäki et al 2017), but it can equally
well be applied here, by treating sorted residuals as point-wise evaluations of a function.
</p>
<p>For further details refer to <code>plotenvelope</code>, which is called to construct the plot.
</p>


<h3>Value</h3>

<p>a qqplot with simulation envelope is returned, and additionally:
</p>
<table>
<tr style="vertical-align: top;">
<td><code>x</code></td>
<td>
<p>a vector of theoretical quantiles from the standard normal sorted from
smallest to largest</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>y</code></td>
<td>
<p>a vector of observed residuals sorted from smallest to largest</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>lo</code></td>
<td>
<p>lower bounds on the global simulation envelope for residuals</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>hi</code></td>
<td>
<p>upper bounds on the global simulation envelope for residuals</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>p.value</code></td>
<td>
<p>A <em>P</em>-value for the test that model assumptions are correct,
using a 'parametric bootstrap' test, based on how far sample residuals depart from
the values expected of them if model assumptions were satisfied.</p>
</td>
</tr>
</table>
<h3>Author(s)</h3>

<p>David Warton &lt;david.warton@unsw.edu.au&gt;
</p>


<h3>References</h3>

<p>Myllymäki, M., Mrkvička, T., Grabarnik, P., Seijo, H. and Hahn, U. (2017), Global envelope tests for spatial processes. J. R. Stat. Soc. B, 79: 381-404. doi:10.1111/rssb.12172
Warton DI (2022) Eco-Stats - Data Analysis in Ecology, from <em>t</em>-tests to multivariate abundances. Springer, ISBN 978-3-030-88442-0
</p>


<h3>See Also</h3>

<p><code>qqnorm</code>, <code>qqline</code>, <code>plotenvelope</code>
</p>


<h3>Examples</h3>

<pre><code class="language-R"># simulate some data and fit a qq plot:
y=rnorm(20)
qqenvelope(y)

# fit a multivariate linear model to the iris dataset:
data(iris)
Y = with(iris, cbind(Sepal.Length,Sepal.Width,Petal.Length,Petal.Width))
iris.mlm=lm(Y~Species,data=iris)
# check normality assumption:
qqenvelope(iris.mlm,n.sim=79)

</code></pre>


</div>