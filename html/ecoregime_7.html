<div class="container">

<table style="width: 100%;"><tr>
<td>deviation_metrics</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Metrics of trajectory deviation with respect to a reference trajectory</h2>

<h3>Description</h3>

<p>Set of metrics to analyze the deviation of disturbed trajectories from an
ecological dynamic regime (EDR) considering a representative trajectory as the
reference. These metrics include the resistance to the disturbance, amplitude,
recovery, and net change.
</p>


<h3>Usage</h3>

<pre><code class="language-R">resistance(
  d,
  trajectories,
  states,
  disturbed_trajectories,
  disturbed_states,
  predisturbed_states = disturbed_states - 1
)

amplitude(
  d,
  trajectories,
  states,
  disturbed_trajectories,
  disturbed_states,
  predisturbed_states = disturbed_states - 1,
  reference,
  index = c("absolute", "relative"),
  method = "nearest_state"
)

recovery(
  d,
  trajectories,
  states,
  disturbed_trajectories,
  disturbed_states,
  reference,
  index = c("absolute", "relative"),
  method = "nearest_state"
)

net_change(
  d,
  trajectories,
  states,
  disturbed_trajectories,
  disturbed_states,
  predisturbed_states = disturbed_states - 1,
  reference,
  index = c("absolute", "relative"),
  method = "nearest_state"
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>d</code></td>
<td>
<p>Either a symmetric matrix or an object of class <code>dist</code> containing the
dissimilarities between each pair of states.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>trajectories</code></td>
<td>
<p>Vector indicating the trajectory or site to which each
state in <code>d</code> belongs.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>states</code></td>
<td>
<p>Vector of integers indicating the order of the states in <code>d</code> for
each trajectory.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>disturbed_trajectories</code></td>
<td>
<p>Vector of the same class as <code>trajectories</code> indicating
the identifier of the disturbed trajectories.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>disturbed_states</code></td>
<td>
<p>Vector of integers included in <code>states</code>indicating the
first state after the release of the disturbance for each value in
<code>disturbed_trajectories</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>predisturbed_states</code></td>
<td>
<p>Vector of integers included in <code>states</code> indicating
the last undisturbed state of each <code>disturbed_trajectories</code>. The previous states
to <code>disturbed_states</code> are considered by default.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>reference</code></td>
<td>
<p>Object of class <code>RETRA</code> indicating the representative trajectory
taken as the reference to compute the amplitude, recovery, and net_change of
the disturbed trajectories (see Details).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>index</code></td>
<td>
<p>Method to calculate amplitude, recovery, or net change (<code>"absolute"</code>,
<code>"relative"</code>; see Details).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>method</code></td>
<td>
<p>Method to calculate the distance between the <code>disturbed_states</code>
or <code>predisturbed_states</code> and the <code>reference</code> trajectory. One of <code>"nearest_state"</code>,
<code>"projection"</code> or <code>"mixed"</code> (see Details).</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p><strong>Resistance (<code>resistance()</code>)</strong>
</p>
<p><em>Resistance</em> captures the immediate impact of the disturbance as a function
of the changes in the state variables (Sánchez-Pinillos et al., 2019).
</p>
<p><code class="reqn">
Rt = 1 - d_{pre,dist}
</code>
</p>
<p><strong>Amplitude (<code>amplitude()</code>)</strong>
</p>
<p><em>Amplitude</em> indicates the direction in which the system is displaced during the
disturbance in relation to the <code>reference</code> (Sánchez-Pinillos et al., 2024).
Positive values indicate that the disturbance displaces the system towards the
boundaries of the dynamic regime. Negative values indicate that the disturbance
displaces the system towards the representative trajectory.
</p>
<p>Two indices can be calculated:
</p>
<p>If <code>index = "absolute"</code>,
</p>
<p><code class="reqn">
A = d_{dist,RT} - d_{pre,RT}
</code>
</p>
<p>If <code>index = "relative"</code>,
</p>
<p><code class="reqn">
A = \frac{d_{dist,RT} - d_{pre,RT}}{d_{pre,dist}}
</code>
</p>
<p><strong>Recovery (<code>recovery()</code>)</strong>
</p>
<p><em>Recovery</em> quantifies the ability of the system to evolve towards the <code>reference</code>
following the relief of the disturbance (if positive) or move in the direction
of the boundaries of the dynamic regime (if negative) (Sánchez-Pinillos et al.,
2024).
</p>
<p>Two indices can be calculated:
</p>
<p>If <code>index = "absolute"</code>,
</p>
<p><code class="reqn">
Rc = d_{dist,RT} - d_{post,RT}
</code>
</p>
<p>If <code>index = "relative"</code>,
</p>
<p><code class="reqn">
Rc = \frac{d_{dist,RT} - d_{post,RT}}{d_{dist,post}}
</code>
</p>
<p><strong>Net change (<code>net_change()</code>)</strong>
</p>
<p><em>Net change</em> quantifies the proximity of the system to the <code>reference</code> relative to
the pre-disturbed state (Sánchez-Pinillos et al., 2024). Positive values indicate
that the system eventually evolves towards the boundaries of the dynamic regime.
Negative values indicate that the system eventually evolves towards the
<code>reference</code>.
</p>
<p>Two indices can be calculated:
</p>
<p>If <code>index = "absolute"</code>,
</p>
<p><code class="reqn">
NC = d_{post,RT} - d_{pre,RT}
</code>
</p>
<p>If <code>index = "relative"</code>,
</p>
<p><code class="reqn">
NC = \frac{d_{post,RT} - d_{pre,RT}}{d_{pre,post}}
</code>
</p>
<p>In all cases:
</p>

<ul>
<li> <p><code class="reqn">d_{pre,RT}</code> is the dissimilarity between the <code>predisturbed_states</code> and
the <code>reference</code>.
</p>
</li>
<li> <p><code class="reqn">d_{dist,RT}</code> is the dissimilarity between the <code>disturbed_states</code> and
the <code>reference</code>.
</p>
</li>
<li> <p><code class="reqn">d_{post,RT}</code> is the dissimilarity between the states after <code>disturbed_states</code>
and the <code>reference</code>.
</p>
</li>
<li> <p><code class="reqn">d_{pre,dist}</code> is the dissimilarity contained in <code>d</code> between the
<code>predisturbed_states</code> and the <code>disturbed_states</code>.
</p>
</li>
<li> <p><code class="reqn">d_{dist,post}</code> is the dissimilarity contained in <code>d</code> between the
<code>disturbed_states</code> and the post-disturbed states.
</p>
</li>
<li> <p><code class="reqn">d_{pre,post}</code> is the dissimilarity contained in <code>d</code> between the
<code>predisturbed_states</code> and the post-disturbed states.
</p>
</li>
</ul>
<p><code class="reqn">d_{pre,RT}</code>, <code class="reqn">d_{dist,RT}</code>, and <code class="reqn">d_{post,RT}</code> are calculated using
the function <code>state_to_trajectory()</code> by three different methods:
</p>

<ul>
<li>
<p> If <code>method = "nearest_state"</code>, <code class="reqn">d_{pre,RT}</code>, <code class="reqn">d_{dist,RT}</code>, and
<code class="reqn">d_{post,RT}</code> are calculated as the dissimilarity between the pre-disturbance,
disturbed, or post-disturbance states and their nearest state in the  <code>reference</code>.
</p>
</li>
<li>
<p> If <code>method = "projection"</code>, <code class="reqn">d_{pre,RT}</code>, <code class="reqn">d_{dist,RT}</code>, and
<code class="reqn">d_{post,RT}</code> are calculated as the dissimilarity between the pre-disturbance,
disturbed, or post-disturbance states and their projection onto the <code>reference</code>.
</p>
</li>
<li>
<p> If <code>method = "mixed"</code>, <code class="reqn">d_{pre,RT}</code>, <code class="reqn">d_{dist,RT}</code>, and <code class="reqn">d_{post,RT}</code>
are calculated in the same way than <code>method = "projection"</code> whenever the
pre-disturbance, disturbed and post-disturbance states can be projected onto
any segment of the <code>reference</code>. Otherwise, <code class="reqn">d_{pre,RT}</code>, <code class="reqn">d_{dist,RT}</code>,
and <code class="reqn">d_{post,RT}</code> are calculated using the nearest state of the <code>reference</code>.
</p>
</li>
</ul>
<h3>Value</h3>


<ul>
<li> <p><code>resistance()</code> returns a data frame of two columns indicating the resistance
value (<code>Rt</code>) for each <code>disturbed_trajectory</code>.
</p>
</li>
<li> <p><code>amplitude()</code> returns a data frame of three columns indicating the amplitude
value (<code>A_abs</code>; <code>A_rel</code>) for each <code>disturbed_trajectory</code> and <code>reference</code>.
If <code>index = c("absolute", "relative")</code>, both values are included in a data
frame of four columns.
</p>
</li>
<li> <p><code>recovery()</code> returns a data frame of four columns indicating the recovery
value (<code>Rc_abs</code>; <code>Rc_rel</code>) for each <code>disturbed_trajectory</code>, post-disturbance
state (<code>state</code>) and <code>reference</code>. If <code>index = c("absolute", "relative")</code>, both
values are included in a data frame of five columns.
</p>
</li>
<li> <p><code>net_change</code> returns a data frame of four columns indicating the net change
value (<code>NC_abs</code>; <code>NC_rel</code>) for each <code>disturbed_trajectory</code>, post-disturbance
state (<code>state</code>), and <code>reference</code>. If <code>index = c("absolute", "relative")</code>, both
values are included in a data frame of five columns.
</p>
</li>
</ul>
<h3>Author(s)</h3>

<p>Martina Sánchez-Pinillos
</p>


<h3>References</h3>

<p>Sánchez-Pinillos, M., Leduc, A., Ameztegui, A., Kneeshaw, D., Lloret, F., &amp; Coll, L.
(2019). Resistance, resilience or change: Post-disturbance dynamics of boreal
forests after insect outbreaks. <em>Ecosystems</em> 22, 1886-1901
https://doi.org/10.1007/s10021-019-00378-6
</p>
<p>Sánchez-Pinillos, M., Dakos, V., &amp; Kéfi, S. (2024). Ecological dynamic regimes:
A key concept for assessing ecological resilience. <em>Biological Conservation</em>
289, 110409 https://doi.org/10.1016/j.biocon.2023.110409
</p>


<h3>See Also</h3>

<p><code>retra_edr()</code> to identify representative trajectories in an ecological dynamic
regime.
</p>
<p><code>define_retra()</code> to generate an object of class<code>RETRA</code>.
</p>
<p><code>state_to_trajectory()</code> to calculate the position of a state with respect to
a trajectory.
</p>


<h3>Examples</h3>

<pre><code class="language-R"># Identify the representative trajectories of the EDR from undisturbed trajectories
RT &lt;- retra_edr(d = EDR_data$EDR3$state_dissim,
                trajectories = EDR_data$EDR3$abundance$traj,
                states = as.integer(EDR_data$EDR3$abundance$state),
                minSegs = 5)

# Abundance matrix including disturbed and undisturbed trajectories
abundance &lt;- rbind(EDR_data$EDR3$abundance,
                   EDR_data$EDR3_disturbed$abundance, fill = TRUE)

# State dissimilarities (Bray-Curtis) for disturbed and undisturbed trajectories
d &lt;- vegan::vegdist(abundance[, paste0("sp", 1:12)], method = "bray")

# Resistance
Rt &lt;- resistance(d = d, trajectories = abundance$traj, states = abundance$state,
                 disturbed_trajectories = unique(abundance[!is.na(disturbed_states)]$traj),
                 disturbed_states = abundance[disturbed_states == 1]$state)

# Amplitude
A &lt;- amplitude(d = d, trajectories = abundance$traj, states = abundance$state,
               disturbed_trajectories = unique(abundance[!is.na(disturbed_states)]$traj),
               disturbed_states = abundance[disturbed_states == 1]$state, reference = RT)

# Recovery
Rc &lt;- recovery(d = d, trajectories = abundance$traj, states = abundance$state,
               disturbed_trajectories = unique(abundance[!is.na(disturbed_states)]$traj),
               disturbed_states = abundance[disturbed_states == 1]$state, reference = RT)

# Net change
NC &lt;- net_change(d = d, trajectories = abundance$traj, states = abundance$state,
                 disturbed_trajectories = unique(abundance[!is.na(disturbed_states)]$traj),
                 disturbed_states = abundance[disturbed_states == 1]$state, reference = RT)

</code></pre>


</div>