<div class="container">

<table style="width: 100%;"><tr>
<td>identify_inconsistency</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Identify inconsistencies in a dataset</h2>

<h3>Description</h3>

<p>Tests pairs of variables for consistency between their values according to
a table of rules or 'consistency table'.
</p>


<h3>Usage</h3>

<pre><code class="language-R">identify_inconsistency(data = NULL, consis_tbl = NULL, id_var = NULL)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>data</code></td>
<td>
<p>data frame which will be checked for internal consistency</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>consis_tbl</code></td>
<td>
<p>data frame or tibble containing information on internal
consistency rules (see "Consistency Table Requirements" section)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>id_var</code></td>
<td>
<p>An unquoted expression which corresponds to a variable in
<code>data</code> which identifies each row.</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>Multiple types of checks for inconsistency are supported:
</p>

<ol>
<li>
<p> Comparing by logical operators (&lt;, &lt;=, ==, !=, &gt;=, &gt;)
</p>
</li>
<li>
<p> Comparing permitted categories (e.g. cat1 in varA only if cat2 in varB)
</p>
</li>
<li>
<p> Comparing permitted numeric ranges (e.g. 20-25 in varC only if 10-20 in
varD)
</p>
</li>
<li>
<p> Mixtures of 2 and 3 (e.g. cat1 in varA only if 20-25 in varC) 
</p>
</li>
</ol>
<p>The consistency tests rely on such rules being specified in a
separate data frame (<code>consis_tbl</code>; see section "Consistency Table Requirements").
</p>
<p>Variable A is given higher priority than Variable B when A is a category. If A
(as char) is not equal to the value in col 4, the check is not made. This is
to account for one way dependencies (i.e. VarA is fruit, VarB is apple)
</p>


<h3>Value</h3>

<p>tibble detailing any identified internal inconsistencies in
<code>data</code>, if any are found. If no inconsistencies are found, <code>data</code>
is returned invisibly.
</p>


<h3>Consistency Table Requirements</h3>

<p>Table must have exactly five character columns.
The columns should be ordered according to the list below which describes the
values of each column:
</p>

<ol>
<li>
<p> First column name of data values that will be subject to 
consistency checking. String. Required.
</p>
</li>
<li>
<p> Second column name of data values that will be subject to 
consistency checking. String. Required.
</p>
</li>
<li>
<p> Logical test to compare columns one and two. One of: "&gt;","&gt;=",
"&lt;","&lt;=","==", "!=". String. Optional if columns 4 and 5 have non-<code>NA</code> values.
</p>
</li>
<li>
<p> Either a single character string or a colon-separated range of
numbers which should only appear in column A. Optional if column 3 has a
non-<code>NA</code> value.
</p>
</li>
<li>
<p> Either a single character string or a colon-separated range of
numbers which should only appear in column B given the value/range
specified in column 4. Optional if column 3 has a non-<code>NA</code> value.
</p>
</li>
</ol>
<p>Each row should detail one test to make.
Therefore, either column 3 or columns 4 and 5 must contain non-<code>NA</code>
values.
</p>


<h3>See Also</h3>

<p>Other internal consistency functions: 
<code>validate_consistency_tbl()</code>
</p>


<h3>Examples</h3>

<pre><code class="language-R">require(tibble)
# example with synthetic dataset on number of bean counts
# there is a lot going on in the function so a simple dataset aids this example
#
# creating `data`:
beans &lt;- tibble::tibble(red_beans = 1:15,
blue_beans = 1:15,
total_beans = 1:15*2,
red_bean_summary = c(rep("few_beans",9), rep("many_beans",6)))
#
# creating `consis_tbl`
bean_rules &lt;- tibble::tribble(~varA, ~varB, ~lgl_test, ~varA_boundaries, ~varB_boundaries,
"red_beans", "blue_beans", "==", NA, NA,
"red_beans", "total_beans", "&lt;=", NA,NA,
"red_beans", "red_bean_summary", NA, "1:9", "few_beans",
"red_beans", "red_bean_summary", NA, "10:15", "many_beans")

identify_inconsistency(beans, bean_rules)

# creating some inconsistencies as examples
beans[1, "red_bean_summary"] &lt;- "many_beans"
beans[1, "red_beans"] &lt;- 10

identify_inconsistency(beans, bean_rules)

</code></pre>


</div>