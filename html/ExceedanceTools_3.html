<div class="container">

<table style="width: 100%;"><tr>
<td>confreg</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Construct confidence regions for exceedance (excursion) sets.</h2>

<h3>Description</h3>

<p><code>confreg</code> constructs confidence regions for the exceedance (excursions) sets of geostatistical processes.  These will actually be credible regions if <code>obj</code> contains samples from the joint posterior predictive distribution in a Bayesian setting.
</p>


<h3>Usage</h3>

<pre><code class="language-R">confreg(
  obj,
  level,
  statistic = NULL,
  conf.level = 0.95,
  direction = "&gt;",
  type = "o",
  method = "test",
  greedy = FALSE
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>obj</code></td>
<td>
<p>An object of the appropriate type (<code>matrix</code>, <code>krigeConditionalSample</code>, or <code>jointPredictiveSample</code>.  See Details.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>level</code></td>
<td>
<p>The threshold level for the exceedance region.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>statistic</code></td>
<td>
<p>The statistic used in constructing the confidence region.  Should be a vector containing a value for each location</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>conf.level</code></td>
<td>
<p>The confidence level of the confidence region.  Default is 0.95.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>direction</code></td>
<td>
<p>The direction of the exceedance region.  <code>"&gt;"</code> indicates the exceedance region is values above a threshold, while <code>"&lt;"</code> indicates values below a threshold.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>type</code></td>
<td>
<p><code>"o"</code> indicates on outer confidence region while <code>"i"</code> indicates in inner confidence region.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>method</code></td>
<td>
<p><code>"test"</code> indicates a testing-based method, while <code>"direct"</code> indicates a direct method using joint probabilities.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>greedy</code></td>
<td>
<p>Only applicable for the direct construction method.  Default is <code>FALSE</code>.  If <code>TRUE</code>, then grid cells are added to the confidence region using a greedy algorithm based on joint probability.</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p><code>obj</code> can be an object of class <code>matrix</code>,  <code>krigeConditionalSample</code>, or <code>jointPredictiveSample</code>.  If <code>obj</code> is a <code>matrix</code>, then it should have <code>m</code> rows and <code>nsim</code> columns.  In that case, each row of <code>obj</code> corresponds to a sample from the conditional distribution of the response conditional on the observed data.  Each row represents a different location.  Generally, these locations are assumed to be on a grid spanning the spatial domain of interest.  A <code>krigeConditionalSample</code> object can be obtained using the <code>krige.sk</code>, <code>krige.ok</code>, 
or <code>krige.uk</code> functions in the <code>SpatialTools</code> package.  In these functions, the <code>nsim</code> argument must be greater than 0, and indicates the number of samples used to construct the confidence region.  A <code>jointPredictiveSample</code> object can be obtained using the <code>spLMPredictJoint</code> function in the <code>SpatialTools</code> package.  Since this is in the context of Bayesian statistics, the function actually produces credible region.  
</p>
<p>If <code>statistic</code> is supplied for the direct construction procedure, then the locations are ordered by marginal probability and then the statistic.  <code>statistic</code> should be a vector of length <code>m</code>, where <code>m</code> is the number of prediction locations at which samples were drawn for in <code>obj</code>.
</p>
<p>If type == <code>"o"</code>, then an outer credible region is constructed.  The outer credible region should entirely contain the true exceedanace region with the specified posterior probability.  If type == <code>"i"</code>, then an inner credible region is constructed.  The inner confidence region should be entirely contained within the true exceedanace region with specified posterior probability.
</p>


<h3>Value</h3>

<p>Returns an object of class <code>confreg</code> with the following components: 
</p>
<table>
<tr style="vertical-align: top;">
<td><code>confidence</code></td>
<td>
<p>The sites included in the confidence region.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>complement</code></td>
<td>
<p>The complement of the confidence region.</p>
</td>
</tr>
</table>
<h3>Author(s)</h3>

<p>Joshua French
</p>


<h3>References</h3>

<p>Joshua P. French and Stephan R. Sain (2013).
Spatio-temporal exceedance locations and confidence
regions.  Annals of Applied Statistics.  7(3):1421-1449.
</p>
<p>French, J. P. (2014), Confidence regions for the level
curves of spatial data, Environmetrics, 25, pages
498–512, DOI: 10.1002/env.2295
</p>
<p>French, J. P., and Hoeting, J. A. (2016) Credible regions
for exceedance sets of geostatistical data.
Environmetrics, 27: 4–14. doi: 10.1002/env.2371.
</p>


<h3>Examples</h3>

<pre><code class="language-R"># Set parameters
n &lt;- 100
mygrid = create.pgrid(0, 1, 0, 1, nx = 5, ny = 4)
n.samples &lt;- 10
burnin.start &lt;- 1
sigmasq &lt;- 1
tausq &lt;- 0.0
phi &lt;- 1
cov.model &lt;- "exponential"
n.report &lt;- 5

# Generate coordinates
coords &lt;- matrix(runif(2 * n), ncol = 2) 
pcoords &lt;- mygrid$pgrid
# Construct design matrices
X &lt;- as.matrix(cbind(1, coords))
Xp &lt;- cbind(1, pcoords)

# Specify priors
starting &lt;- list("phi" = phi, "sigma.sq"= sigmasq, "tau.sq" = tausq)
tuning &lt;- list("phi"=0.1, "sigma.sq"=0.1, "tau.sq"=0.1)
priors.1 &lt;- list("beta.Norm"=list(c(1, 2, 1), diag(100, 3)), "phi.Unif"=c(0.00001, 10), 
 "sigma.sq.IG"=c(1, 1))

# Generate data
library(SpatialTools)
B &lt;- rnorm(3, c(1, 2, 1), sd = 10)
phi &lt;- runif(1, 0, 10)
sigmasq &lt;- 1/rgamma(1, 1, 1)
V &lt;- simple.cov.sp(D = dist1(coords), cov.model, c(sigmasq, 1/phi), error.var = tausq, 
 smoothness = nu, finescale.var = 0)
y &lt;- X %*% B + rmvnorm(1, rep(0, n), V) + rnorm(n, 0, sqrt(tausq))

# Create spLM object
library(spBayes)
m1 &lt;- spBayes::spLM(y ~ X - 1, coords = coords, starting = starting, tuning = tuning, 
 priors = priors.1, cov.model = cov.model, n.samples = n.samples, verbose = FALSE,
 n.report = n.report)

# Sample from joint posterior predictive distribution
y1 &lt;- spLMPredictJoint(m1, pred.coords = pcoords, pred.covars = Xp, 
 start = burnin.start, verbose = FALSE, method = "chol")
 u = quantile(y, .5)
myfun = function(x)
{
    (mean(x) - u)/sd(x)
}

myfun2 = function(x)
{
 mean(x &gt; u)
}

stat1 = apply(y1, 1, myfun)
stat2 = apply(y1, 1, myfun2)

myconf = confreg(y1, level = u, statistic = NULL, direction = "&gt;", type = "o", method = "direct")
myconf2 = confreg(y1, level = u, statistic = stat1, direction = "&gt;", type = "o")
myconf3 = confreg(y1, level = u, statistic = stat2, direction = "&gt;", type = "o")
</code></pre>


</div>