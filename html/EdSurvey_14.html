<div class="container">

<table style="width: 100%;"><tr>
<td>cor.sdf</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Bivariate Correlation</h2>

<h3>Description</h3>

<p>Computes the correlation of two variables on an <code>edsurvey.data.frame</code>,
a <code>light.edsurvey.data.frame</code>, or an <code>edsurvey.data.frame.list</code>.
The correlation accounts for plausible values and the survey design.
</p>


<h3>Usage</h3>

<pre><code class="language-R">cor.sdf(
  x,
  y,
  data,
  method = c("Pearson", "Spearman", "Polychoric", "Polyserial"),
  weightVar = "default",
  reorder = NULL,
  dropOmittedLevels = TRUE,
  defaultConditions = TRUE,
  recode = NULL,
  condenseLevels = TRUE,
  fisherZ = if (match.arg(method) %in% "Pearson") {
     TRUE
 } else {
     FALSE
 },
  jrrIMax = Inf,
  verbose = TRUE,
  omittedLevels = deprecated()
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>x</code></td>
<td>
<p>a character variable name from the <code>data</code> to be correlated with <code>y</code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>y</code></td>
<td>
<p>a character variable name from the <code>data</code> to be correlated with <code>x</code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>data</code></td>
<td>
<p>an <code>edsurvey.data.frame</code>, a <code>light.edsurvey.data.frame</code>, or an <code>edsurvey.data.frame.list</code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>method</code></td>
<td>
<p>a character string indicating which correlation coefficient (or covariance) is to be computed.
One of <code>Pearson</code> (default), <code>Spearman</code>, <code>Polychoric</code>, or <code>Polyserial</code>. For Polyserial, the continuous argument must be <code>x</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>weightVar</code></td>
<td>
<p>character indicating the weight variable to use. See Details section in <code>lm.sdf</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>reorder</code></td>
<td>
<p>a list of variables to reorder. Defaults to <code>NULL</code> (no variables are reordered). Can be set as
<code>reorder</code> <code>=</code> <code>list(var1</code> <code>=</code> <code>c("a","b","c"),</code> <code>var2</code> <code>=</code> <code>c("4", "3", "2", "1"))</code>. See Examples.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>dropOmittedLevels</code></td>
<td>
<p>a logical value. When set to the default value of <code>TRUE</code>, drops those levels of all factor variables that are specified
in an <code>edsurvey.data.frame</code>. Use <code>print</code> on an <code>edsurvey.data.frame</code> to see the omitted levels.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>defaultConditions</code></td>
<td>
<p>a logical value. When set to the default value of <code>TRUE</code>, uses the default conditions stored in an <code>edsurvey.data.frame</code>
to subset the data. Use <code>print</code> on an <code>edsurvey.data.frame</code> to see the default conditions.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>recode</code></td>
<td>
<p>a list of lists to recode variables. Defaults to <code>NULL</code>. Can be set as
<code>recode</code> <code>=</code> <code>list(var1</code> <code>=</code> <code>list(from</code> <code>=</code> <code>c("a","b","c"), to</code> <code>=</code> <code>"d"))</code>. See Examples.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>condenseLevels</code></td>
<td>
<p>a logical value. When set to the default value of
<code>TRUE</code> and either <code>x</code> or <code>y</code> is a
categorical variable, the function will drop all unused
levels and rank the levels of the variable before
calculating the correlation. When set to <code>FALSE</code>,
the numeric levels of the variable remain the same as
in the codebook. See Examples.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>fisherZ</code></td>
<td>
<p>for standard error and mean calculations, set to <code>TRUE</code> to use
the Fisher Z-transformation (see details), or <code>FALSE</code>
to use no transformation of the data. The <code>fisherZ</code> argument defaults
to Fisher Z-transformation for Pearson and no transformation
for other correlation types.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>jrrIMax</code></td>
<td>
<p>a numeric value; when using the jackknife variance estimation method, the default estimation option, <code>jrrIMax=Inf</code>, uses the
sampling variance from all plausible values as the component for sampling variance estimation. The <code>Vjrr</code>
term (see
<a href="https://www.air.org/sites/default/files/EdSurvey-Statistics.pdf"><em>Statistical Methods Used in EdSurvey</em></a>)
can be estimated with any number of plausible values, and values larger than the number of
plausible values on the survey (including <code>Inf</code>) will result in all plausible values being used.
Higher values of <code>jrrIMax</code> lead to longer computing times and more accurate variance estimates.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>verbose</code></td>
<td>
<p>a logical value. Set to <code>FALSE</code> to avoid messages about variable conversion.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>omittedLevels</code></td>
<td>
<p>this argument is deprecated. Use <code>dropOmittedLevels</code>.</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>The <code>getData</code> arguments and <code>recode.sdf</code> may be useful. (See Examples.)
The correlation methods are calculated as described in the documentation for the <code>wCorr</code> package—see <code>browseVignettes(package="wCorr")</code>.
</p>
<p>When <code>method</code> is set to <code>polyserial</code>, all <code>x</code> arguments are assumed to be continuous and all <code>y</code> assumed discrete. Therefore,
be mindful of variable selection as this may result in calculations taking a very long time to complete.
</p>
<p>The Fisher Z-transformation is both a variance stabilizing  and normalizing transformation
for the Pearson correlation coefficient (Fisher, 1915).
The transformation takes the inverse hyperbolic tangent of the correlation coefficients and then calculates all variances and confidence intervals.
These are then transformed back to the correlation space (values between -1 and 1, inclusive) using the hyperbolic tangent function.
The Taylor series approximation (or delta method) is applied for the standard errors.
</p>


<h3>Value</h3>

<p>An <code>edsurvey.cor</code> that has print and summary methods.
</p>
<p>The class includes the following elements:
</p>
<table>
<tr style="vertical-align: top;">
<td><code>correlation</code></td>
<td>
<p>numeric estimated correlation coefficient</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>Zse</code></td>
<td>
<p>standard error of the correlation (<code>Vimp</code> + <code>Vjrr</code>). In the case of Pearson, this is calculated in the linear atanh space and is not a standard error in the usual sense.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>correlates</code></td>
<td>
<p>a vector of length two showing the columns for which the correlation coefficient was calculated</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>variables</code></td>
<td>
<p><code>correlates</code> that are discrete</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>order</code></td>
<td>
<p>a list that shows the order of each variable</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>method</code></td>
<td>
<p>the type of correlation estimated</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>Vjrr</code></td>
<td>
<p>the jackknife component of the variance estimate. For Pearson, in the atanh space.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>Vimp</code></td>
<td>
<p>the imputation component of the variance estimate. For Pearson, in the atanh space.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>weight</code></td>
<td>
<p>the weight variable used</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>npv</code></td>
<td>
<p>the number of plausible values used</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>njk</code></td>
<td>
<p>the number of the jackknife replicates used</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>n0</code></td>
<td>
<p>the original number of observations</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>nUsed</code></td>
<td>
<p>the number of observations used in the analysis—after any conditions and any listwise deletion of missings is applied</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>se</code></td>
<td>
<p>the standard error of the correlation, in the correlation ([-1,1]) space</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>ZconfidenceInterval</code></td>
<td>
<p>the confidence interval of the correlation in the transformation space</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>confidenceInterval</code></td>
<td>
<p>the confidence interval of the correlation in the correlation ([-1,1]) space</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>transformation</code></td>
<td>
<p>the name of the transformation used when calculating standard errors</p>
</td>
</tr>
</table>
<h3>Author(s)</h3>

<p>Paul Bailey; relies heavily on the <code>wCorr</code> package, written by Ahmad Emad and Paul Bailey
</p>


<h3>References</h3>

<p>Fisher, R. A. (1915). Frequency distribution of the values of the correlation coefficient in samples from an indefinitely large population. <em>Biometrika</em>, <em>10</em>(4), 507–521.
</p>


<h3>See Also</h3>

<p><code>cor</code> and <code>weightedCorr</code>
</p>


<h3>Examples</h3>

<pre><code class="language-R">## Not run: 
# read in the example data (generated, not real student data)
sdf &lt;- readNAEP(path=system.file("extdata/data", "M36NT2PM.dat", package = "NAEPprimer"))

# for two categorical variables any of the following work
c1_pears &lt;- cor.sdf(x="b017451", y="b003501", data=sdf, method="Pearson",
                    weightVar="origwt")
c1_spear &lt;- cor.sdf(x="b017451", y="b003501", data=sdf, method="Spearman",
                    weightVar="origwt")
c1_polyc &lt;- cor.sdf(x="b017451", y="b003501", data=sdf, method="Polychoric",
                    weightVar="origwt")

c1_pears
c1_spear
c1_polyc

# for categorical variables, users can either keep the original numeric levels of the variables
# or condense the levels (default)
# the following call condenses the levels of the variable 'c046501'
cor.sdf(x="c046501", y="c044006", data=sdf)

# the following call keeps the original levels of the variable 'c046501'
cor.sdf(x="c046501", y="c044006", data=sdf, condenseLevels = FALSE)

# these take awhile to calculate for large datasets, so limit to a subset
sdf_dnf &lt;- subset(sdf, b003601 == 1)

# for a categorical variable and a scale score any of the following work
c2_pears &lt;- cor.sdf(x="composite", y="b017451", data=sdf_dnf, method="Pearson",
                    weightVar="origwt")
c2_spear &lt;- cor.sdf(x="composite", y="b017451", data=sdf_dnf, method="Spearman",
                    weightVar="origwt")
c2_polys &lt;- cor.sdf(x="composite", y="b017451", data=sdf_dnf, method="Polyserial",
                    weightVar="origwt")

c2_pears
c2_spear
c2_polys

# recode two variables
cor.sdf(x="c046501", y="c044006", data=sdf, method="Spearman", weightVar="origwt",
        recode=list(c046501=list(from="0%",to="None"),
                    c046501=list(from=c("1-5%", "6-10%", "11-25%", "26-50%",
                                        "51-75%", "76-90%", "Over 90%"),
                                 to="Between 0% and 100%"),
                    c044006=list(from=c("1-5%", "6-10%", "11-25%", "26-50%",
                                        "51-75%", "76-90%", "Over 90%"),
                                 to="Between 0% and 100%")))

# reorder two variables
cor.sdf(x="b017451", y="sdracem", data=sdf, method="Spearman", weightVar="origwt", 
        reorder=list(sdracem=c("White", "Hispanic", "Black", "Asian/Pacific Island",
                               "Amer Ind/Alaska Natv", "Other"),
                     b017451=c("Every day", "2 or 3 times a week", "About once a week",
                               "Once every few weeks", "Never or hardly ever")))

# recode two variables and reorder
cor.sdf(x="pared", y="b013801", data=subset(sdf, !pared %in% "I Don\'t Know"),
        method="Spearman", weightVar = "origwt",
        recode=list(pared=list(from="Some ed after H.S.", to="Graduated H.S."), 
                    pared=list(from="Graduated college", to="Graduated H.S."),
                    b013801=list(from="0-10", to="Less than 100"), 
                    b013801=list(from="11-25", to="Less than 100"),
                    b013801=list(from="26-100", to="Less than 100")),
        reorder=list(b013801=c("Less than 100", "&gt;100")))

## End(Not run)
</code></pre>


</div>