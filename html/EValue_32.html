<div class="container">

<table style="width: 100%;"><tr>
<td>sens_plot</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Plots for sensitivity analyses</h2>

<h3>Description</h3>

<p>Produces line plots (<code>type="line"</code>) showing the average bias factor across studies on the relative risk (RR) scale vs. the estimated proportion
of studies with true RRs above or below a chosen threshold <code>q</code>.
The plot secondarily includes a X-axis showing the minimum strength of confounding
to produce the given bias factor. The shaded region represents a pointwise confidence band.
Alternatively, produces distribution plots (<code>type="dist"</code>) for a specific bias factor showing the observed and
true distributions of RRs with a red line marking exp(<code>q</code>).
</p>


<h3>Usage</h3>

<pre><code class="language-R">sens_plot(
  method = "calibrated",
  type,
  q,
  CI.level = 0.95,
  tail = NA,
  muB.toward.null = FALSE,
  give.CI = TRUE,
  Bmin = 0,
  Bmax = log(4),
  breaks.x1 = NA,
  breaks.x2 = NA,
  muB,
  sigB,
  yr,
  vyr = NA,
  t2,
  vt2 = NA,
  R = 1000,
  dat = NA,
  yi.name = NA,
  vi.name = NA
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>method</code></td>
<td>
<p><code>"calibrated"</code> or <code>"parametric"</code>. See Details.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>type</code></td>
<td>
<p><code>dist</code> for distribution plot; <code>line</code> for line plot (see Details)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>q</code></td>
<td>
<p>True causal effect size chosen as the threshold for a meaningfully large effect</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>CI.level</code></td>
<td>
<p>Pointwise confidence level as a proportion (e.g., 0.95).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>tail</code></td>
<td>
<p><code>"above"</code> for the proportion of effects above <code>q</code>; <code>"below"</code> for
the proportion of effects below <code>q</code>. By default, is set to <code>"above"</code> if the pooled point estimate (<code>method = "parametric"</code>) or median of the calibrated estimates (<code>method = "calibrated"</code>) is above 1 on the relative risk scale and is set to <code>"below"</code> otherwise.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>muB.toward.null</code></td>
<td>
<p>Whether you want to consider bias that has on average shifted studies' point estimates away from the null (<code>FALSE</code>; the default) or that has on average shifted studies' point estimates toward the null (<code>TRUE</code>). See Details.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>give.CI</code></td>
<td>
<p>Logical. If <code>TRUE</code>, a pointwise confidence intervals is plotted.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>Bmin</code></td>
<td>
<p>Lower limit of lower X-axis on the log scale (only needed if <code>type = "line"</code>).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>Bmax</code></td>
<td>
<p>Upper limit of lower X-axis on the log scale (only needed if <code>type = "line"</code>)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>breaks.x1</code></td>
<td>
<p>Breaks for lower X-axis (bias factor) on RR scale. (optional for <code>type = "line"</code>; not used for <code>type = "dist"</code>).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>breaks.x2</code></td>
<td>
<p>Breaks for upper X-axis (confounding strength) on RR scale (optional for <code>type = "line"</code>; not used for <code>type = "dist"</code>)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>muB</code></td>
<td>
<p>Single mean bias factor on log scale (only needed if <code>type = "dist"</code>)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>sigB</code></td>
<td>
<p>Standard deviation of log bias factor across studies (only used if <code>method = "parametric"</code>)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>yr</code></td>
<td>
<p>Pooled point estimate (on log scale) from confounded meta-analysis (only used if <code>method = "parametric"</code>)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>vyr</code></td>
<td>
<p>Estimated variance of pooled point estimate from confounded meta-analysis (only used if <code>method = "parametric"</code>)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>t2</code></td>
<td>
<p>Estimated heterogeneity (<code class="reqn">\tau^2</code>) from confounded meta-analysis (only used if <code>method = "parametric"</code>)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>vt2</code></td>
<td>
<p>Estimated variance of <code class="reqn">\tau^2</code> from confounded meta-analysis (only used if <code>method = "parametric"</code>)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>R</code></td>
<td>
<p>Number  of  bootstrap  iterates for confidence interval estimation. Only used if <code>method = "calibrated"</code> and <code>give.CI = TRUE</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>dat</code></td>
<td>
<p>Dataframe containing studies' point estimates and variances. Only used if <code>method = "calibrated"</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>yi.name</code></td>
<td>
<p>Name of variable in <code>dat</code> containing studies' point estimates. Only used if <code>method = "calibrated"</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>vi.name</code></td>
<td>
<p>Name of variable in <code>dat</code> containing studies' variance estimates. Only used if <code>method = "calibrated"</code>.</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>This function calls <code>confounded_meta</code> to get the point estimate and confidence interval at each value of the bias factor. See <code>?confounded_meta</code> for details.
</p>
<p>Note that <code>Bmin</code> and <code>Bmax</code> are specified on the log scale for consistency with the <code>muB</code> argument and with the function <code>confounded_meta</code>, whereas <code>breaks.x1</code> and <code>breaks.x2</code> are specified on the relative risk scale to facilitate adjustments to the plot appearance.
</p>


<h3>References</h3>

<p>Mathur MB &amp; VanderWeele TJ (2020a). Sensitivity analysis for unmeasured confounding in meta-analyses. <em>Journal of the American Statistical Association</em>.
</p>
<p>Mathur MB &amp; VanderWeele TJ (2020b). Robust metrics and sensitivity analyses for meta-analyses of heterogeneous effects. <em>Epidemiology</em>.
</p>
<p>Wang C-C &amp; Lee W-C (2019). A simple method to estimate prediction intervals and
predictive distributions: Summarizing meta-analyses
beyond means and confidence intervals. <em>Research Synthesis Methods</em>.
</p>


<h3>Examples</h3>

<pre><code class="language-R">
##### Example 1: Calibrated Line Plots #####

# simulated dataset with exponentially distributed 
#  population effects
# we will use the calibrated method to avoid normality assumption
data(toyMeta)

# without confidence band
sens_plot( method = "calibrated",
           type="line",
           q=log(.9),
           tail = "below",
           dat = toyMeta,
           yi.name = "est",
           vi.name = "var",
           give.CI = FALSE )


# # with confidence band and a different threshold, q
# # commented out because takes a while too run
# sens_plot( method = "calibrated",
#            type="line",
#            q=0,
#            tail = "below",
#            dat = toyMeta,
#            yi.name = "est",
#            vi.name = "var",
#            give.CI = TRUE,
#            R = 300 ) # should be higher in practice


##### Example 2: Calibrated and Parametric Line Plots #####

# example dataset
d = metafor::escalc(measure="RR",
                    ai=tpos,
                    bi=tneg,
                    ci=cpos,
                    di=cneg,
                    data=metadat::dat.bcg)

# without confidence band
sens_plot( method = "calibrated",
           type="line",
           tail = "below",
           q=log(1.1),
           dat = d,
           yi.name = "yi",
           vi.name = "vi",
           give.CI = FALSE )

# # with confidence band
# # commented out because it takes a while
# # this example gives bootstrap warnings because of its small sample size
# sens_plot( method = "calibrated",
#            type="line",
#            q=log(1.1),
#            R = 500,  # should be higher in practice (e.g., 1000)
#            dat = d,
#            yi.name = "yi",
#            vi.name = "vi",
#            give.CI = TRUE )


# now with heterogeneous bias across studies (via sigB) and with confidence band
sens_plot( method = "parametric",
           type="line",
           q=log(1.1),
           yr=log(1.3),
           vyr = .05,
           vt2 = .001,
           t2=0.4,
           sigB = 0.1,
           Bmin=0,
           Bmax=log(4) )

##### Distribution Line Plot #####

# distribution plot: apparently causative
sens_plot( type="dist",
           q=log(1.1),
           muB=log(2),
           sigB = 0.1,
           yr=log(1.3),
           t2=0.4 )

# distribution plot: apparently preventive
sens_plot( type="dist",
           q=log(0.90),
           muB=log(1.5),
           sigB = 0.1,
           yr=log(0.7),
           t2=0.2 )
</code></pre>


</div>