<div class="container">

<table style="width: 100%;"><tr>
<td>nops_eval</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Evaluate NOPS Exams</h2>

<h3>Description</h3>

<p>Evaluate NOPS exams produced with <code>exams2nops</code>,
and scanned by <code>nops_scan</code>.
</p>


<h3>Usage</h3>

<pre><code class="language-R">  nops_eval(register = dir(pattern = "\\.csv$"), solutions = dir(pattern = "\\.rds$"),
    scans = dir(pattern = "^nops_scan_[[:digit:]]*\\.zip$"),
    points = NULL, eval = exams_eval(partial = TRUE, negative = FALSE, rule = "false2"),
    mark = c(0.5, 0.6, 0.75, 0.85), labels = NULL,
    dir = ".", results = "nops_eval", file = NULL, flavor = NULL,
    language = "en", interactive = TRUE,
    string_scans = dir(pattern = "^nops_string_scan_[[:digit:]]*\\.zip$"),
    string_points = seq(0, 1, 0.25),
    ...)

  nops_eval_write(results = "nops_eval.csv", file = "exam_eval",
    dir = ".", language = "en", converter = NULL,
    col = hcl(c(0, 0, 60, 120), c(70, 0, 70, 70), 90), encoding = "UTF-8",
    html = NULL)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>register</code></td>
<td>
<p>character. File name of a CSV file (semicolon-separated)
of the registered students. Must contain columns <code>"registration"</code>
(registration number), <code>"name"</code> (student name), <code>"id"</code> (some user name
or other string unique for each student). The file name should not contain spaces,
umlaut or other special characters (e.g., something like
<code>"exam-2015-07-01.csv"</code> is recommended).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>solutions</code></td>
<td>
<p>character. File name of the RDS exam file
produced by <code>exams2nops</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>scans</code></td>
<td>
<p>character. File name of the ZIP file with scanning results
(containing Daten.txt and PNG files) as produced by
<code>nops_scan</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>points</code></td>
<td>
<p>numeric. Vector of points per exercise. By default read from
<code>solutions</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>eval</code></td>
<td>
<p>list specification of evaluation policy as computed by
<code>exams_eval</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>mark</code></td>
<td>
<p>logical or numeric. If <code>mark = FALSE</code>, no marks are computed.
Otherwise <code>mark</code> needs to be a numeric vector with threshold values to
compute marks. The thresholds can either be relative (all lower than 1)
or absolute. In case results exactly matching a threshold, the better mark is used.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>labels</code></td>
<td>
<p>character. Vector of labels for the marks with
<code>length(mark) + 1</code> elements. Default is <code>(length(mark) + 1):1</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>dir</code></td>
<td>
<p>character. File path to the output directory (the default being the
current working directory).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>results</code></td>
<td>
<p>character. Prefix for output files.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>file</code></td>
<td>
<p>character. File name for individual report files, in the default
<code>nops_eval_write</code> the same as <code>register</code> with suffix <code>.html</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>flavor</code></td>
<td>
<p>character. Rather than using the default <code>nops_eval_write</code>
it is possible to call <code>nops_eval_write_&lt;flavor&gt;</code>. Currently, only
the default writer is available but other formats are planned (e.g., Moodle).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>language</code></td>
<td>
<p>character. Path to a DCF file with a language specification.
Currently, the package ships: English (<code>"en"</code>), Dutch (<code>"nl"</code>),
French (<code>"fr"</code>), German (<code>"de"</code>), Italian (<code>"it"</code>),
Romanian (<code>"ro"</code>), Portuguese (<code>"pt"</code>), Spanish (<code>"es"</code>),
Turkish (<code>"tr"</code>).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>interactive</code></td>
<td>
<p>logical. Should possible errors in the Daten.txt file
by corrected interactively? Requires the <span class="pkg">png</span> package for full
interactivity.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>string_scans</code></td>
<td>
<p>character. Optional file name of the ZIP file with scanning results
of string exercise sheets (if any) containing Daten2.txt and PNG files as produced
by <code>nops_scan</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>string_points</code></td>
<td>
<p>numeric. Vector of length 5 with points assigned
to string results, multiplied with the <code>points</code> for the corresponding
exercises.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>further optional arguments passed from <code>nops_eval</code> to
<code>nops_eval_write</code> (or any other <code>nops_eval_write_&lt;flavor&gt;</code>).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>converter</code></td>
<td>
<p>character. The HTML converter to be used for the <code>language</code>
text elements. Can be <code>"none"</code>, <code>"tth"</code>, or <code>"pandoc"</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>col</code></td>
<td>
<p>character. Hex color codes used for exercises with
negative, neutral, positive, full solution.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>encoding</code></td>
<td>
<p>character. Encoding of <code>register</code>, e.g.,
<code>"latin1"</code> or <code>"UTF-8"</code> (default).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>html</code></td>
<td>
<p>character. Alternative specifciation of the <code>file</code> name for the
individual HTML report files. As <code>html</code> was used rather than <code>file</code>
in earlier versions of the package, <code>html</code> is preserved as an argument
and overwrites <code>file</code> if specified.</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p><code>nops_eval</code> is a companion function for <code>exams2nops</code>
and <code>nops_scan</code>. It evaluates the scanned exams by computing
the sums of the points achived and (if desired) maps them to marks. Furthermore
a HTML report for each individual student is generated by default (e.g., for upload into
a learning management system).
</p>
<p>Tutorial for NOPS workflow: <a href="https://www.R-exams.org/tutorials/exams2nops/">https://www.R-exams.org/tutorials/exams2nops/</a>.
</p>


<h3>Value</h3>

<p>A <code>data.frame</code> with the detailed exam results is returned invisibly.
It is also written to a CSV file in the current directory, by default along with
a ZIP file containing HTML reports.
</p>


<h3>See Also</h3>

<p><code>exams2nops</code>, <code>nops_scan</code></p>


<h3>Examples</h3>

<pre><code class="language-R">
## --- Preliminaries ---

## load package and enforce par(ask = FALSE)
## additionally, for simplicity, enforce using the basic
## tools::texi2dvi() LaTeX interface instead of the more
## flexible/robust tinytex::latexmk()
library("exams")
oopt &lt;- options(device.ask.default = FALSE, exams_tex = "tools")

## set up a temporary working directory in which all files are managed
odir &lt;- getwd()
dir.create(mydir &lt;- tempfile())
setwd(mydir)


## --- Step 1 ---
## exam generation

## define an exam (= list of exercises)
myexam &lt;- list(
  "tstat2.Rmd",
  "ttest.Rmd",
  "relfreq.Rmd",
  "anova.Rmd",
  c("boxplots.Rmd", "scatterplot.Rmd"),
  "cholesky.Rmd"
)

## create multiple exams on the disk with different numbers of points
## per exercise (see ?exams2nops for more examples)
set.seed(403)
ex1 &lt;- exams2nops(myexam, n = 2, dir = ".", date = "2015-07-29",
  points = c(1, 1, 1, 2, 2, 3), showpoints = TRUE)
dir()

## assume the PDF exams were already printed (and possibly backed up
## in a different directory) so that they are not needed anymore
file.remove(dir(pattern = "pdf$"))


## --- Step 2 ---
## scan results

## assume two participants filled out the printed exam sheets
## and the corresponding scans are in two PNG files,
img &lt;- dir(system.file("nops", package = "exams"), pattern = "nops_scan",
  full.names = TRUE)

## copy the PNG files to the working directory
file.copy(img, to = ".")

## read the scanned images (all locally available .png files) and collect
## results in a ZIP archive (see ?nops_scan for more details)
nops_scan()
dir()

## the ZIP archive contains copies of the PNG images so that these are
## can be deleted here (possibly after backup in a different directory)
file.remove(dir(pattern = "png$"))


## -- Step 3 ---
## evaluate results

## three files are required: (a) an RDS file with the exam meta-information
## (see Step 1), (b) a ZIP file with the scanned sheets (see Step 2), (c) a
## CSV file with the student infomation (registration number, name, and some
## for of ID/username)

## here we create the CSV file on the fly but in practice this will typically
## be processed from some registration service or learning management system etc
write.table(data.frame(
  registration = c("1501090", "9901071"),
  name = c("Jane Doe", "Ambi Dexter"),
  id = c("jane_doe", "ambi_dexter")
), file = "Exam-2015-07-29.csv", sep = ";", quote = FALSE, row.names = FALSE)
dir()
## now the exam can be evaluated creating an output data frame (also stored
## as CSV file) and individual HTML reports (stored in a ZIP file),

## as there is only exactly on CSV/RDS/ZIP file in the current directory,
## these are found automatically - furthermore an evaluation scheme without
## partial points and differing points per exercise are used
ev1 &lt;- nops_eval(eval = exams_eval(partial = FALSE, negative = FALSE))
dir()

## inspect evaluated data
ev1

## inspect corresponding HTML reports
if(interactive()) {
unzip("nops_eval.zip")
browseURL(file.path(mydir, "jane_doe",    "Exam-2015-07-29.html"))
browseURL(file.path(mydir, "ambi_dexter", "Exam-2015-07-29.html"))
}

## --- Options ---
if(interactive()) {
## below three typically needed options are discussed:
## (a) using a different evaluation strategy (here with partial credits),
## (b) using a different language (here de/German),
## (c) an error of the participant when filling in the registration number.

## as for (a): partial credits should only be used for multiple-choice questions
## where at least one alternative is correct and at least one is false
## [note that in this example this is not the case for the first question
## (single-choice) and the third question for Jane Doe (no alternative correct)]

## as for (c): for Ambi Dexter such an error was included in the PNG example
## image, the actual number is "9911071" but the crosses indicate "9901071"

## clean up previous evaluation
file.remove(c("nops_eval.csv", "nops_eval.zip"))

## write correct registration information
write.table(data.frame(
  registration = c("1501090", "9911071"),
  name = c("Jane Doe", "Ambi Dexter"),
  id = c("jane_doe", "ambi_dexter")
), file = "Exam-2015-07-29.csv", sep = ";", quote = FALSE, row.names = FALSE)

## call nops_eval() with modified options, where the error in the registration
## number of Ambi Dexter will trigger an interactive prompt
ev2 &lt;- nops_eval(eval = exams_eval(partial = TRUE, rule = "false2"),
  language = "de")

## inspect evaluated data
ev2
cbind(ev1$points, ev2$points)

## inspect corresponding HTML reports
unzip("nops_eval.zip")
browseURL(file.path(mydir, "jane_doe",    "Exam-2015-07-29.html"))
browseURL(file.path(mydir, "ambi_dexter", "Exam-2015-07-29.html"))
}

## switch back to original working directory and options
setwd(odir)
options(exams_tex = oopt$exams_tex)

</code></pre>


</div>