<div class="container">

<table style="width: 100%;"><tr>
<td>eql</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>The Extended Quasi-Likelihood Function</h2>

<h3>Description</h3>

<p>Computes the Extended Quasi Likelihood (<abbr><span class="acronym">EQL</span></abbr>) function for
a given set of variance functions from a particular variance family.
</p>


<h3>Usage</h3>

<pre><code class="language-R">eql(formula, param.space, family = powerVarianceFamily(),
    phi.method = c("pearson", "mean.dev"), include.model = TRUE,
    smooth.grid = 10, do.smooth = dim(family) == 1,
    verbose = 1, ...)

## S3 method for class 'eql'
plot(x, do.points = (dim(x) == 1 &amp;&amp; sum(!x$is.smoothed) &lt;= 20),
     do.ci = TRUE, alpha = 0.95, do.bw = TRUE,
     show.max = TRUE, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>formula</code></td>
<td>
<p>an object of class <code>formula</code> (or one that can be coerced to
that class): a symbolic description of the model to be
used to determine the parameters of the variance function.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>param.space</code></td>
<td>
<p>a list of parameters for which the <abbr><span class="acronym">EQL</span></abbr>
value should be evaluated. If provided as a named list,
the names must equal the names of the parameters defined by
the variance family.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>family</code></td>
<td>
<p>an object of class <code>varianceFamily</code> giving a
parameterized family of variance functions. See
<code>varianceFamily</code> for further details.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>phi.method</code></td>
<td>
<p>a character string giving the name of the method 
used to estimate the dispersion parameter
<code class="reqn">\phi</code>. Must be one of (“pearson”,
“mean.dev”) representing the estimation of <code class="reqn">\phi</code>
by the mean Pearson's statistic or by the mean deviance, respectively.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>include.model</code></td>
<td>
<p>logical. If <code>TRUE</code> (the default) the final
model is included in the output.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>x</code></td>
<td>
<p>an object of class <code>eql</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>do.smooth, smooth.grid</code></td>
<td>
<p><code>do.smooth</code> is a logical value and
<code>smooth.grid</code> is an integer value giving the number of nodes
for the smoothing process. If <code>do.smooth</code> is <code>TRUE</code>,
smoothing is carried out by cubic splines on an equidistant grid
with an amount of nodes equals to <code>smooth.grid</code> between two
adjacent <abbr><span class="acronym">EQL</span></abbr> values. Smoothing is currently only
available for one-dimensional variance families, i.e. families that
depend only on one parameter.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>verbose</code></td>
<td>
<p>the amount of feedback requested: ‘0’ or <code>FALSE</code> means
no feedback, ‘1’ or <code>TRUE</code> means some feedback (the
default), and ‘2’ means to show all available
feedback. For the default setting, a progress bar will be displayed
to give a rough estimation of the remaining calculation time. Full
feedback prints  the <abbr><span class="acronym">EQL</span></abbr> value for each parameter
combination.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>further arguments to be passed to the <code>glm</code>
routine and the plotting routine, respectively.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>do.points, show.max</code></td>
<td>
<p>logical. If <code>do.points</code> is
<code>TRUE</code>, the computed <abbr><span class="acronym">EQL</span></abbr>  values are marked in the
plot. If <code>show.max</code> is <code>TRUE</code>, the maximum of the
<abbr><span class="acronym">EQL</span></abbr> function is emphasized in the plot.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>do.ci, alpha</code></td>
<td>
<p><code>do.ci</code> is a logical value, if <code>TRUE</code> a
<code class="reqn">\alpha</code> confidence interval (respectively confidence
ellipsoid) is added to the plot.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>do.bw</code></td>
<td>
<p>logical. If <code>TRUE</code> (the default) a “black
and white” plot is produced, otherwise colours are used.</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>The <abbr><span class="acronym">EQL</span></abbr> function as defined by <cite>Nelder and Pregibon</cite>
(see ‘References’) is given by:
</p>
<p style="text-align: center;"><code class="reqn">Q^+_\theta(y,\mu) = -\frac{1}{2} \log [2\pi\phi V_\theta(y)] -
     \frac{1}{2\phi} D_\theta(y,\mu),</code>
</p>

<p>where <code class="reqn">D_\theta()</code> and <code class="reqn">V_\theta()</code> denote the
deviance function and the variance function, respectively, determined by
the particular choice of the variance family.
</p>
<p>The goal is to maximize the <abbr><span class="acronym">EQL</span></abbr> function over <code class="reqn">\mu</code>
and the not necessarily one-dimensional space of parameters
<code class="reqn">\theta</code>. The function <code>eql</code> takes a particular finite
set of candidate parameters and computes the corresponding
<abbr><span class="acronym">EQL</span></abbr> value for each of these parameters and returns the
maximum <abbr><span class="acronym">EQL</span></abbr> value for the given set. That implies that the
function is only capable of capturing local maxima. If the maximum occurs
at the boundary of the set, the set of parameters may be badly chosen
and one should consider a larger set with the found maximum as an
interior point.
</p>
<p>The <code>plot</code> function is an important tool to investigate the
structure of the <abbr><span class="acronym">EQL</span></abbr> function. Confidence intervals and
confidence ellipsoids give an idea of plausible parameter values
for the variance function. The contour plot
used for two-dimensional variance families is generated using the
package <span class="pkg">lattice</span>, which in turn relies on so called
<code>trellis</code> plots. Hence, for two-dimensional families the
<code>plot</code> function does not only generate the plot, but also
returns the plot object to allow for further modifications of the
plot. This is not true for one-dimensional variance models, which are
plotted using the <span style="font-family: Courier New, Courier; color: #666666;"><b>R</b></span> standard graphical engine.
</p>
<p>For large parameter sets the computation may take a long time. If no
feedback is chosen, the function seems to be hung up, because the
function does not provide any textual feedback while computing. Hence,
a minimal feedback (including a progress bar) should be chosen to have
an idea of the remaining calculation time.
</p>
<p>An explicitely given deviance function speeds up calculation. A rather
large amount of the total calculation time is used to determine the
numerical values of the integral in the deviance function.
</p>


<h3>Value</h3>

<p><code>eql</code> returns an object of class <code>eql</code>, which contains the
following components:
</p>
<table>
<tr style="vertical-align: top;">
<td><code>eql</code></td>
<td>
<p>a numerical vector with the computed eql values for the given
set of parameter values. For one-dimensional variance families
(i.e. those families with only one parameter), a smoothing
operation can be performed to obtain intermediate values.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>param</code></td>
<td>
<p>a <code>data.frame</code> containing the values of the
parameters at which the eql function was evaluated.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>eql.max</code></td>
<td>
<p>the maximum value of the eql function in the considered
range.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>param.max</code></td>
<td>
<p>a <code>data.frame</code> containing the values of the
parameters at which the maximum is obtained.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>dim</code></td>
<td>
<p>an integer value giving the dimension of the parameters in
the underlying variance family.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>smooth</code></td>
<td>
<p>a logical value indicating whether a smoothing operation
was performed.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>is.smoothed</code></td>
<td>
<p>a vector of logical values of the same length as
<code>eql</code> indicating if the particular <abbr><span class="acronym">EQL</span></abbr> value was
obtained by smoothing or was calculated directly.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>smooth.grid</code></td>
<td>
<p>an integer value giving the number of points used
in the smoothing process or <code>NULL</code> if no smoothing was
performed.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>model</code></td>
<td>
<p>if <code>include.model</code> is <code>TRUE</code>, the <abbr><span class="acronym">GLM</span></abbr>
for which the maximum <abbr><span class="acronym">EQL</span></abbr> value was archieved,
<code>NULL</code> otherwise.</p>
</td>
</tr>
</table>
<h3>Note</h3>

<p>The EQL for variance functions with <code class="reqn">V_\theta(0)=0</code>
becomes infinite. Hence, if there are exact zeros in the data, one
should provide a variance family, which do not equate to zero at the
origin. <cite>Nelder and Pregibon</cite> propose some adjustment of <code class="reqn">V(y)</code>
at the origin, which leads to a modified variance function. 
</p>
<p>The predefined families <code>powerVarianceFamily</code> and
<code>extBinomialVarianceFamily</code> are, however, <em>not</em> capable of
dealing with exact zeros, for there is no general mechanism to modify
the variance function for all possible values of the particular variance
family.
</p>
<p>The confidence interval for one-dimensional variance families is not
calculated exactly, but depends on the amount of <abbr><span class="acronym">EQL</span></abbr> values
available. Hence, if one is interested in a confidence interval, one
should allow for smoothing.
</p>
<p>The function <code>eql</code> does not use a direct maximization routine, but
rather do a simple maximation over a finite set. Hence, all obtained
values including confidence intervals and confidence ellipsoids have a
“local flavour” and should not be regarded as global solutions.
</p>
<p>The confidence bounds are determined rather empirically and do heavily
depend on the amount of parameter values under consideration.
</p>


<h3>Author(s)</h3>

<p>Thorn Thaler</p>


<h3>References</h3>

<p>Nelder, J.A. and Pregibon, D. (1987).  An extended quasi-likelihood
function. <em>Biometrika</em>, <b>74</b>, 221–232.
</p>


<h3>See Also</h3>

<p><code>varianceFamily</code>, <code>glm</code></p>


<h3>Examples</h3>

<pre><code class="language-R">## Power Variance Family
# Data from Box and Cox (1964)
x &lt;- (-1:1)
y &lt;- c(674,370,292,338,266,210,170,118,90,1414,1198,634,1022,620,438,
       442,332,220,3636,3184,2000,1568,1070,566,1140,884,360)
yarn.raw &lt;- data.frame(expand.grid(x3=x, x2=x, x1=x), cycles=y)
yarn &lt;- data.frame(x1=yarn.raw$x1, x2=yarn.raw$x2, x3=yarn.raw$x3,
   cycles=yarn.raw$cycles)
attach(yarn)

ps.power &lt;- list(theta=seq(1, 4, length = 20))
eq.power &lt;- eql(cycles~x1+x2+x3, param.space=ps.power,
   family=powerVarianceFamily("log"), smooth.grid=500)
plot(eq.power)

## Not run: 
## Extended Binomial Variance Family
# Data from McCullagh &amp; Nelder: GLM, p. 329
# (zeros replaced by 'NA')

site &lt;- rep(1:9, each=10)
variety &lt;- rep(1:10, 9)
resp &lt;- c(0.05,NA,NA,0.10,0.25,0.05,0.50,1.30,1.50,1.50,
   NA,0.05,0.05,0.30,0.75,0.30,3,7.50,1,12.70,1.25,1.25,
   2.50,16.60,2.50,2.50,NA,20,37.50,26.25,2.50,0.50,0.01,
   3,2.50,0.01,25,55,5,40,5.50,1,6,1.10,2.50,8,16.50,
   29.50,20,43.50,1,5,5,5,5,5,10,5,50,75,5,0.10,5,5,
   50,10,50,25,50,75,5,10,5,5,25,75,50,75,75,75,17.50,
   25,42.50,50,37.50,95,62.50,95,95,95) / 100

ps.binomial &lt;- list(seq(1, 2.2, length=32), seq(1, 3, length=32))
eq.binomial &lt;- eql(resp~site*variety, param.space=ps.binomial,
   family=extBinomialVarianceFamily())
plot(eq.binomial)

## End(Not run)
</code></pre>


</div>