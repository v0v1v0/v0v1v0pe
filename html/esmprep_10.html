<div class="container">

<table style="width: 100%;"><tr>
<td>esAssign</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>esAssign</h2>

<h3>Description</h3>

<p>esAssign assigns ESM questionnaires to the (selected) persons who generated them.
</p>


<h3>Usage</h3>

<pre><code class="language-R">esAssign(esDf, refDf, RELEVANTINFO_ES = NULL, RELEVANTVN_ES = NULL,
  RELEVANTVN_REF = NULL, singlePerson = NULL, prompted = NULL,
  promptTimeframe = 30, midnightPrompt = FALSE, dstDates = NULL)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>esDf</code></td>
<td>
<p>a data.frame. A single ESM dataset. It must contain the 2 columns that hold the date-time object for when an ESM questionnaire was started and finished, respectively.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>refDf</code></td>
<td>
<p>a data.frame. The reference dataset.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>RELEVANTINFO_ES</code></td>
<td>
<p>a list. This list is generated by function <code>setES</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>RELEVANTVN_ES</code></td>
<td>
<p>a list. This list is generated by function <code>setES</code> and it is extended once either by function <code>genDateTime</code> or by function <code>splitDateTime</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>RELEVANTVN_REF</code></td>
<td>
<p>a list. This list is generated by function <code>setREF</code> and it is extended once either by function <code>genDateTime</code> or by function <code>splitDateTime</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>singlePerson</code></td>
<td>
<p>a character string. If you want to select a single person (must be contained in the reference dataset) enter its identification code (ID); else all participants in the reference dataset are selected (default).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>prompted</code></td>
<td>
<p>logical. If there was no prompt per ESM day at all, enter FALSE; else ignore this argument, meaning that per default at least one prompt per ESM day is assumed.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>promptTimeframe</code></td>
<td>
<p>an integer value. The default value is 30, i.e. within "genDateTime" <strong>minutes</strong> around each prompt a participant is expected to have answered the ESM questionnaire. This argument must be set to an integer value larger than 0, even if there was no prompt at all. If NA, NULL, 0 is passed to this argument, the function returns an error. If less than "genDateTime" minutes is passed to this argument, the function returns a warning message.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>midnightPrompt</code></td>
<td>
<p>logical. Default FALSE, i.e. no participant was able to start a questionnaire around the midnight hour. However, if this was possible, set this argument to TRUE, in which case it takes the function <code>esAssign</code> a little longer to do its job, compared to midnightPrompt = FALSE.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>dstDates</code></td>
<td>
<p>a vector of character strings. If a check shall be made concerning the daylight saving time (last weekend in March and October, respectively), enter the respective date(s) in the form yyyy-mm-dd as vector, e.g. c("2007-10-28", "2008-03-30).</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>Data can only be assigned to those individuals who are contained in the reference dataset.<br><code>esAssign</code> is of utmost importance in preparing the ESM dataset because the results of any statistical analysis depends on the correct assignment of data to the persons who generated it.
New columns in output list of function <code>esAssign</code> are
</p>

<ol>
<li>
<p> ID. Unique identification code of each participant.
</p>
</li>
<li>
<p> CV_ES. CV is short for count variable. It counts all the questionnaires that have been filled out by the participant during the ESM period. In incrementing order it starts at 1 and skips a number, whenever a questionnaire is missing.
</p>
</li>
<li>
<p> CV_ESDAY. This variable counts the single ESM days. In incrementing order it starts at 1. It only skips a number when all questionnaires of that day are missing.
</p>
</li>
<li>
<p> CV_ESWEEKDAY. This variable counts the weekday, with Monday represented by the value 1, ..., Sunday = 7.
</p>
</li>
<li>
<p> PROMPT. Correspondance of the actual start time of the questionnaire to its prompt (in our exemplary dataset this ranges between 1 and 4).
</p>
</li>
<li>
<p> PROMPTEND. Correspondance of the actual end time of the questionnaire to its prompt (in our exemplary dataset this ranges between 1 and 4).
</p>
</li>
<li>
<p> LAG_MINS. Time difference in minutes (rounded) between the scheduled time of the prompt and the actual start time of a questionnaire.
</p>
</li>
<li>
<p> ES_MULT. Dichotomous variable. The value 1 represents a questionnaire that has been filled out repeatedly at one specific prompt.
</p>
</li>
<li>
<p> ES_MULT2. Alternative representation of ES_MULT. The very first questionnaire at a prompt is represented by the value 1, the second questionnaire (i.e. the first repeatedly filled out q.) is represented by the value 2, etc.
</p>
</li>
<li>
<p> ST. Assigns the prompt/scheduled time (ST) to the actual start time of a questionnaire, by choosing the miminal time difference between all possible prompts (per participant) and the actual start time of the single ESM questionnaire.
</p>
</li>
<li>
<p> STDATE. Variable is returned only if argument midnightPrompt is set to TRUE. Possible values and meaning: -1 = scheduled start date is prior to actual start date; 0 = scheduled start date and actual start date are equal to one another; 1 = scheduled date is subsequent to actual start date.
</p>
</li>
<li>
<p> TFRAME. Dichotomous variable. The value 1 represents a questionnaire that is within the time frame, as specified by the user.
</p>
</li>
<li>
<p> DST. Dichotomous variable. The value 1 represents a questionnaire's date to be equal or later than the daylight saving date, as specified by the user.
</p>
</li>
<li>
<p> QWST. Dichotomous variable. The value 1 represents a questionnaire to be fully within the scheduled time, i.e. the time differences of both the actual start time and the actual end time are minimal relative to the same scheduled time.
</p>
</li>
</ol>
<p>Additionally, if the reference dataset contains any duplicates in the column representing the participant IDs, then <code>esAssign</code> stops and an error message is printed in the R console.
</p>


<h3>Value</h3>

<p>The user receives a list containing 4 datasets:
</p>

<ol>
<li>
<p> ES, i.e. ESM data assigned to selected participants with new columns added, see <strong>Details</strong>.
</p>
</li>
<li>
<p> ESopt, i.e. the optimal ESM data sequence for all selected participants.
</p>
</li>
<li>
<p> ESout, i.e. ESM data that couldn't be assigned.
</p>
</li>
<li>
<p> ESrate, i.e. the average completion rates per participant, both per prompt and overall.
</p>
</li>
</ol>
<p>The effective ESM completion rates per selected individual and per prompt are also printed to the console. However, these are not the final completion rates, since some of the current questionnaires later might either be removed (see function <code>intolerable</code>) or be shifted to a neighboring prompt index (see functions <code>suggestShift</code> and <code>makeShift</code>).
</p>


<h3>See Also</h3>

<p>Exemplary code (fully executable) in the documentation of <code>esmprep</code> (function 17 of 29).
</p>


<h3>Examples</h3>

<pre><code class="language-R"># o=o=o=o=o=o=o=o=o=o=o=o=o=o=o=o=o=o=o=o=o=o=o=o=o=o=o=o=o=o=o=o=o=o
# Prerequisites in order to execute esAssign. Start -----------------
# esMerged1 is the raw ESM dataset, also delivered with the package
# referenceDfNew is the modified reference dataset, delivered with
# the package.
# RELEVANTINFO_ES is delivered with the package
# Use example list delivered with the package
RELEVANTVN_ES &lt;- RELEVANTVN_ESext
# Use example list delivered with the package
RELEVANTVN_REF &lt;- RELEVANTVN_REFext
# Prerequisites in order to execute esAssign. End -------------------
# -------------------------------------------------------
# Run function 17 of 29; see esmprep functions' hierarchy.
# -------------------------------------------------------
# Assign questionnaires contained in the raw ESM dataset to all participants listed
# in the reference dataset. esMerged1 is the result of function 'convertChars',
# referenceDfNew is the result of function 'genDateTime' or of function
# 'splitDateTime'.
# Run only the first 2 out of 8 participants (saves time). The warning message the
# user receives in this case (2 out of 8 participants) is correct.
esAssigned &lt;- esAssign(esDf = esMerged1, refDf = referenceDfNew[1:2,], RELEVANTINFO_ES,
RELEVANTVN_ES, RELEVANTVN_REF)
# # Assign questionnaires contained in the raw ESM dataset to participant P001 listed
# # in the reference dataset.
# esAssigned &lt;- esAssign(esDf = esMerged1, refDf = referenceDfNew, RELEVANTINFO_ES,
# RELEVANTVN_ES, RELEVANTVN_REF, singlePerson="P001")
# More options can be passed to 'esAssign', see parameter description. Note that when
# setting the argument midnightPrompt to TRUE, esAssign takes a bit longer to do its job.
# Output: List with 4 data.frames.
names(esAssigned)
# o=o=o=o=o=o=o=o=o=o=o=o=o=o=o=o=o=o=o=o=o=o=o=o=o=o=o=o=o=o=o=o=o=o
</code></pre>


</div>