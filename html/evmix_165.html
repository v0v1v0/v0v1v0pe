<div class="container">

<table style="width: 100%;"><tr>
<td>fgpd</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>MLE Fitting of Generalised Pareto Distribution (GPD)</h2>

<h3>Description</h3>

<p>Maximum likelihood estimation for fitting the GPD with
parameters scale <code>sigmau</code> and shape <code>xi</code> to the threshold
exceedances, conditional on being above a threshold <code>u</code>. Unconditional
likelihood fitting also provided when the probability <code>phiu</code> of being
above the threshold <code>u</code> is given.
</p>


<h3>Usage</h3>

<pre><code class="language-R">fgpd(x, u = 0, phiu = NULL, pvector = NULL, std.err = TRUE,
  method = "BFGS", control = list(maxit = 10000), finitelik = TRUE,
  ...)

lgpd(x, u = 0, sigmau = 1, xi = 0, phiu = 1, log = TRUE)

nlgpd(pvector, x, u = 0, phiu = 1, finitelik = FALSE)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>x</code></td>
<td>
<p>vector of sample data</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>u</code></td>
<td>
<p>scalar threshold</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>phiu</code></td>
<td>
<p>probability of being above threshold <code class="reqn">[0, 1]</code> or <code>NULL</code>, see Details</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>pvector</code></td>
<td>
<p>vector of initial values of GPD parameters (<code>sigmau</code>, <code>xi</code>) or <code>NULL</code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>std.err</code></td>
<td>
<p>logical, should standard errors be calculated</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>method</code></td>
<td>
<p>optimisation method (see <code>optim</code>)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>control</code></td>
<td>
<p>optimisation control list (see <code>optim</code>)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>finitelik</code></td>
<td>
<p>logical, should log-likelihood return finite value for invalid parameters</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>optional inputs passed to <code>optim</code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>sigmau</code></td>
<td>
<p>scalar scale parameter (positive)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>xi</code></td>
<td>
<p>scalar shape parameter</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>log</code></td>
<td>
<p>logical, if <code>TRUE</code> then log-likelihood rather than likelihood is output</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>The GPD is fitted to the exceedances of the threshold <code>u</code> using
maximum likelihood estimation. The estimated parameters, 
variance-covariance matrix and their standard errors are automatically 
output.
</p>
<p>The log-likelihood and negative log-likelihood are also provided for wider 
usage, e.g. constructing your own extreme value mixture model or profile
likelihood functions. The 
parameter vector <code>pvector</code> must be specified in the negative 
log-likelihood <code>nlgpd</code>.
</p>
<p>Log-likelihood calculations are carried out in 
<code>lgpd</code>, which takes parameters as inputs in the 
same form as distribution functions. The negative log-likelihood is a 
wrapper for <code>lgpd</code>, designed towards making it 
useable for optimisation (e.g. parameters are given a vector as first 
input).
</p>
<p>The default value for the tail fraction <code>phiu</code> in the fitting function
<code>fgpd</code> is <code>NULL</code>, in which case the MLE is calculated 
using the sample proportion of exceedances. In this case the standard error for <code>phiu</code> is 
estimated and output as <code>se.phiu</code>, otherwise it is set to <code>NA</code>. Consistent with the 
<code>evd</code> library the missing values (<code>NA</code> and 
<code>NaN</code>) are assumed to be below the threshold in calculating the tail fraction.
</p>
<p>Otherwise, in the fitting function <code>fgpd</code> the tail 
fraction <code>phiu</code> can be specified as any value over <code class="reqn">(0, 1]</code>, i.e.
excludes <code class="reqn">\phi_u=0</code>, leading to the unconditional log-likelihood being
used for estimation. In this case the standard error will be output as <code>NA</code>.
</p>
<p>In the log-likelihood functions <code>lgpd</code> and 
<code>nlgpd</code> the tail fraction <code>phiu</code> cannot be
<code>NULL</code> but can be over the range <code class="reqn">[0, 1]</code>, i.e. which includes
<code class="reqn">\phi_u=0</code>.
</p>
<p>The value of <code>phiu</code> does not effect the GPD parameter estimates, only
the value of the likelihood, as:
</p>
<p style="text-align: center;"><code class="reqn">L(\sigma_u, \xi; u, \phi_u) = (\phi_u ^ {n_u}) L(\sigma_u, \xi; u,
  \phi_u=1)</code>
</p>

<p>where the GPD has scale <code class="reqn">\sigma_u</code> and shape <code class="reqn">\xi</code>, the threshold
is <code class="reqn">u</code> and <code class="reqn">nu</code> is the number of exceedances. A non-unit value for
<code>phiu</code> simply scales the likelihood and shifts the log-likelihood,
thus the GPD parameter estimates are invariant to <code>phiu</code>.
</p>
<p>The default optimisation algorithm is "BFGS", which requires a finite
negative log-likelihood function evaluation <code>finitelik=TRUE</code>. For
invalid parameters, a zero likelihood is replaced with <code>exp(-1e6)</code>.
The "BFGS" optimisation algorithms require finite values for likelihood, so
any user input for <code>finitelik</code> will be overridden and set to
<code>finitelik=TRUE</code> if either of these optimisation methods is chosen.
</p>
<p>It will display a warning for non-zero convergence result comes from 
<code>optim</code> function call.
</p>
<p>If the hessian is of reduced rank then the variance covariance (from
inverse hessian) and standard error of parameters cannot be calculated,
then by default <code>std.err=TRUE</code> and the function will stop. If you want
the parameter estimates even if the hessian is of reduced rank (e.g. in a
simulation study) then set <code>std.err=FALSE</code>.
</p>


<h3>Value</h3>

<p><code>lgpd</code> gives (log-)likelihood and 
<code>nlgpd</code> gives the negative log-likelihood. 
<code>fgpd</code> returns a simple list with the following
elements
</p>

<table>
<tr>
<td style="text-align: left;">
<code>call</code>:     </td>
<td style="text-align: left;"> <code>optim</code> call</td>
</tr>
<tr>
<td style="text-align: left;">
<code>x</code>:        </td>
<td style="text-align: left;"> data vector <code>x</code>
</td>
</tr>
<tr>
<td style="text-align: left;">
<code>init</code>:     </td>
<td style="text-align: left;"> <code>pvector</code>
</td>
</tr>
<tr>
<td style="text-align: left;">
<code>optim</code>:    </td>
<td style="text-align: left;"> complete <code>optim</code> output</td>
</tr>
<tr>
<td style="text-align: left;">
<code>mle</code>:      </td>
<td style="text-align: left;"> vector of MLE of parameters</td>
</tr>
<tr>
<td style="text-align: left;">
<code>cov</code>:      </td>
<td style="text-align: left;"> variance-covariance matrix of MLE of parameters</td>
</tr>
<tr>
<td style="text-align: left;">
<code>se</code>:       </td>
<td style="text-align: left;"> vector of standard errors of MLE of parameters</td>
</tr>
<tr>
<td style="text-align: left;">
<code>rate</code>:     </td>
<td style="text-align: left;"> <code>phiu</code> to be consistent with <code>evd</code>
</td>
</tr>
<tr>
<td style="text-align: left;">
<code>nllh</code>:     </td>
<td style="text-align: left;"> minimum negative log-likelihood</td>
</tr>
<tr>
<td style="text-align: left;">
<code>n</code>:        </td>
<td style="text-align: left;"> total sample size</td>
</tr>
<tr>
<td style="text-align: left;">
<code>u</code>:        </td>
<td style="text-align: left;"> threshold</td>
</tr>
<tr>
<td style="text-align: left;">
<code>sigmau</code>:   </td>
<td style="text-align: left;"> MLE of GPD scale</td>
</tr>
<tr>
<td style="text-align: left;">
<code>xi</code>:       </td>
<td style="text-align: left;"> MLE of GPD shape</td>
</tr>
<tr>
<td style="text-align: left;">
<code>phiu</code>:     </td>
<td style="text-align: left;"> MLE of tail fraction</td>
</tr>
<tr>
<td style="text-align: left;">
<code>se.phiu</code>:  </td>
<td style="text-align: left;"> standard error of MLE of tail fraction (parameterised approach using sample proportion)</td>
</tr>
<tr>
<td style="text-align: left;">
</td>
</tr>
</table>
<p>The output list has some duplicate entries and repeats some of the inputs to both 
provide similar items to those from <code>fpot</code> and increase usability.
</p>


<h3>Acknowledgments</h3>

<p>Based on the <code>gpd.fit</code> and
<code>fpot</code> functions in the 
<code>ismev</code> and
<code>evd</code> packages for which their author's contributions are gratefully acknowledged.
They are designed to have similar syntax and functionality to simplify the transition for users of these packages.
</p>


<h3>Note</h3>

<p>Unlike all the distribution functions for the GPD, the MLE fitting only
permits single scalar values for each parameter, <code>phiu</code> and threshold
<code>u</code>.
</p>
<p>When <code>pvector=NULL</code> then the initial values are calculated, type
<code>fgpd</code> to see the default formulae used. The GPD fitting is not very
sensitive to the initial values, so you will rarely have to  give
alternatives. Avoid setting the starting value for the shape parameter to
<code>xi=0</code> as depending on the optimisation method it may be get stuck.
</p>
<p>Default values for the threshold <code>u=0</code> and tail fraction
<code>phiu=NULL</code> are given in the fitting <code>fpgd</code>,
in which case the MLE assumes that excesses over the threshold are given,
rather than exceedances.
</p>
<p>The usual default of <code>phiu=1</code> is given in the likelihood functions
<code>lpgd</code> and <code>nlpgd</code>.
</p>
<p>The <code>lgpd</code> also has the usual defaults for the
other parameters, but <code>nlgpd</code> has no defaults.
</p>
<p>Infinite sample values are dropped in fitting function
<code>fpgd</code>, but missing values are used to estimate
<code>phiu</code> as described above. But in likelihood functions
<code>lpgd</code> and <code>nlpgd</code> both
infinite and missing values are ignored.
</p>
<p>Error checking of the inputs is carried out and will either stop or give
warning message as appropriate.
</p>


<h3>Author(s)</h3>

<p>Yang Hu and Carl Scarrott <a href="mailto:carl.scarrott@canterbury.ac.nz">carl.scarrott@canterbury.ac.nz</a>
</p>


<h3>References</h3>

<p><a href="http://en.wikipedia.org/wiki/Generalized_Pareto_distribution">http://en.wikipedia.org/wiki/Generalized_Pareto_distribution</a>
</p>
<p>Hu Y. and Scarrott, C.J. (2018). evmix: An R Package for Extreme Value Mixture Modeling, 
Threshold Estimation and Boundary Corrected Kernel Density Estimation. Journal of
Statistical Software 84(5), 1-27. doi: 10.18637/jss.v084.i05.
</p>


<h3>See Also</h3>

<p><code>dgpd</code>, <code>fpot</code> and
<code>fitdistr</code>
</p>
<p>Other gpd: <code>gpd</code>
</p>
<p>Other fgpd: <code>gpd</code>
</p>


<h3>Examples</h3>

<pre><code class="language-R">set.seed(1)
par(mfrow = c(2, 1))

# GPD is conditional model for threshold exceedances
# so tail fraction phiu not relevant when only have exceedances
x = rgpd(1000, u = 10, sigmau = 5, xi = 0.2)
xx = seq(0, 100, 0.1)
hist(x, breaks = 100, freq = FALSE, xlim = c(0, 100))
lines(xx, dgpd(xx, u = 10, sigmau = 5, xi = 0.2))
fit = fgpd(x, u = 10)
lines(xx, dgpd(xx, u = fit$u, sigmau = fit$sigmau, xi = fit$xi), col="red")

# but tail fraction phiu is needed for conditional modelling of population tail
x = rnorm(10000)
xx = seq(-4, 4, 0.01)
hist(x, breaks = 200, freq = FALSE, xlim = c(0, 4))
lines(xx, dnorm(xx), lwd = 2)
fit = fgpd(x, u = 1)
lines(xx, dgpd(xx, u = fit$u, sigmau = fit$sigmau, xi = fit$xi, phiu = fit$phiu),
  col = "red", lwd = 2)
legend("topright", c("True Density","Fitted Density"), col=c("black", "red"), lty = 1)

</code></pre>


</div>