<div class="container">

<table style="width: 100%;"><tr>
<td>ec.util</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Utility functions</h2>

<h3>Description</h3>

<p>tabset, table layout, support for GIS shapefiles through library 'sf'
</p>


<h3>Usage</h3>

<pre><code class="language-R">ec.util(..., cmd = "sf.series", js = NULL)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>Optional parameters for the command <br>
for <em>sf.series</em> - see <a href="https://echarts.apache.org/en/option.html#series-scatter.type">points</a>, <a href="https://echarts.apache.org/en/option.html#series-lines.type">polylines</a>, polygons(itemStyle).<br>
for <em>tabset</em> parameters should be in format <em>name1=chart1, name2=chart2</em>, see example<br></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>cmd</code></td>
<td>
<p>utility command, see Details<br></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>js</code></td>
<td>
<p>optional JavaScript function, default is NULL.<br></p>
</td>
</tr>
</table>
<h3>Details</h3>

<p><strong>cmd = 'sf.series'</strong><br><code style="white-space: pre;">⁠ ⁠</code>Build <em>leaflet</em> or <a href="https://echarts.apache.org/en/option.html#geo.map">geo</a> map series from shapefiles.<br><code style="white-space: pre;">⁠ ⁠</code>Supported types: POINT, MULTIPOINT, LINESTRING, MULTILINESTRING, POLYGON, MULTIPOLYGON <br><code style="white-space: pre;">⁠ ⁠</code>Coordinate system is <em>leaflet</em>(default), <em>geo</em> or <em>cartesian3D</em> (for POINT(xyz))<br><code style="white-space: pre;">⁠ ⁠</code>Limitations:<br><code style="white-space: pre;">⁠     ⁠</code>polygons can have only their name in tooltip,  <br><code style="white-space: pre;">⁠     ⁠</code>assumes Geodetic CRS is WGS 84, for conversion use st_transform with <em>crs=4326</em>.<br><code style="white-space: pre;">⁠ ⁠</code>Parameters:<br><code style="white-space: pre;">⁠   ⁠</code>df - value from st_read<br><code style="white-space: pre;">⁠   ⁠</code>nid - optional column name for name-id used in tooltips<br><code style="white-space: pre;">⁠   ⁠</code>cs - optional <em>coordinateSystem</em> value, default 'leaflet'<br><code style="white-space: pre;">⁠   ⁠</code>verbose - optional, print shapefile item names in console<br><code style="white-space: pre;">⁠ ⁠</code>Returns a list of chart series<br><strong>cmd = 'sf.bbox'</strong><br><code style="white-space: pre;">⁠ ⁠</code>Returns JavaScript code to position a map inside a bounding box from st_bbox, for leaflet only.<br><strong>cmd = 'sf.unzip'</strong><br><code style="white-space: pre;">⁠ ⁠</code>Unzips a remote file and returns local file name of the unzipped .shp file<br><code style="white-space: pre;">⁠   ⁠</code>url - URL of remote zipped shapefile<br><code style="white-space: pre;">⁠   ⁠</code>shp - optional name of .shp file inside ZIP file if multiple exist. Do not add file extension. <br><strong>cmd = 'geojson'</strong> <br><code style="white-space: pre;">⁠ ⁠</code>Custom series list from geoJson objects<br><code style="white-space: pre;">⁠   ⁠</code>geojson - object from fromJSON<br><code style="white-space: pre;">⁠   ⁠</code>cs - optional <em>coordinateSystem</em> value, default 'leaflet'<br><code style="white-space: pre;">⁠   ⁠</code>ppfill - optional fill color like '#F00', OR NULL for no-fill, for all Points and Polygons<br><code style="white-space: pre;">⁠   ⁠</code>nid - optional feature property for item name used in tooltips<br><code style="white-space: pre;">⁠   ⁠</code>... - optional custom series attributes like <em>itemStyle</em><br><code style="white-space: pre;">⁠ ⁠</code>Can display also geoJson <em>feature properties</em>: color; lwidth, ldash (lines); ppfill, radius (points)<br><strong>cmd = 'layout'</strong> <br><code style="white-space: pre;">⁠ ⁠</code>Multiple charts in table-like rows/columns format<br><code style="white-space: pre;">⁠   ⁠</code>... - List of charts<br><code style="white-space: pre;">⁠   ⁠</code>title - optional title for the set, rows= Number of rows, cols= Number of columns<br><code style="white-space: pre;">⁠ ⁠</code>Returns a container div in rmarkdown, otherwise browsable.<br><code style="white-space: pre;">⁠ ⁠</code>For 3-4 charts one would use multiple series within a <a href="https://echarts.apache.org/en/option.html#grid">grid</a>. <br><code style="white-space: pre;">⁠ ⁠</code>For greater number of charts <em>ec.util(cmd='layout')</em> comes in handy<br><strong>cmd = 'tabset'</strong> <br><code style="white-space: pre;">⁠   ⁠</code>... - a list name/chart pairs like <em>n1=chart1, n2=chart2</em>, each tab may contain a chart.<br><code style="white-space: pre;">⁠   ⁠</code>tabStyle - tab style string, see default <em>tabStyle</em> variable in the code<br><code style="white-space: pre;">⁠ ⁠</code>Returns A) tagList of tabs when in a pipe without '...' params, see example<br><code style="white-space: pre;">⁠ ⁠</code>Returns B) browsable when '...' params are provided by user<br><strong>cmd = 'button'</strong> <br><code style="white-space: pre;">⁠ ⁠</code>UI button to execute a JS function,<br><code style="white-space: pre;">⁠   ⁠</code>text - the button label<br><code style="white-space: pre;">⁠   ⁠</code>js - the JS function string<br><code style="white-space: pre;">⁠   ⁠</code>... - optional parameters for the <a href="https://echarts.apache.org/en/option.html#graphic.elements-rect.type">rect</a> element<br><code style="white-space: pre;">⁠ ⁠</code>Returns a graphic.elements-<a href="https://echarts.apache.org/en/option.html#graphic.elements-rect.type">rect</a> element.<br><strong>cmd = 'morph'</strong> <br><code style="white-space: pre;">⁠   ⁠</code>... - a list of charts or chart options<br><code style="white-space: pre;">⁠   ⁠</code>js - optional JS function for switching charts. Default function is on <em>mouseover</em>. Disable with FALSE.<br><code style="white-space: pre;">⁠ ⁠</code>Returns a chart with ability to morph into other charts<br><strong>cmd = 'fullscreen'</strong> <br><code style="white-space: pre;">⁠ ⁠</code>A toolbox feature to toggle fullscreen on/off. Works in a browser, not in RStudio.<br><strong>cmd = 'rescale'</strong> <br><code style="white-space: pre;">⁠   ⁠</code>v - input vector of numeric values to rescale<br><code style="white-space: pre;">⁠   ⁠</code>t - target range c(min,max), numeric vector of two<br><strong>cmd = 'level'</strong> <br><code style="white-space: pre;">⁠ ⁠</code>Calculate vertical levels for timeline <em>line</em> charts, returns a numeric vector<br><code style="white-space: pre;">⁠   ⁠</code>df - data.frame with <em>from</em> and <em>to</em> columns<br><code style="white-space: pre;">⁠   ⁠</code>from - name of 'from' column<br><code style="white-space: pre;">⁠   ⁠</code>to - name of 'to' column<br></p>


<h3>Examples</h3>

<pre><code class="language-R">if (interactive()) {  # comm.out: Fedora errors about some 'browser'
  library(sf)
  fname &lt;- system.file("shape/nc.shp", package="sf")
  nc &lt;- as.data.frame(st_read(fname))
  ec.init(load= c('leaflet', 'custom'),  # load custom for polygons
     js= ec.util(cmd= 'sf.bbox', bbox= st_bbox(nc$geometry)),
     series= ec.util(cmd= 'sf.series', df= nc, nid= 'NAME', itemStyle= list(opacity=0.3)),
     tooltip= list(formatter= '{a}')
  )

  htmltools::browsable(
    lapply(iris |&gt; dplyr::group_by(Species) |&gt; dplyr::group_split(), 
           function(x) {
     x |&gt; ec.init(ctype= 'scatter', title= list(text= unique(x$Species)))
           }) |&gt; 
    ec.util(cmd= 'tabset')
  )

  p1 &lt;- cars |&gt; ec.init(grid= list(top= 20))  # move chart up
  p2 &lt;- mtcars |&gt; ec.init()
  ec.util(cmd= 'tabset', cars= p1, mtcars= p2, width= 333, height= 333)

  lapply(list('dark','macarons','gray','jazz','dark-mushroom'),
                \(x) cars |&gt; ec.init() |&gt; ec.theme(x) ) |&gt;
  ec.util(cmd='layout', cols= 2, title= 'my layout')
  
  setd &lt;- \(type) {
	   mtcars |&gt; group_by(cyl) |&gt; 
	 ec.init(ctype= type,
		  title= list(subtext= 'mouseover points to morph'),
		  xAxis= list(scale= TRUE))
  }
  oscatter &lt;- setd('scatter')
  obar &lt;- setd('bar')
  ec.util(cmd='morph', oscatter, obar)
}
</code></pre>


</div>